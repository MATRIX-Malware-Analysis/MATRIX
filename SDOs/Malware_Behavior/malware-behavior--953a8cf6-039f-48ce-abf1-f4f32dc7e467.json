{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--953a8cf6-039f-48ce-abf1-f4f32dc7e467",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.458503Z",
    "name": "Impair Defenses: Disable or Modify System Firewall",
    "description": "Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage. Changes could be disabling the entire mechanism as well as adding, deleting, or modifying particular rules. This can be done numerous ways depending on the operating system, including via command-line, editing Windows Registry keys, and Windows Control Panel.Modifying or disabling a system firewall may enable adversary C2 communications, lateral movement, and/or data exfiltration that would otherwise not be allowed. For example, adversaries may add a new firewall rule for a well-known protocol (such as RDP) using a non-traditional and potentially less securitized port (i.e. Non-Standard Port).[1]Adversaries may also modify host networking settings that indirectly manipulate system firewalls, such as interface bandwidth or network connection request thresholds.[2] Settings related to enabling abuse of various Remote Services may also indirectly modify firewall rules.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1562/004",
            "external_id": "T1562/004"
        },
        {
            "source_name": "CAPEC 578",
            "external_id": "malware-behavior--2f8f9894-8e67-43f6-99d5-2527cce30d1c"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "os": "linux"
                            },
                            {
                                "api": "system"
                            },
                            {
                                "substring": "iptables"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Software Discovery::Security Software Discovery [T1518.001]",
                        "Defense Evasion::Impair Defenses::Disable or Modify System Firewall [T1562.004]"
                    ],
                    "authors": [
                        "joakim@intezer.com"
                    ],
                    "name": "interact with iptables",
                    "namespace": "host-interaction/firewall",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "api": "ole32.CoCreateInstance"
                            },
                            {
                                "bytes": "42 E9 4C 30 39 6E D8 40 94 3A B9 13 C4 0C 9C D4 = CLSID_NetFwMgr"
                            },
                            {
                                "bytes": "F5 8A 89 F7 C4 CA 32 46 A2 EC DA 06 E5 11 1A F2 = IID_INetFwMgr"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Software Discovery::Security Software Discovery [T1518.001]",
                        "Defense Evasion::Impair Defenses::Disable or Modify System Firewall [T1562.004]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "EB355BD63BDDCE02955792B4CD6539FB:0x10003927"
                    ],
                    "name": "access firewall settings via INetFwMgr",
                    "namespace": "host-interaction/firewall/modify",
                    "scopes": {
                        "dynamic": "unsupported",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/08/08",
            "description": "Identifies when a firewall is created, modified, or deleted.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName": [
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/WRITE",
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/DELETE"
                    ]
                }
            },
            "falsepositives": [
                "Firewall being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "Firewall modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "512cf937-ea9b-4332-939c-4c2c94baadcd",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/08/23",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Azure Firewall Modified or Deleted"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/08/08",
            "description": "Identifies when Rule Collections (Application, NAT, and Network) is being modified or deleted.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName": [
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/APPLICATIONRULECOLLECTIONS/WRITE",
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/APPLICATIONRULECOLLECTIONS/DELETE",
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/NATRULECOLLECTIONS/WRITE",
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/NATRULECOLLECTIONS/DELETE",
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/NETWORKRULECOLLECTIONS/WRITE",
                        "MICROSOFT.NETWORK/AZUREFIREWALLS/NETWORKRULECOLLECTIONS/DELETE"
                    ]
                }
            },
            "falsepositives": [
                "Rule Collections (Application, NAT, and Network) being modified or deleted may be performed by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "Rule Collections (Application, NAT, and Network) modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "025c9fe7-db72-49f9-af0d-31341dd7dd57",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/08/23",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Azure Firewall Rule Collection Modified or Deleted"
        },
        {
            "author": "Sander Wiebing, Jonhnathan Ribeiro, Daniil Yugoslavskiy, oscd.community",
            "date": "2020/05/25",
            "description": "Detects Netsh command execution that whitelists a program located in a suspicious location in the Windows Firewall",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": [
                    {
                        "CommandLine|contains|all": [
                            "firewall",
                            "add",
                            "allowedprogram"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "advfirewall",
                            "firewall",
                            "add",
                            "rule",
                            "action=allow",
                            "program="
                        ]
                    }
                ],
                "selection_img": [
                    {
                        "Image|endswith": "\\netsh.exe"
                    },
                    {
                        "OriginalFileName": "netsh.exe"
                    }
                ],
                "selection_paths": {
                    "CommandLine|contains": [
                        ":\\$Recycle.bin\\",
                        ":\\RECYCLER.BIN\\",
                        ":\\RECYCLERS.BIN\\",
                        ":\\SystemVolumeInformation\\",
                        ":\\Temp\\",
                        ":\\Users\\Default\\",
                        ":\\Users\\Desktop\\",
                        ":\\Users\\Public\\",
                        ":\\Windows\\addins\\",
                        ":\\Windows\\cursors\\",
                        ":\\Windows\\debug\\",
                        ":\\Windows\\drivers\\",
                        ":\\Windows\\fonts\\",
                        ":\\Windows\\help\\",
                        ":\\Windows\\system32\\tasks\\",
                        ":\\Windows\\Tasks\\",
                        ":\\Windows\\Temp\\",
                        "\\Downloads\\",
                        "\\Local Settings\\Temporary Internet Files\\",
                        "\\Temporary Internet Files\\Content.Outlook\\",
                        "%Public%\\",
                        "%TEMP%",
                        "%TMP%"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a35f5a72-f347-4e36-8895-9869b0d5fc6d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/11",
            "references": [
                "https://www.virusradar.com/en/Win32_Kasidet.AD/description",
                "https://www.hybrid-analysis.com/sample/07e789f4f2f3259e7559fdccb36e96814c2dbff872a21e1fa03de9ee377d581f?environmentId=100"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Suspicious Program Location Whitelisted In Firewall Via Netsh.EXE"
        },
        {
            "author": "Sander Wiebing",
            "date": "2020/05/23",
            "description": "Detects usage of the netsh command to open and allow connections to port 3389 (RDP). As seen used by Sarwent Malware",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        "portopening",
                        "allow"
                    ],
                    "CommandLine|contains|all": [
                        "firewall ",
                        "add ",
                        "tcp ",
                        "3389"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\netsh.exe"
                    },
                    {
                        "OriginalFileName": "netsh.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administration activity"
            ],
            "id": "01aeb693-138d-49d2-9403-c4f52d7d3d62",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/11",
            "references": [
                "https://labs.sentinelone.com/sarwent-malware-updates-command-detonation/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "RDP Connection Allowed Via Netsh.EXE"
        },
        {
            "author": "frack113",
            "date": "2022/01/09",
            "description": "Adversaries may modify system firewalls in order to bypass controls limiting network usage",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "advfirewall",
                        "firewall",
                        "set",
                        "rule",
                        "group=",
                        "new",
                        "enable=Yes"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\netsh.exe"
                    },
                    {
                        "OriginalFileName": "netsh.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administration activity"
            ],
            "id": "347906f3-e207-4d18-ae5b-a9403d6bcdef",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md#atomic-test-3---allow-smb-and-rdp-on-microsoft-defender-firewall",
                "https://learn.microsoft.com/en-us/troubleshoot/windows-server/networking/netsh-advfirewall-firewall-control-firewall-behavior"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Netsh Allow Group Policy on Microsoft Defender Firewall"
        },
        {
            "author": "Markus Neis, Sander Wiebing",
            "date": "2019/01/29",
            "description": "Detects the addition of a new rule to the Windows firewall via netsh",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_optional_*",
                "filter_optional_dropbox": {
                    "CommandLine|contains": [
                        "advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=?:\\Program Files (x86)\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any",
                        "advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=?:\\Program Files\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\netsh.exe"
                    },
                    {
                        "OriginalFileName": "netsh.exe"
                    }
                ],
                "selection_cli": {
                    "CommandLine|contains|all": [
                        " firewall ",
                        " add "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration activity",
                "Software installations"
            ],
            "id": "cd5cfd80-aa5f-44c0-9c20-108c4ae12e3c",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/10",
            "references": [
                "https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-RAT-and-Staging-Report.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004",
                "attack.s0246"
            ],
            "title": "New Firewall Rule Added Via Netsh.EXE"
        },
        {
            "author": "Fatih Sirin",
            "date": "2019/11/01",
            "description": "Detects netsh commands that turns off the Windows firewall",
            "detection": {
                "condition": "selection_img and 1 of selection_cli_*",
                "selection_cli_1": {
                    "CommandLine|contains|all": [
                        "firewall",
                        "set",
                        "opmode",
                        "disable"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\netsh.exe"
                    },
                    {
                        "OriginalFileName": "netsh.exe"
                    }
                ],
                "selection_cli_2": {
                    "CommandLine|contains|all": [
                        "advfirewall",
                        "set",
                        "state",
                        "off"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration activity"
            ],
            "id": "57c4bf16-227f-4394-8ec7-1b745ee061c3",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/13",
            "references": [
                "https://www.winhelponline.com/blog/enable-and-disable-windows-firewall-quickly-using-command-line/",
                "https://app.any.run/tasks/210244b9-0b6b-4a2c-83a3-04bd3175d017/",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md#atomic-test-1---disable-microsoft-defender-firewall"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004",
                "attack.s0108"
            ],
            "title": "Firewall Disabled via Netsh.EXE"
        },
        {
            "author": "frack113",
            "date": "2022/08/14",
            "description": "Detects the removal of a port or application rule in the Windows Firewall configuration using netsh",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_optional_*",
                "filter_optional_dropbox": {
                    "CommandLine|contains": "name=Dropbox",
                    "ParentImage|endswith": "\\Dropbox.exe"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\netsh.exe"
                    },
                    {
                        "OriginalFileName": "netsh.exe"
                    }
                ],
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "firewall",
                        "delete "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration activity",
                "Software installations and removal"
            ],
            "id": "1a5fefe6-734f-452e-a07d-fc1c35bce4b2",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/10",
            "references": [
                "https://app.any.run/tasks/8bbd5b4c-b82d-4e6d-a3ea-d454594a37cc/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Firewall Rule Deleted Via Netsh.EXE"
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2024/05/10",
            "description": "Detects the addition of a new \"Allow\" firewall rule by the WMI process (WmiPrvSE.EXE).\nThis can occur if an attacker leverages PowerShell cmdlets such as \"New-NetFirewallRule\", or directly uses WMI CIM classes such as \"MSFT_NetFirewallRule\".\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Action": 3,
                    "EventID": [
                        2004,
                        2071,
                        2097
                    ],
                    "ModifyingApplication|endswith": ":\\Windows\\System32\\wbem\\WmiPrvSE.exe"
                }
            },
            "falsepositives": [
                "Administrator scripts or activity."
            ],
            "id": "eca81e8d-09e1-4d04-8614-c91f44fd0519",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1562.004/T1562.004.md#atomic-test-24---set-a-firewall-rule-using-new-netfirewallrule",
                "https://malware.news/t/the-rhysida-ransomware-activity-analysis-and-ties-to-vice-society/72170",
                "https://cybersecuritynews.com/rhysida-ransomware-attacking-windows/"
            ],
            "status": "experimental",
            "title": "New Firewall Rule Added In Windows Firewall Exception List Via WmiPrvSE.EXE",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/02/19",
            "description": "Detects when a rule has been added to the Windows Firewall exception list",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_block": {
                    "Action": 2
                },
                "filter_main_covered_paths": {
                    "ApplicationPath|contains": [
                        ":\\PerfLogs\\",
                        ":\\Temp\\",
                        ":\\Tmp\\",
                        ":\\Users\\Public\\",
                        ":\\Windows\\Tasks\\",
                        ":\\Windows\\Temp\\",
                        "\\AppData\\Local\\Temp\\"
                    ]
                },
                "filter_main_generic": {
                    "ApplicationPath|contains": [
                        ":\\Program Files (x86)\\",
                        ":\\Program Files\\",
                        ":\\Windows\\System32\\",
                        ":\\Windows\\SysWOW64\\",
                        ":\\Windows\\WinSxS\\"
                    ]
                },
                "filter_optional_msmpeng": {
                    "ModifyingApplication|contains|all": [
                        ":\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                        "\\MsMpEng.exe"
                    ]
                },
                "selection": {
                    "EventID": [
                        2004,
                        2071,
                        2097
                    ]
                }
            },
            "id": "cde0a575-7d3d-4a49-9817-b8004a7bf105",
            "level": "medium",
            "modified": "2024/05/10",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
            ],
            "status": "experimental",
            "title": "Uncommon New Firewall Rule Added In Windows Firewall Exception List",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/02/19",
            "description": "Detects activity when The Windows Defender Firewall service failed to load Group Policy",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 2009
                }
            },
            "id": "7ec15688-fd24-4177-ba43-1a950537ee39",
            "level": "low",
            "modified": "2023/01/17",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
            ],
            "status": "test",
            "title": "The Windows Defender Firewall Service Failed To Load Group Policy",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/17",
            "description": "Detects when a all the rules have been deleted from the Windows Defender Firewall configuration",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_svchost": {
                    "ModifyingApplication|endswith": ":\\Windows\\System32\\svchost.exe"
                },
                "selection": {
                    "EventID": [
                        2033,
                        2059
                    ]
                },
                "filter_optional_msmpeng": {
                    "ModifyingApplication|contains|all": [
                        ":\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                        "\\MsMpEng.exe"
                    ]
                }
            },
            "id": "79609c82-a488-426e-abcf-9f341a39365d",
            "level": "high",
            "modified": "2024/01/22",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
            ],
            "status": "experimental",
            "title": "All Rules Have Been Deleted From The Windows Firewall Configuration",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/02/19",
            "description": "Detects when a single rules or all of the rules have been deleted from the Windows Defender Firewall",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_empty": {
                    "ModifyingApplication": ""
                },
                "filter_main_generic": {
                    "ModifyingApplication|startswith": [
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "filter_main_null": {
                    "ModifyingApplication": null
                },
                "filter_main_svchost": {
                    "ModifyingApplication": "C:\\Windows\\System32\\svchost.exe"
                },
                "filter_optional_msmpeng": {
                    "ModifyingApplication|endswith": "\\MsMpEng.exe",
                    "ModifyingApplication|startswith": "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\"
                },
                "selection": {
                    "EventID": [
                        2006,
                        2052
                    ]
                }
            },
            "id": "c187c075-bb3e-4c62-b4fa-beae0ffc211f",
            "level": "medium",
            "modified": "2023/06/12",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
            ],
            "status": "test",
            "title": "A Rule Has Been Deleted From The Windows Firewall Exception List",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/02/19",
            "description": "Detects activity when Windows Defender Firewall has been reset to its default configuration",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        2032,
                        2060
                    ]
                }
            },
            "id": "04b60639-39c0-412a-9fbe-e82499c881a3",
            "level": "low",
            "modified": "2023/04/21",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
            ],
            "status": "test",
            "title": "Windows Defender Firewall Has Been Reset To Its Default Configuration",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/02/19",
            "description": "Detects activity when the settings of the Windows firewall have been changed",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        2002,
                        2083,
                        2003,
                        2082,
                        2008
                    ]
                }
            },
            "id": "00bb5bd5-1379-4fcf-a965-a5b6f7478064",
            "level": "low",
            "modified": "2023/04/21",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)"
            ],
            "status": "test",
            "title": "Windows Firewall Settings Have Been Changed",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "frack113",
            "date": "2023/02/26",
            "description": "Detects the addition of a new rule to the Windows Firewall exception list for an application located in a potentially suspicious location.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_block": {
                    "Action": 2
                },
                "selection": {
                    "ApplicationPath|contains": [
                        ":\\PerfLogs\\",
                        ":\\Temp\\",
                        ":\\Tmp\\",
                        ":\\Users\\Public\\",
                        ":\\Windows\\Tasks\\",
                        ":\\Windows\\Temp\\",
                        "\\AppData\\Local\\Temp\\"
                    ],
                    "EventID": [
                        2004,
                        2071,
                        2097
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "9e2575e7-2cb9-4da1-adc8-ed94221dca5e",
            "level": "high",
            "modified": "2024/05/10",
            "logsource": {
                "product": "windows",
                "service": "firewall-as"
            },
            "status": "experimental",
            "references": [
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd364427(v=ws.10)",
                "https://app.any.run/tasks/7123e948-c91e-49e0-a813-00e8d72ab393/#"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "cde0a575-7d3d-4a49-9817-b8004a7bf105"
                }
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "New Firewall Rule Added In Windows Firewall Exception List For Potential Suspicious Application"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/10/12",
            "description": "Detects when a user disables the Windows Firewall via a Profile to help evade defense.",
            "detection": {
                "condition": "all of selection*",
                "selection_args": {
                    "ScriptBlockText|contains|all": [
                        "Set-NetFirewallProfile ",
                        " -Enabled ",
                        " False"
                    ]
                },
                "selection_opt": {
                    "ScriptBlockText|contains": [
                        " -All ",
                        "Public",
                        "Domain",
                        "Private"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "488b44e7-3781-4a71-888d-c95abfacf44d",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/30",
            "references": [
                "https://learn.microsoft.com/en-us/powershell/module/netsecurity/set-netfirewallprofile?view=windowsserver2022-ps",
                "https://www.tutorialspoint.com/how-to-get-windows-firewall-profile-settings-using-powershell",
                "http://powershellhelp.space/commands/set-netfirewallrule-psv5.php",
                "http://woshub.com/manage-windows-firewall-powershell/",
                "https://www.elastic.co/guide/en/security/current/windows-firewall-disabled-via-powershell.html"
            ],
            "related": [
                {
                    "id": "12f6b752-042d-483e-bf9c-915a6d06ad75",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Windows Firewall Profile Disabled"
        },
        {
            "author": "frack113",
            "date": "2022/01/09",
            "description": "Adversaries may disable or modify system firewalls in order to bypass controls limiting network usage",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "DWORD (0x00000000)",
                    "TargetObject|contains": "\\Services\\SharedAccess\\Parameters\\FirewallPolicy\\",
                    "TargetObject|endswith": "\\EnableFirewall"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "974515da-6cc5-4c95-ae65-f97f9150ec7f",
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2024/03/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md#atomic-test-2---disable-microsoft-defender-firewall-via-registry"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Disable Microsoft Defender Firewall via Registry"
        },
        {
            "author": "frack113",
            "date": "2022/08/19",
            "description": "Detect set EnableFirewall to 0 to disable the Windows firewall",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "DWORD (0x00000000)",
                    "TargetObject|endswith": [
                        "\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\StandardProfile\\EnableFirewall",
                        "\\SOFTWARE\\Policies\\Microsoft\\WindowsFirewall\\DomainProfile\\EnableFirewall"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "e78c408a-e2ea-43cd-b5ea-51975cf358c0",
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1562.004/T1562.004.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Disable Windows Firewall by Registry"
        },
        {
            "author": "Joseliyo Sanchez, @Joseliyo_Jstnk",
            "date": "2023/01/18",
            "description": "Detect use of iptables to flush all firewall rules, tables and chains and allow all network traffic",
            "detection": {
                "condition": "all of selection_*",
                "selection_img": {
                    "Image|endswith": [
                        "/iptables",
                        "/xtables-legacy-multi",
                        "/iptables-legacy-multi",
                        "/ip6tables",
                        "/ip6tables-legacy-multi"
                    ]
                },
                "selection_params": {
                    "CommandLine|contains": [
                        "-F",
                        "-Z",
                        "-X"
                    ]
                },
                "selection_ufw": {
                    "CommandLine|contains": [
                        "ufw-logging-deny",
                        "ufw-logging-allow",
                        "ufw6-logging-deny",
                        "ufw6-logging-allow"
                    ]
                }
            },
            "falsepositives": [
                "Network administrators"
            ],
            "id": "3be619f4-d9ec-4ea8-a173-18fdd01996ab",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://blogs.blackberry.com/",
                "https://www.cyberciti.biz/tips/linux-iptables-how-to-flush-all-rules.html",
                "https://twitter.com/Joseliyo_Jstnk/status/1620131033474822144"
            ],
            "status": "test",
            "title": "Flush Iptables Ufw Chain",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "\u00d6mer G\u00fcnal, Alejandro Ortuno, oscd.community",
            "date": "2020/06/17",
            "description": "Detects disabling security tools",
            "detection": {
                "condition": "1 of selection*",
                "selection_carbonblack_1": {
                    "CommandLine|contains|all": [
                        "cbdaemon",
                        "stop"
                    ],
                    "Image|endswith": "/service"
                },
                "selection_carbonblack_2": {
                    "CommandLine|contains|all": [
                        "cbdaemon",
                        "off"
                    ],
                    "Image|endswith": "/chkconfig"
                },
                "selection_carbonblack_3": {
                    "CommandLine|contains|all": [
                        "cbdaemon",
                        "stop"
                    ],
                    "Image|endswith": "/systemctl"
                },
                "selection_carbonblack_4": {
                    "CommandLine|contains|all": [
                        "cbdaemon",
                        "disable"
                    ],
                    "Image|endswith": "/systemctl"
                },
                "selection_crowdstrike_1": {
                    "CommandLine|contains|all": [
                        "stop",
                        "falcon-sensor"
                    ],
                    "Image|endswith": "/systemctl"
                },
                "selection_crowdstrike_2": {
                    "CommandLine|contains|all": [
                        "disable",
                        "falcon-sensor"
                    ],
                    "Image|endswith": "/systemctl"
                },
                "selection_firewall_1": {
                    "CommandLine|contains|all": [
                        "firewalld",
                        "stop"
                    ],
                    "Image|endswith": "/systemctl"
                },
                "selection_firewall_2": {
                    "CommandLine|contains|all": [
                        "firewalld",
                        "disable"
                    ],
                    "Image|endswith": "/systemctl"
                },
                "selection_iptables_1": {
                    "CommandLine|contains|all": [
                        "iptables",
                        "stop"
                    ],
                    "Image|endswith": "/service"
                },
                "selection_iptables_2": {
                    "CommandLine|contains|all": [
                        "ip6tables",
                        "stop"
                    ],
                    "Image|endswith": "/service"
                },
                "selection_iptables_3": {
                    "CommandLine|contains|all": [
                        "iptables",
                        "stop"
                    ],
                    "Image|endswith": "/chkconfig"
                },
                "selection_iptables_4": {
                    "CommandLine|contains|all": [
                        "ip6tables",
                        "stop"
                    ],
                    "Image|endswith": "/chkconfig"
                },
                "selection_selinux": {
                    "CommandLine|contains": "0",
                    "Image|endswith": "/setenforce"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "e3a8a052-111f-4606-9aee-f28ebeb76776",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Disabling Security Tools"
        },
        {
            "author": "Joseliyo Sanchez, @Joseliyo_Jstnk",
            "date": "2023/01/18",
            "description": "Detects attempts to force stop the ufw using ufw-init",
            "detection": {
                "condition": "1 of selection_*",
                "selection_init": {
                    "CommandLine|contains|all": [
                        "-ufw-init",
                        "force-stop"
                    ]
                },
                "selection_ufw": {
                    "CommandLine|contains|all": [
                        "ufw",
                        "disable"
                    ]
                }
            },
            "falsepositives": [
                "Network administrators"
            ],
            "id": "84c9e83c-599a-458a-a0cb-0ecce44e807a",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://blogs.blackberry.com/",
                "https://twitter.com/Joseliyo_Jstnk/status/1620131033474822144"
            ],
            "status": "test",
            "title": "Ufw Force Stop Using Ufw-Init",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "author": "\u00d6mer G\u00fcnal, Alejandro Ortuno, oscd.community",
            "date": "2020/06/17",
            "description": "Detects disabling security tools",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "stopping iptables",
                    "stopping ip6tables",
                    "stopping firewalld",
                    "stopping cbdaemon",
                    "stopping falcon-sensor"
                ]
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "49f5dfc1-f92e-4d34-96fa-feba3f6acf36",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "syslog"
            },
            "modified": "2022/11/26",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "e3a8a052-111f-4606-9aee-f28ebeb76776"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ],
            "title": "Disabling Security Tools - Builtin"
        },
        {
            "author": "IAI",
            "date": "2023/03/06",
            "description": "Detects the removal of system firewall rules. Adversaries may only delete or modify a specific system firewall rule to bypass controls limiting network usage or access.\nDetection rules that match only on the disabling of firewalls will miss this.\n",
            "detection": {
                "condition": "1 of selection*",
                "selection1": {
                    "a0": "iptables",
                    "a1|contains": "DROP",
                    "type": "EXECVE"
                },
                "selection2": {
                    "a0": "firewall-cmd",
                    "a1|contains": "remove",
                    "type": "EXECVE"
                },
                "selection3": {
                    "a0": "ufw",
                    "a1|contains": "delete",
                    "type": "EXECVE"
                }
            },
            "falsepositives": [
                "Legitimate admin activity"
            ],
            "id": "323ff3f5-0013-4847-bbd4-250b5edb62cc",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "references": [
                "https://www.trendmicro.com/en_us/research/22/c/cyclops-blink-sets-sights-on-asus-routers--.html",
                "https://blog.aquasec.com/container-security-tnt-container-attack"
            ],
            "related": [
                {
                    "id": "53059bc0-1472-438b-956a-7508a94a91f0",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.t1562.004",
                "attack.defense_evasion"
            ],
            "title": "Modify System Firewall"
        },
        {
            "author": "Rafal Piasecki",
            "date": "2022/08/10",
            "description": "All TCP traffic on particular port from attacker is routed to different port. ex. '/sbin/iptables -t nat -D PREROUTING -p tcp -s 192.168.1.1 --dport 22 -j REDIRECT --to-ports 42392'\nThe traffic looks like encrypted SSH communications going to TCP port 22, but in reality is being directed to the shell port once it hits the iptables rule for the attacker host only.\n",
            "detection": {
                "cmd": {
                    "a0|endswith": "iptables",
                    "a1": "-t",
                    "type": "EXECVE",
                    "a2": "nat"
                },
                "condition": "cmd and keywords",
                "keywords": [
                    "--to-ports 42",
                    "--to-ports 43"
                ]
            },
            "falsepositives": [
                "Legitimate ports redirect"
            ],
            "id": "70b4156e-50fc-4523-aa50-c9dddf1993fc",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "references": [
                "https://www.sandflysecurity.com/blog/bpfdoor-an-evasive-linux-backdoor-technical-analysis/",
                "https://www.elastic.co/security-labs/a-peek-behind-the-bpfdoor"
            ],
            "status": "test",
            "title": "Bpfdoor TCP Ports Redirect",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.004"
            ]
        },
        {
            "id": "53059bc0-1472-438b-956a-7508a94a91f0",
            "author": "Pawel Mazur",
            "date": "2022/01/22",
            "description": "Detects disabling of system firewalls which could be used by adversaries to bypass controls that limit usage of the network.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "type": "SERVICE_STOP",
                    "unit": [
                        "firewalld",
                        "iptables",
                        "ufw"
                    ]
                }
            },
            "falsepositives": [
                "Admin activity"
            ],
            "level": "high",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1562.004/T1562.004.md",
                "https://firewalld.org/documentation/man-pages/firewall-cmd.html"
            ],
            "status": "test",
            "title": "Disable System Firewall",
            "tags": [
                "attack.t1562.004",
                "attack.defense_evasion"
            ]
        }
    ]
}