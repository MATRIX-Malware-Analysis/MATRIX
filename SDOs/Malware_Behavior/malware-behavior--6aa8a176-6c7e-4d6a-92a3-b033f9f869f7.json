{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--6aa8a176-6c7e-4d6a-92a3-b033f9f869f7",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.335914Z",
    "name": "System Owner/User Discovery",
    "description": "Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system, or whether a user is actively using the system. They may do this, for example, by retrieving account usernames or by using OS Credential Dumping. The information may be collected in a number of different ways using other Discovery techniques, because user and username details are prevalent throughout a system and include running process ownership, file/directory ownership, session information, and system logs. Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.Various utilities and commands may acquire this information, including whoami. In macOS and Linux, the currently logged in user can be identified with w and who. On macOS the dscl . list /Users | grep -v '_' command can also be used to enumerate user accounts. Environment variables, such as %USERNAME% and $USER, may also be used to access this information.On network devices, Network Device CLI commands such as show users and show ssh can be used to display users currently logged into the device.[1][2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1033",
            "external_id": "T1033"
        },
        {
            "source_name": "CAPEC 577",
            "external_id": "malware-behavior--3eb4cba5-3e9d-4f27-a6fc-c54968d35005"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1033",
            "external_id": "T1033"
        },
        {
            "source_name": "show_ssh_users_cmd_cisco",
            "description": "Cisco. (2023, March 7). Cisco IOS Security Command Reference: Commands S to Z . Retrieved July 13, 2022.",
            "url": "https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/s1/sec-s1-cr-book/sec-cr-s5.html"
        },
        {
            "source_name": "US-CERT TA18-106A Network Infrastructure Devices 2018",
            "description": "US-CERT. (2018, April 20). Russian State-Sponsored Cyber Actors Targeting Network Infrastructure Devices. Retrieved October 19, 2020.",
            "url": "https://us-cert.cisa.gov/ncas/alerts/TA18-106A"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "api": "wtsapi32.WTSQuerySessionInformation"
                            },
                            {
                                "optional": [
                                    {
                                        "api": "wtsapi32.WTSFreeMemory"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::System Owner/User Discovery [T1033]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "name": "get session information",
                    "namespace": "host-interaction/session",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "advapi32.GetUserName"
                            },
                            {
                                "api": "secur32.GetUserNameEx"
                            },
                            {
                                "basic block": [
                                    {
                                        "and": [
                                            {
                                                "api": "wtsapi32.WTSQuerySessionInformation"
                                            },
                                            {
                                                "number": "5 = WTSUserName"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "call": [
                                    {
                                        "and": [
                                            {
                                                "api": "wtsapi32.WTSQuerySessionInformation"
                                            },
                                            {
                                                "number": "5 = WTSUserName"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "api": "System.Security.Principal.WindowsIdentity::GetCurrent"
                            },
                            {
                                "property/read": "System.Environment::UserName"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::System Owner/User Discovery [T1033]",
                        "Discovery::Account Discovery [T1087]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "examples": [
                        "Practical Malware Analysis Lab 14-01.exe_:0x401285"
                    ],
                    "name": "get session user name",
                    "namespace": "host-interaction/session",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "api": "advapi32.CheckTokenMembership"
                            },
                            {
                                "optional": [
                                    {
                                        "api": "advapi32.AllocateAndInitializeSid"
                                    },
                                    {
                                        "api": "advapi32.FreeSid"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::System Owner/User Discovery [T1033]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "examples": [
                        "mimikatz.exe_:0x40DABE"
                    ],
                    "name": "get token membership",
                    "namespace": "host-interaction/session",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "os": "linux"
                                    },
                                    {
                                        "os": "android"
                                    }
                                ]
                            },
                            {
                                "or": [
                                    {
                                        "api": "geteuid"
                                    },
                                    {
                                        "api": "getpwuid"
                                    },
                                    {
                                        "api": "getlogin"
                                    },
                                    {
                                        "api": "getlogin_r"
                                    },
                                    {
                                        "api": "cuserid"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::System Owner/User Discovery [T1033]"
                    ],
                    "authors": [
                        "joakim@intezer.com"
                    ],
                    "examples": [
                        "7351f8a40c5450557b24622417fc478d:0x405438"
                    ],
                    "name": "get current user on Linux",
                    "namespace": "host-interaction/session",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "shell32.IsUserAnAdmin"
                            },
                            {
                                "and": [
                                    {
                                        "api": "System.Security.Principal.WindowsIdentity::GetCurrent"
                                    },
                                    {
                                        "number": "0x220 = BUILTIN\\Administrators"
                                    },
                                    {
                                        "api": "System.Security.Principal.WindowsPrincipal::IsInRole"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::System Owner/User Discovery [T1033]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "examples": [
                        "9879D201DC5ACA863F357184CD1F170E:0x10003643"
                    ],
                    "name": "get session integrity level",
                    "namespace": "host-interaction/session",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sagie Dulce, Dekel Paz",
            "date": "2022/01/01",
            "description": "Detects remote RPC calls to MS-DRSR from non DC hosts, which could indicate DCSync / DCShadow attacks.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "OpNum": [
                        0,
                        1,
                        12
                    ]
                },
                "selection": {
                    "EventID": 3,
                    "EventLog": "RPCFW",
                    "InterfaceUuid": "e3514235-4b06-11d1-ab04-00c04fc2dcd2"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "56fda488-113e-4ce9-8076-afc2457922c3",
            "level": "high",
            "logsource": {
                "category": "application",
                "definition": "Requirements: install and apply the RPC Firewall to all processes, enable DRSR UUID (e3514235-4b06-11d1-ab04-00c04fc2dcd2) for \"dangerous\" opcodes (not 0,1 or 12) only from trusted IPs (DCs)",
                "product": "rpc_firewall"
            },
            "modified": "2022/01/01",
            "references": [
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa-673e-4f66-b9bf-48c640241d47?redirectedfrom=MSDN",
                "https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/ddd4608fe8684fcf2fcf9b48c5f0b3c28097f8a3/documents/MS-DRSR.md",
                "https://github.com/zeronetworks/rpcfirewall",
                "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall/"
            ],
            "status": "test",
            "tags": [
                "attack.t1033",
                "attack.discovery"
            ],
            "title": "Possible DCSync Attack"
        },
        {
            "author": "Sagie Dulce, Dekel Paz",
            "date": "2022/01/01",
            "description": "Detects remote RPC calls useb by SharpHound to map remote connections and local group membership.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "EventLog": "RPCFW",
                    "InterfaceUuid": "4b324fc8-1670-01d3-1278-5a47bf6ee188",
                    "OpNum": 12
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "6d580420-ff3f-4e0e-b6b0-41b90c787e28",
            "level": "high",
            "logsource": {
                "category": "application",
                "definition": "Requirements: install and apply the RPC Firewall to all processes with \"audit:true action:block uuid:4b324fc8-1670-01d3-1278-5a47bf6ee188 opnum:12",
                "product": "rpc_firewall"
            },
            "modified": "2022/01/01",
            "references": [
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/02b1f559-fda2-4ba3-94c2-806eb2777183",
                "https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/ddd4608fe8684fcf2fcf9b48c5f0b3c28097f8a3/documents/MS-SRVS.md",
                "https://github.com/zeronetworks/rpcfirewall",
                "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall/"
            ],
            "status": "test",
            "tags": [
                "attack.t1033"
            ],
            "title": "SharpHound Recon Sessions"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/12",
            "description": "Find information about network devices that is not stored in config files",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "dir",
                    "show arp",
                    "show cdp",
                    "show clock",
                    "show ip interface",
                    "show ip route",
                    "show ip sockets",
                    "show processes",
                    "show ssh",
                    "show users",
                    "show version"
                ]
            },
            "falsepositives": [
                "Commonly used by administrators for troubleshooting"
            ],
            "id": "9705a6a1-6db6-4a16-a987-15b7151e299b",
            "level": "low",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "references": [
                "https://www.cisco.com/c/en/us/td/docs/server_nw_virtual/2-5_release/command_reference/show.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1083",
                "attack.t1201",
                "attack.t1057",
                "attack.t1018",
                "attack.t1082",
                "attack.t1016",
                "attack.t1049",
                "attack.t1033",
                "attack.t1124"
            ],
            "title": "Cisco Discovery"
        },
        {
            "author": "Florian Roth (Nextron Systems), Jonhnathan Ribeiro, Anton Kutepov, oscd.community",
            "date": "2017/01/01",
            "description": "Detects certain command line parameters often used during reconnaissance activity via web shells",
            "detection": {
                "condition": "1 of selection_webserver_* and 1 of selection_susp_*",
                "selection_susp_change_dir": {
                    "CommandLine|contains": [
                        "&cd&echo",
                        "cd /d "
                    ]
                },
                "selection_susp_misc_discovery_binaries": [
                    {
                        "Image|endswith": [
                            "\\dsquery.exe",
                            "\\find.exe",
                            "\\findstr.exe",
                            "\\ipconfig.exe",
                            "\\netstat.exe",
                            "\\nslookup.exe",
                            "\\pathping.exe",
                            "\\quser.exe",
                            "\\schtasks.exe",
                            "\\systeminfo.exe",
                            "\\tasklist.exe",
                            "\\tracert.exe",
                            "\\ver.exe",
                            "\\wevtutil.exe",
                            "\\whoami.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "dsquery.exe",
                            "find.exe",
                            "findstr.exe",
                            "ipconfig.exe",
                            "netstat.exe",
                            "nslookup.exe",
                            "pathping.exe",
                            "quser.exe",
                            "schtasks.exe",
                            "sysinfo.exe",
                            "tasklist.exe",
                            "tracert.exe",
                            "ver.exe",
                            "VSSADMIN.EXE",
                            "wevtutil.exe",
                            "whoami.exe"
                        ]
                    }
                ],
                "selection_susp_misc_discovery_commands": {
                    "CommandLine|contains": [
                        " Test-NetConnection ",
                        "dir \\"
                    ]
                },
                "selection_susp_net_utility": {
                    "CommandLine|contains": [
                        " user ",
                        " use ",
                        " group "
                    ],
                    "OriginalFileName": [
                        "net.exe",
                        "net1.exe"
                    ]
                },
                "selection_susp_ping_utility": {
                    "CommandLine|contains": " -n ",
                    "OriginalFileName": "ping.exe"
                },
                "selection_susp_wmic_utility": {
                    "CommandLine|contains": " /node:",
                    "OriginalFileName": "wmic.exe"
                },
                "selection_webserver_characteristics_tomcat1": {
                    "ParentImage|contains": [
                        "-tomcat-",
                        "\\tomcat"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat2": {
                    "CommandLine|contains": [
                        "catalina.jar",
                        "CATALINA_HOME"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_image": {
                    "ParentImage|endswith": [
                        "\\w3wp.exe",
                        "\\php-cgi.exe",
                        "\\nginx.exe",
                        "\\httpd.exe",
                        "\\caddy.exe",
                        "\\ws_tomcatservice.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bed2a484-9348-4143-8a8a-b801c979301c",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/05/13",
            "references": [
                "https://www.fireeye.com/blog/threat-research/2013/08/breaking-down-the-china-chopper-web-shell-part-ii.html",
                "https://unit42.paloaltonetworks.com/bumblebee-webshell-xhunt-campaign/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1018",
                "attack.t1033",
                "attack.t1087"
            ],
            "title": "Webshell Detection With Command Line Keywords"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/08/12",
            "description": "Detects the execution of whoami.exe with suspicious parent processes.",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_known_parents": {
                    "ParentImage|endswith": [
                        "\\cmd.exe",
                        "\\powershell_ise.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe"
                    ]
                },
                "filter_main_parent_empty": {
                    "ParentImage": ""
                },
                "filter_main_parent_null": {
                    "ParentImage": null
                },
                "filter_optional_ms_monitoring_agent": {
                    "ParentImage|endswith": ":\\Program Files\\Microsoft Monitoring Agent\\Agent\\MonitoringHost.exe"
                },
                "selection": [
                    {
                        "Image|endswith": "\\whoami.exe"
                    },
                    {
                        "OriginalFileName": "whoami.exe"
                    }
                ]
            },
            "falsepositives": [
                "Admin activity",
                "Scripts and administrative tools used in the monitored environment",
                "Monitoring activity"
            ],
            "id": "8de1cbe8-d6f5-496d-8237-5f44a721c7a0",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/04",
            "references": [
                "https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/",
                "https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/",
                "https://www.youtube.com/watch?v=DsJ9ByX84o4&t=6s"
            ],
            "status": "experimental",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "Whoami.EXE Execution Anomaly"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/11/29",
            "description": "Detects a suspicious process command line that uses whoami as first parameter (as e.g. used by EfsPotato)",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": ".exe whoami"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "e9142d84-fbe0-401d-ac50-3e519fb00c89",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/25",
            "references": [
                "https://twitter.com/blackarrowsec/status/1463805700602224645?s=12"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "WhoAmI as Parameter"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/05/05",
            "description": "Detects a whoami.exe executed with the /priv command line flag instructing the tool to show all current user privileges. This is often used after a privilege escalation attempt.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " /priv",
                        " -priv"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\whoami.exe"
                    },
                    {
                        "OriginalFileName": "whoami.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "97a80ec7-0e2f-4d05-9ef4-65760e634f6b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/28",
            "references": [
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/whoami"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Security Privileges Enumeration Via Whoami.EXE"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/12/04",
            "description": "Detects the execution of \"whoami.exe\" with the \"/all\" flag",
            "detection": {
                "condition": "all of selection_main_*",
                "selection_main_cli": {
                    "CommandLine|contains|windash": " -all"
                },
                "selection_main_img": [
                    {
                        "Image|endswith": "\\whoami.exe"
                    },
                    {
                        "OriginalFileName": "whoami.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c248c896-e412-4279-8c15-1c558067b6fa",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/05",
            "references": [
                "https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/",
                "https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/",
                "https://www.youtube.com/watch?v=DsJ9ByX84o4&t=6s"
            ],
            "status": "experimental",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "Enumerate All Information With Whoami.EXE"
        },
        {
            "author": "Timur Zinniatullin, Daniil Yugoslavskiy, oscd.community",
            "date": "2019/10/21",
            "description": "Local accounts, System Owner/User discovery using operating systems utilities",
            "detection": {
                "condition": "(selection_cmd and not filter_cmd) or (selection_net and not filter_net) or 1 of selection_other_*",
                "filter_cmd": {
                    "CommandLine|contains": " rmdir "
                },
                "filter_net": {
                    "CommandLine|contains": [
                        "/domain",
                        "/add",
                        "/delete",
                        "/active",
                        "/expires",
                        "/passwordreq",
                        "/scriptpath",
                        "/times",
                        "/workstations"
                    ]
                },
                "selection_cmd": {
                    "CommandLine|contains|all": [
                        " /c",
                        "dir ",
                        "\\Users\\"
                    ],
                    "Image|endswith": "\\cmd.exe"
                },
                "selection_net": {
                    "CommandLine|contains": "user",
                    "Image|endswith": [
                        "\\net.exe",
                        "\\net1.exe"
                    ]
                },
                "selection_other_cmdkey": {
                    "CommandLine|contains": " /l",
                    "Image|endswith": "\\cmdkey.exe"
                },
                "selection_other_img": {
                    "Image|endswith": [
                        "\\whoami.exe",
                        "\\quser.exe",
                        "\\qwinsta.exe"
                    ]
                },
                "selection_other_wmi": {
                    "CommandLine|contains|all": [
                        "useraccount",
                        "get"
                    ],
                    "Image|endswith": "\\wmic.exe"
                }
            },
            "falsepositives": [
                "Legitimate administrator or user enumerates local users for legitimate reason"
            ],
            "id": "502b42de-4306-40b4-9596-6f590c81f073",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/01/03",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "attack.t1087.001"
            ],
            "title": "Local Accounts Discovery"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/08/13",
            "description": "Detects the execution of whoami, which is often used by attackers after exploitation / privilege escalation",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\whoami.exe"
                    },
                    {
                        "OriginalFileName": "whoami.exe"
                    }
                ]
            },
            "falsepositives": [
                "Admin activity",
                "Scripts and administrative tools used in the monitored environment",
                "Monitoring activity"
            ],
            "id": "e28a5a99-da44-436d-b7a0-2afc20a5f413",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/30",
            "references": [
                "https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/",
                "https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "Whoami Utility Execution"
        },
        {
            "author": "frack113",
            "date": "2021/12/10",
            "description": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "OriginalFileName": "SharpView.exe"
                    },
                    {
                        "Image|endswith": "\\SharpView.exe"
                    },
                    {
                        "CommandLine|contains": [
                            "Add-RemoteConnection",
                            "Convert-ADName",
                            "ConvertFrom-SID",
                            "ConvertFrom-UACValue",
                            "Convert-SidToName",
                            "Export-PowerViewCSV",
                            "Find-DomainObjectPropertyOutlier",
                            "Find-DomainProcess",
                            "Find-DomainShare",
                            "Find-DomainUserEvent",
                            "Find-DomainUserLocation",
                            "Find-ForeignGroup",
                            "Find-ForeignUser",
                            "Find-GPOComputerAdmin",
                            "Find-GPOLocation",
                            "Find-Interesting",
                            "Find-LocalAdminAccess",
                            "Find-ManagedSecurityGroups",
                            "Get-CachedRDPConnection",
                            "Get-DFSshare",
                            "Get-DomainComputer",
                            "Get-DomainController",
                            "Get-DomainDFSShare",
                            "Get-DomainDNSRecord",
                            "Get-DomainFileServer",
                            "Get-DomainForeign",
                            "Get-DomainGPO",
                            "Get-DomainGroup",
                            "Get-DomainGUIDMap",
                            "Get-DomainManagedSecurityGroup",
                            "Get-DomainObject",
                            "Get-DomainOU",
                            "Get-DomainPolicy",
                            "Get-DomainSID",
                            "Get-DomainSite",
                            "Get-DomainSPNTicket",
                            "Get-DomainSubnet",
                            "Get-DomainTrust",
                            "Get-DomainUserEvent",
                            "Get-ForestDomain",
                            "Get-ForestGlobalCatalog",
                            "Get-ForestTrust",
                            "Get-GptTmpl",
                            "Get-GroupsXML",
                            "Get-LastLoggedOn",
                            "Get-LoggedOnLocal",
                            "Get-NetComputer",
                            "Get-NetDomain",
                            "Get-NetFileServer",
                            "Get-NetForest",
                            "Get-NetGPO",
                            "Get-NetGroupMember",
                            "Get-NetLocalGroup",
                            "Get-NetLoggedon",
                            "Get-NetOU",
                            "Get-NetProcess",
                            "Get-NetRDPSession",
                            "Get-NetSession",
                            "Get-NetShare",
                            "Get-NetSite",
                            "Get-NetSubnet",
                            "Get-NetUser",
                            "Get-PathAcl",
                            "Get-PrincipalContext",
                            "Get-RegistryMountedDrive",
                            "Get-RegLoggedOn",
                            "Get-WMIRegCachedRDPConnection",
                            "Get-WMIRegLastLoggedOn",
                            "Get-WMIRegMountedDrive",
                            "Get-WMIRegProxy",
                            "Invoke-ACLScanner",
                            "Invoke-CheckLocalAdminAccess",
                            "Invoke-Kerberoast",
                            "Invoke-MapDomainTrust",
                            "Invoke-RevertToSelf",
                            "Invoke-Sharefinder",
                            "Invoke-UserImpersonation",
                            "Remove-DomainObjectAcl",
                            "Remove-RemoteConnection",
                            "Request-SPNTicket",
                            "Set-DomainObject",
                            "Test-AdminAccess"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b2317cfa-4a47-4ead-b3ff-297438c0bc2d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://github.com/tevora-threat/SharpView/",
                "https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1049/T1049.md#atomic-test-4---system-discovery-using-sharpview"
            ],
            "related": [
                {
                    "id": "dcd74b95-3f36-4ed9-9598-0490951643aa",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1049",
                "attack.t1069.002",
                "attack.t1482",
                "attack.t1135",
                "attack.t1033"
            ],
            "title": "HackTool - SharpView Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/02/28",
            "description": "Detects the execution of whoami.exe with the /group command line flag to show group membership for the current user, account type, security identifiers (SID), and attributes.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " /groups",
                        " -groups"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\whoami.exe"
                    },
                    {
                        "OriginalFileName": "whoami.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bd8b828d-0dca-48e1-8a63-8a58ecf2644f",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/whoami"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Group Membership Reconnaissance Via Whoami.EXE"
        },
        {
            "author": "Florian Roth (Nextron Systems), MSTI (query)",
            "date": "2022/10/01",
            "description": "Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmdline": {
                    "CommandLine|contains": [
                        "&ipconfig&echo",
                        "&quser&echo",
                        "&whoami&echo",
                        "&c:&echo",
                        "&cd&echo",
                        "&dir&echo",
                        "&echo [E]",
                        "&echo [S]"
                    ]
                },
                "selection_origin": [
                    {
                        "Image|endswith": "\\w3wp.exe"
                    },
                    {
                        "ParentImage|endswith": "\\w3wp.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fa3c117a-bc0d-416e-a31b-0c0e80653efb",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/"
            ],
            "status": "test",
            "title": "Chopper Webshell Process Pattern",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1018",
                "attack.t1033",
                "attack.t1087"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/08/29",
            "description": "Detects SharpLdapWhoami, a whoami alternative that queries the LDAP service on a domain controller",
            "detection": {
                "condition": "1 of selection*",
                "selection_flags1": {
                    "CommandLine|endswith": [
                        " /method:ntlm",
                        " /method:kerb",
                        " /method:nego",
                        " /m:nego",
                        " /m:ntlm",
                        " /m:kerb"
                    ]
                },
                "selection_name": {
                    "Image|endswith": "\\SharpLdapWhoami.exe"
                },
                "selection_pe": [
                    {
                        "OriginalFileName|contains": "SharpLdapWhoami"
                    },
                    {
                        "Product": "SharpLdapWhoami"
                    }
                ]
            },
            "falsepositives": [
                "Programs that use the same command line flags"
            ],
            "id": "d9367cbb-c2e0-47ce-bdc0-128cb6da898d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/bugch3ck/SharpLdapWhoami"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "HackTool - SharpLdapWhoami Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/03/17",
            "description": "Detects certain parent child patterns found in cases in which a web shell is used to perform certain credential dumping or exfiltration activities on a compromised system\n",
            "detection": {
                "condition": "1 of selection_webserver_* and 1 of selection_child_*",
                "selection_child_1": {
                    "CommandLine|contains|all": [
                        "rundll32",
                        "comsvcs"
                    ]
                },
                "selection_child_2": {
                    "CommandLine|contains|all": [
                        " -hp",
                        " a ",
                        " -m"
                    ]
                },
                "selection_child_3": {
                    "CommandLine|contains|all": [
                        "net",
                        " user ",
                        " /add"
                    ]
                },
                "selection_child_4": {
                    "CommandLine|contains|all": [
                        "net",
                        " localgroup ",
                        " administrators ",
                        "/add"
                    ]
                },
                "selection_child_5": {
                    "Image|endswith": [
                        "\\ntdsutil.exe",
                        "\\ldifde.exe",
                        "\\adfind.exe",
                        "\\procdump.exe",
                        "\\Nanodump.exe",
                        "\\vssadmin.exe",
                        "\\fsutil.exe"
                    ]
                },
                "selection_child_6": {
                    "CommandLine|contains": [
                        " -decode ",
                        " -NoP ",
                        " -W Hidden ",
                        " /decode ",
                        " /ticket:",
                        " sekurlsa",
                        ".dmp full",
                        ".downloadfile(",
                        ".downloadstring(",
                        "FromBase64String",
                        "process call create",
                        "reg save ",
                        "whoami /priv"
                    ]
                },
                "selection_webserver_characteristics_tomcat1": {
                    "ParentImage|contains": [
                        "-tomcat-",
                        "\\tomcat"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat2": {
                    "CommandLine|contains": [
                        "catalina.jar",
                        "CATALINA_HOME"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_image": {
                    "ParentImage|endswith": [
                        "\\caddy.exe",
                        "\\httpd.exe",
                        "\\nginx.exe",
                        "\\php-cgi.exe",
                        "\\w3wp.exe",
                        "\\ws_tomcatservice.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "4ebc877f-4612-45cb-b3a5-8e3834db36c9",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/09",
            "references": [
                "https://youtu.be/7aemGhaE9ds?t=641"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1018",
                "attack.t1033",
                "attack.t1087"
            ],
            "title": "Webshell Hacking Activity Patterns"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/08/12",
            "description": "Detects the execution of whoami that has been renamed to a different name to avoid detection",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "Image|endswith": "\\whoami.exe"
                },
                "selection": {
                    "OriginalFileName": "whoami.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f1086bf7-a0c4-4a37-9102-01e573caf4a0",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/",
                "https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "Renamed Whoami Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/09/09",
            "description": "Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " > ",
                        " | Select ",
                        "Out-File",
                        "Set-Content",
                        "Add-Content"
                    ],
                    "CommandLine|contains|all": [
                        "Get-ADUser ",
                        " -Filter \\*"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\powershell.exe",
                            "\\pwsh.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Legitimate admin scripts may use the same technique, it's better to exclude specific computers or users who execute these commands or scripts often"
            ],
            "id": "1114e048-b69c-4f41-bc20-657245ae6e3f",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/11/17",
            "references": [
                "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
                "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/"
            ],
            "related": [
                {
                    "id": "c2993223-6da8-4b1a-88ee-668b8bf315e9",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "User Discovery And Export Via Get-ADUser Cmdlet"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/02/28",
            "description": "Detects the execution of \"whoami.exe\" with the \"/FO\" flag to choose CSV as output format or with redirection options to export the results to a file for later use.",
            "detection": {
                "condition": "all of selection_main_* or selection_special",
                "selection_main_cli": {
                    "CommandLine|contains": [
                        " /FO CSV",
                        " -FO CSV"
                    ]
                },
                "selection_main_img": [
                    {
                        "Image|endswith": "\\whoami.exe"
                    },
                    {
                        "OriginalFileName": "whoami.exe"
                    }
                ],
                "selection_special": {
                    "CommandLine|contains": "whoami*>"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c30fb093-1109-4dc8-88a8-b30d11c95a5d",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/04",
            "references": [
                "https://brica.de/alerts/alert/public/1247926/agent-tesla-keylogger-delivered-inside-a-power-iso-daa-archive/",
                "https://app.any.run/tasks/7eaba74e-c1ea-400f-9c17-5e30eee89906/",
                "https://www.youtube.com/watch?v=DsJ9ByX84o4&t=6s"
            ],
            "status": "experimental",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "car.2016-03-001"
            ],
            "title": "Whoami.EXE Execution With Output Option"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/11/10",
            "description": "Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " > ",
                        " | Select ",
                        "Out-File",
                        "Set-Content",
                        "Add-Content"
                    ],
                    "CommandLine|contains|all": [
                        "Get-ADComputer ",
                        " -Filter \\*"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\powershell.exe",
                            "\\pwsh.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Legitimate admin scripts may use the same technique, it's better to exclude specific computers or users who execute these commands or scripts often"
            ],
            "id": "435e10e4-992a-4281-96f3-38b11106adde",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/11/17",
            "references": [
                "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
                "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/",
                "https://www.cisa.gov/uscert/sites/default/files/publications/aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal%20network_deploy_crypto%20miner_credential_harvester.pdf"
            ],
            "related": [
                {
                    "id": "db885529-903f-4c5d-9864-28fe199e6370",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Computer Discovery And Export Via Get-ADComputer Cmdlet"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov",
            "date": "2022/01/28",
            "description": "Detects the execution of \"whoami.exe\" by privileged accounts that are often abused by threat actors",
            "detection": {
                "condition": "all of selection_*",
                "selection_img": [
                    {
                        "OriginalFileName": "whoami.exe"
                    },
                    {
                        "Image|endswith": "\\whoami.exe"
                    }
                ],
                "selection_user": {
                    "User|contains": [
                        "AUTHORI",
                        "AUTORI",
                        "TrustedInstaller"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "79ce34ca-af29-4d0e-b832-fc1b377020db",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/04",
            "references": [
                "https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment",
                "https://nsudo.m2team.org/en-us/"
            ],
            "related": [
                {
                    "id": "80167ada-7a12-41ed-b8e9-aa47195c66a1",
                    "type": "obsoletes"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.privilege_escalation",
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Whoami.EXE Execution From Privileged Process"
        },
        {
            "author": "frack113",
            "date": "2022/03/17",
            "description": "Detects AS-REP roasting is an attack that is often-overlooked. It is not very common as you have to explicitly set accounts that do not require pre-authentication.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Get-ADUser",
                        "-Filter",
                        "useraccountcontrol",
                        "-band",
                        "4194304"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate PowerShell scripts"
            ],
            "id": "96c982fe-3d08-4df4-bed2-eb14e02f21c8",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md#atomic-test-11---get-aduser-enumeration-using-useraccountcontrol-flags-as-rep-roasting",
                "https://shellgeek.com/useraccountcontrol-flags-to-manipulate-properties/"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Get-ADUser Enumeration Using UserAccountControl Flags"
        },
        {
            "author": "frack113",
            "date": "2022/04/04",
            "description": "Detects the use of PowerShell to identify the current logged user.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "[System.Environment]::UserName",
                        "$env:UserName",
                        "[System.Security.Principal.WindowsIdentity]::GetCurrent()"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate PowerShell scripts"
            ],
            "id": "4096a49c-7de4-4da0-a230-c66ccd56ea5a",
            "level": "low",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md#atomic-test-4---user-discovery-with-env-vars-powershell-script",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md#atomic-test-5---getcurrent-user-with-powershell-script"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Suspicious PowerShell Get Current User"
        },
        {
            "id": "db885529-903f-4c5d-9864-28fe199e6370",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/11/17",
            "description": "Detects usage of the Get-ADComputer cmdlet to collect computer information and output it to a file",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        " | Select ",
                        "Out-File",
                        "Set-Content",
                        "Add-Content"
                    ],
                    "ScriptBlockText|contains|all": [
                        "Get-ADComputer ",
                        " -Filter \\*"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate admin scripts may use the same technique, it's better to exclude specific computers or users who execute these commands or scripts often"
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "related": [
                {
                    "type": "similar",
                    "id": "435e10e4-992a-4281-96f3-38b11106adde"
                }
            ],
            "references": [
                "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
                "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/",
                "https://www.cisa.gov/uscert/sites/default/files/publications/aa22-320a_joint_csa_iranian_government-sponsored_apt_actors_compromise_federal%20network_deploy_crypto%20miner_credential_harvester.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "Computer Discovery And Export Via Get-ADComputer Cmdlet - PowerShell"
        },
        {
            "id": "c2993223-6da8-4b1a-88ee-668b8bf315e9",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/11/17",
            "description": "Detects usage of the Get-ADUser cmdlet to collect user information and output it to a file",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        " > ",
                        " | Select ",
                        "Out-File",
                        "Set-Content",
                        "Add-Content"
                    ],
                    "ScriptBlockText|contains|all": [
                        "Get-ADUser ",
                        " -Filter \\*"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate admin scripts may use the same technique, it's better to exclude specific computers or users who execute these commands or scripts often"
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "related": [
                {
                    "type": "similar",
                    "id": "1114e048-b69c-4f41-bc20-657245ae6e3f"
                }
            ],
            "references": [
                "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
                "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "User Discovery And Export Via Get-ADUser Cmdlet - PowerShell"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), Cedric Maurugeon",
            "date": "2023/09/04",
            "description": "Detects execution of the \"esxcli\" command with the \"storage\" flag in order to retrieve information about the storage status and other related information. Seen used by malware such as DarkSide and LockBit.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " get",
                        " list"
                    ]
                },
                "selection_img": {
                    "CommandLine|contains": "storage",
                    "Image|endswith": "/esxcli"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "f41dada5-3f56-4232-8503-3fb7f9cf2d60",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://www.trendmicro.com/en_us/research/21/e/darkside-linux-vms-targeted.html",
                "https://www.trendmicro.com/en_us/research/22/a/analysis-and-Impact-of-lockbit-ransomwares-first-linux-and-vmware-esxi-variant.html",
                "https://developer.vmware.com/docs/11743/esxi-7-0-esxcli-command-reference/namespace/esxcli_storage.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "attack.t1007"
            ],
            "title": "ESXi Storage Information Discovery Via ESXCLI"
        },
        {
            "author": "Cedric Maurugeon",
            "date": "2023/09/04",
            "description": "Detects execution of the \"esxcli\" command with the \"network\" flag in order to retrieve information about the network configuration.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " get",
                        " list"
                    ]
                },
                "selection_img": {
                    "CommandLine|contains": "network",
                    "Image|endswith": "/esxcli"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "33e814e0-1f00-4e43-9c34-31fb7ae2b174",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://www.crowdstrike.com/blog/hypervisor-jackpotting-ecrime-actors-increase-targeting-of-esxi-servers/",
                "https://developer.vmware.com/docs/11743/esxi-7-0-esxcli-command-reference/namespace/esxcli_network.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "attack.t1007"
            ],
            "title": "ESXi Network Configuration Discovery Via ESXCLI"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), Cedric Maurugeon",
            "date": "2023/09/04",
            "description": "Detects execution of the \"esxcli\" command with the \"vsan\" flag in order to retrieve information about virtual storage. Seen used by malware such as DarkSide.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " get",
                        " list"
                    ]
                },
                "selection_img": {
                    "CommandLine|contains": "vsan",
                    "Image|endswith": "/esxcli"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "d54c2f06-aca9-4e2b-81c9-5317858f4b79",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://www.trendmicro.com/en_us/research/21/e/darkside-linux-vms-targeted.html",
                "https://www.trendmicro.com/en_us/research/22/a/analysis-and-Impact-of-lockbit-ransomwares-first-linux-and-vmware-esxi-variant.html",
                "https://developer.vmware.com/docs/11743/esxi-7-0-esxcli-command-reference/namespace/esxcli_vsan.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "attack.t1007"
            ],
            "title": "ESXi VSAN Information Discovery Via ESXCLI"
        },
        {
            "author": "Cedric Maurugeon",
            "date": "2023/09/04",
            "description": "Detects execution of the \"esxcli\" command with the \"system\" flag in order to retrieve information about the different component of the system. Such as accounts, modules, NTP, etc.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " get",
                        " list"
                    ]
                },
                "selection_img": {
                    "CommandLine|contains": "system",
                    "Image|endswith": "/esxcli"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "e80273e1-9faf-40bc-bd85-dbaff104c4e9",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://www.crowdstrike.com/blog/hypervisor-jackpotting-ecrime-actors-increase-targeting-of-esxi-servers/",
                "https://developer.vmware.com/docs/11743/esxi-7-0-esxcli-command-reference/namespace/esxcli_system.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "attack.t1007"
            ],
            "title": "ESXi System Information Discovery Via ESXCLI"
        },
        {
            "author": "Cedric Maurugeon",
            "date": "2023/09/04",
            "description": "Detects execution of the \"esxcli\" command with the \"vm\" flag in order to retrieve information about the installed VMs.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "vm process",
                    "Image|endswith": "/esxcli",
                    "CommandLine|endswith": " list"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "5f1573a7-363b-4114-9208-ad7a61de46eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://www.crowdstrike.com/blog/hypervisor-jackpotting-ecrime-actors-increase-targeting-of-esxi-servers/",
                "https://developer.vmware.com/docs/11743/esxi-7-0-esxcli-command-reference/namespace/esxcli_vm.html",
                "https://www.secuinfra.com/en/techtalk/hide-your-hypervisor-analysis-of-esxiargs-ransomware/",
                "https://www.trendmicro.com/en_us/research/22/e/new-linux-based-ransomware-cheerscrypt-targets-exsi-devices.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033",
                "attack.t1007"
            ],
            "title": "ESXi VM List Discovery Via ESXCLI"
        },
        {
            "author": "Timur Zinniatullin, oscd.community",
            "date": "2019/10/21",
            "description": "Adversaries may use the information from System Owner/User Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "a0": [
                        "users",
                        "w",
                        "who"
                    ],
                    "type": "EXECVE"
                }
            },
            "falsepositives": [
                "Admin activity"
            ],
            "id": "9a0d8ca0-2385-4020-b6c6-cb6153ca56f3",
            "level": "low",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1033/T1033.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1033"
            ],
            "title": "System Owner or User Discovery"
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows",
        "Network"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Austin Clark, @c2defense"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "discovery"
        }
    ],
    "x_mitre_detection": "`System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.\n\nMonitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).\n\nFor network infrastructure devices, collect AAA logging to monitor `show` commands being run by non-standard users from non-standard locations.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.5",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Active Directory: Active Directory Object Access",
        "Process: OS API Execution",
        "Command: Command Execution",
        "Network Traffic: Network Traffic Content",
        "Process: Process Creation",
        "Network Traffic: Network Traffic Flow",
        "Windows Registry: Windows Registry Key Access",
        "File: File Access",
        "Process: Process Access"
    ],
    "x_mitre_permissions_required": []
}