{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--20ca94d3-0bb8-44ca-b847-ef5cd759c749",
    "created": "2024-08-13T14:46:37.151602Z",
    "modified": "2024-08-13T14:46:46.323921Z",
    "name": "Unsecured Credentials: Container API",
    "description": "Adversaries may gather credentials via APIs within a containers environment. APIs in these environments, such as the Docker API and Kubernetes APIs, allow a user to remotely manage their container resources and cluster components.[1][2]An adversary may access the Docker API to collect logs that contain credentials to cloud, container, and various other resources in the environment.[3] An adversary with sufficient permissions, such as via a pod's service account, may also use the Kubernetes API to retrieve credentials from the Kubernetes API server. These credentials may include those needed for Docker API authentication or secrets from Kubernetes cluster components.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1552/007",
            "external_id": "T1552/007"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/11/25",
            "description": "Identifies when an admission controller is executed in GCP Kubernetes.\nA Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server.\nThe behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster.\nAn adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster.\nFor example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials.\nAn adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "gcp.audit.method_name|contains": [
                        ".mutatingwebhookconfigurations.",
                        ".validatingwebhookconfigurations."
                    ],
                    "gcp.audit.method_name|endswith": [
                        "create",
                        "patch",
                        "replace"
                    ],
                    "gcp.audit.method_name|startswith": "admissionregistration.k8s.io.v"
                }
            },
            "falsepositives": [
                "Google Cloud Kubernetes Admission Controller may be done by a system administrator.",
                "If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "6ad91e31-53df-4826-bd27-0166171c8040",
            "level": "medium",
            "logsource": {
                "product": "gcp",
                "service": "gcp.audit"
            },
            "modified": "2022/12/18",
            "references": [
                "https://cloud.google.com/kubernetes-engine/docs"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1078",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.007"
            ],
            "title": "Google Cloud Kubernetes Admission Controller"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/11/25",
            "description": "Identifies when an admission controller is executed in Azure Kubernetes.\nA Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server.\nThe behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster.\nAn adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster.\nFor example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod.\nAn adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials.\nAn adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName|endswith": [
                        "/MUTATINGWEBHOOKCONFIGURATIONS/WRITE",
                        "/VALIDATINGWEBHOOKCONFIGURATIONS/WRITE"
                    ],
                    "operationName|startswith": [
                        "MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO",
                        "MICROSOFT.CONTAINERSERVICE/MANAGEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO"
                    ]
                }
            },
            "falsepositives": [
                "Azure Kubernetes Admissions Controller may be done by a system administrator.",
                "If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "a61a3c56-4ce2-4351-a079-88ae4cbd2b58",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/12/18",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1078",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.007"
            ],
            "title": "Azure Kubernetes Admission Controller"
        },
        {
            "author": "kelnage",
            "date": "2024/07/11",
            "description": "Detects when a modification (create, update or replace) action is taken that affects mutating or validating webhook configurations, as they can be used by an adversary to achieve persistence or exfiltrate access credentials.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "objectRef.apiGroup": "admissionregistration.k8s.io",
                    "objectRef.resource": [
                        "mutatingwebhookconfigurations",
                        "validatingwebhookconfigurations"
                    ],
                    "verb": [
                        "create",
                        "delete",
                        "patch",
                        "replace",
                        "update"
                    ]
                }
            },
            "falsepositives": [
                "Modifying the Kubernetes Admission Controller may need to be done by a system administrator.",
                "Automated processes may need to take these actions and may need to be filtered."
            ],
            "id": "eed82177-38f5-4299-8a76-098d50d225ab",
            "level": "medium",
            "logsource": {
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://kubernetes.io/docs/reference/config-api/apiserver-audit.v1/",
                "https://security.padok.fr/en/blog/kubernetes-webhook-attackers"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "6ad91e31-53df-4826-bd27-0166171c8040"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1078",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.007"
            ],
            "title": "Kubernetes Admission Controller Modification"
        },
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects enumeration of Kubernetes secrets.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "objectRef.resource": "secrets",
                    "verb": "list"
                }
            },
            "falsepositives": [
                "The Kubernetes dashboard occasionally accesses the kubernetes-dashboard-key-holder secret"
            ],
            "id": "eeb3e9e1-b685-44e4-9232-6bb701f925b5",
            "level": "low",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://microsoft.github.io/Threat-Matrix-for-Kubernetes/techniques/List%20K8S%20secrets/"
            ],
            "related": [
                {
                    "id": "7ee0b4aa-d8d4-4088-b661-20efdf41a04c",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.t1552.007"
            ],
            "title": "Kubernetes Secrets Enumeration"
        }
    ]
}