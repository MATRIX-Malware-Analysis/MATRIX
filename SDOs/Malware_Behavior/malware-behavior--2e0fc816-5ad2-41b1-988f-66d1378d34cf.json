{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--2e0fc816-5ad2-41b1-988f-66d1378d34cf",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.057949Z",
    "name": "Create or Modify System Process: Launch Daemon",
    "description": "Adversaries may create or modify Launch Daemons to execute malicious payloads as part of persistence. Launch Daemons are plist files used to interact with Launchd, the service management framework used by macOS. Launch Daemons require elevated privileges to install, are executed for every user on a system prior to login, and run in the background without the need for user interaction. During the macOS initialization startup, the launchd process loads the parameters for launch-on-demand system-level daemons from plist files found in /System/Library/LaunchDaemons/ and /Library/LaunchDaemons/. Required Launch Daemons parameters include a Label to identify the task, Program to provide a path to the executable, and RunAtLoad to specify when the task is run. Launch Daemons are often used to provide access to shared resources, updates to software, or conduct automation tasks.[1][2][3]Adversaries may install a Launch Daemon configured to execute at startup by using the RunAtLoad parameter set to true and the Program parameter set to the malicious executable path. The daemon name may be disguised by using a name from a related operating system or benign software (i.e. Masquerading). When the Launch Daemon is executed, the program inherits administrative permissions.[4][5]Additionally, system configuration changes (such as the installation of third party package managing software) may cause folders such as usr/local/bin to become globally writeable. So, it is possible for poor configurations to allow an adversary to modify executables referenced by current Launch Daemon's plist files.[6][7]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1543/004",
            "external_id": "T1543/004"
        },
        {
            "source_name": "CAPEC 564",
            "external_id": "malware-behavior--f5b71bfe-8ee3-4767-b9da-031cbb48d99e"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/02/18",
            "description": "Detects potential persistence activity using LaunchAgents or LaunchDaemons via the PlistBuddy utility",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "LaunchAgents",
                        "LaunchDaemons"
                    ],
                    "CommandLine|contains|all": [
                        "RunAtLoad",
                        "true"
                    ],
                    "Image|endswith": "/PlistBuddy"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "65d506d3-fcfe-4071-b4b2-bcefe721bbbb",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://redcanary.com/blog/clipping-silver-sparrows-wings/",
                "https://www.manpagez.com/man/8/PlistBuddy/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1543.001",
                "attack.t1543.004"
            ],
            "title": "Potential Persistence Via PlistBuddy"
        },
        {
            "author": "Pratinav Chandra",
            "date": "2024/05/13",
            "description": "Detects the execution of programs as Launch Agents or Launch Daemons using launchctl on macOS.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "submit",
                        "load",
                        "start"
                    ],
                    "Image|endswith": "/launchctl"
                }
            },
            "falsepositives": [
                "Legitimate administration activities is expected to trigger false positives. Investigate the command line being passed to determine if the service or launch agent are suspicious."
            ],
            "id": "ae9d710f-dcd1-4f75-a0a5-93a73b5dda0e",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1569.001/T1569.001.md",
                "https://www.sentinelone.com/labs/20-common-tools-techniques-used-by-macos-threat-actors-malware/",
                "https://www.welivesecurity.com/2020/07/16/mac-cryptocurrency-trading-application-rebranded-bundled-malware/",
                "https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html",
                "https://www.loobins.io/binaries/launchctl/"
            ],
            "status": "experimental",
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1569.001",
                "attack.t1543.001",
                "attack.t1543.004"
            ],
            "title": "Launch Agent/Daemon Execution Via Launchctl"
        }
    ]
}