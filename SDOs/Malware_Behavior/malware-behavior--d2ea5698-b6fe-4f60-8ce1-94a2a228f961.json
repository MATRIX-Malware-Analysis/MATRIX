{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--d2ea5698-b6fe-4f60-8ce1-94a2a228f961",
    "created": "2024-08-13T14:46:37.02575Z",
    "modified": "2024-08-13T14:46:48.534433Z",
    "name": "Command and Scripting Interpreter: Python",
    "description": "Adversaries may abuse Python commands and scripts for execution. Python is a very popular scripting/programming language, with capabilities to perform many functions. Python can be executed interactively from the command-line (via the python.exe interpreter) or via scripts (.py) that can be written and distributed to different systems. Python code can also be compiled into binary executables.[1]Python comes with many built-in packages to interact with the underlying system, such as file operations and device I/O. Adversaries can use these libraries to download and execute commands or other scripts as well as perform various malicious behaviors.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1059/006",
            "external_id": "T1059/006"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "string": "pyarmor_runtimesh"
                            },
                            {
                                "string": "PYARMOR"
                            },
                            {
                                "string": "__pyarmor__"
                            },
                            {
                                "string": "PYARMOR_SIGNATURE"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Execution::Command and Scripting Interpreter::Python [T1059.006]",
                        "Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]"
                    ],
                    "authors": [
                        "@stvemillertime, @itreallynick"
                    ],
                    "examples": [
                        "a0fb20bc9aa944c3a0a6c4545c195818"
                    ],
                    "name": "compiled with pyarmor",
                    "namespace": "compiler/pyarmor",
                    "references": [
                        "https://twitter.com/stvemillertime/status/1349032548580483073"
                    ],
                    "scopes": {
                        "dynamic": "file",
                        "static": "file"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "and": [
                                    {
                                        "os": "windows"
                                    },
                                    {
                                        "3 or more": [
                                            {
                                                "string": "cx_Freeze Fatal Error"
                                            },
                                            {
                                                "string": "cx_Freeze: Python error in main script"
                                            },
                                            {
                                                "string": "cx_Freeze: Application Terminated"
                                            },
                                            {
                                                "string": "%ls\\lib\\library.zip;%ls\\lib"
                                            },
                                            {
                                                "string": "Unable to calculate directory of executable!"
                                            },
                                            {
                                                "string": "Unable to load python3.dll!"
                                            },
                                            {
                                                "string": "Unable to change DLL search path!"
                                            },
                                            {
                                                "string": "initializing with config file %ls"
                                            },
                                            {
                                                "string": "%ls --install <NAME> [<CONFIGFILE>]"
                                            },
                                            {
                                                "string": "exception calling session_changed method"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "and": [
                                    {
                                        "or": [
                                            {
                                                "os": "linux"
                                            },
                                            {
                                                "os": "macos"
                                            }
                                        ]
                                    },
                                    {
                                        "3 or more": [
                                            {
                                                "string": "PATH environment variable not defined!"
                                            },
                                            {
                                                "string": "Unable to determine absolute path for executable!"
                                            },
                                            {
                                                "string": "Unable to convert path to string!"
                                            },
                                            {
                                                "string": "Unable to calculate directory of executable!"
                                            },
                                            {
                                                "string": "Out of memory creating sys.path!"
                                            },
                                            {
                                                "string": "Out of memory converting arguments!"
                                            },
                                            {
                                                "string": "Unable to convert argument to string!"
                                            },
                                            {
                                                "string": "%ls/lib/library.zip:%ls/lib"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Execution::Command and Scripting Interpreter::Python [T1059.006]",
                        "Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]"
                    ],
                    "authors": [
                        "@mr-tz",
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "573174640974b288d9d161cf4d29387cd7dbf7d80a80f5547df887f9836df8fb"
                    ],
                    "name": "compiled with cx_Freeze",
                    "namespace": "compiler/cx_freeze",
                    "references": [
                        "https://github.com/marcelotduarte/cx_Freeze"
                    ],
                    "scopes": {
                        "dynamic": "file",
                        "static": "file"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Markus Neis, Sander Wiebing",
            "date": "2018/11/22",
            "description": "Detects Executables in the Downloads folder without FileVersion,Description,Product,Company likely created with py2exe",
            "detection": {
                "condition": "(selection1 or selection2 or selection3) and folder",
                "folder": {
                    "Image|contains": "\\Downloads\\"
                },
                "selection1": {
                    "Description": "\\?",
                    "FileVersion": "\\?"
                },
                "selection2": {
                    "Description": "\\?",
                    "Product": "\\?"
                },
                "selection3": {
                    "Description": "\\?",
                    "Company": "\\?"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "9637e8a5-7131-4f7f-bdc7-2b05d8670c43",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://securelist.com/muddywater/88059/",
                "https://www.virustotal.com/#/file/276a765a10f98cda1a38d3a31e7483585ca3722ecad19d784441293acf1b7beb/detection"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.006"
            ],
            "title": "Suspicious File Characteristics Due to Missing Fields"
        },
        {
            "author": "Pushkarev Dmitry",
            "date": "2020/06/28",
            "description": "Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        8004,
                        8007,
                        8022,
                        8025
                    ]
                }
            },
            "falsepositives": [
                "Need tuning applocker or add exceptions in SIEM"
            ],
            "fields": [
                "PolicyName",
                "RuleId",
                "RuleName",
                "TargetUser",
                "TargetProcessId",
                "FilePath",
                "FileHash",
                "Fqbn"
            ],
            "id": "401e5d00-b944-11ea-8f9a-00163ecd60ae",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "applocker"
            },
            "modified": "2021/11/27",
            "references": [
                "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/what-is-applocker",
                "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/using-event-viewer-with-applocker",
                "https://nxlog.co/documentation/nxlog-user-guide/applocker.html"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1204.002",
                "attack.t1059.001",
                "attack.t1059.003",
                "attack.t1059.005",
                "attack.t1059.006",
                "attack.t1059.007"
            ],
            "title": "File Was Not Allowed To Run"
        }
    ]
}