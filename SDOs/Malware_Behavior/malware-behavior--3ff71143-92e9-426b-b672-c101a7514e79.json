{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--3ff71143-92e9-426b-b672-c101a7514e79",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.406129Z",
    "name": "Permission Groups Discovery",
    "description": "Adversaries may attempt to discover group and permission settings. This information can help adversaries determine which user accounts and groups are available, the membership of users in particular groups, and which users and groups have elevated permissions.Adversaries may attempt to discover group permission settings in many different ways. This data may provide the adversary with information about the compromised environment that can be used in follow-on activity and targeting.[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1069",
            "external_id": "T1069"
        },
        {
            "source_name": "CAPEC 576",
            "external_id": "malware-behavior--46538d03-15e2-40e9-8298-09a3b4ea7dfb"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1069",
            "external_id": "T1069"
        },
        {
            "source_name": "K8s Authorization Overview",
            "description": "Kubernetes. (n.d.). Authorization Overview. Retrieved June 24, 2021.",
            "url": "https://kubernetes.io/docs/reference/access-authn-authz/authorization/"
        },
        {
            "source_name": "CrowdStrike BloodHound April 2018",
            "description": "Red Team Labs. (2018, April 24). Hidden Administrative Accounts: BloodHound to the Rescue. Retrieved October 28, 2020.",
            "url": "https://www.crowdstrike.com/blog/hidden-administrative-accounts-bloodhound-to-the-rescue/"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "netapi32.NetGroupEnum"
                            },
                            {
                                "api": "netapi32.NetLocalGroupEnum"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Permission Groups Discovery [T1069]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "description": "enumerates all the groups present on the system/domain",
                    "name": "list user account groups",
                    "namespace": "host-interaction/accounts",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "netapi32.NetLocalGroupGetMembers"
                            },
                            {
                                "api": "netapi32.NetGroupGetUsers"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Permission Groups Discovery [T1069]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "name": "list user accounts for group",
                    "namespace": "host-interaction/accounts",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects identities attempting to enumerate their Kubernetes RBAC permissions.\nIn the early stages of a breach, attackers will aim to list the permissions they have within the compromised environment.\nIn a Kubernetes cluster, this can be achieved by interacting with the API server, and querying the SelfSubjectAccessReview API via e.g. a \"kubectl auth can-i --list\" command.\nThis will enumerate the Role-Based Access Controls (RBAC) rules defining the compromised user's authorization.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "apiGroup": "authorization.k8s.io",
                    "objectRef.resource": "selfsubjectrulesreviews",
                    "verb": "create"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "84b777bd-c946-4d17-aa2e-c39f5a454325",
            "level": "low",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://www.elastic.co/guide/en/security/current/kubernetes-suspicious-self-subject-review.html"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1069.003",
                "attack.t1087.004"
            ],
            "title": "RBAC Permission Enumeration Attempt"
        },
        {
            "author": "\u00d6mer G\u00fcnal, Alejandro Ortuno, oscd.community",
            "date": "2020/10/11",
            "description": "Detects enumeration of local system groups",
            "detection": {
                "condition": "1 of selection*",
                "selection_1": {
                    "CommandLine|contains|all": [
                        "-q",
                        "group"
                    ],
                    "Image|endswith": "/dscacheutil"
                },
                "selection_2": {
                    "CommandLine|contains": "/etc/group",
                    "Image|endswith": "/cat"
                },
                "selection_3": {
                    "CommandLine|contains|all": [
                        "-list",
                        "/groups"
                    ],
                    "Image|endswith": "/dscl"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "89bb1f97-c7b9-40e8-b52b-7d6afbd67276",
            "level": "informational",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2022/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Local Groups Discovery - MacOs"
        },
        {
            "author": "C.J. May",
            "date": "2022/08/09",
            "description": "Detects default file names outputted by the BloodHound collection tool SharpHound",
            "detection": {
                "condition": "selection and not 1 of filter_optional_*",
                "filter_optional_ms_winapps": {
                    "Image|endswith": "\\svchost.exe",
                    "TargetFilename|endswith": "\\pocket_containers.json",
                    "TargetFilename|startswith": "C:\\Program Files\\WindowsApps\\Microsoft."
                },
                "selection": {
                    "TargetFilename|endswith": [
                        "BloodHound.zip",
                        "_computers.json",
                        "_containers.json",
                        "_domains.json",
                        "_gpos.json",
                        "_groups.json",
                        "_ous.json",
                        "_users.json"
                    ]
                }
            },
            "falsepositives": [
                "Some false positives may arise in some environment and this may require some tuning. Add additional filters or reduce level depending on the level of noise"
            ],
            "id": "02773bed-83bf-469f-b7ff-e676e7d78bab",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/03/29",
            "references": [
                "https://academy.hackthebox.com/course/preview/active-directory-bloodhound/bloodhound--data-collection"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1087.001",
                "attack.t1087.002",
                "attack.t1482",
                "attack.t1069.001",
                "attack.t1069.002",
                "attack.execution",
                "attack.t1059.001"
            ],
            "title": "BloodHound Collection Files"
        },
        {
            "author": "Janantha Marasinghe (https://github.com/blueteam0ps), FPT.EagleEye Team, omkar72, oscd.community",
            "date": "2021/02/02",
            "description": "Detects AdFind execution with common flags seen used during attacks",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "domainlist",
                        "trustdmp",
                        "dcmodes",
                        "adinfo",
                        " dclist ",
                        "computer_pwdnotreqd",
                        "objectcategory=",
                        "-subnets -f",
                        "name=\"Domain Admins\"",
                        "-sc u:",
                        "domainncs",
                        "dompol",
                        " oudmp ",
                        "subnetdmp",
                        "gpodmp",
                        "fspdmp",
                        "users_noexpire",
                        "computers_active",
                        "computers_pwdnotreqd"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate admin activity"
            ],
            "id": "9a132afa-654e-11eb-ae93-0242ac130002",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/05",
            "references": [
                "https://www.joeware.net/freetools/tools/adfind/",
                "https://thedfirreport.com/2020/05/08/adfind-recon/",
                "https://thedfirreport.com/2021/01/11/trickbot-still-alive-and-well/",
                "https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/",
                "https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx",
                "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/bf62ece1c679b07b5fb49c4bae947fe24c81811f/fin6/Emulation_Plan/Phase1.md",
                "https://github.com/redcanaryco/atomic-red-team/blob/0f229c0e42bfe7ca736a14023836d65baa941ed2/atomics/T1087.002/T1087.002.md#atomic-test-7---adfind---enumerate-active-directory-user-objects"
            ],
            "related": [
                {
                    "id": "455b9d50-15a1-4b99-853f-8d37655a4c1b",
                    "type": "similar"
                },
                {
                    "id": "75df3b17-8bcc-4565-b89b-c9898acef911",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1018",
                "attack.t1087.002",
                "attack.t1482",
                "attack.t1069.002",
                "stp.1u"
            ],
            "title": "PUA - AdFind Suspicious Execution"
        },
        {
            "author": "frack113",
            "date": "2021/12/12",
            "description": "Detects the execution of \"wmic\" with the \"group\" flag.\nAdversaries may attempt to find local system groups and permission settings.\nThe knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.\n",
            "detection": {
                "condition": "all of selection*",
                "selection_cli": {
                    "CommandLine|contains": " group"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\wmic.exe"
                    },
                    {
                        "OriginalFileName": "wmic.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "164eda96-11b2-430b-85ff-6a265c15bf32",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Local Groups Reconnaissance Via Wmic.EXE"
        },
        {
            "author": "frack113",
            "date": "2021/12/10",
            "description": "Adversaries may look for details about the network configuration and settings of systems they access or through information discovery of remote systems",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "OriginalFileName": "SharpView.exe"
                    },
                    {
                        "Image|endswith": "\\SharpView.exe"
                    },
                    {
                        "CommandLine|contains": [
                            "Add-RemoteConnection",
                            "Convert-ADName",
                            "ConvertFrom-SID",
                            "ConvertFrom-UACValue",
                            "Convert-SidToName",
                            "Export-PowerViewCSV",
                            "Find-DomainObjectPropertyOutlier",
                            "Find-DomainProcess",
                            "Find-DomainShare",
                            "Find-DomainUserEvent",
                            "Find-DomainUserLocation",
                            "Find-ForeignGroup",
                            "Find-ForeignUser",
                            "Find-GPOComputerAdmin",
                            "Find-GPOLocation",
                            "Find-Interesting",
                            "Find-LocalAdminAccess",
                            "Find-ManagedSecurityGroups",
                            "Get-CachedRDPConnection",
                            "Get-DFSshare",
                            "Get-DomainComputer",
                            "Get-DomainController",
                            "Get-DomainDFSShare",
                            "Get-DomainDNSRecord",
                            "Get-DomainFileServer",
                            "Get-DomainForeign",
                            "Get-DomainGPO",
                            "Get-DomainGroup",
                            "Get-DomainGUIDMap",
                            "Get-DomainManagedSecurityGroup",
                            "Get-DomainObject",
                            "Get-DomainOU",
                            "Get-DomainPolicy",
                            "Get-DomainSID",
                            "Get-DomainSite",
                            "Get-DomainSPNTicket",
                            "Get-DomainSubnet",
                            "Get-DomainTrust",
                            "Get-DomainUserEvent",
                            "Get-ForestDomain",
                            "Get-ForestGlobalCatalog",
                            "Get-ForestTrust",
                            "Get-GptTmpl",
                            "Get-GroupsXML",
                            "Get-LastLoggedOn",
                            "Get-LoggedOnLocal",
                            "Get-NetComputer",
                            "Get-NetDomain",
                            "Get-NetFileServer",
                            "Get-NetForest",
                            "Get-NetGPO",
                            "Get-NetGroupMember",
                            "Get-NetLocalGroup",
                            "Get-NetLoggedon",
                            "Get-NetOU",
                            "Get-NetProcess",
                            "Get-NetRDPSession",
                            "Get-NetSession",
                            "Get-NetShare",
                            "Get-NetSite",
                            "Get-NetSubnet",
                            "Get-NetUser",
                            "Get-PathAcl",
                            "Get-PrincipalContext",
                            "Get-RegistryMountedDrive",
                            "Get-RegLoggedOn",
                            "Get-WMIRegCachedRDPConnection",
                            "Get-WMIRegLastLoggedOn",
                            "Get-WMIRegMountedDrive",
                            "Get-WMIRegProxy",
                            "Invoke-ACLScanner",
                            "Invoke-CheckLocalAdminAccess",
                            "Invoke-Kerberoast",
                            "Invoke-MapDomainTrust",
                            "Invoke-RevertToSelf",
                            "Invoke-Sharefinder",
                            "Invoke-UserImpersonation",
                            "Remove-DomainObjectAcl",
                            "Remove-RemoteConnection",
                            "Request-SPNTicket",
                            "Set-DomainObject",
                            "Test-AdminAccess"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b2317cfa-4a47-4ead-b3ff-297438c0bc2d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://github.com/tevora-threat/SharpView/",
                "https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1049/T1049.md#atomic-test-4---system-discovery-using-sharpview"
            ],
            "related": [
                {
                    "id": "dcd74b95-3f36-4ed9-9598-0490951643aa",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1049",
                "attack.t1069.002",
                "attack.t1482",
                "attack.t1135",
                "attack.t1033"
            ],
            "title": "HackTool - SharpView Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/20",
            "description": "Detects command line parameters used by Bloodhound and Sharphound hack tools",
            "detection": {
                "condition": "1 of selection_*",
                "selection_cli_1": {
                    "CommandLine|contains": [
                        " -CollectionMethod All ",
                        " --CollectionMethods Session ",
                        " --Loop --Loopduration ",
                        " --PortScanTimeout ",
                        ".exe -c All -d ",
                        "Invoke-Bloodhound",
                        "Get-BloodHoundData"
                    ]
                },
                "selection_cli_2": {
                    "CommandLine|contains|all": [
                        " -JsonFolder ",
                        " -ZipFileName "
                    ]
                },
                "selection_cli_3": {
                    "CommandLine|contains|all": [
                        " DCOnly ",
                        " --NoSaveCache "
                    ]
                },
                "selection_img": [
                    {
                        "Product|contains": "SharpHound"
                    },
                    {
                        "Description|contains": "SharpHound"
                    },
                    {
                        "Company|contains": [
                            "SpecterOps",
                            "evil corp"
                        ]
                    },
                    {
                        "Image|contains": [
                            "\\Bloodhound.exe",
                            "\\SharpHound.exe"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Other programs that use these command line option and accepts an 'All' parameter"
            ],
            "id": "f376c8a7-a2d0-4ddc-aa0c-16c17236d962",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/BloodHoundAD/BloodHound",
                "https://github.com/BloodHoundAD/SharpHound"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1087.001",
                "attack.t1087.002",
                "attack.t1482",
                "attack.t1069.001",
                "attack.t1069.002",
                "attack.execution",
                "attack.t1059.001"
            ],
            "title": "HackTool - Bloodhound/Sharphound Execution"
        },
        {
            "author": "Teymur Kheirkhabarov (idea), Mangatas Tondang, oscd.community, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/10/13",
            "description": "Detects the usage of the \"Accesschk\" utility, an access and privilege audit tool developed by SysInternal and often being abused by attacker to verify process privileges",
            "detection": {
                "condition": "all of selection*",
                "selection_cli": {
                    "CommandLine|contains": [
                        "uwcqv ",
                        "kwsu ",
                        "qwsu ",
                        "uwdqs "
                    ]
                },
                "selection_img": [
                    {
                        "Product|endswith": "AccessChk"
                    },
                    {
                        "Description|contains": "Reports effective permissions"
                    },
                    {
                        "Image|endswith": [
                            "\\accesschk.exe",
                            "\\accesschk64.exe"
                        ]
                    },
                    {
                        "OriginalFileName": "accesschk.exe"
                    }
                ]
            },
            "falsepositives": [
                "System administrator Usage"
            ],
            "fields": [
                "IntegrityLevel",
                "Product",
                "Description",
                "CommandLine"
            ],
            "id": "c625d754-6a3d-4f65-9c9a-536aea960d37",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2023/02/20",
            "status": "test",
            "references": [
                "https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment?slide=43",
                "https://www.youtube.com/watch?v=JGs-aKf2OtU&ab_channel=OFFZONEMOSCOW",
                "https://github.com/carlospolop/PEASS-ng/blob/fa0f2e17fbc1d86f1fd66338a40e665e7182501d/winPEAS/winPEASbat/winPEAS.bat",
                "https://github.com/gladiatx0r/Powerless/blob/04f553bbc0c65baf4e57344deff84e3f016e6b51/Powerless.bat"
            ],
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Permission Check Via Accesschk.EXE"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/02",
            "description": "Detects Commandlet names from well-known PowerShell exploitation frameworks",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "Add-Exfiltration",
                        "Add-Persistence",
                        "Add-RegBackdoor",
                        "Add-RemoteRegBackdoor",
                        "Add-ScrnSaveBackdoor",
                        "Check-VM",
                        "ConvertTo-Rc4ByteStream",
                        "Decrypt-Hash",
                        "Disable-ADIDNSNode",
                        "Disable-MachineAccount",
                        "Do-Exfiltration",
                        "Enable-ADIDNSNode",
                        "Enable-MachineAccount",
                        "Enabled-DuplicateToken",
                        "Exploit-Jboss",
                        "Export-ADR",
                        "Export-ADRCSV",
                        "Export-ADRExcel",
                        "Export-ADRHTML",
                        "Export-ADRJSON",
                        "Export-ADRXML",
                        "Find-Fruit",
                        "Find-GPOLocation",
                        "Find-TrustedDocuments",
                        "Get-ADIDNS",
                        "Get-ApplicationHost",
                        "Get-ChromeDump",
                        "Get-ClipboardContents",
                        "Get-FoxDump",
                        "Get-GPPPassword",
                        "Get-IndexedItem",
                        "Get-KerberosAESKey",
                        "Get-Keystrokes",
                        "Get-LSASecret",
                        "Get-MachineAccountAttribute",
                        "Get-MachineAccountCreator",
                        "Get-PassHashes",
                        "Get-RegAlwaysInstallElevated",
                        "Get-RegAutoLogon",
                        "Get-RemoteBootKey",
                        "Get-RemoteCachedCredential",
                        "Get-RemoteLocalAccountHash",
                        "Get-RemoteLSAKey",
                        "Get-RemoteMachineAccountHash",
                        "Get-RemoteNLKMKey",
                        "Get-RickAstley",
                        "Get-Screenshot",
                        "Get-SecurityPackages",
                        "Get-ServiceFilePermission",
                        "Get-ServicePermission",
                        "Get-ServiceUnquoted",
                        "Get-SiteListPassword",
                        "Get-System",
                        "Get-TimedScreenshot",
                        "Get-UnattendedInstallFile",
                        "Get-Unconstrained",
                        "Get-USBKeystrokes",
                        "Get-VaultCredential",
                        "Get-VulnAutoRun",
                        "Get-VulnSchTask",
                        "Grant-ADIDNSPermission",
                        "Gupt-Backdoor",
                        "HTTP-Login",
                        "Install-ServiceBinary",
                        "Install-SSP",
                        "Invoke-ACLScanner",
                        "Invoke-ADRecon",
                        "Invoke-ADSBackdoor",
                        "Invoke-AgentSmith",
                        "Invoke-AllChecks",
                        "Invoke-ARPScan",
                        "Invoke-AzureHound",
                        "Invoke-BackdoorLNK",
                        "Invoke-BadPotato",
                        "Invoke-BetterSafetyKatz",
                        "Invoke-BypassUAC",
                        "Invoke-Carbuncle",
                        "Invoke-Certify",
                        "Invoke-ConPtyShell",
                        "Invoke-CredentialInjection",
                        "Invoke-DAFT",
                        "Invoke-DCSync",
                        "Invoke-DinvokeKatz",
                        "Invoke-DllInjection",
                        "Invoke-DNSUpdate",
                        "Invoke-DomainPasswordSpray",
                        "Invoke-DowngradeAccount",
                        "Invoke-EgressCheck",
                        "Invoke-Eyewitness",
                        "Invoke-FakeLogonScreen",
                        "Invoke-Farmer",
                        "Invoke-Get-RBCD-Threaded",
                        "Invoke-Gopher",
                        "Invoke-Grouper",
                        "Invoke-HandleKatz",
                        "Invoke-ImpersonatedProcess",
                        "Invoke-ImpersonateSystem",
                        "Invoke-InteractiveSystemPowerShell",
                        "Invoke-Internalmonologue",
                        "Invoke-Inveigh",
                        "Invoke-InveighRelay",
                        "Invoke-KrbRelay",
                        "Invoke-LdapSignCheck",
                        "Invoke-Lockless",
                        "Invoke-MalSCCM",
                        "Invoke-Mimikatz",
                        "Invoke-Mimikittenz",
                        "Invoke-MITM6",
                        "Invoke-NanoDump",
                        "Invoke-NetRipper",
                        "Invoke-Nightmare",
                        "Invoke-NinjaCopy",
                        "Invoke-OfficeScrape",
                        "Invoke-OxidResolver",
                        "Invoke-P0wnedshell",
                        "Invoke-Paranoia",
                        "Invoke-PortScan",
                        "Invoke-PoshRatHttp",
                        "Invoke-PostExfil",
                        "Invoke-PowerDump",
                        "Invoke-PowerShellTCP",
                        "Invoke-PowerShellWMI",
                        "Invoke-PPLDump",
                        "Invoke-PsExec",
                        "Invoke-PSInject",
                        "Invoke-PsUaCme",
                        "Invoke-ReflectivePEInjection",
                        "Invoke-ReverseDNSLookup",
                        "Invoke-Rubeus",
                        "Invoke-RunAs",
                        "Invoke-SafetyKatz",
                        "Invoke-SauronEye",
                        "Invoke-SCShell",
                        "Invoke-Seatbelt",
                        "Invoke-ServiceAbuse",
                        "Invoke-ShadowSpray",
                        "Invoke-Sharp",
                        "Invoke-Shellcode",
                        "Invoke-SMBScanner",
                        "Invoke-Snaffler",
                        "Invoke-Spoolsample",
                        "Invoke-SpraySinglePassword",
                        "Invoke-SSHCommand",
                        "Invoke-StandIn",
                        "Invoke-StickyNotesExtract",
                        "Invoke-SystemCommand",
                        "Invoke-Tasksbackdoor",
                        "Invoke-Tater",
                        "Invoke-Thunderfox",
                        "Invoke-ThunderStruck",
                        "Invoke-TokenManipulation",
                        "Invoke-Tokenvator",
                        "Invoke-TotalExec",
                        "Invoke-UrbanBishop",
                        "Invoke-UserHunter",
                        "Invoke-VoiceTroll",
                        "Invoke-Whisker",
                        "Invoke-WinEnum",
                        "Invoke-winPEAS",
                        "Invoke-WireTap",
                        "Invoke-WmiCommand",
                        "Invoke-WMIExec",
                        "Invoke-WScriptBypassUAC",
                        "Invoke-Zerologon",
                        "MailRaider",
                        "New-ADIDNSNode",
                        "New-DNSRecordArray",
                        "New-HoneyHash",
                        "New-InMemoryModule",
                        "New-MachineAccount",
                        "New-SOASerialNumberArray",
                        "Out-Minidump",
                        "Port-Scan",
                        "PowerBreach",
                        "powercat ",
                        "PowerUp",
                        "PowerView",
                        "Remove-ADIDNSNode",
                        "Remove-MachineAccount",
                        "Remove-Update",
                        "Rename-ADIDNSNode",
                        "Revoke-ADIDNSPermission",
                        "Set-ADIDNSNode",
                        "Set-MacAttribute",
                        "Set-MachineAccountAttribute",
                        "Set-Wallpaper",
                        "Show-TargetScreen",
                        "Start-CaptureServer",
                        "Start-Dnscat2",
                        "Start-WebcamRecorder",
                        "VolumeShadowCopyTools"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "02030f2f-6199-49ec-b258-ea71b07e03dc",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/01/25",
            "status": "experimental",
            "references": [
                "https://adsecurity.org/?p=2921",
                "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries",
                "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1",
                "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1",
                "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1",
                "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1",
                "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/",
                "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/",
                "https://github.com/calebstewart/CVE-2021-1675",
                "https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1",
                "https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html",
                "https://github.com/HarmJ0y/DAMP",
                "https://github.com/samratashok/nishang",
                "https://github.com/DarkCoderSc/PowerRunAsSystem/",
                "https://github.com/besimorhino/powercat",
                "https://github.com/Kevin-Robertson/Powermad",
                "https://github.com/adrecon/ADRecon",
                "https://github.com/adrecon/AzureADRecon"
            ],
            "related": [
                {
                    "id": "89819aa4-bbd6-46bc-88ec-c7f7fe30efa6",
                    "type": "derived"
                },
                {
                    "id": "7d0d0329-0ef1-4e84-a9f5-49500f9d7c6c",
                    "type": "similar"
                }
            ],
            "tags": [
                "attack.execution",
                "attack.discovery",
                "attack.t1482",
                "attack.t1087",
                "attack.t1087.001",
                "attack.t1087.002",
                "attack.t1069.001",
                "attack.t1069.002",
                "attack.t1069",
                "attack.t1059.001"
            ],
            "title": "Malicious PowerShell Commandlets - ProcessCreation"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/08/21",
            "description": "Detects the use of a renamed Adfind.exe. AdFind continues to be seen across majority of breaches. It is used to domain trust discovery to plan out subsequent steps in the attack chain.",
            "detection": {
                "condition": "1 of selection* and not filter",
                "filter": {
                    "Image|endswith": "\\AdFind.exe"
                },
                "selection_1": {
                    "CommandLine|contains": [
                        "domainlist",
                        "trustdmp",
                        "dcmodes",
                        "adinfo",
                        " dclist ",
                        "computer_pwdnotreqd",
                        "objectcategory=",
                        "-subnets -f",
                        "name=\"Domain Admins\"",
                        "-sc u:",
                        "domainncs",
                        "dompol",
                        " oudmp ",
                        "subnetdmp",
                        "gpodmp",
                        "fspdmp",
                        "users_noexpire",
                        "computers_active",
                        "computers_pwdnotreqd"
                    ]
                },
                "selection_2": [
                    {
                        "Imphash": [
                            "bca5675746d13a1f246e2da3c2217492",
                            "53e117a96057eaf19c41380d0e87f1c2"
                        ]
                    },
                    {
                        "Hashes|contains": [
                            "IMPHASH=BCA5675746D13A1F246E2DA3C2217492",
                            "IMPHASH=53E117A96057EAF19C41380D0E87F1C2"
                        ]
                    }
                ],
                "selection_3": {
                    "OriginalFileName": "AdFind.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "df55196f-f105-44d3-a675-e9dfb6cc2f2b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://www.joeware.net/freetools/tools/adfind/",
                "https://thedfirreport.com/2020/05/08/adfind-recon/",
                "https://thedfirreport.com/2021/01/11/trickbot-still-alive-and-well/",
                "https://www.microsoft.com/security/blog/2021/01/20/deep-dive-into-the-solorigate-second-stage-activation-from-sunburst-to-teardrop-and-raindrop/",
                "https://social.technet.microsoft.com/wiki/contents/articles/7535.adfind-command-examples.aspx",
                "https://github.com/center-for-threat-informed-defense/adversary_emulation_library/blob/bf62ece1c679b07b5fb49c4bae947fe24c81811f/fin6/Emulation_Plan/Phase1.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1018",
                "attack.t1087.002",
                "attack.t1482",
                "attack.t1069.002"
            ],
            "title": "Renamed AdFind Execution"
        },
        {
            "author": "Adeem Mawani",
            "date": "2021/06/22",
            "description": "Detects potential Active Directory enumeration via LDAP",
            "detection": {
                "condition": "(generic_search and not narrow_down_filter) or suspicious_flag",
                "generic_search": {
                    "EventID": 30,
                    "SearchFilter|contains": [
                        "(groupType:1.2.840.113556.1.4.803:=2147483648)",
                        "(groupType:1.2.840.113556.1.4.803:=2147483656)",
                        "(groupType:1.2.840.113556.1.4.803:=2147483652)",
                        "(groupType:1.2.840.113556.1.4.803:=2147483650)",
                        "(sAMAccountType=805306369)",
                        "(sAMAccountType=805306368)",
                        "(sAMAccountType=536870913)",
                        "(sAMAccountType=536870912)",
                        "(sAMAccountType=268435457)",
                        "(sAMAccountType=268435456)",
                        "(objectCategory=groupPolicyContainer)",
                        "(objectCategory=organizationalUnit)",
                        "(objectCategory=Computer)",
                        "(objectCategory=nTDSDSA)",
                        "(objectCategory=server)",
                        "(objectCategory=domain)",
                        "(objectCategory=person)",
                        "(objectCategory=group)",
                        "(objectCategory=user)",
                        "(objectClass=trustedDomain)",
                        "(objectClass=computer)",
                        "(objectClass=server)",
                        "(objectClass=group)",
                        "(objectClass=user)",
                        "(primaryGroupID=521)",
                        "(primaryGroupID=516)",
                        "(primaryGroupID=515)",
                        "(primaryGroupID=512)",
                        "Domain Admins",
                        "objectGUID=\\*",
                        "(schemaIDGUID=\\*)"
                    ]
                },
                "narrow_down_filter": {
                    "EventID": 30,
                    "SearchFilter|contains": [
                        "(domainSid=*)",
                        "(objectSid=*)"
                    ]
                },
                "suspicious_flag": {
                    "EventID": 30,
                    "SearchFilter|contains": [
                        "(userAccountControl:1.2.840.113556.1.4.803:=4194304)",
                        "(userAccountControl:1.2.840.113556.1.4.803:=2097152)",
                        "!(userAccountControl:1.2.840.113556.1.4.803:=1048574)",
                        "(userAccountControl:1.2.840.113556.1.4.803:=524288)",
                        "(userAccountControl:1.2.840.113556.1.4.803:=65536)",
                        "(userAccountControl:1.2.840.113556.1.4.803:=8192)",
                        "(userAccountControl:1.2.840.113556.1.4.803:=544)",
                        "!(UserAccountControl:1.2.840.113556.1.4.803:=2)",
                        "msDS-AllowedToActOnBehalfOfOtherIdentity",
                        "msDS-AllowedToDelegateTo",
                        "msDS-GroupManagedServiceAccount",
                        "(accountExpires=9223372036854775807)",
                        "(accountExpires=0)",
                        "(adminCount=1)",
                        "ms-MCS-AdmPwd"
                    ]
                }
            },
            "id": "31d68132-4038-47c7-8f8e-635a39a7c174",
            "logsource": {
                "definition": "Requirements: Microsoft-Windows-LDAP-Client/Debug ETW logging",
                "product": "windows",
                "service": "ldap"
            },
            "modified": "2023/11/03",
            "level": "medium",
            "references": [
                "https://techcommunity.microsoft.com/t5/microsoft-defender-for-endpoint/hunting-for-reconnaissance-activities-using-ldap-search-filters/ba-p/824726",
                "https://github.com/PowerShellMafia/PowerSploit/blob/d943001a7defb5e0d1657085a77a0e78609be58f/Recon/PowerView.ps1",
                "https://github.com/BloodHoundAD/SharpHound3/blob/7d96b991b1887ff50349ce59c80980bc0d95c86a/SharpHound3/LdapBuilder.cs",
                "https://medium.com/falconforce/falconfriday-detecting-active-directory-data-collection-0xff21-c22d1a57494c",
                "https://github.com/fox-it/BloodHound.py/blob/d65eb614831cd30f26028ccb072f5e77ca287e0b/bloodhound/ad/domain.py#L427"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.002",
                "attack.t1087.002",
                "attack.t1482"
            ],
            "title": "Potential Active Directory Reconnaissance/Enumeration Via LDAP"
        },
        {
            "author": "Florian Roth (Nextron Systems), Jack Croock (method), Jonhnathan Ribeiro (improvements), oscd.community",
            "date": "2017/03/07",
            "description": "Detects activity as \"net user administrator /domain\" and \"net group domain admins /domain\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AccessMask": "0x2d",
                    "EventID": 4661,
                    "ObjectName|endswith": [
                        "-500",
                        "-512"
                    ],
                    "ObjectName|startswith": "S-1-5-21-",
                    "ObjectType": [
                        "SAM_USER",
                        "SAM_GROUP"
                    ]
                }
            },
            "falsepositives": [
                "Administrator activity"
            ],
            "id": "968eef52-9cff-4454-8992-1e74b9cbad6c",
            "level": "high",
            "logsource": {
                "definition": "The volume of Event ID 4661 is high on Domain Controllers and therefore \"Audit SAM\" and \"Audit Kernel Object\" advanced audit policy settings are not configured in the recommendations for server systems",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/08/22",
            "references": [
                "https://findingbad.blogspot.de/2017/01/hunting-what-does-it-look-like.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1087.002",
                "attack.t1069.002",
                "attack.s0039"
            ],
            "title": "Reconnaissance Activity"
        },
        {
            "author": "frack113",
            "date": "2021/12/15",
            "description": "Adversaries may attempt to find domain-level groups and permission settings.\nThe knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as domain administrators.\n",
            "detection": {
                "condition": "1 of test_*",
                "test_2": {
                    "ScriptBlockText|contains": "get-ADPrincipalGroupMembership"
                },
                "test_7": {
                    "ScriptBlockText|contains|all": [
                        "get-aduser",
                        "-f ",
                        "-pr ",
                        "DoesNotRequirePreAuth"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "88f0884b-331d-403d-a3a1-b668cf035603",
            "level": "low",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "AD Groups Or Users Enumeration Using PowerShell - ScriptBlock"
        },
        {
            "author": "frack113",
            "date": "2022/03/17",
            "description": "Detects usage of the \"Get-AdGroup\" cmdlet to enumerate Groups within Active Directory",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Get-AdGroup ",
                        "-Filter"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8c3a6607-b7dc-4f0d-a646-ef38c00b76ee",
            "level": "low",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/11/17",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1018/T1018.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.002"
            ],
            "title": "Active Directory Group Enumeration With Get-AdGroup"
        },
        {
            "author": "frack113",
            "date": "2021/12/12",
            "description": "Adversaries may attempt to find local system groups and permission settings.\nThe knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.\n",
            "detection": {
                "condition": "1 of test_*",
                "test_3": {
                    "ScriptBlockText|contains": [
                        "get-localgroup",
                        "Get-LocalGroupMember"
                    ]
                },
                "test_6": {
                    "ScriptBlockText|contains|all": [
                        "Get-WMIObject",
                        "Win32_Group"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fa6a5a45-3ee2-4529-aa14-ee5edc9e29cb",
            "level": "low",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/11/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Suspicious Get Local Groups Information - PowerShell"
        },
        {
            "id": "89819aa4-bbd6-46bc-88ec-c7f7fe30efa6",
            "author": "Sean Metcalf, Florian Roth, Bartlomiej Czyz @bczyz1, oscd.community, Nasreddine Bencherchali, Tim Shelton, Mustafa Kaan Demir, Georg Lauenstein, Max Altgelt, Tobias Michalski, Austin Songer",
            "date": "2017/03/05",
            "description": "Detects Commandlet names from well-known PowerShell exploitation frameworks",
            "detection": {
                "condition": "selection and not 1 of filter_optional_*",
                "filter_optional_amazon_ec2": {
                    "ScriptBlockText|contains": [
                        "Get-SystemDriveInfo",
                        "C:\\ProgramData\\Amazon\\EC2-Windows\\Launch\\Module\\"
                    ]
                },
                "selection": {
                    "ScriptBlockText|contains": [
                        "Add-Exfiltration",
                        "Add-Persistence",
                        "Add-RegBackdoor",
                        "Add-RemoteRegBackdoor",
                        "Add-ScrnSaveBackdoor",
                        "ConvertTo-Rc4ByteStream",
                        "Decrypt-Hash",
                        "Disable-ADIDNSNode",
                        "Do-Exfiltration",
                        "Enable-ADIDNSNode",
                        "Enabled-DuplicateToken",
                        "Exploit-Jboss",
                        "Export-ADRCSV",
                        "Export-ADRExcel",
                        "Export-ADRHTML",
                        "Export-ADRJSON",
                        "Export-ADRXML",
                        "Find-Fruit",
                        "Find-GPOLocation",
                        "Find-TrustedDocuments",
                        "Get-ADIDNSNodeAttribute",
                        "Get-ADIDNSNodeOwner",
                        "Get-ADIDNSNodeTombstoned",
                        "Get-ADIDNSPermission",
                        "Get-ADIDNSZone",
                        "Get-ChromeDump",
                        "Get-ClipboardContents",
                        "Get-FoxDump",
                        "Get-GPPPassword",
                        "Get-IndexedItem",
                        "Get-KerberosAESKey",
                        "Get-Keystrokes",
                        "Get-LSASecret",
                        "Get-PassHashes",
                        "Get-RegAlwaysInstallElevated",
                        "Get-RegAutoLogon",
                        "Get-RemoteBootKey",
                        "Get-RemoteCachedCredential",
                        "Get-RemoteLocalAccountHash",
                        "Get-RemoteLSAKey",
                        "Get-RemoteMachineAccountHash",
                        "Get-RemoteNLKMKey",
                        "Get-RickAstley",
                        "Get-SecurityPackages",
                        "Get-ServiceFilePermission",
                        "Get-ServicePermission",
                        "Get-ServiceUnquoted",
                        "Get-SiteListPassword",
                        "Get-System",
                        "Get-TimedScreenshot",
                        "Get-UnattendedInstallFile",
                        "Get-Unconstrained",
                        "Get-USBKeystrokes",
                        "Get-VaultCredential",
                        "Get-VulnAutoRun",
                        "Get-VulnSchTask",
                        "Grant-ADIDNSPermission",
                        "Gupt-Backdoor",
                        "Invoke-ACLScanner",
                        "Invoke-ADRecon",
                        "Invoke-ADSBackdoor",
                        "Invoke-AgentSmith",
                        "Invoke-AllChecks",
                        "Invoke-ARPScan",
                        "Invoke-AzureHound",
                        "Invoke-BackdoorLNK",
                        "Invoke-BadPotato",
                        "Invoke-BetterSafetyKatz",
                        "Invoke-BypassUAC",
                        "Invoke-Carbuncle",
                        "Invoke-Certify",
                        "Invoke-ConPtyShell",
                        "Invoke-CredentialInjection",
                        "Invoke-DAFT",
                        "Invoke-DCSync",
                        "Invoke-DinvokeKatz",
                        "Invoke-DllInjection",
                        "Invoke-DNSUpdate",
                        "Invoke-DomainPasswordSpray",
                        "Invoke-DowngradeAccount",
                        "Invoke-EgressCheck",
                        "Invoke-Eyewitness",
                        "Invoke-FakeLogonScreen",
                        "Invoke-Farmer",
                        "Invoke-Get-RBCD-Threaded",
                        "Invoke-Gopher",
                        "Invoke-Grouper",
                        "Invoke-HandleKatz",
                        "Invoke-ImpersonatedProcess",
                        "Invoke-ImpersonateSystem",
                        "Invoke-InteractiveSystemPowerShell",
                        "Invoke-Internalmonologue",
                        "Invoke-Inveigh",
                        "Invoke-InveighRelay",
                        "Invoke-KrbRelay",
                        "Invoke-LdapSignCheck",
                        "Invoke-Lockless",
                        "Invoke-MalSCCM",
                        "Invoke-Mimikatz",
                        "Invoke-Mimikittenz",
                        "Invoke-MITM6",
                        "Invoke-NanoDump",
                        "Invoke-NetRipper",
                        "Invoke-Nightmare",
                        "Invoke-NinjaCopy",
                        "Invoke-OfficeScrape",
                        "Invoke-OxidResolver",
                        "Invoke-P0wnedshell",
                        "Invoke-Paranoia",
                        "Invoke-PortScan",
                        "Invoke-PoshRatHttp",
                        "Invoke-PostExfil",
                        "Invoke-PowerDump",
                        "Invoke-PowerShellTCP",
                        "Invoke-PowerShellWMI",
                        "Invoke-PPLDump",
                        "Invoke-PsExec",
                        "Invoke-PSInject",
                        "Invoke-PsUaCme",
                        "Invoke-ReflectivePEInjection",
                        "Invoke-ReverseDNSLookup",
                        "Invoke-Rubeus",
                        "Invoke-RunAs",
                        "Invoke-SafetyKatz",
                        "Invoke-SauronEye",
                        "Invoke-SCShell",
                        "Invoke-Seatbelt",
                        "Invoke-ServiceAbuse",
                        "Invoke-ShadowSpray",
                        "Invoke-Sharp",
                        "Invoke-Shellcode",
                        "Invoke-SMBScanner",
                        "Invoke-Snaffler",
                        "Invoke-Spoolsample",
                        "Invoke-SpraySinglePassword",
                        "Invoke-SSHCommand",
                        "Invoke-StandIn",
                        "Invoke-StickyNotesExtract",
                        "Invoke-SystemCommand",
                        "Invoke-Tasksbackdoor",
                        "Invoke-Tater",
                        "Invoke-Thunderfox",
                        "Invoke-ThunderStruck",
                        "Invoke-TokenManipulation",
                        "Invoke-Tokenvator",
                        "Invoke-TotalExec",
                        "Invoke-UrbanBishop",
                        "Invoke-UserHunter",
                        "Invoke-VoiceTroll",
                        "Invoke-Whisker",
                        "Invoke-WinEnum",
                        "Invoke-winPEAS",
                        "Invoke-WireTap",
                        "Invoke-WmiCommand",
                        "Invoke-WMIExec",
                        "Invoke-WScriptBypassUAC",
                        "Invoke-Zerologon",
                        "MailRaider",
                        "New-ADIDNSNode",
                        "New-HoneyHash",
                        "New-InMemoryModule",
                        "New-SOASerialNumberArray",
                        "Out-Minidump",
                        "PowerBreach",
                        "powercat ",
                        "PowerUp",
                        "PowerView",
                        "Remove-ADIDNSNode",
                        "Remove-Update",
                        "Rename-ADIDNSNode",
                        "Revoke-ADIDNSPermission",
                        "Set-ADIDNSNode",
                        "Show-TargetScreen",
                        "Start-CaptureServer",
                        "Start-Dnscat2",
                        "Start-WebcamRecorder",
                        "VolumeShadowCopyTools"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2024/01/25",
            "references": [
                "https://adsecurity.org/?p=2921",
                "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries",
                "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1",
                "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1",
                "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1",
                "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1",
                "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/",
                "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/",
                "https://github.com/calebstewart/CVE-2021-1675",
                "https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1",
                "https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html",
                "https://github.com/HarmJ0y/DAMP",
                "https://github.com/samratashok/nishang",
                "https://github.com/DarkCoderSc/PowerRunAsSystem/",
                "https://github.com/besimorhino/powercat",
                "https://github.com/Kevin-Robertson/Powermad",
                "https://github.com/adrecon/ADRecon",
                "https://github.com/adrecon/AzureADRecon"
            ],
            "related": [
                {
                    "id": "7d0d0329-0ef1-4e84-a9f5-49500f9d7c6c",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "02030f2f-6199-49ec-b258-ea71b07e03dc"
                },
                {
                    "id": "6d3f1399-a81c-4409-aff3-1ecfe9330baf",
                    "type": "obsoletes"
                },
                {
                    "id": "83083ac6-1816-4e76-97d7-59af9a9ae46e",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.discovery",
                "attack.t1482",
                "attack.t1087",
                "attack.t1087.001",
                "attack.t1087.002",
                "attack.t1069.001",
                "attack.t1069.002",
                "attack.t1069",
                "attack.t1059.001"
            ],
            "title": "Malicious PowerShell Commandlets - ScriptBlock"
        },
        {
            "author": "frack113",
            "date": "2021/12/15",
            "description": "Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as\na precursor for Collection and to identify potential systems of interest for Lateral Movement.\nNetworks often contain shared network drives and folders that enable users to access file directories on various systems across a network.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": "get-smbshare"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "95f0643a-ed40-467c-806b-aac9542ec5ab",
            "level": "low",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Suspicious Get Information for SMB Share"
        },
        {
            "author": "frack113",
            "date": "2021/12/12",
            "description": "Adversaries may attempt to find local system groups and permission settings.\nThe knowledge of local system permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as the users found within the local administrators group.\n",
            "detection": {
                "condition": "1 of test_*",
                "test_3": [
                    {
                        "Payload|contains": [
                            "get-localgroup",
                            "Get-LocalGroupMember"
                        ]
                    },
                    {
                        "ContextInfo|contains": [
                            "get-localgroup",
                            "Get-LocalGroupMember"
                        ]
                    }
                ],
                "test_6": [
                    {
                        "Payload|contains|all": [
                            "Get-WMIObject",
                            "Win32_Group"
                        ]
                    },
                    {
                        "ContextInfo|contains|all": [
                            "Get-WMIObject",
                            "Win32_Group"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Administrator script"
            ],
            "id": "cef24b90-dddc-4ae1-a09a-8764872f69fc",
            "level": "low",
            "logsource": {
                "category": "ps_module",
                "product": "windows",
                "definition": "0ad03ef1-f21b-4a79-8ce8-e6900c54b65b"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Suspicious Get Local Groups Information"
        },
        {
            "author": "frack113",
            "date": "2021/12/15",
            "description": "Adversaries may look for folders and drives shared on remote systems as a means of identifying sources of information to gather as a precursor for Collection and\nto identify potential systems of interest for Lateral Movement.\nNetworks often contain shared network drives and folders that enable users to access file directories on various systems across a network.\n",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Payload|contains": "get-smbshare"
                    },
                    {
                        "ContextInfo|contains": "get-smbshare"
                    }
                ]
            },
            "falsepositives": [
                "Administrator script"
            ],
            "id": "6942bd25-5970-40ab-af49-944247103358",
            "level": "low",
            "logsource": {
                "category": "ps_module",
                "product": "windows",
                "definition": "0ad03ef1-f21b-4a79-8ce8-e6900c54b65b"
            },
            "modified": "2022/12/02",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Suspicious Get Information for SMB Share - PowerShell Module"
        },
        {
            "id": "7d0d0329-0ef1-4e84-a9f5-49500f9d7c6c",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/20",
            "description": "Detects Commandlet names from well-known PowerShell exploitation frameworks",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Payload|contains": [
                        "Add-Exfiltration",
                        "Add-Persistence",
                        "Add-RegBackdoor",
                        "Add-RemoteRegBackdoor",
                        "Add-ScrnSaveBackdoor",
                        "Check-VM",
                        "ConvertTo-Rc4ByteStream",
                        "Decrypt-Hash",
                        "Disable-ADIDNSNode",
                        "Disable-MachineAccount",
                        "Do-Exfiltration",
                        "Enable-ADIDNSNode",
                        "Enable-MachineAccount",
                        "Enabled-DuplicateToken",
                        "Exploit-Jboss",
                        "Export-ADR",
                        "Export-ADRCSV",
                        "Export-ADRExcel",
                        "Export-ADRHTML",
                        "Export-ADRJSON",
                        "Export-ADRXML",
                        "Find-Fruit",
                        "Find-GPOLocation",
                        "Find-TrustedDocuments",
                        "Get-ADIDNS",
                        "Get-ApplicationHost",
                        "Get-ChromeDump",
                        "Get-ClipboardContents",
                        "Get-FoxDump",
                        "Get-GPPPassword",
                        "Get-IndexedItem",
                        "Get-KerberosAESKey",
                        "Get-Keystrokes",
                        "Get-LSASecret",
                        "Get-MachineAccountAttribute",
                        "Get-MachineAccountCreator",
                        "Get-PassHashes",
                        "Get-RegAlwaysInstallElevated",
                        "Get-RegAutoLogon",
                        "Get-RemoteBootKey",
                        "Get-RemoteCachedCredential",
                        "Get-RemoteLocalAccountHash",
                        "Get-RemoteLSAKey",
                        "Get-RemoteMachineAccountHash",
                        "Get-RemoteNLKMKey",
                        "Get-RickAstley",
                        "Get-Screenshot",
                        "Get-SecurityPackages",
                        "Get-ServiceFilePermission",
                        "Get-ServicePermission",
                        "Get-ServiceUnquoted",
                        "Get-SiteListPassword",
                        "Get-System",
                        "Get-TimedScreenshot",
                        "Get-UnattendedInstallFile",
                        "Get-Unconstrained",
                        "Get-USBKeystrokes",
                        "Get-VaultCredential",
                        "Get-VulnAutoRun",
                        "Get-VulnSchTask",
                        "Grant-ADIDNSPermission",
                        "Gupt-Backdoor",
                        "HTTP-Login",
                        "Install-ServiceBinary",
                        "Install-SSP",
                        "Invoke-ACLScanner",
                        "Invoke-ADRecon",
                        "Invoke-ADSBackdoor",
                        "Invoke-AgentSmith",
                        "Invoke-AllChecks",
                        "Invoke-ARPScan",
                        "Invoke-AzureHound",
                        "Invoke-BackdoorLNK",
                        "Invoke-BadPotato",
                        "Invoke-BetterSafetyKatz",
                        "Invoke-BypassUAC",
                        "Invoke-Carbuncle",
                        "Invoke-Certify",
                        "Invoke-ConPtyShell",
                        "Invoke-CredentialInjection",
                        "Invoke-DAFT",
                        "Invoke-DCSync",
                        "Invoke-DinvokeKatz",
                        "Invoke-DllInjection",
                        "Invoke-DNSUpdate",
                        "Invoke-DomainPasswordSpray",
                        "Invoke-DowngradeAccount",
                        "Invoke-EgressCheck",
                        "Invoke-Eyewitness",
                        "Invoke-FakeLogonScreen",
                        "Invoke-Farmer",
                        "Invoke-Get-RBCD-Threaded",
                        "Invoke-Gopher",
                        "Invoke-Grouper",
                        "Invoke-HandleKatz",
                        "Invoke-ImpersonatedProcess",
                        "Invoke-ImpersonateSystem",
                        "Invoke-InteractiveSystemPowerShell",
                        "Invoke-Internalmonologue",
                        "Invoke-Inveigh",
                        "Invoke-InveighRelay",
                        "Invoke-KrbRelay",
                        "Invoke-LdapSignCheck",
                        "Invoke-Lockless",
                        "Invoke-MalSCCM",
                        "Invoke-Mimikatz",
                        "Invoke-Mimikittenz",
                        "Invoke-MITM6",
                        "Invoke-NanoDump",
                        "Invoke-NetRipper",
                        "Invoke-Nightmare",
                        "Invoke-NinjaCopy",
                        "Invoke-OfficeScrape",
                        "Invoke-OxidResolver",
                        "Invoke-P0wnedshell",
                        "Invoke-Paranoia",
                        "Invoke-PortScan",
                        "Invoke-PoshRatHttp",
                        "Invoke-PostExfil",
                        "Invoke-PowerDump",
                        "Invoke-PowerShellTCP",
                        "Invoke-PowerShellWMI",
                        "Invoke-PPLDump",
                        "Invoke-PsExec",
                        "Invoke-PSInject",
                        "Invoke-PsUaCme",
                        "Invoke-ReflectivePEInjection",
                        "Invoke-ReverseDNSLookup",
                        "Invoke-Rubeus",
                        "Invoke-RunAs",
                        "Invoke-SafetyKatz",
                        "Invoke-SauronEye",
                        "Invoke-SCShell",
                        "Invoke-Seatbelt",
                        "Invoke-ServiceAbuse",
                        "Invoke-ShadowSpray",
                        "Invoke-Sharp",
                        "Invoke-Shellcode",
                        "Invoke-SMBScanner",
                        "Invoke-Snaffler",
                        "Invoke-Spoolsample",
                        "Invoke-SpraySinglePassword",
                        "Invoke-SSHCommand",
                        "Invoke-StandIn",
                        "Invoke-StickyNotesExtract",
                        "Invoke-SystemCommand",
                        "Invoke-Tasksbackdoor",
                        "Invoke-Tater",
                        "Invoke-Thunderfox",
                        "Invoke-ThunderStruck",
                        "Invoke-TokenManipulation",
                        "Invoke-Tokenvator",
                        "Invoke-TotalExec",
                        "Invoke-UrbanBishop",
                        "Invoke-UserHunter",
                        "Invoke-VoiceTroll",
                        "Invoke-Whisker",
                        "Invoke-WinEnum",
                        "Invoke-winPEAS",
                        "Invoke-WireTap",
                        "Invoke-WmiCommand",
                        "Invoke-WMIExec",
                        "Invoke-WScriptBypassUAC",
                        "Invoke-Zerologon",
                        "MailRaider",
                        "New-ADIDNSNode",
                        "New-DNSRecordArray",
                        "New-HoneyHash",
                        "New-InMemoryModule",
                        "New-MachineAccount",
                        "New-SOASerialNumberArray",
                        "Out-Minidump",
                        "Port-Scan",
                        "PowerBreach",
                        "powercat ",
                        "PowerUp",
                        "PowerView",
                        "Remove-ADIDNSNode",
                        "Remove-MachineAccount",
                        "Remove-Update",
                        "Rename-ADIDNSNode",
                        "Revoke-ADIDNSPermission",
                        "Set-ADIDNSNode",
                        "Set-MacAttribute",
                        "Set-MachineAccountAttribute",
                        "Set-Wallpaper",
                        "Show-TargetScreen",
                        "Start-CaptureServer",
                        "Start-Dnscat2",
                        "Start-WebcamRecorder",
                        "VolumeShadowCopyTools"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "ps_module",
                "product": "windows",
                "definition": "0ad03ef1-f21b-4a79-8ce8-e6900c54b65b"
            },
            "modified": "2024/01/25",
            "references": [
                "https://adsecurity.org/?p=2921",
                "https://github.com/S3cur3Th1sSh1t/PowerSharpPack/tree/master/PowerSharpBinaries",
                "https://github.com/BC-SECURITY/Invoke-ZeroLogon/blob/111d17c7fec486d9bb23387e2e828b09a26075e4/Invoke-ZeroLogon.ps1",
                "https://github.com/xorrior/RandomPS-Scripts/blob/848c919bfce4e2d67b626cbcf4404341cfe3d3b6/Get-DXWebcamVideo.ps1",
                "https://github.com/rvrsh3ll/Misc-Powershell-Scripts/blob/6f23bb41f9675d7e2d32bacccff75e931ae00554/OfficeMemScraper.ps1",
                "https://github.com/dafthack/DomainPasswordSpray/blob/b13d64a5834694aa73fd2aea9911a83027c465a7/DomainPasswordSpray.ps1",
                "https://unit42.paloaltonetworks.com/threat-assessment-black-basta-ransomware/",
                "https://research.nccgroup.com/2022/06/06/shining-the-light-on-black-basta/",
                "https://github.com/calebstewart/CVE-2021-1675",
                "https://github.com/BloodHoundAD/BloodHound/blob/0927441f67161cc6dc08a53c63ceb8e333f55874/Collectors/AzureHound.ps1",
                "https://bloodhound.readthedocs.io/en/latest/data-collection/azurehound.html",
                "https://github.com/HarmJ0y/DAMP",
                "https://github.com/samratashok/nishang",
                "https://github.com/DarkCoderSc/PowerRunAsSystem/",
                "https://github.com/besimorhino/powercat",
                "https://github.com/Kevin-Robertson/Powermad",
                "https://github.com/adrecon/ADRecon",
                "https://github.com/adrecon/AzureADRecon"
            ],
            "related": [
                {
                    "id": "89819aa4-bbd6-46bc-88ec-c7f7fe30efa6",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "02030f2f-6199-49ec-b258-ea71b07e03dc"
                }
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.discovery",
                "attack.t1482",
                "attack.t1087",
                "attack.t1087.001",
                "attack.t1087.002",
                "attack.t1069.001",
                "attack.t1069.002",
                "attack.t1069",
                "attack.t1059.001"
            ],
            "title": "Malicious PowerShell Commandlets - PoshModule"
        },
        {
            "author": "frack113",
            "date": "2021/12/15",
            "description": "Adversaries may attempt to find domain-level groups and permission settings.\nThe knowledge of domain-level permission groups can help adversaries determine which groups exist and which users belong to a particular group.\nAdversaries may use this information to determine which users have elevated permissions, such as domain administrators.\n",
            "detection": {
                "condition": "1 of selection_*",
                "selection_ad_principal": [
                    {
                        "Payload|contains": "get-ADPrincipalGroupMembership"
                    },
                    {
                        "ContextInfo|contains": "get-ADPrincipalGroupMembership"
                    }
                ],
                "selection_get_aduser": [
                    {
                        "Payload|contains|all": [
                            "get-aduser",
                            "-f ",
                            "-pr ",
                            "DoesNotRequirePreAuth"
                        ]
                    },
                    {
                        "ContextInfo|contains|all": [
                            "get-aduser",
                            "-f ",
                            "-pr ",
                            "DoesNotRequirePreAuth"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Administrator script"
            ],
            "id": "815bfc17-7fc6-4908-a55e-2f37b98cedb4",
            "level": "low",
            "logsource": {
                "category": "ps_module",
                "product": "windows",
                "definition": "0ad03ef1-f21b-4a79-8ce8-e6900c54b65b"
            },
            "modified": "2023/01/20",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.002/T1069.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "AD Groups Or Users Enumeration Using PowerShell - PoshModule"
        },
        {
            "author": "\u00d6mer G\u00fcnal, Alejandro Ortuno, oscd.community",
            "date": "2020/10/11",
            "description": "Detects enumeration of local system groups. Adversaries may attempt to find local system groups and permission settings",
            "detection": {
                "condition": "1 of selection*",
                "selection_1": {
                    "Image|endswith": "/groups"
                },
                "selection_2": {
                    "CommandLine|contains": "/etc/group",
                    "Image|endswith": [
                        "/cat",
                        "/head",
                        "/tail",
                        "/more"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "676381a6-15ca-4d73-a9c8-6a22e970b90d",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1069.001/T1069.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1069.001"
            ],
            "title": "Local Groups Discovery - Linux"
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "Azure AD",
        "Office 365",
        "SaaS",
        "IaaS",
        "Linux",
        "macOS",
        "Google Workspace",
        "Containers"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Daniel Prizmant, Palo Alto Networks",
        "Yuval Avrahami, Palo Alto Networks",
        "Microsoft Threat Intelligence Center (MSTIC)"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "discovery"
        }
    ],
    "x_mitre_detection": "System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Lateral Movement, based on the information obtained.\n\nMonitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001). Monitor container logs for commands and/or API calls related to listing permissions for pods and nodes, such as <code>kubectl auth can-i</code>.(Citation: K8s Authorization Overview)",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "2.5",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Process: Process Creation",
        "Group: Group Metadata",
        "Command: Command Execution",
        "Application Log: Application Log Content",
        "Group: Group Enumeration"
    ],
    "x_mitre_permissions_required": []
}