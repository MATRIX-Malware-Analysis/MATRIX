{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--dad5facc-b45f-42f7-9cb7-1b599aa5d35c",
    "created": "2024-08-13T14:46:37.001619Z",
    "modified": "2024-08-13T14:46:48.505005Z",
    "name": "Obfuscated Files or Information: Indicator Removal from Tools",
    "description": "Adversaries may remove indicators from tools if they believe their malicious tool was detected, quarantined, or otherwise curtailed. They can modify the tool by removing the indicator and using the updated version that is no longer detected by the target's defensive systems or subsequent targets that may use similar systems.A good example of this is when malware is detected with a file signature and quarantined by anti-virus software. An adversary who can determine that the malware was quarantined because of its file signature may modify the file to explicitly avoid that signature, and then re-use the malware.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1027/005",
            "external_id": "T1027/005"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "characteristic": "stack string"
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "Practical Malware Analysis Lab 16-03.exe_:0x4013D0"
                    ],
                    "mbc": [
                        "Anti-Static Analysis::Executable Code Obfuscation::Argument Obfuscation [B0032.020]",
                        "Anti-Static Analysis::Executable Code Obfuscation::Stack Strings [B0032.017]"
                    ],
                    "name": "contain obfuscated stackstrings",
                    "namespace": "anti-analysis/obfuscation/string/stackstring",
                    "scopes": {
                        "dynamic": "unsupported",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "number": "0x5FBFF0FB = djb2(LoadLibraryA)"
                            },
                            {
                                "number": "0x3870CA07 = djb2(CloseHandle)"
                            },
                            {
                                "number": "0x382C0F97 = djb2(VirtualAlloc)"
                            },
                            {
                                "number": "0x844FF18D = djb2(VirtualProtect)"
                            },
                            {
                                "number": "0xCF31BB1F = djb2(GetProcAddress)"
                            },
                            {
                                "number": "0xEB96C5FA = djb2(CreateFileA)"
                            },
                            {
                                "number": "0xEB96C610 = djb2(CreateFileW)"
                            },
                            {
                                "number": "0x71019921 = djb2(ReadFile)"
                            },
                            {
                                "number": "0x0E19E5FE = djb2(Sleep)"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]"
                    ],
                    "authors": [
                        "still@teamt5.org"
                    ],
                    "description": "known import name hashes calculated using the non-cryptographic djb2 hashing algorithm",
                    "mbc": [
                        "Data::Non-Cryptographic Hash [C0030]"
                    ],
                    "name": "resolve function by djb2 hash",
                    "namespace": "linking/runtime-linking",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "number": "0x6a4abc5b = ROR13(kernel32.dll)"
                            },
                            {
                                "number": "0x3cfa685d = ROR13(ntdll.dll)"
                            },
                            {
                                "number": "0xec0e4e8e = ROR13(LoadLibraryA)"
                            },
                            {
                                "number": "0x7c0dfcaa = ROR13(GetProcAddress)"
                            },
                            {
                                "number": "0x91afca54 = ROR13(VirtualAlloc)"
                            },
                            {
                                "number": "0x534c0ab8 = ROR13(NtFlushInstructionCache)"
                            },
                            {
                                "number": "0xff7f061a = ROR13(RtlExitUserThread)"
                            },
                            {
                                "number": "0x60e0ceef = ROR13(ExitThread)"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]"
                    ],
                    "authors": [
                        "william.ballenthin@mandiant.com"
                    ],
                    "name": "resolve function by hash",
                    "references": [
                        "https://www.mandiant.com/resources/precalculated-string-hashes-reverse-engineering-shellcode",
                        "https://pastebin.com/ci5XYW4P"
                    ],
                    "namespace": "linking/runtime-linking",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "number": "0x53b2070f = FNV(LoadLibraryA)"
                            },
                            {
                                "number": "0xfaba0065 = FNV(CloseHandle)"
                            },
                            {
                                "number": "0x03285501 = FNV(VirtualAlloc)"
                            },
                            {
                                "number": "0x820621f3 = FNV(VirtualProtect)"
                            },
                            {
                                "number": "0xf8f45725 = FNV(GetProcAddress)"
                            },
                            {
                                "number": "0xbdcac9ce = FNV(CreateFileA)"
                            },
                            {
                                "number": "0xafcab3c4 = FNV(CreateFileW)"
                            },
                            {
                                "number": "0x54fcc943 = FNV(ReadFile)"
                            },
                            {
                                "number": "0x2fa62ca8 = FNV(Sleep)"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Obfuscated Files or Information::Indicator Removal from Tools [T1027.005]"
                    ],
                    "authors": [
                        "still@teamt5.org"
                    ],
                    "description": "known import name hashes calculated using the non-cryptographic FNV-1a hashing algorithm",
                    "name": "resolve function by FNV-1a hash",
                    "namespace": "linking/runtime-linking",
                    "references": [
                        "https://blog.xorhex.com/blog/reddeltaplugxchangeup/"
                    ],
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/08/30",
            "description": "Detects the use of DefenderCheck, a tool to evaluate the signatures used in Microsoft Defender. It can be used to figure out the strings / byte chains used in Microsoft Defender to detect a tool and thus used for AV evasion.",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\DefenderCheck.exe"
                    },
                    {
                        "Description": "DefenderCheck"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "f0ca6c24-3225-47d5-b1f5-352bf07ecfa7",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/matterpreter/DefenderCheck"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1027.005"
            ],
            "title": "PUA - DefenderCheck Execution"
        },
        {
            "author": "Micah Babinski",
            "date": "2022/12/11",
            "description": "Detects the use of rcedit to potentially alter executable PE metadata properties, which could conceal efforts to rename system utilities for defense evasion.",
            "detection": {
                "condition": "all of selection_*",
                "selection_attributes": {
                    "CommandLine|contains": [
                        "OriginalFileName",
                        "CompanyName",
                        "FileDescription",
                        "ProductName",
                        "ProductVersion",
                        "LegalCopyright"
                    ]
                },
                "selection_flags": {
                    "CommandLine|contains": "--set-"
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\rcedit-x64.exe",
                            "\\rcedit-x86.exe"
                        ]
                    },
                    {
                        "Description": "Edit resources of exe"
                    },
                    {
                        "Product": "rcedit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate use of the tool by administrators or users to update metadata of a binary"
            ],
            "id": "0c92f2e6-f08f-4b73-9216-ecb0ca634689",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/05",
            "references": [
                "https://security.stackexchange.com/questions/210843/is-it-possible-to-change-original-filename-of-an-exe",
                "https://www.virustotal.com/gui/file/02e8e8c5d430d8b768980f517b62d7792d690982b9ba0f7e04163cbc1a6e7915",
                "https://github.com/electron/rcedit"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.003",
                "attack.t1036",
                "attack.t1027.005",
                "attack.t1027"
            ],
            "title": "PUA - Potential PE Metadata Tamper Using Rcedit"
        },
        {
            "author": "Thomas Patzke",
            "date": "2020/05/22",
            "description": "The CrachMapExec pentesting framework implements a PowerShell obfuscation with some static strings detected by this rule.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        "join*split",
                        "( $ShellId[1]+$ShellId[13]+'x')",
                        "( $PSHome[*]+$PSHOME[*]+",
                        "( $env:Public[13]+$env:Public[5]+'x')",
                        "( $env:ComSpec[4,*,25]-Join'')",
                        "[1,3]+'x'-Join'')"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\powershell.exe",
                            "\\pwsh.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ComputerName",
                "User",
                "CommandLine"
            ],
            "id": "6f8b3439-a203-45dc-a88b-abf57ea15ccf",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "status": "test",
            "references": [
                "https://github.com/byt3bl33d3r/CrackMapExec",
                "https://github.com/byt3bl33d3r/CrackMapExec/blob/0a49f75347b625e81ee6aa8c33d3970b5515ea9e/cme/helpers/powershell.py#L242"
            ],
            "tags": [
                "attack.execution",
                "attack.t1059.001",
                "attack.defense_evasion",
                "attack.t1027.005"
            ],
            "title": "HackTool - CrackMapExec PowerShell Obfuscation"
        },
        {
            "author": "Thomas Patzke",
            "date": "2017/06/14",
            "description": "Detects renaming of file while deletion with SDelete tool.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        4656,
                        4663,
                        4658
                    ],
                    "ObjectName|endswith": [
                        ".AAA",
                        ".ZZZ"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate usage of SDelete"
            ],
            "id": "39a80702-d7ca-4a83-b776-525b1f86a36d",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/27",
            "references": [
                "https://jpcertcc.github.io/ToolAnalysisResultSheet/details/sdelete.htm",
                "https://www.jpcert.or.jp/english/pub/sr/ir_research.html",
                "https://learn.microsoft.com/en-gb/sysinternals/downloads/sdelete"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.defense_evasion",
                "attack.t1070.004",
                "attack.t1027.005",
                "attack.t1485",
                "attack.t1553.002",
                "attack.s0195"
            ],
            "title": "Secure Deletion with SDelete"
        }
    ]
}