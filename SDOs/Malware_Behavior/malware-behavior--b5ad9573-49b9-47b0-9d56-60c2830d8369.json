{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--b5ad9573-49b9-47b0-9d56-60c2830d8369",
    "created": "2024-08-13T14:46:36.998069Z",
    "modified": "2024-08-13T14:46:48.5002Z",
    "name": "Obfuscated Files or Information: Dynamic API Resolution",
    "description": "Adversaries may obfuscate then dynamically resolve API functions called by their malware in order to conceal malicious functionalities and impair defensive analysis. Malware commonly uses various Native API functions provided by the OS to perform various tasks such as those involving processes, files, and other system artifacts.API functions called by malware may leave static artifacts such as strings in payload files. Defensive analysts may also uncover which functions a binary file may execute via an import address table (IAT) or other structures that help dynamically link calling code to the shared modules that provide functions.[1][2]To avoid static or other defensive analysis, adversaries may use dynamic API resolution to conceal malware characteristics and functionalities. Similar to Software Packing, dynamic API resolution may change file signatures and obfuscate malicious API function calls until they are resolved and invoked during runtime.Various methods may be used to obfuscate malware calls to API functions. For example, hashes of function names are commonly stored in malware in lieu of literal strings. Malware can use these hashes (or other identifiers) to manually reproduce the linking and loading process using functions such as GetProcAddress() and LoadLibrary(). These hashes/identifiers can also be further obfuscated using encryption or other string manipulation tricks (requiring various forms of Deobfuscate/Decode Files or Information during execution).[3][4][1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1027/007",
            "external_id": "T1027/007"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "basic block": [
                                    {
                                        "and": [
                                            {
                                                "mnemonic": "add"
                                            },
                                            {
                                                "or": [
                                                    {
                                                        "instruction": [
                                                            {
                                                                "mnemonic": "imul"
                                                            },
                                                            {
                                                                "operand[2].number": 2049
                                                            }
                                                        ]
                                                    },
                                                    {
                                                        "and": [
                                                            {
                                                                "mnemonic": "mul"
                                                            },
                                                            {
                                                                "number": 2049
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "instruction": [
                                                    {
                                                        "mnemonic": "or"
                                                    },
                                                    {
                                                        "operand[1].number": 41943040
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "basic block": [
                                    {
                                        "and": [
                                            {
                                                "mnemonic": "add"
                                            },
                                            {
                                                "instruction": [
                                                    {
                                                        "mnemonic": "shl"
                                                    },
                                                    {
                                                        "operand[1].number": 11
                                                    }
                                                ]
                                            },
                                            {
                                                "instruction": [
                                                    {
                                                        "mnemonic": "or"
                                                    },
                                                    {
                                                        "operand[1].number": 41943040
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Obfuscated Files or Information::Dynamic API Resolution [T1027.007]"
                    ],
                    "authors": [
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "description": "Custom API hashing algorithm used in Brute Ratel Badger (version 1.3 or higher)",
                    "examples": [
                        "64ce9ab801d9bef5284b408c3373dd30ba2dc6952c0950c8049be067b5f24530:0x6DB42430"
                    ],
                    "mbc": [
                        "Defense Evasion::Obfuscated Files or Information [E1027]"
                    ],
                    "name": "resolve function by Brute Ratel Badger hash",
                    "namespace": "linking/runtime-linking",
                    "references": [
                        "https://bruteratel.com/release_notes/releases.txt"
                    ],
                    "scopes": {
                        "dynamic": "unsupported",
                        "static": "function"
                    }
                }
            }
        }
    ]
}