{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--6fe617d0-1401-40e3-b7b9-8f2ff872f9cd",
    "created": "2024-08-13T14:46:36.995853Z",
    "modified": "2024-08-13T14:46:48.496597Z",
    "name": "Timestomp: ",
    "description": "Adversaries may modify file time attributes to hide new or changes to existing files. Timestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder. This is done, for example, on files that have been modified or created by the adversary so that they do not appear conspicuous to forensic investigators or file analysis tools.Timestomping may be used along with file name Masquerading to hide malware and tools.[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1070/006",
            "external_id": "T1070/006"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "api": "kernel32.GetSystemTime"
                                    },
                                    {
                                        "api": "kernel32.FileTimeToLocalFileTime"
                                    },
                                    {
                                        "api": "kernel32.GetSystemTimeAsFileTime"
                                    },
                                    {
                                        "api": "kernel32.SystemTimeToFileTime"
                                    },
                                    {
                                        "api": "kernel32.GetFileTime"
                                    }
                                ]
                            },
                            {
                                "api": "kernel32.SetFileTime"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Indicator Removal::Timestomp [T1070.006]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "Practical Malware Analysis Lab 03-04.exe_:0x4014e0"
                    ],
                    "name": "timestomp file",
                    "namespace": "anti-analysis/anti-forensic/timestomp",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Igor Fits, Mikhail Larin, oscd.community",
            "date": "2020/10/19",
            "description": "Detect file time attribute change to hide new or changes to existing files",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "-t",
                        "-acmr",
                        "-d",
                        "-r"
                    ],
                    "Image|endswith": "/touch"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "88c0f9d8-30a8-4120-bb6b-ebb54abcf2a0",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2022/01/12",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.006/T1070.006.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.006"
            ],
            "title": "File Time Attribute Change"
        },
        {
            "author": "frack113, Florian Roth (Nextron Systems)",
            "date": "2022/08/12",
            "description": "Attackers may change the file creation time of a backdoor to make it look like it was installed with the operating system.\nNote that many processes legitimately change the creation time of a file; it does not necessarily indicate malicious activity.\n",
            "detection": {
                "condition": "(( selection1 and not filter1 ) or ( selection2 and not filter2 )) and not 1 of gen_filter*",
                "filter1": {
                    "CreationUtcTime|startswith": "2022"
                },
                "filter2": {
                    "CreationUtcTime|startswith": "202"
                },
                "gen_filter_tiworker": {
                    "Image|endswith": "\\TiWorker.exe",
                    "Image|startswith": "C:\\WINDOWS\\",
                    "TargetFilename|endswith": ".cab"
                },
                "gen_filter_updates": [
                    {
                        "Image": [
                            "C:\\Windows\\system32\\ProvTool.exe",
                            "C:\\Windows\\System32\\usocoreworker.exe",
                            "C:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe"
                        ]
                    },
                    {
                        "TargetFilename|startswith": "C:\\ProgramData\\USOPrivate\\UpdateStore\\"
                    },
                    {
                        "TargetFilename|endswith": [
                            ".tmp",
                            ".temp"
                        ]
                    }
                ],
                "selection1": {
                    "PreviousCreationUtcTime|startswith": "2022"
                },
                "selection2": {
                    "PreviousCreationUtcTime|startswith": "202"
                }
            },
            "falsepositives": [
                "Changes made to or by the local NTP service"
            ],
            "id": "558eebe5-f2ba-4104-b339-36f7902bcc1a",
            "level": "high",
            "logsource": {
                "category": "file_change",
                "product": "windows"
            },
            "modified": "2022/10/25",
            "references": [
                "https://www.inversecos.com/2022/04/defence-evasion-technique-timestomping.html"
            ],
            "status": "test",
            "tags": [
                "attack.t1070.006",
                "attack.defense_evasion"
            ],
            "title": "File Creation Date Changed to Another Year"
        },
        {
            "author": "@neu5ron",
            "date": "2019/02/05",
            "description": "Detect scenarios where a potentially unauthorized application or user is modifying the system time.",
            "detection": {
                "condition": "selection and not 1 of filter*",
                "filter1": {
                    "ProcessName": [
                        "C:\\Program Files\\VMware\\VMware Tools\\vmtoolsd.exe",
                        "C:\\Windows\\System32\\VBoxService.exe",
                        "C:\\Windows\\System32\\oobe\\msoobe.exe"
                    ]
                },
                "filter2": {
                    "ProcessName": "C:\\Windows\\System32\\svchost.exe",
                    "SubjectUserSid": "S-1-5-19"
                },
                "selection": {
                    "EventID": 4616
                }
            },
            "falsepositives": [
                "HyperV or other virtualization technologies with binary not listed in filter portion of detection"
            ],
            "id": "faa031b5-21ed-4e02-8881-2591f98d82ed",
            "level": "low",
            "logsource": {
                "definition": "Requirements: Audit Policy : System > Audit Security State Change, Group Policy : Computer Configuration\\Windows Settings\\Security Settings\\Advanced Audit Policy Configuration\\Audit Policies\\System\\Audit Security State Change",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/08/03",
            "references": [
                "Private Cuckoo Sandbox (from many years ago, no longer have hash, NDA as well)",
                "Live environment caused by malware",
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4616"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.006"
            ],
            "title": "Unauthorized System Time Modification"
        },
        {
            "author": "frack113",
            "date": "2021/08/03",
            "description": "Adversaries may modify file time attributes to hide new or changes to existing files.\nTimestomping is a technique that modifies the timestamps of a file (the modify, access, create, and change times), often to mimic files that are in the same folder.\n",
            "detection": {
                "condition": "selection_ioc",
                "selection_ioc": {
                    "ScriptBlockText|contains": [
                        ".CreationTime =",
                        ".LastWriteTime =",
                        ".LastAccessTime =",
                        "[IO.File]::SetCreationTime",
                        "[IO.File]::SetLastAccessTime",
                        "[IO.File]::SetLastWriteTime"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate admin script"
            ],
            "id": "c6438007-e081-42ce-9483-b067fbef33c3",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.006/T1070.006.md",
                "https://www.offensive-security.com/metasploit-unleashed/timestomp/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.006"
            ],
            "title": "Powershell Timestomp"
        },
        {
            "author": "Joseliyo Sanchez, @Joseliyo_Jstnk",
            "date": "2023/01/11",
            "description": "Detects usage of the \"touch\" process in service file.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": " -t ",
                    "Image|endswith": "/touch",
                    "CommandLine|endswith": ".service"
                }
            },
            "falsepositives": [
                "Admin changing date of files."
            ],
            "id": "31545105-3444-4584-bebf-c466353230d2",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://blogs.blackberry.com/",
                "https://twitter.com/Joseliyo_Jstnk/status/1620131033474822144"
            ],
            "status": "test",
            "title": "Touch Suspicious Service File",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.006"
            ]
        },
        {
            "author": "Igor Fits, oscd.community",
            "date": "2020/10/15",
            "description": "Detect file time attribute change to hide new or changes to existing files.",
            "detection": {
                "condition": "execve and touch and selection2",
                "execve": {
                    "type": "EXECVE"
                },
                "selection2": [
                    "-t",
                    "-acmr",
                    "-d",
                    "-r"
                ],
                "touch": [
                    "touch"
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b3cec4e7-6901-4b0d-a02d-8ab2d8eb818b",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2022/11/28",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.006/T1070.006.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.006"
            ],
            "title": "File Time Attribute Change - Linux"
        }
    ]
}