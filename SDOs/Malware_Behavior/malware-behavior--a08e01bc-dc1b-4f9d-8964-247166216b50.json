{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--a08e01bc-dc1b-4f9d-8964-247166216b50",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.28144Z",
    "name": "File and Directory Discovery",
    "description": "Adversaries may enumerate files and directories or may search in specific locations of a host or network share for certain information within a file system. Adversaries may use the information from File and Directory Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.Many command shell utilities can be used to obtain this information. Examples include dir, tree, ls, find, and locate.[1] Custom tools may also be used to gather file and directory information and interact with the Native API. Adversaries may also leverage a Network Device CLI on network devices to gather file and directory information (e.g. dir, show flash, and/or nvram).[2]Some files and directories may require elevated or specific user permissions to access.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1083",
            "external_id": "T1083"
        },
        {
            "source_name": "CAPEC 127",
            "external_id": "malware-behavior--2064c5aa-11ba-4633-8936-3e27d4601625"
        },
        {
            "source_name": "CAPEC 497",
            "external_id": "malware-behavior--ee237880-1afb-48b1-b53e-ad26b59f774e"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1083",
            "external_id": "T1083"
        },
        {
            "source_name": "Windows Commands JPCERT",
            "description": "Tomonaga, S. (2016, January 26). Windows Commands Abused by Attackers. Retrieved February 2, 2016.",
            "url": "https://blogs.jpcert.or.jp/en/2016/01/windows-commands-abused-by-attackers.html"
        },
        {
            "source_name": "US-CERT-TA18-106A",
            "description": "US-CERT. (2018, April 20). Alert (TA18-106A) Russian State-Sponsored Cyber Actors Targeting Network Infrastructure Devices. Retrieved October 19, 2020.",
            "url": "https://www.us-cert.gov/ncas/alerts/TA18-106A"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "System.IO.DirectoryInfo::GetFiles"
                            },
                            {
                                "api": "System.IO.DirectoryInfo::EnumerateFiles"
                            },
                            {
                                "api": "System.IO.Directory::GetFiles"
                            },
                            {
                                "api": "System.IO.Directory::EnumerateFiles"
                            },
                            {
                                "api": "System.IO.Directory::EnumerateFileSystemEntries"
                            },
                            {
                                "api": "System.IO.DirectoryInfo::GetDirectories"
                            },
                            {
                                "api": "System.IO.DirectoryInfo::EnumerateDirectories"
                            },
                            {
                                "api": "System.IO.Directory::GetDirectories"
                            },
                            {
                                "api": "System.IO.Directory::EnumerateDirectories"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "name": "enumerate files in .NET",
                    "namespace": "host-interaction/file-system/files/list",
                    "references": [
                        "https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b"
                    ],
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "System.IO.Directory::Exists"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "name": "check if directory exists",
                    "namespace": "host-interaction/file-system/exists",
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "msvcrt.__p__pgmptr"
                            },
                            {
                                "api": "msvcrt.__p__wpgmptr"
                            },
                            {
                                "api": "msvcrt._get_pgmptr"
                            },
                            {
                                "api": "msvcrt._get_wpgmptr"
                            },
                            {
                                "api": "msvcrt._pgmptr"
                            },
                            {
                                "api": "msvcrt._wpgmptr"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "@_re_fox"
                    ],
                    "examples": [
                        "31600ad0d1a7ea615690df111ae36c73:0x4016B8"
                    ],
                    "name": "resolve path using msvcrt",
                    "namespace": "host-interaction/cli",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "number": "0x26 = CSIDL_PROGRAM_FILES"
                                    },
                                    {
                                        "number": "0x2A = CSIDL_PROGRAM_FILESX86"
                                    }
                                ]
                            },
                            {
                                "or": [
                                    {
                                        "api": "shell32.SHGetFolderPath"
                                    },
                                    {
                                        "api": "shell32.SHGetFolderLocation"
                                    },
                                    {
                                        "api": "shell32.SHGetSpecialFolderPath"
                                    },
                                    {
                                        "api": "shell32.SHGetSpecialFolderLocation"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "BC452CC1128CCF7FA9F76D83CDA79132740414973600FED14509749FE946816E:0x407880"
                    ],
                    "name": "get Program Files directory",
                    "namespace": "host-interaction/file-system",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "SHGetFileInfo"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "examples": [
                        "50D5EE1CE2CA5E30C6B1019EE64EEEC2:0x403538"
                    ],
                    "name": "get file system object information",
                    "namespace": "host-interaction/file-system",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "kernel32.GetTempPath"
                            },
                            {
                                "api": "kernel32.GetTempFileName"
                            },
                            {
                                "api": "kernel32.GetSystemDirectory"
                            },
                            {
                                "api": "kernel32.GetWindowsDirectory"
                            },
                            {
                                "api": "kernel32.GetSystemWow64Directory"
                            },
                            {
                                "api": "GetAllUsersProfileDirectory"
                            },
                            {
                                "api": "GetAppContainerFolderPath"
                            },
                            {
                                "api": "GetCurrentDirectory"
                            },
                            {
                                "api": "GetDefaultUserProfileDirectory"
                            },
                            {
                                "api": "GetProfilesDirectory"
                            },
                            {
                                "api": "GetUserProfileDirectory"
                            },
                            {
                                "api": "SHGetFolderPathAndSubDir"
                            },
                            {
                                "api": "shell32.SHGetFolderPath"
                            },
                            {
                                "api": "shell32.SHGetFolderLocation"
                            },
                            {
                                "api": "shell32.SHGetKnownFolderPath"
                            },
                            {
                                "api": "shell32.SHGetSpecialFolderPath"
                            },
                            {
                                "api": "shell32.SHGetSpecialFolderLocation"
                            },
                            {
                                "api": "System.IO.Directory::GetCurrentDirectory"
                            },
                            {
                                "api": "System.Environment::GetFolderPath"
                            },
                            {
                                "property/read": "System.Environment::SystemDirectory"
                            },
                            {
                                "property/read": "System.Environment::CurrentDirectory"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com",
                        "michael.hunhoff@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "Practical Malware Analysis Lab 03-02.dll_:0x10003415",
                        "972B219F18379907A045431303F4DA7D:0x404887"
                    ],
                    "name": "get common file path",
                    "namespace": "host-interaction/file-system",
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "and": [
                                    {
                                        "or": [
                                            {
                                                "api": "kernel32.FindFirstFile"
                                            },
                                            {
                                                "api": "kernel32.FindFirstFileEx"
                                            },
                                            {
                                                "api": "kernel32.FindFirstFileTransacted"
                                            },
                                            {
                                                "api": "kernel32.FindFirstFileName"
                                            },
                                            {
                                                "api": "kernel32.FindFirstFileNameTransacted"
                                            }
                                        ]
                                    },
                                    {
                                        "or": [
                                            {
                                                "api": "kernel32.FindNextFile"
                                            },
                                            {
                                                "api": "kernel32.FindNextFileName"
                                            }
                                        ]
                                    },
                                    {
                                        "optional": [
                                            {
                                                "api": "kernel32.FindClose"
                                            },
                                            {
                                                "match": "contain loop"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "and": [
                                    {
                                        "or": [
                                            {
                                                "basic block": [
                                                    {
                                                        "and": [
                                                            {
                                                                "number": "1 = DIRECTORY_QUERY"
                                                            },
                                                            {
                                                                "api": "ntdll.NtOpenDirectoryObject"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "call": [
                                                    {
                                                        "and": [
                                                            {
                                                                "number": "1 = DIRECTORY_QUERY"
                                                            },
                                                            {
                                                                "api": "ntdll.NtOpenDirectoryObject"
                                                            }
                                                        ]
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "api": "ntdll.NtQueryDirectoryObject"
                                    },
                                    {
                                        "optional": [
                                            {
                                                "api": "RtlAllocateHeap"
                                            },
                                            {
                                                "match": "contain loop"
                                            },
                                            {
                                                "characteristic": "indirect call"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "Practical Malware Analysis Lab 01-01.exe_:0x4011E0",
                        "Practical Malware Analysis Lab 20-02.exe_:0x401000",
                        "563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x14000203C"
                    ],
                    "name": "enumerate files on Windows",
                    "namespace": "host-interaction/file-system/files/list",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    },
                    "references": [
                        "https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b5/Source/Furutaka/sup.c#L315"
                    ]
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "os": "linux"
                                    },
                                    {
                                        "os": "android"
                                    }
                                ]
                            },
                            {
                                "or": [
                                    {
                                        "and": [
                                            {
                                                "match": "create or open file"
                                            },
                                            {
                                                "or": [
                                                    {
                                                        "api": "getdents"
                                                    },
                                                    {
                                                        "api": "getdents64"
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "and": [
                                            {
                                                "api": "opendir"
                                            },
                                            {
                                                "api": "readdir"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "william.ballenthin@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "7351f8a40c5450557b24622417fc478d:0x405438"
                    ],
                    "name": "enumerate files on Linux",
                    "namespace": "host-interaction/file-system/files/list",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "match": "enumerate files on Windows"
                                    },
                                    {
                                        "match": "enumerate files on Linux"
                                    }
                                ]
                            },
                            {
                                "characteristic": "recursive call"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "@_re_fox",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "5f66b82558ca92e54e77f216ef4c066c:0x40640E"
                    ],
                    "name": "enumerate files recursively",
                    "namespace": "host-interaction/file-system/files/list",
                    "scopes": {
                        "dynamic": "unsupported",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "api": "version.GetFileVersionInfo"
                                    },
                                    {
                                        "api": "version.GetFileVersionInfoEx"
                                    },
                                    {
                                        "api": "System.Diagnostics.FileVersionInfo::GetVersionInfo"
                                    }
                                ]
                            },
                            {
                                "optional": [
                                    {
                                        "description": "retrieve specified version information from the version-information resource"
                                    },
                                    {
                                        "api": "version.VerQueryValue"
                                    },
                                    {
                                        "or": [
                                            {
                                                "api": "version.GetFileVersionInfoSize"
                                            },
                                            {
                                                "api": "version.GetFileVersionInfoSizeEx"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "mimikatz.exe_:0x45E308"
                    ],
                    "name": "get file version info",
                    "namespace": "host-interaction/file-system/meta",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "kernel32.GetFileSize"
                            },
                            {
                                "api": "kernel32.GetFileSizeEx"
                            },
                            {
                                "property/read": "System.IO.FileInfo::Length"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com",
                        "anushka.virgaonkar@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "mimikatz.exe_:0x40630D"
                    ],
                    "name": "get file size",
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    },
                    "namespace": "host-interaction/file-system/meta"
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "basic block": [
                                    {
                                        "and": [
                                            {
                                                "api": "kernel32.GetFileAttributes"
                                            },
                                            {
                                                "instruction": [
                                                    {
                                                        "mnemonic": "cmp"
                                                    },
                                                    {
                                                        "number": "0xFFFFFFFF = INVALID_FILE_ATTRIBUTES"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "basic block": [
                                    {
                                        "and": [
                                            {
                                                "api": "kernel32.GetLastError"
                                            },
                                            {
                                                "instruction": [
                                                    {
                                                        "mnemonic": "cmp"
                                                    },
                                                    {
                                                        "number": "2 = ERROR_FILE_NOT_FOUND"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "api": "shlwapi.PathFileExists"
                            },
                            {
                                "api": "System.IO.File::Exists"
                            },
                            {
                                "property/read": "System.IO.FileSystemInfo::Exists"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::File and Directory Discovery [T1083]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com",
                        "michael.hunhoff@mandiant.com"
                    ],
                    "mbc": [
                        "Discovery::File and Directory Discovery [E1083]"
                    ],
                    "examples": [
                        "31600AD0D1A7EA615690DF111AE36C73:0x401284"
                    ],
                    "namespace": "host-interaction/file-system/exists",
                    "name": "check if file exists",
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "James Ahearn",
            "date": "2019/06/08",
            "description": "Detects source code enumeration that use GET requests by keyword searches in URL strings",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    ".git/"
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "client_ip",
                "vhost",
                "url",
                "response"
            ],
            "id": "953d460b-f810-420a-97a2-cfca4c98e602",
            "level": "medium",
            "logsource": {
                "category": "webserver"
            },
            "modified": "2022/10/05",
            "references": [
                "https://pentester.land/tutorials/2018/10/25/source-code-disclosure-via-exposed-git-folder.html",
                "https://medium.com/@logicbomb_1/bugbounty-how-i-was-able-to-download-the-source-code-of-indias-largest-telecom-service-52cf5c5640a1"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ],
            "title": "Source Code Enumeration Detection by Keyword"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/12",
            "description": "Find information about network devices that is not stored in config files",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "dir",
                    "show arp",
                    "show cdp",
                    "show clock",
                    "show ip interface",
                    "show ip route",
                    "show ip sockets",
                    "show processes",
                    "show ssh",
                    "show users",
                    "show version"
                ]
            },
            "falsepositives": [
                "Commonly used by administrators for troubleshooting"
            ],
            "id": "9705a6a1-6db6-4a16-a987-15b7151e299b",
            "level": "low",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "references": [
                "https://www.cisco.com/c/en/us/td/docs/server_nw_virtual/2-5_release/command_reference/show.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1083",
                "attack.t1201",
                "attack.t1057",
                "attack.t1018",
                "attack.t1082",
                "attack.t1016",
                "attack.t1049",
                "attack.t1033",
                "attack.t1124"
            ],
            "title": "Cisco Discovery"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/28",
            "description": "Detects usage of \"find\" binary in a suspicious manner to perform discovery",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "-perm -4000",
                        "-perm -2000",
                        "-perm 0777",
                        "-perm -222",
                        "-perm -o w",
                        "-perm -o x",
                        "-perm -u=s",
                        "-perm -g=s"
                    ],
                    "Image|endswith": "/find"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "85de3a19-b675-4a51-bfc6-b11a5186c971",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "level": "medium",
            "references": [
                "https://github.com/SaiSathvik1/Linux-Privilege-Escalation-Notes"
            ],
            "related": [
                {
                    "id": "8344c0e5-5783-47cc-9cf9-a0f7fd03e6cf",
                    "type": "similar"
                }
            ],
            "status": "test",
            "title": "Potential Discovery Activity Using Find - MacOS",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2020/10/19",
            "description": "Detects usage of system utilities to discover files and directories",
            "detection": {
                "condition": "1 of select*",
                "select_file_with_asterisk": {
                    "CommandLine|re": "(.){200,}",
                    "Image": "/usr/bin/file"
                },
                "select_find_execution": {
                    "Image": "/usr/bin/find"
                },
                "select_mdfind_execution": {
                    "Image": "/usr/bin/mdfind"
                },
                "select_recursive_ls": {
                    "CommandLine|contains": "-R",
                    "Image": "/bin/ls"
                },
                "select_tree_execution|endswith": {
                    "Image": "/tree"
                }
            },
            "falsepositives": [
                "Legitimate activities"
            ],
            "id": "089dbdf6-b960-4bcc-90e3-ffc3480c20f6",
            "level": "informational",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2022/11/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1083/T1083.md"
            ],
            "status": "test",
            "title": "File and Directory Discovery - MacOS",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/08/20",
            "description": "Detect the usage of \"DirLister.exe\" a utility for quickly listing folder or drive contents. It was seen used by BlackCat ransomware to create a list of accessible directories and files.",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "OriginalFileName": "DirLister.exe"
                    },
                    {
                        "Image|endswith": "\\dirlister.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate use by users"
            ],
            "id": "b4dc61f5-6cce-468e-a608-b48b469feaa2",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1083/T1083.md",
                "https://news.sophos.com/en-us/2022/07/14/blackcat-ransomware-attacks-not-merely-a-byproduct-of-bad-luck/"
            ],
            "status": "test",
            "title": "DirLister Execution",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali",
            "date": "2022/10/10",
            "description": "Detects suspicious use of PCHunter, a tool like Process Hacker to view and manipulate processes, kernel options and other low level stuff",
            "detection": {
                "condition": "1 of selection_*",
                "selection_hash_values": [
                    {
                        "md5": [
                            "228dd0c2e6287547e26ffbd973a40f14",
                            "987b65cd9b9f4e9a1afd8f8b48cf64a7"
                        ]
                    },
                    {
                        "sha1": [
                            "5f1cbc3d99558307bc1250d084fa968521482025",
                            "3fb89787cb97d902780da080545584d97fb1c2eb"
                        ]
                    },
                    {
                        "sha256": [
                            "2b214bddaab130c274de6204af6dba5aeec7433da99aa950022fa306421a6d32",
                            "55f041bf4e78e9bfa6d4ee68be40e496ce3a1353e1ca4306598589e19802522c"
                        ]
                    },
                    {
                        "Imphash": [
                            "444d210cea1ff8112f256a4997eed7ff",
                            "0479f44df47cfa2ef1ccc4416a538663"
                        ]
                    }
                ],
                "selection_hashes": {
                    "Hashes|contains": [
                        "SHA1=5F1CBC3D99558307BC1250D084FA968521482025",
                        "MD5=987B65CD9B9F4E9A1AFD8F8B48CF64A7",
                        "SHA256=2B214BDDAAB130C274DE6204AF6DBA5AEEC7433DA99AA950022FA306421A6D32",
                        "IMPHASH=444D210CEA1FF8112F256A4997EED7FF",
                        "SHA1=3FB89787CB97D902780DA080545584D97FB1C2EB",
                        "MD5=228DD0C2E6287547E26FFBD973A40F14",
                        "SHA256=55F041BF4E78E9BFA6D4EE68BE40E496CE3A1353E1CA4306598589E19802522C",
                        "IMPHASH=0479F44DF47CFA2EF1CCC4416A538663"
                    ]
                },
                "selection_image": {
                    "Image|endswith": [
                        "\\PCHunter64.exe",
                        "\\PCHunter32.exe"
                    ]
                },
                "selection_pe": [
                    {
                        "OriginalFileName": "PCHunter.exe"
                    },
                    {
                        "Description": "Epoolsoft Windows Information View Tools"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "fca949cc-79ca-446e-8064-01aa7e52ece5",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/13",
            "references": [
                "http://www.xuetr.com/",
                "https://www.crowdstrike.com/blog/falcon-overwatch-report-finds-increase-in-ecrime/",
                "https://www.hexacorn.com/blog/2018/04/20/kernel-hacking-tool-you-might-have-never-heard-of-xuetr-pchunter/"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.discovery",
                "attack.t1082",
                "attack.t1057",
                "attack.t1012",
                "attack.t1083",
                "attack.t1007"
            ],
            "title": "HackTool - PCHunter Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/18",
            "description": "Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters",
            "detection": {
                "condition": "selection_img or all of selection_group_*",
                "selection_group_list": {
                    "CommandLine|contains": [
                        " -group=misc",
                        " -group=remote",
                        " -group=chromium",
                        " -group=slack",
                        " -group=system",
                        " -group=user",
                        " -group=all"
                    ]
                },
                "selection_group_output": {
                    "CommandLine|contains": " -outputfile="
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\Seatbelt.exe"
                    },
                    {
                        "OriginalFileName": "Seatbelt.exe"
                    },
                    {
                        "Description": "Seatbelt"
                    },
                    {
                        "CommandLine|contains": [
                            " DpapiMasterKeys",
                            " InterestingProcesses",
                            " InterestingFiles",
                            " CertificateThumbprints",
                            " ChromiumBookmarks",
                            " ChromiumHistory",
                            " ChromiumPresence",
                            " CloudCredentials",
                            " CredEnum",
                            " CredGuard",
                            " FirefoxHistory",
                            " ProcessCreationEvents"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "38646daa-e78f-4ace-9de0-55547b2d30da",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/GhostPack/Seatbelt",
                "https://www.bluetangle.dev/2022/08/fastening-seatbelt-on-threat-hunting.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1526",
                "attack.t1087",
                "attack.t1083"
            ],
            "title": "PUA - Seatbelt Execution"
        },
        {
            "author": "frack113",
            "date": "2022/09/16",
            "description": "Detect adversaries enumerate sensitive files",
            "detection": {
                "condition": "all of selection_*",
                "selection_action": {
                    "ScriptBlockText|contains": [
                        "ls",
                        "get-childitem",
                        "gci"
                    ]
                },
                "selection_file": {
                    "ScriptBlockText|contains": [
                        ".pass",
                        ".kdbx",
                        ".kdb"
                    ]
                },
                "selection_recurse": {
                    "ScriptBlockText|contains": "-recurse"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "7d416556-6502-45b2-9bad-9d2f05f38997",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "level": "medium",
            "references": [
                "https://twitter.com/malmoeb/status/1570814999370801158"
            ],
            "related": [
                {
                    "id": "d23f2ba5-9da0-4463-8908-8ee47f614bb9",
                    "type": "derived"
                }
            ],
            "status": "test",
            "title": "Powershell Sensitive File Discovery",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/03/17",
            "description": "Detects technique used by MAZE ransomware to enumerate directories using Powershell",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "foreach",
                        "Get-ChildItem",
                        "-Path ",
                        "-ErrorAction ",
                        "SilentlyContinue",
                        "Out-File ",
                        "-append"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate PowerShell scripts"
            ],
            "id": "162e69a7-7981-4344-84a9-0f1c9a217a52",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "level": "medium",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1083/T1083.md",
                "https://www.mandiant.com/resources/tactics-techniques-procedures-associated-with-maze-ransomware-incidents"
            ],
            "title": "Powershell Directory Enumeration",
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "id": "8344c0e5-5783-47cc-9cf9-a0f7fd03e6cf",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/28",
            "description": "Detects usage of \"find\" binary in a suspicious manner to perform discovery",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "-perm -4000",
                        "-perm -2000",
                        "-perm 0777",
                        "-perm -222",
                        "-perm -o w",
                        "-perm -o x",
                        "-perm -u=s",
                        "-perm -g=s"
                    ],
                    "Image|endswith": "/find"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "level": "medium",
            "references": [
                "https://github.com/SaiSathvik1/Linux-Privilege-Escalation-Notes"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "85de3a19-b675-4a51-bfc6-b11a5186c971"
                }
            ],
            "status": "test",
            "title": "Potential Discovery Activity Using Find - Linux",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/28",
            "description": "Detects usage of \"apt\" and \"apt-get\" as a GTFOBin to execute and proxy command and binary execution",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "APT::Update::Pre-Invoke::=",
                    "Image|endswith": [
                        "/apt",
                        "/apt-get"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bb382fd5-b454-47ea-a264-1828e4c766d6",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "level": "medium",
            "references": [
                "https://gtfobins.github.io/gtfobins/apt/",
                "https://gtfobins.github.io/gtfobins/apt-get/"
            ],
            "title": "Apt GTFOBin Abuse - Linux",
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/28",
            "description": "Detects usage of \"vim\" and it's siblings as a GTFOBin to execute and proxy command and binary execution",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        ":!/",
                        ":py ",
                        ":lua ",
                        "/bin/sh",
                        "/bin/bash",
                        "/bin/dash",
                        "/bin/zsh",
                        "/bin/fish"
                    ]
                },
                "selection_img": {
                    "CommandLine|contains": [
                        " -c ",
                        " --cmd"
                    ],
                    "Image|endswith": [
                        "/vim",
                        "/rvim",
                        "/vimdiff"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "7ab8f73a-fcff-428b-84aa-6a5ff7877dea",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://gtfobins.github.io/gtfobins/vim/",
                "https://gtfobins.github.io/gtfobins/rvim/",
                "https://gtfobins.github.io/gtfobins/vimdiff/"
            ],
            "title": "Vim GTFOBin Abuse - Linux",
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/28",
            "description": "Detects usage of \"getcap\" binary. This is often used during recon activity to determine potential binaries that can be abused as GTFOBins or other.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|windash": " -r ",
                    "Image|endswith": "/getcap"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d8d97d51-122d-4cdd-9e2f-01b4b4933530",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2024/03/05",
            "references": [
                "https://github.com/SaiSathvik1/Linux-Privilege-Escalation-Notes",
                "https://github.com/carlospolop/PEASS-ng",
                "https://github.com/diego-treitos/linux-smart-enumeration"
            ],
            "status": "test",
            "title": "Capabilities Discovery - Linux",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        },
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2020/10/19",
            "description": "Detects usage of system utilities to discover files and directories",
            "detection": {
                "condition": "1 of select*",
                "select_file_with_asterisk": {
                    "CommandLine|re": "(.){200,}",
                    "Image|endswith": "/file"
                },
                "select_find_execution": {
                    "Image|endswith": "/find"
                },
                "select_recursive_ls": {
                    "CommandLine|contains": "-R",
                    "Image|endswith": "/ls"
                },
                "select_tree_execution": {
                    "Image|endswith": "/tree"
                }
            },
            "falsepositives": [
                "Legitimate activities"
            ],
            "id": "d3feb4ee-ff1d-4d3d-bd10-5b28a238cc72",
            "level": "informational",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/11/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1083/T1083.md"
            ],
            "status": "test",
            "title": "File and Directory Discovery - Linux",
            "tags": [
                "attack.discovery",
                "attack.t1083"
            ]
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows",
        "Network"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Austin Clark, @c2defense"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "discovery"
        }
    ],
    "x_mitre_detection": "System and network discovery techniques normally occur throughout an operation as an adversary learns the environment. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities, such as Collection and Exfiltration, based on the information obtained.\n\nMonitor processes and command-line arguments for actions that could be taken to gather system and network information. Remote access tools with built-in features may interact directly with the Windows API to gather information. Information may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001). Further, [Network Device CLI](https://attack.mitre.org/techniques/T1059/008) commands may also be used to gather file and directory information with built-in features native to the network device platform.  Monitor CLI activity for unexpected or unauthorized use of commands being run by non-standard users from non-standard locations.  ",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.6",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Command: Command Execution",
        "Process: Process Creation",
        "Process: OS API Execution"
    ],
    "x_mitre_permissions_required": []
}