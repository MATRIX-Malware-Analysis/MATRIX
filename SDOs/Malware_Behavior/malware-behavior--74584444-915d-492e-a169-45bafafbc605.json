{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--74584444-915d-492e-a169-45bafafbc605",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.295773Z",
    "name": "Use Alternate Authentication Material: Pass the Hash",
    "description": "Adversaries may 'pass the hash' using stolen password hashes to move laterally within an environment, bypassing normal system access controls. Pass the hash (PtH) is a method of authenticating as a user without having access to the user's cleartext password. This method bypasses standard authentication steps that require a cleartext password, moving directly into the portion of the authentication that uses the password hash.When performing PtH, valid password hashes for the account being used are captured using a Credential Access technique. Captured hashes are used with PtH to authenticate as that user. Once authenticated, PtH may be used to perform actions on local or remote systems.Adversaries may also use stolen password hashes to 'overpass the hash.' Similar to PtH, this involves using a password hash to authenticate as a user but also uses the password hash to create a valid Kerberos ticket. This ticket can then be used to perform Pass the Ticket attacks.[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1550/002",
            "external_id": "T1550/002"
        },
        {
            "source_name": "CAPEC 644",
            "external_id": "malware-behavior--23a22024-f387-4982-a9a6-3c367615f3ac"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/06/08",
            "description": "Detects logons using NTLM, which could be caused by a legacy source or attackers",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 8002
                }
            },
            "falsepositives": [
                "Legacy hosts"
            ],
            "id": "98c3bcf1-56f2-49dc-9d8d-c66cf190238b",
            "level": "low",
            "logsource": {
                "definition": "Requires events from Microsoft-Windows-NTLM/Operational",
                "product": "windows",
                "service": "ntlm"
            },
            "modified": "2024/07/22",
            "references": [
                "https://twitter.com/JohnLaTwC/status/1004895028995477505"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1550.002"
            ],
            "title": "NTLM Logon"
        },
        {
            "author": "Tim Shelton, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/04/26",
            "description": "Detects the reporting of NTLMv1 being used between a client and server. NTLMv1 is insecure as the underlying encryption algorithms can be brute-forced by modern hardware.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        6038,
                        6039
                    ],
                    "Provider_Name": "LsaSrv"
                }
            },
            "falsepositives": [
                "Environments that use NTLMv1"
            ],
            "id": "e9d4ab66-a532-4ef7-a502-66a9e4a34f5d",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2023/06/06",
            "references": [
                "https://github.com/nasbench/EVTX-ETW-Resources/blob/f1b010ce0ee1b71e3024180de1a3e67f99701fe4/ETWProvidersManifests/Windows10/22H2/W10_22H2_Pro_20230321_19045.2728/WEPExplorer/LsaSrv.xml"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.lateral_movement",
                "attack.t1550.002"
            ],
            "title": "NTLMv1 Logon Between Client and Server"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/05/31",
            "description": "This events that are generated when using the hacktool Ruler by Sensepost",
            "detection": {
                "condition": "(1 of selection*)",
                "selection1": {
                    "EventID": 4776,
                    "Workstation": "RULER"
                },
                "selection2": {
                    "EventID": [
                        4624,
                        4625
                    ],
                    "WorkstationName": "RULER"
                }
            },
            "falsepositives": [
                "Go utilities that use staaldraad awesome NTLM library"
            ],
            "id": "24549159-ac1b-479c-8175-d42aea947cae",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/sensepost/ruler",
                "https://github.com/sensepost/ruler/issues/47",
                "https://github.com/staaldraad/go-ntlm/blob/cd032d41aa8ce5751c07cb7945400c0f5c81e2eb/ntlm/ntlmv1.go#L427",
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4776",
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4624"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.execution",
                "attack.t1087",
                "attack.t1114",
                "attack.t1059",
                "attack.t1550.002"
            ],
            "title": "Hacktool Ruler"
        },
        {
            "author": "Dave Kennedy, Jeff Warren (method) / David Vassallo (rule)",
            "date": "2019/06/14",
            "description": "Detects the attack technique pass the hash which is used to move laterally inside the network",
            "detection": {
                "condition": "1 of selection_* and not filter",
                "filter": {
                    "TargetUserName": "ANONYMOUS LOGON"
                },
                "selection_logon3": {
                    "EventID": 4624,
                    "KeyLength": 0,
                    "LogonProcessName": "NtLmSsp",
                    "LogonType": 3,
                    "SubjectUserSid": "S-1-0-0"
                },
                "selection_logon9": {
                    "EventID": 4624,
                    "LogonProcessName": "seclogo",
                    "LogonType": 9
                }
            },
            "falsepositives": [
                "Administrator activity"
            ],
            "id": "8eef149c-bd26-49f2-9e5a-9b00e3af499b",
            "level": "medium",
            "logsource": {
                "definition": "The successful use of PtH for lateral movement between workstations would trigger event ID 4624",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/05",
            "references": [
                "https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Events",
                "https://web.archive.org/web/20170909091934/https://blog.binarydefense.com/reliably-detecting-pass-the-hash-through-event-log-analysis",
                "https://blog.stealthbits.com/how-to-detect-pass-the-hash-attacks/"
            ],
            "status": "stable",
            "tags": [
                "attack.lateral_movement",
                "attack.t1550.002"
            ],
            "title": "Pass the Hash Activity 2"
        },
        {
            "author": "Roberto Rodriguez (source), Dominik Schaudel (rule)",
            "date": "2018/02/12",
            "description": "Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4624,
                    "AuthenticationPackageName": "Negotiate",
                    "LogonProcessName": "seclogo",
                    "LogonType": 9
                }
            },
            "falsepositives": [
                "Runas command-line tool using /netonly parameter"
            ],
            "id": "192a0330-c20b-4356-90b6-7b7049ae0b87",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/27",
            "references": [
                "https://web.archive.org/web/20220419045003/https://cyberwardog.blogspot.com/2017/04/chronicles-of-threat-hunter-hunting-for.html"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.s0002",
                "attack.t1550.002"
            ],
            "title": "Successful Overpass the Hash Attempt"
        }
    ]
}