{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--c9609995-3391-411c-be02-ac5f1c463f2b",
    "created": "2024-08-13T14:46:36.996349Z",
    "modified": "2024-08-13T14:46:48.498128Z",
    "name": "BITS Jobs",
    "description": "Adversaries may abuse BITS jobs to persistently execute code and perform various background tasks. Windows Background Intelligent Transfer Service (BITS) is a low-bandwidth, asynchronous file transfer mechanism exposed through Component Object Model (COM).[1][2] BITS is commonly used by updaters, messengers, and other applications preferred to operate in the background (using available idle bandwidth) without interrupting other networked applications. File transfer tasks are implemented as BITS jobs, which contain a queue of one or more file operations.The interface to create and manage BITS jobs is accessible through PowerShell and the BITSAdmin tool.[2][3]Adversaries may abuse BITS to download (e.g. Ingress Tool Transfer), execute, and even clean up after running malicious code (e.g. Indicator Removal). BITS tasks are self-contained in the BITS job database, without new files or registry modifications, and often permitted by host firewalls.[4][5][6] BITS enabled execution may also enable persistence by creating long-standing jobs (the default maximum lifetime is 90 days and extendable) or invoking an arbitrary program when a job completes or errors (including after system reboots).[7][4]BITS upload functionalities can also be used to perform Exfiltration Over Alternative Protocol.[4]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1197",
            "external_id": "T1197"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1197",
            "external_id": "T1197"
        },
        {
            "source_name": "CTU BITS Malware June 2016",
            "description": "Counter Threat Unit Research Team. (2016, June 6). Malware Lingers with BITS. Retrieved January 12, 2018.",
            "url": "https://www.secureworks.com/blog/malware-lingers-with-bits"
        },
        {
            "source_name": "Symantec BITS May 2007",
            "description": "Florio, E. (2007, May 9). Malware Update with Windows Update. Retrieved January 12, 2018.",
            "url": "https://www.symantec.com/connect/blogs/malware-update-windows-update"
        },
        {
            "source_name": "Elastic - Hunting for Persistence Part 1",
            "description": "French, D., Murphy, B. (2020, March 24). Adversary tradecraft 101: Hunting for persistence using Elastic Security (Part 1). Retrieved December 21, 2020.",
            "url": "https://www.elastic.co/blog/hunting-for-persistence-using-elastic-security-part-1"
        },
        {
            "source_name": "PaloAlto UBoatRAT Nov 2017",
            "description": "Hayashi, K. (2017, November 28). UBoatRAT Navigates East Asia. Retrieved January 12, 2018.",
            "url": "https://researchcenter.paloaltonetworks.com/2017/11/unit42-uboatrat-navigates-east-asia/"
        },
        {
            "source_name": "Microsoft Issues with BITS July 2011",
            "description": "Microsoft. (2011, July 19). Issues with BITS. Retrieved January 12, 2018.",
            "url": "https://technet.microsoft.com/library/dd939934.aspx"
        },
        {
            "source_name": "Microsoft BITS",
            "description": "Microsoft. (n.d.). Background Intelligent Transfer Service. Retrieved January 12, 2018.",
            "url": "https://msdn.microsoft.com/library/windows/desktop/bb968799.aspx"
        },
        {
            "source_name": "Microsoft BITSAdmin",
            "description": "Microsoft. (n.d.). BITSAdmin Tool. Retrieved January 12, 2018.",
            "url": "https://msdn.microsoft.com/library/aa362813.aspx"
        },
        {
            "source_name": "Microsoft COM",
            "description": "Microsoft. (n.d.). Component Object Model (COM). Retrieved November 22, 2017.",
            "url": "https://msdn.microsoft.com/library/windows/desktop/ms680573.aspx"
        },
        {
            "source_name": "Mondok Windows PiggyBack BITS May 2007",
            "description": "Mondok, M. (2007, May 11). Malware piggybacks on Windows\u2019 Background Intelligent Transfer Service. Retrieved January 12, 2018.",
            "url": "https://arstechnica.com/information-technology/2007/05/malware-piggybacks-on-windows-background-intelligent-transfer-service/"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "and": [
                                    {
                                        "bytes": "0D 4C E3 5C C9 0D 1F 4C 89 7C DA A1 B7 8C EE 7C = IBackgroundCopyManager"
                                    },
                                    {
                                        "bytes": "4B D3 91 49 A1 80 91 42 83 B6 33 28 36 6B 90 97 = BITS_ControlClass"
                                    },
                                    {
                                        "offset": "0xC = IBackgroundCopyManagerVtbl.CreateJob"
                                    },
                                    {
                                        "offset": "0x10 = IBackgroundCopyJobVtbl.AddFile"
                                    }
                                ]
                            },
                            {
                                "optional": [
                                    {
                                        "description": "SetNotifyCmdLine may be use to persist"
                                    },
                                    {
                                        "bytes": "39 07 B5 54 6F 68 EB 45 9D FF D6 A9 A0 FA A9 AF = IBackgroundCopyJob2"
                                    },
                                    {
                                        "offset": "0x8C = IBackgroundCopyJob2Vtbl.SetNotifyCmdLine"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::BITS Jobs [T1197]",
                        "Persistence::BITS Jobs [T1197]"
                    ],
                    "authors": [
                        "@mr-tz"
                    ],
                    "description": "BITS jobs can be used to download data or achieve persistence (via SetNotifyCmdLine)",
                    "examples": [
                        "08ac667c65d36d6542917655571e61c8.exe_:0x401E78"
                    ],
                    "name": "create BITS job",
                    "namespace": "communication/http/client",
                    "references": [
                        "https://www.mandiant.com/resources/attacker-use-of-windows-background-intelligent-transfer-service"
                    ],
                    "scopes": {
                        "dynamic": "unsupported",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/10",
            "description": "Detects Bitsadmin connections to IP addresses instead of FQDN names",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|startswith": "Microsoft BITS/",
                    "cs-host|endswith": [
                        "1",
                        "2",
                        "3",
                        "4",
                        "5",
                        "6",
                        "7",
                        "8",
                        "9"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8ccd35a2-1c7c-468b-b568-ac6cdf80eec3",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2022/08/24",
            "references": [
                "https://isc.sans.edu/diary/Microsoft+BITS+Used+to+Download+Payloads/21027"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190"
            ],
            "title": "Bitsadmin to Uncommon IP Server Address"
        },
        {
            "author": "Florian Roth (Nextron Systems), Tim Shelton",
            "date": "2019/03/07",
            "description": "Detects Bitsadmin connections to domains with uncommon TLDs",
            "detection": {
                "condition": "selection and not falsepositives",
                "falsepositives": {
                    "cs-host|endswith": [
                        ".com",
                        ".net",
                        ".org",
                        ".scdn.co",
                        ".sfx.ms"
                    ]
                },
                "selection": {
                    "c-useragent|startswith": "Microsoft BITS/"
                }
            },
            "falsepositives": [
                "Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "9eb68894-7476-4cd6-8752-23b51f5883a7",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/17",
            "status": "test",
            "references": [
                "https://twitter.com/jhencinski/status/1102695118455349248",
                "https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/"
            ],
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190"
            ],
            "title": "Bitsadmin to Uncommon TLD"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects usage of bitsadmin downloading a file to a suspicious target folder",
            "detection": {
                "condition": "all of selection_*",
                "selection_flags": {
                    "CommandLine|contains": [
                        " /transfer ",
                        " /create ",
                        " /addfile "
                    ]
                },
                "selection_folder": {
                    "CommandLine|contains": [
                        ":\\Perflogs",
                        ":\\ProgramData\\",
                        ":\\Temp\\",
                        ":\\Users\\Public\\",
                        ":\\Windows\\",
                        "\\AppData\\Local\\Temp\\",
                        "\\AppData\\Roaming\\",
                        "\\Desktop\\",
                        "%ProgramData%",
                        "%public%"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "2ddef153-167b-4e89-86b6-757a9e65dcac",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/30",
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/",
                "https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190",
                "attack.t1036.003"
            ],
            "title": "File Download Via Bitsadmin To A Suspicious Target Folder"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects usage of bitsadmin downloading a file using an URL that contains an IP",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_*",
                "selection_flags": {
                    "CommandLine|contains": [
                        " /transfer ",
                        " /create ",
                        " /addfile "
                    ]
                },
                "filter_seven_zip": {
                    "CommandLine|contains": "://7-"
                },
                "selection_extension": {
                    "CommandLine|contains": [
                        "://1",
                        "://2",
                        "://3",
                        "://4",
                        "://5",
                        "://6",
                        "://7",
                        "://8",
                        "://9"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "99c840f2-2012-46fd-9141-c761987550ef",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/",
                "https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/"
            ],
            "modified": "2023/02/15",
            "status": "test",
            "related": [
                {
                    "id": "90f138c1-f578-4ac3-8c49-eecfd847c8b7",
                    "type": "similar"
                }
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190",
                "attack.t1036.003"
            ],
            "title": "Suspicious Download From Direct IP Via Bitsadmin"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects usage of bitsadmin downloading a file to uncommon target folder",
            "detection": {
                "condition": "all of selection_*",
                "selection_flags": {
                    "CommandLine|contains": [
                        " /transfer ",
                        " /create ",
                        " /addfile "
                    ]
                },
                "selection_folder": {
                    "CommandLine|contains": [
                        "%AppData%",
                        "%temp%",
                        "%tmp%",
                        "\\AppData\\Local\\",
                        "C:\\Windows\\Temp\\"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "6e30c82f-a9f8-4aab-b79c-7c12bce6f248",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/",
                "https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/"
            ],
            "modified": "2023/02/15",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190",
                "attack.t1036.003"
            ],
            "title": "File Download Via Bitsadmin To An Uncommon Target Folder"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects usage of bitsadmin downloading a file from a suspicious domain",
            "detection": {
                "condition": "all of selection_*",
                "selection_flags": {
                    "CommandLine|contains": [
                        " /transfer ",
                        " /create ",
                        " /addfile "
                    ]
                },
                "selection_domain": {
                    "CommandLine|contains": [
                        ".githubusercontent.com",
                        "anonfiles.com",
                        "cdn.discordapp.com",
                        "cdn.discordapp.com/attachments/",
                        "ddns.net",
                        "dl.dropboxusercontent.com",
                        "ghostbin.co",
                        "glitch.me",
                        "gofile.io",
                        "hastebin.com",
                        "mediafire.com",
                        "mega.nz",
                        "onrender.com",
                        "paste.ee",
                        "pastebin.com",
                        "pastebin.pl",
                        "pastetext.net",
                        "privatlab.com",
                        "privatlab.net",
                        "send.exploit.in",
                        "sendspace.com",
                        "storage.googleapis.com",
                        "storjshare.io",
                        "supabase.co",
                        "temp.sh",
                        "transfer.sh",
                        "ufile.io"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ]
            },
            "falsepositives": [
                "Some legitimate apps use this, but limited."
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "8518ed3d-f7c9-4601-a26c-f361a4256a0c",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/02/09",
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/",
                "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker",
                "https://www.cisa.gov/uscert/ncas/alerts/aa22-321a",
                "https://www.microsoft.com/en-us/security/blog/2024/01/17/new-ttps-observed-in-mint-sandstorm-campaign-targeting-high-profile-individuals-at-universities-and-research-orgs/"
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190",
                "attack.t1036.003"
            ],
            "title": "Suspicious Download From File-Sharing Website Via Bitsadmin"
        },
        {
            "author": "Sreeman",
            "date": "2020/10/29",
            "description": "BITS will allow you to schedule a command to execute after a successful download to notify you that the job is finished.\nWhen the job runs on the system the command specified in the BITS job will be executed.\nThis can be abused by actors to create a backdoor within the system and for persistence.\nIt will be chained in a BITS job to schedule the download of malware/additional binaries and execute the program after being downloaded.\n",
            "detection": {
                "condition": "selection_img and (all of selection_cli_notify_* or all of selection_cli_add_*)",
                "selection_cli_add_1": {
                    "CommandLine|contains": "/Addfile"
                },
                "selection_cli_add_2": {
                    "CommandLine|contains": [
                        "http:",
                        "https:",
                        "ftp:",
                        "ftps:"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ],
                "selection_cli_notify_1": {
                    "CommandLine|contains": "/SetNotifyCmdLine"
                },
                "selection_cli_notify_2": {
                    "CommandLine|contains": [
                        "%COMSPEC%",
                        "cmd.exe",
                        "regsvr32.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b9cbbc17-d00d-4e3d-a827-b06d03d2380d",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2024/01/25",
            "references": [
                "https://www.fireeye.com/blog/threat-research/2020/10/kegtap-and-singlemalt-with-a-ransomware-chaser.html",
                "http://0xthem.blogspot.com/2014/03/t-emporal-persistence-with-and-schtasks.html",
                "https://isc.sans.edu/diary/Wipe+the+drive+Stealthy+Malware+Persistence+Mechanism+-+Part+1/15394"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1197"
            ],
            "title": "Monitoring For Persistence Via BITS"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects usage of bitsadmin downloading a file with a suspicious extension",
            "detection": {
                "condition": "all of selection_*",
                "selection_flags": {
                    "CommandLine|contains": [
                        " /transfer ",
                        " /create ",
                        " /addfile "
                    ]
                },
                "selection_extension": {
                    "CommandLine|contains": [
                        ".7z",
                        ".asax",
                        ".ashx",
                        ".asmx",
                        ".asp",
                        ".aspx",
                        ".bat",
                        ".cfm",
                        ".cgi",
                        ".chm",
                        ".cmd",
                        ".dll",
                        ".gif",
                        ".jpeg",
                        ".jpg",
                        ".jsp",
                        ".jspx",
                        ".log",
                        ".png",
                        ".ps1",
                        ".psm1",
                        ".rar",
                        ".scf",
                        ".sct",
                        ".txt",
                        ".vbe",
                        ".vbs",
                        ".war",
                        ".wsf",
                        ".wsh",
                        ".xll",
                        ".zip"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5b80a791-ad9b-4b75-bcc1-ad4e1e89c200",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/30",
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190",
                "attack.t1036.003"
            ],
            "title": "File With Suspicious Extension Downloaded Via Bitsadmin"
        },
        {
            "author": "Michael Haag, FPT.EagleEye",
            "date": "2017/03/09",
            "description": "Detects usage of bitsadmin downloading a file",
            "detection": {
                "condition": "selection_img and (selection_cmd or all of selection_cli_*)",
                "selection_cli_1": {
                    "CommandLine|contains": [
                        " /create ",
                        " /addfile "
                    ]
                },
                "selection_cli_2": {
                    "CommandLine|contains": "http"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\bitsadmin.exe"
                    },
                    {
                        "OriginalFileName": "bitsadmin.exe"
                    }
                ],
                "selection_cmd": {
                    "CommandLine|contains": " /transfer "
                }
            },
            "falsepositives": [
                "Some legitimate apps use this, but limited."
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "d059842b-6b9d-4ed1-b5c3-5b89143c6ede",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/"
            ],
            "modified": "2023/02/15",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190",
                "attack.t1036.003"
            ],
            "title": "File Download Via Bitsadmin"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects new BITS transfer job where the LocalName/Saved file is stored in a potentially suspicious location",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 16403,
                    "LocalName|contains": [
                        "\\Desktop\\",
                        "C:\\Users\\Public\\",
                        "C:\\PerfLogs\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f8a56cb7-a363-44ed-a82f-5926bb44cd05",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "modified": "2023/03/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "BITS Transfer Job Download To Potential Suspicious Folder"
        },
        {
            "author": "frack113",
            "date": "2022/03/01",
            "description": "Detects the creation of a new bits job by PowerShell",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "processPath|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe"
                    ]
                }
            },
            "falsepositives": [
                "Administrator PowerShell scripts"
            ],
            "id": "fe3a2d49-f255-4d10-935c-bda7391108eb",
            "level": "low",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "modified": "2023/03/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "New BITS Job Created Via PowerShell"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/10",
            "description": "Detects a suspicious download using the BITS client from a FQDN that is unusual. Adversaries may abuse BITS jobs to persistently execute or clean up after malicious payloads.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": {
                    "RemoteName|contains": [
                        ".azureedge.net/",
                        ".com/",
                        ".sfx.ms/",
                        "download.mozilla.org/"
                    ]
                },
                "selection": {
                    "EventID": 16403
                }
            },
            "falsepositives": [
                "This rule doesn't exclude other known TLDs such as \".org\" or \".net\". It's recommended to apply additional filters for software and scripts that leverage the BITS service"
            ],
            "id": "6d44fb93-e7d2-475c-9d3d-54c9c1e33427",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "level": "medium",
            "modified": "2023/03/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md",
                "https://twitter.com/malmoeb/status/1535142803075960832"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "BITS Transfer Job With Uncommon Or Suspicious Remote TLD"
        },
        {
            "author": "frack113",
            "date": "2022/03/01",
            "description": "Detects the creation of a new bits job by Bitsadmin",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "processPath|endswith": "\\bitsadmin.exe"
                }
            },
            "falsepositives": [
                "Many legitimate applications or scripts could leverage \"bitsadmin\". This event is best correlated with EID 16403 via the JobID field"
            ],
            "id": "1ff315dc-2a3a-4b71-8dde-873818d25d39",
            "level": "low",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "modified": "2023/03/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "New BITS Job Created Via Bitsadmin"
        },
        {
            "author": "frack113",
            "date": "2022/03/01",
            "description": "Detects new BITS transfer job saving local files with potential suspicious extensions",
            "detection": {
                "condition": "selection and not 1 of filter_optional_*",
                "filter_optional_generic": {
                    "LocalName|contains": "\\AppData\\",
                    "RemoteName|contains": ".com"
                },
                "selection": {
                    "EventID": 16403,
                    "LocalName|endswith": [
                        ".bat",
                        ".dll",
                        ".exe",
                        ".hta",
                        ".ps1",
                        ".psd1",
                        ".sh",
                        ".vbe",
                        ".vbs"
                    ]
                }
            },
            "falsepositives": [
                "While the file extensions in question can be suspicious at times. It's best to add filters according to your environment to avoid large amount false positives"
            ],
            "id": "b85e5894-9b19-4d86-8c87-a2f3b81f0521",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "level": "medium",
            "modified": "2023/03/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "BITS Transfer Job Downloading File Potential Suspicious Extension"
        },
        {
            "id": "90f138c1-f578-4ac3-8c49-eecfd847c8b7",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/11",
            "description": "Detects a BITS transfer job downloading file(s) from a direct IP address.",
            "detection": {
                "condition": "selection and not 1 of filter_optional_*",
                "filter_optional_local_networks": {
                    "RemoteName|contains": [
                        "://10.",
                        "://192.168.",
                        "://172.16.",
                        "://172.17.",
                        "://172.18.",
                        "://172.19.",
                        "://172.20.",
                        "://172.21.",
                        "://172.22.",
                        "://172.23.",
                        "://172.24.",
                        "://172.25.",
                        "://172.26.",
                        "://172.27.",
                        "://172.28.",
                        "://172.29.",
                        "://172.30.",
                        "://172.31.",
                        "://127.",
                        "://169.254."
                    ]
                },
                "filter_optional_seven_zip": {
                    "RemoteName|contains": [
                        "https://7-",
                        "http://7-"
                    ]
                },
                "selection": {
                    "EventID": 16403,
                    "RemoteName|contains": [
                        "http://1",
                        "http://2",
                        "http://3",
                        "http://4",
                        "http://5",
                        "http://6",
                        "http://7",
                        "http://8",
                        "http://9",
                        "https://1",
                        "https://2",
                        "https://3",
                        "https://4",
                        "https://5",
                        "https://6",
                        "https://7",
                        "https://8",
                        "https://9"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "modified": "2023/03/27",
            "references": [
                "https://blog.netspi.com/15-ways-to-download-a-file/#bitsadmin",
                "https://isc.sans.edu/diary/22264",
                "https://lolbas-project.github.io/lolbas/Binaries/Bitsadmin/",
                "https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "99c840f2-2012-46fd-9141-c761987550ef"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "BITS Transfer Job Download From Direct IP"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects BITS transfer job downloading files from a file sharing domain.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 16403,
                    "RemoteName|contains": [
                        ".githubusercontent.com",
                        "anonfiles.com",
                        "cdn.discordapp.com",
                        "cdn.discordapp.com/attachments/",
                        "ddns.net",
                        "dl.dropboxusercontent.com",
                        "ghostbin.co",
                        "glitch.me",
                        "gofile.io",
                        "hastebin.com",
                        "mediafire.com",
                        "mega.nz",
                        "onrender.com",
                        "paste.ee",
                        "pastebin.com",
                        "pastebin.pl",
                        "pastetext.net",
                        "privatlab.com",
                        "privatlab.net",
                        "send.exploit.in",
                        "sendspace.com",
                        "storage.googleapis.com",
                        "storjshare.io",
                        "supabase.co",
                        "temp.sh",
                        "transfer.sh",
                        "ufile.io"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d635249d-86b5-4dad-a8c7-d7272b788586",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "bits-client"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1197/T1197.md",
                "https://twitter.com/malmoeb/status/1535142803075960832",
                "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/ransomware-hive-conti-avoslocker",
                "https://www.microsoft.com/en-us/security/blog/2024/01/17/new-ttps-observed-in-mint-sandstorm-campaign-targeting-high-profile-individuals-at-universities-and-research-orgs/"
            ],
            "modified": "2024/02/09",
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197"
            ],
            "title": "BITS Transfer Job Download From File Sharing Domains"
        }
    ],
    "x_mitre_platforms": [
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Brent Murphy, Elastic",
        "David French, Elastic",
        "Ricardo Dias",
        "Red Canary"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "defense-evasion"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "persistence"
        }
    ],
    "x_mitre_detection": "BITS runs as a service and its status can be checked with the Sc query utility (<code>sc query bits</code>).(Citation: Microsoft Issues with BITS July 2011) Active BITS tasks can be enumerated using the [BITSAdmin](https://attack.mitre.org/software/S0190) tool (<code>bitsadmin /list /allusers /verbose</code>).(Citation: Microsoft BITS)\n\nMonitor usage of the [BITSAdmin](https://attack.mitre.org/software/S0190) tool (especially the \u2018Transfer\u2019, 'Create', 'AddFile', 'SetNotifyFlags', 'SetNotifyCmdLine', 'SetMinRetryDelay', 'SetCustomHeaders', and 'Resume' command options)(Citation: Microsoft BITS) Admin logs, PowerShell logs, and the Windows Event log for BITS activity.(Citation: Elastic - Hunting for Persistence Part 1) Also consider investigating more detailed information about jobs by parsing the BITS job database.(Citation: CTU BITS Malware June 2016)\n\nMonitor and analyze network activity generated by BITS. BITS jobs use HTTP(S) and SMB for remote connections and are tethered to the creating user and will only function when that user is logged on (this rule applies even if a user attaches the job to a service account).(Citation: Microsoft BITS)",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.4",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Command: Command Execution",
        "Network Traffic: Network Connection Creation",
        "Process: Process Creation",
        "Service: Service Metadata"
    ],
    "x_mitre_permissions_required": []
}