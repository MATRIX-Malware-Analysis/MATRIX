{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--2c8c35bb-48dc-45db-a061-e193c26ccd82",
    "created": "2024-08-13T14:46:36.969413Z",
    "modified": "2024-08-13T14:46:45.180616Z",
    "name": "Dynamic Resolution",
    "description": "Adversaries may dynamically establish connections to command and control infrastructure to evade common detections and remediations. This may be achieved by using malware that shares a common algorithm with the infrastructure the adversary uses to receive the malware's communications. These calculations can be used to dynamically adjust parameters such as the domain name, IP address, or port number the malware uses for command and control.Adversaries may use dynamic resolution for the purpose of Fallback Channels. When contact is lost with the primary command and control server malware may employ dynamic resolution as a means to reestablishing command and control.[1][2][3]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1568",
            "external_id": "T1568"
        },
        {
            "source_name": "mitre-attack",
            "external_id": "T1568",
            "url": "https://attack.mitre.org/techniques/T1568"
        },
        {
            "url": "http://blog.talosintelligence.com/2017/09/avast-distributes-malware.html",
            "description": "Brumaghin, E. et al. (2017, September 18). CCleanup: A Vast Number of Machines at Risk. Retrieved March 9, 2018.",
            "source_name": "Talos CCleanup 2017"
        },
        {
            "url": "https://www.fireeye.com/blog/threat-research/2017/03/dissecting_one_ofap.html",
            "description": "Dunwoody, M.. (2017, April 3). Dissecting One of APT29\u2019s Fileless WMI and PowerShell Backdoors (POSHSPY). Retrieved April 5, 2017.",
            "source_name": "FireEye POSHSPY April 2017"
        },
        {
            "source_name": "ESET Sednit 2017 Activity",
            "url": "https://www.welivesecurity.com/2017/12/21/sednit-update-fancy-bear-spent-year/",
            "description": "ESET. (2017, December 21). Sednit update: How Fancy Bear Spent the Year. Retrieved February 18, 2019."
        },
        {
            "source_name": "Data Driven Security DGA",
            "url": "https://datadrivensecurity.info/blog/posts/2014/Oct/dga-part2/",
            "description": "Jacobs, J. (2014, October 2). Building a DGA Classifier: Part 2, Feature Engineering. Retrieved February 18, 2019."
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/11/08",
            "description": "Detects download of certain file types from hosts with dynamic DNS names (selected list)",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri-extension": [
                        "exe",
                        "vbs",
                        "bat",
                        "rar",
                        "ps1",
                        "doc",
                        "docm",
                        "xls",
                        "xlsm",
                        "pptm",
                        "rtf",
                        "hta",
                        "dll",
                        "ws",
                        "wsf",
                        "sct",
                        "zip"
                    ],
                    "cs-host|endswith": [
                        ".hopto.org",
                        ".no-ip.org",
                        ".no-ip.info",
                        ".no-ip.biz",
                        ".no-ip.com",
                        ".noip.com",
                        ".ddns.name",
                        ".myftp.org",
                        ".myftp.biz",
                        ".serveblog.net",
                        ".servebeer.com",
                        ".servemp3.com",
                        ".serveftp.com",
                        ".servequake.com",
                        ".servehalflife.com",
                        ".servehttp.com",
                        ".servegame.com",
                        ".servepics.com",
                        ".myvnc.com",
                        ".ignorelist.com",
                        ".jkub.com",
                        ".dlinkddns.com",
                        ".jumpingcrab.com",
                        ".ddns.info",
                        ".mooo.com",
                        ".dns-dns.com",
                        ".strangled.net",
                        ".adultdns.net",
                        ".craftx.biz",
                        ".ddns01.com",
                        ".dns53.biz",
                        ".dnsapi.info",
                        ".dnsd.info",
                        ".dnsdynamic.com",
                        ".dnsdynamic.net",
                        ".dnsget.org",
                        ".fe100.net",
                        ".flashserv.net",
                        ".ftp21.net",
                        ".http01.com",
                        ".http80.info",
                        ".https443.com",
                        ".imap01.com",
                        ".kadm5.com",
                        ".mysq1.net",
                        ".ns360.info",
                        ".ntdll.net",
                        ".ole32.com",
                        ".proxy8080.com",
                        ".sql01.com",
                        ".ssh01.com",
                        ".ssh22.net",
                        ".tempors.com",
                        ".tftpd.net",
                        ".ttl60.com",
                        ".ttl60.org",
                        ".user32.com",
                        ".voip01.com",
                        ".wow64.net",
                        ".x64.me",
                        ".xns01.com",
                        ".dyndns.org",
                        ".dyndns.info",
                        ".dyndns.tv",
                        ".dyndns-at-home.com",
                        ".dnsomatic.com",
                        ".zapto.org",
                        ".webhop.net",
                        ".25u.com",
                        ".slyip.net"
                    ]
                }
            },
            "falsepositives": [
                "Software downloads"
            ],
            "fields": [
                "cs-ip",
                "c-uri"
            ],
            "id": "195c1119-ef07-4909-bb12-e66f5e07bf3c",
            "level": "medium",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/18",
            "references": [
                "https://www.alienvault.com/blogs/security-essentials/dynamic-dns-security-and-potential-threats"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1105",
                "attack.t1568"
            ],
            "title": "Download from Suspicious Dyndns Hosts"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/11/03",
            "description": "Detects an executable initiating a network connection to \"ngrok\" tunneling domains.\nAttackers were seen using this \"ngrok\" in order to store their second stage payloads and malware.\nWhile communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DestinationHostname|contains": [
                        "tunnel.us.ngrok.com",
                        "tunnel.eu.ngrok.com",
                        "tunnel.ap.ngrok.com",
                        "tunnel.au.ngrok.com",
                        "tunnel.sa.ngrok.com",
                        "tunnel.jp.ngrok.com",
                        "tunnel.in.ngrok.com"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of the ngrok service."
            ],
            "id": "1d08ac94-400d-4469-a82f-daee9a908849",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/02/02",
            "references": [
                "https://twitter.com/hakluke/status/1587733971814977537/photo/1",
                "https://ngrok.com/docs/secure-tunnels/tunnels/ssh-reverse-tunnel-agent"
            ],
            "related": [
                {
                    "id": "18249279-932f-45e2-b37a-8925f2597670",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.command_and_control",
                "attack.t1567",
                "attack.t1568.002",
                "attack.t1572",
                "attack.t1090",
                "attack.t1102",
                "attack.s0508"
            ],
            "title": "Communication To Ngrok Tunneling Service Initiated"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/11/03",
            "description": "Detects an executable accessing an ngrok tunneling endpoint, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DestinationHostname|contains": [
                        "tunnel.us.ngrok.com",
                        "tunnel.eu.ngrok.com",
                        "tunnel.ap.ngrok.com",
                        "tunnel.au.ngrok.com",
                        "tunnel.sa.ngrok.com",
                        "tunnel.jp.ngrok.com",
                        "tunnel.in.ngrok.com"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of ngrok"
            ],
            "id": "19bf6fdb-7721-4f3d-867f-53467f6a5db6",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "linux"
            },
            "references": [
                "https://twitter.com/hakluke/status/1587733971814977537/photo/1",
                "https://ngrok.com/docs/secure-tunnels/tunnels/ssh-reverse-tunnel-agent"
            ],
            "title": "Communication To Ngrok Tunneling Service - Linux",
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.command_and_control",
                "attack.t1567",
                "attack.t1568.002",
                "attack.t1572",
                "attack.t1090",
                "attack.t1102",
                "attack.s0508"
            ]
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Chris Roffe"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "command-and-control"
        }
    ],
    "x_mitre_detection": "Detecting dynamically generated C2 can be challenging due to the number of different algorithms, constantly evolving malware families, and the increasing complexity of the algorithms. There are multiple approaches to detecting a pseudo-randomly generated domain name, including using frequency analysis, Markov chains, entropy, proportion of dictionary words, ratio of vowels to other characters, and more (Citation: Data Driven Security DGA). CDN domains may trigger these detections due to the format of their domain names. In addition to detecting algorithm generated domains based on the name, another more general approach for detecting a suspicious domain is to check for recently registered names or for rarely visited domains.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.0",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Network Traffic: Network Connection Creation",
        "Network Traffic: Network Traffic Flow",
        "Network Traffic: Network Traffic Content"
    ],
    "x_mitre_permissions_required": [
        "User"
    ]
}