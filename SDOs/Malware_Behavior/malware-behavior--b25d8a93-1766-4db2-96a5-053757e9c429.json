{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--b25d8a93-1766-4db2-96a5-053757e9c429",
    "created": "2024-08-13T14:46:37.13139Z",
    "modified": "2024-08-13T14:46:46.20277Z",
    "name": "Protocol Impersonation: ",
    "description": "Adversaries may impersonate legitimate protocols or web service traffic to disguise command and control activity and thwart analysis efforts. By impersonating legitimate protocols or web services, adversaries can make their command and control traffic blend in with legitimate network traffic.  Adversaries may impersonate a fake SSL/TLS handshake to make it look like subsequent traffic is SSL/TLS encrypted, potentially interfering with some security tooling, or to make the traffic look like it is related with a trusted entity.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1001/003",
            "external_id": "T1001/003"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "xknow @xknow_infosec, Tim Shelton",
            "date": "2019/03/24",
            "description": "Detects the creation of an \"Active Directory Schema Cache File\" (.sch) file by an uncommon tool.",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_generic": [
                    {
                        "Image|endswith": [
                            ":\\Program Files\\Cylance\\Desktop\\CylanceSvc.exe",
                            ":\\Windows\\CCM\\CcmExec.exe",
                            ":\\windows\\system32\\dllhost.exe",
                            ":\\Windows\\system32\\dsac.exe",
                            ":\\Windows\\system32\\efsui.exe",
                            ":\\windows\\system32\\mmc.exe",
                            ":\\windows\\system32\\svchost.exe",
                            ":\\Windows\\System32\\wbem\\WmiPrvSE.exe",
                            ":\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe"
                        ]
                    },
                    {
                        "Image|contains": [
                            ":\\Windows\\ccmsetup\\autoupgrade\\ccmsetup",
                            ":\\Program Files\\SentinelOne\\Sentinel Agent"
                        ]
                    }
                ],
                "filter_main_office": {
                    "Image|contains|all": [
                        ":\\Program Files\\",
                        "\\Microsoft Office"
                    ],
                    "Image|endswith": "\\OUTLOOK.EXE"
                },
                "filter_optional_citrix": {
                    "Image|endswith": ":\\Program Files\\Citrix\\Receiver StoreFront\\Services\\DefaultDomainServices\\Citrix.DeliveryServices.DomainServices.ServiceHost.exe"
                },
                "filter_optional_ldapwhoami": {
                    "Image|endswith": "\\LANDesk\\LDCLient\\ldapwhoami.exe"
                },
                "selection": {
                    "TargetFilename|contains": "\\Local\\Microsoft\\Windows\\SchCache\\",
                    "TargetFilename|endswith": ".sch"
                }
            },
            "falsepositives": [
                "Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc."
            ],
            "id": "75bf09fa-1dd7-4d18-9af9-dd9e492562eb",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/10/18",
            "references": [
                "https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961",
                "https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/",
                "https://github.com/fox-it/LDAPFragger"
            ],
            "status": "test",
            "tags": [
                "attack.t1001.003",
                "attack.command_and_control"
            ],
            "title": "ADSI-Cache File Creation By Uncommon Tool"
        },
        {
            "author": "xknow @xknow_infosec",
            "date": "2019/03/24",
            "description": "Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AttributeLDAPDisplayName": [
                        "primaryInternationalISDNNumber",
                        "otherFacsimileTelephoneNumber",
                        "primaryTelexNumber"
                    ],
                    "AttributeValue|contains": "*",
                    "EventID": 5136
                }
            },
            "falsepositives": [
                "Companies, who may use these default LDAP-Attributes for personal information"
            ],
            "id": "d00a9a72-2c09-4459-ad03-5e0a23351e36",
            "level": "high",
            "logsource": {
                "definition": "The \"Audit Directory Service Changes\" logging policy must be configured in order to receive events. Audit events are generated only for objects with configured system access control lists (SACLs). Audit events are generated only for objects with configured system access control lists (SACLs) and only when accessed in a manner that matches their SACL settings. This policy covers the following events ids - 5136, 5137, 5138, 5139, 5141. Note that the default policy does not cover User objects. For that a custom AuditRule need to be setup (See https://github.com/OTRF/Set-AuditRule)",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/05",
            "references": [
                "https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961",
                "https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/",
                "https://github.com/fox-it/LDAPFragger"
            ],
            "status": "test",
            "tags": [
                "attack.t1001.003",
                "attack.command_and_control"
            ],
            "title": "Suspicious LDAP-Attributes Used"
        }
    ]
}