{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--bdd65f5f-1408-4ae2-a9cc-a0474bb097af",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.874007Z",
    "name": "Modify Authentication Process",
    "description": "Adversaries may modify authentication mechanisms and processes to access user credentials or enable otherwise unwarranted access to accounts. The authentication process is handled by mechanisms, such as the Local Security Authentication Server (LSASS) process and the Security Accounts Manager (SAM) on Windows, pluggable authentication modules (PAM) on Unix-based systems, and authorization plugins on MacOS systems, responsible for gathering, storing, and validating credentials. By modifying an authentication process, an adversary may be able to authenticate to a service or system without using Valid Accounts.Adversaries may maliciously modify a part of this process to either reveal credentials or bypass authentication mechanisms. Compromised credentials or access may be used to bypass access controls placed on various resources on systems within the network and may even be used for persistent access to remote systems and externally available services, such as VPNs, Outlook Web Access and remote desktop.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1556",
            "external_id": "T1556"
        },
        {
            "source_name": "CAPEC 665",
            "external_id": "malware-behavior--7ecb3b82-e7b1-40e6-ad66-e94d1ebf54b3"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1556",
            "external_id": "T1556"
        },
        {
            "source_name": "Clymb3r Function Hook Passwords Sept 2013",
            "description": "Bialek, J. (2013, September 15). Intercepting Password Changes With Function Hooking. Retrieved November 21, 2017.",
            "url": "https://clymb3r.wordpress.com/2013/09/15/intercepting-password-changes-with-function-hooking/"
        },
        {
            "source_name": "Xorrior Authorization Plugins",
            "description": "Chris Ross. (2018, October 17). Persistent Credential Theft with Authorization Plugins. Retrieved April 22, 2021.",
            "url": "https://xorrior.com/persistent-credential-theft/"
        },
        {
            "source_name": "Dell Skeleton",
            "description": "Dell SecureWorks. (2015, January 12). Skeleton Key Malware Analysis. Retrieved April 8, 2019.",
            "url": "https://www.secureworks.com/research/skeleton-key-malware-analysis"
        },
        {
            "source_name": "dump_pwd_dcsync",
            "description": "Metcalf, S. (2015, November 22). Dump Clear-Text Passwords for All Admins in the Domain Using Mimikatz DCSync. Retrieved November 15, 2021.",
            "url": "https://adsecurity.org/?p=2053"
        },
        {
            "source_name": "TechNet Audit Policy",
            "description": "Microsoft. (2016, April 15). Audit Policy Recommendations. Retrieved June 3, 2016.",
            "url": "https://technet.microsoft.com/en-us/library/dn487457.aspx"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Splunk Threat Research Team (original rule), Harjot Singh @cyb3rjy0t (sigma rule)",
            "date": "2023/09/18",
            "description": "Detects disabling of Multi Factor Authentication.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Operation|contains": "Disable Strong Authentication."
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "60de9b57-dc4d-48b9-a6a0-b39e0469f876",
            "level": "high",
            "logsource": {
                "product": "m365",
                "service": "audit"
            },
            "references": [
                "https://research.splunk.com/cloud/c783dd98-c703-4252-9e8a-f19d9f5c949e/"
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1556"
            ],
            "title": "Disabling Multi Factor Authentication"
        },
        {
            "author": "Muhammad Faisal (@faisalusuf)",
            "date": "2023/01/29",
            "description": "Detects when a user disables a critical security feature for an organization.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "action": [
                        "business_advanced_security.disabled_for_new_repos",
                        "business_advanced_security.disabled_for_new_user_namespace_repos",
                        "business_advanced_security.disabled",
                        "business_advanced_security.user_namespace_repos_disabled",
                        "org.advanced_security_disabled_for_new_repos",
                        "org.advanced_security_disabled_on_all_repos",
                        "org.advanced_security_policy_selected_member_disabled",
                        "org.disable_oauth_app_restrictions",
                        "org.disable_two_factor_requirement",
                        "repo.advanced_security_disabled"
                    ]
                }
            },
            "falsepositives": [
                "Approved administrator/owner activities."
            ],
            "id": "8622c92d-c00e-463c-b09d-fd06166f6794",
            "level": "high",
            "logsource": {
                "definition": "Requirements: The audit log streaming feature must be enabled to be able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming",
                "product": "github",
                "service": "audit"
            },
            "modified": "2024/07/22",
            "references": [
                "https://docs.github.com/en/organizations/managing-oauth-access-to-your-organizations-data/disabling-oauth-app-access-restrictions-for-your-organization",
                "https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization#dependabot_alerts-category-actions",
                "https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/enabling-features-for-your-repository/managing-security-and-analysis-settings-for-your-repository",
                "https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/audit-log-events-for-your-enterprise"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1556"
            ],
            "title": "Github High Risk Configuration Disabled"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/09/21",
            "description": "Detects when an attempt at deactivating  or resetting MFA.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventtype": [
                        "user.mfa.factor.deactivate",
                        "user.mfa.factor.reset_all"
                    ]
                }
            },
            "falsepositives": [
                "If a MFA reset or deactivated was performed by a system administrator."
            ],
            "id": "50e068d7-1e6b-4054-87e5-0a592c40c7e0",
            "level": "medium",
            "logsource": {
                "product": "okta",
                "service": "okta"
            },
            "modified": "2022/10/09",
            "references": [
                "https://developer.okta.com/docs/reference/api/system-log/",
                "https://developer.okta.com/docs/reference/api/event-types/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.t1556.006"
            ],
            "title": "Okta MFA Reset or Deactivated"
        },
        {
            "author": "Michael McIntyre @wtfender",
            "date": "2023/09/27",
            "description": "Detects a change in the AWS Identity Center (FKA AWS SSO) identity provider.\nA change in identity provider allows an attacker to establish persistent access or escalate privileges via user impersonation.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": [
                        "AssociateDirectory",
                        "DisableExternalIdPConfigurationForDirectory",
                        "DisassociateDirectory",
                        "EnableExternalIdPConfigurationForDirectory"
                    ],
                    "eventSource": [
                        "sso-directory.amazonaws.com",
                        "sso.amazonaws.com"
                    ]
                }
            },
            "falsepositives": [
                "Authorized changes to the AWS account's identity provider"
            ],
            "id": "d3adb3ef-b7e7-4003-9092-1924c797db35",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "references": [
                "https://docs.aws.amazon.com/singlesignon/latest/userguide/app-enablement.html",
                "https://docs.aws.amazon.com/singlesignon/latest/userguide/sso-info-in-cloudtrail.html",
                "https://docs.aws.amazon.com/service-authorization/latest/reference/list_awsiamidentitycentersuccessortoawssinglesign-on.html"
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1556"
            ],
            "title": "AWS Identity Center Identity Provider Change"
        },
        {
            "author": "@ionsor",
            "date": "2022/02/08",
            "description": "Detection for when multi factor authentication has been disabled, which might indicate a malicious activity to bypass authentication mechanisms.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": "Disable Strong Authentication.",
                    "eventSource": "AzureActiveDirectory",
                    "status": "success"
                }
            },
            "falsepositives": [
                "Authorized modification by administrators"
            ],
            "id": "7ea78478-a4f9-42a6-9dcd-f861816122bf",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/azure/active-directory/authentication/howto-mfa-userstates"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1556"
            ],
            "title": "Disabled MFA to Bypass Authentication Mechanisms"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Thomas Detzner '@tdetzner'",
            "date": "2022/08/04",
            "description": "Monitor and alert on group membership removal of groups that have CA policy modification access",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Remove member from group"
                }
            },
            "falsepositives": [
                "User removed from the group is approved"
            ],
            "id": "665e2d43-70dc-4ccc-9d27-026c9dd7ed9c",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-infrastructure#conditional-access"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1548",
                "attack.t1556"
            ],
            "title": "User Removed From Group With CA Policy Modification Access"
        },
        {
            "author": "Corissa Koopmans, '@corissalea'",
            "date": "2022/07/19",
            "description": "Monitor and alert on conditional access changes. Is Initiated by (actor) approved to make changes? Review Modified Properties and compare \"old\" vs \"new\" value.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Update conditional access policy"
                }
            },
            "falsepositives": [
                "Misconfigured role permissions",
                "Verify whether the user identity, user agent, and/or hostname should be making changes in your environment."
            ],
            "id": "50a3c7aa-ec29-44a4-92c1-fce229eef6fc",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-infrastructure#conditional-access"
            ],
            "modified": "2024/05/28",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1548",
                "attack.t1556"
            ],
            "title": "CA Policy Updated by Non Approved Actor"
        },
        {
            "author": "Corissa Koopmans, '@corissalea'",
            "date": "2022/07/19",
            "description": "Monitor and alert on conditional access changes where non approved actor removed CA Policy.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Delete conditional access policy"
                }
            },
            "falsepositives": [
                "Misconfigured role permissions",
                "Verify whether the user identity, user agent, and/or hostname should be making changes in your environment."
            ],
            "id": "26e7c5e2-6545-481e-b7e6-050143459635",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-infrastructure#conditional-access"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1548",
                "attack.t1556"
            ],
            "title": "CA Policy Removed by Non Approved Actor"
        },
        {
            "author": "Harjot Shah Singh, '@cyb3rjy0t'",
            "date": "2024/03/26",
            "description": "Detects newly added root certificate authority to an AzureAD tenant to support certificate based authentication.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "OperationName": "Set Company Information",
                    "TargetResources.modifiedProperties.newValue|contains": "TrustedCAsForPasswordlessAuth"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4bb80281-3756-4ec8-a88e-523c5a6fda9e",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://posts.specterops.io/passwordless-persistence-and-privilege-escalation-in-azure-98a01310be3f",
                "https://goodworkaround.com/2022/02/15/digging-into-azure-ad-certificate-based-authentication/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.t1556"
            ],
            "title": "New Root Certificate Authority Added"
        },
        {
            "author": "AlertIQ",
            "date": "2021/10/10",
            "description": "Change to authentication method could be an indicator of an attacker adding an auth method to the account so they can have continued access.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Category": "UserManagement",
                    "LoggedByService": "Authentication Methods",
                    "OperationName": "User registered security info"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4d78a000-ab52-4564-88a5-7ab5242b20c7",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "modified": "2022/12/25",
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1556",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.t1098"
            ],
            "title": "Change to Authentication Method"
        },
        {
            "author": "Harjot Shah Singh, '@cyb3rjy0t'",
            "date": "2024/03/26",
            "description": "Detects when certificate based authentication has been enabled in an Azure Active Directory tenant.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "OperationName": "Authentication Methods Policy Update",
                    "TargetResources.modifiedProperties|contains": "AuthenticationMethodsPolicy"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c2496b41-16a9-4016-a776-b23f8910dc58",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://posts.specterops.io/passwordless-persistence-and-privilege-escalation-in-azure-98a01310be3f",
                "https://goodworkaround.com/2022/02/15/digging-into-azure-ad-certificate-based-authentication/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.t1556"
            ],
            "title": "Certificate-Based Authentication Enabled"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Thomas Detzner '@tdetzner'",
            "date": "2022/08/04",
            "description": "Monitor and alert on group membership additions of groups that have CA policy modification access",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Add member from group"
                }
            },
            "falsepositives": [
                "User removed from the group is approved"
            ],
            "id": "91c95675-1f27-46d0-bead-d1ae96b97cd3",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-infrastructure#conditional-access"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1548",
                "attack.t1556"
            ],
            "title": "User Added To Group With CA Policy Modification Access"
        },
        {
            "author": "MikeDuddington, '@dudders1'",
            "date": "2022/07/27",
            "description": "Detect when users are authenticating without MFA being required.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AuthenticationRequirement": "singleFactorAuthentication",
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "28eea407-28d7-4e42-b0be-575d5ba60b2c",
            "level": "low",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-user-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1556.006"
            ],
            "title": "Azure AD Only Single Factor Authentication Required"
        },
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/18",
            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
            "detection": {
                "condition": "selection_img and (1 of selection_flags_*)",
                "selection_flags_configure": {
                    "CommandLine|contains|all": [
                        "/configure",
                        "/db"
                    ]
                },
                "selection_flags_discovery": {
                    "CommandLine|contains|all": [
                        "/export",
                        "/cfg"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\secedit.exe"
                    },
                    {
                        "OriginalFileName": "SeCEdit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrative use"
            ],
            "id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1562.002",
                "attack.t1547.001",
                "attack.t1505.005",
                "attack.t1556.002",
                "attack.t1562",
                "attack.t1574.007",
                "attack.t1564.002",
                "attack.t1546.008",
                "attack.t1546.007",
                "attack.t1547.014",
                "attack.t1547.010",
                "attack.t1547.002",
                "attack.t1557",
                "attack.t1082"
            ],
            "title": "Potential Suspicious Activity Using SeCEdit"
        },
        {
            "author": "Sreeman",
            "date": "2020/10/29",
            "description": "Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS",
            "detection": {
                "condition": "selection_cmdline",
                "selection_cmdline": {
                    "CommandLine|contains|all": [
                        "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa",
                        "scecli\\0*",
                        "reg add"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b7966f4a-b333-455b-8370-8ca53c229762",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://pentestlab.blog/2020/02/10/credential-access-password-filter-dll/",
                "https://github.com/3gstudent/PasswordFilter/tree/master/PasswordFilter"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1556.002"
            ],
            "title": "Dropping Of Password Filter DLL"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), Elastic (idea)",
            "date": "2022/10/17",
            "description": "Detects possible addition of shadow credentials to an active directory object.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AttributeLDAPDisplayName": "msDS-KeyCredentialLink",
                    "EventID": 5136
                }
            },
            "falsepositives": [
                "Modifications in the msDS-KeyCredentialLink attribute can be done legitimately by the Azure AD Connect synchronization account or the ADFS service account. These accounts can be added as Exceptions. (From elastic FP section)"
            ],
            "id": "f598ea0c-c25a-4f72-a219-50c44411c791",
            "level": "high",
            "logsource": {
                "definition": "The \"Audit Directory Service Changes\" logging policy must be configured in order to receive events. Audit events are generated only for objects with configured system access control lists (SACLs). Audit events are generated only for objects with configured system access control lists (SACLs) and only when accessed in a manner that matches their SACL settings. This policy covers the following events ids - 5136, 5137, 5138, 5139, 5141. Note that the default policy does not cover User objects. For that a custom AuditRule need to be setup (See https://github.com/OTRF/Set-AuditRule)",
                "product": "windows",
                "service": "security"
            },
            "references": [
                "https://www.elastic.co/guide/en/security/8.4/potential-shadow-credentials-added-to-ad-object.html",
                "https://cyberstoph.org/posts/2022/03/detecting-shadow-credentials/",
                "https://twitter.com/SBousseaden/status/1581300963650187264?"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1556"
            ],
            "title": "Possible Shadow Credentials Added"
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/12/27",
            "description": "Uses PowerShell to install/copy a file into a system directory such as \"System32\" or \"SysWOW64\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|re": "(Copy-Item|cpi) .{2,128} -Destination .{1,32}\\\\Windows\\\\(System32|SysWOW64)"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "63bf8794-9917-45bc-88dd-e1b5abc0ecfd",
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2024/01/22",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1556.002/T1556.002.md#atomic-test-1---install-and-register-password-filter-dll"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1556.002"
            ],
            "title": "Powershell Install a DLL in System Directory"
        },
        {
            "author": "Nischal Khadgi",
            "date": "2024/07/11",
            "description": "Detects changes to \"DsrmAdminLogonBehavior\" registry value.\nDuring a Domain Controller (DC) promotion, administrators create a Directory Services Restore Mode (DSRM) local administrator account with a password that rarely changes. The DSRM account is an \u201cAdministrator\u201d account that logs in with the DSRM mode when the server is booting up to restore AD backups or recover the server from a failure.\nAttackers could abuse DSRM account to maintain their persistence and access to the organization's Active Directory.\nIf the \"DsrmAdminLogonBehavior\" value is set to \"0\", the administrator account can only be used if the DC starts in DSRM.\nIf the \"DsrmAdminLogonBehavior\" value is set to \"1\", the administrator account can only be used if the local AD DS service is stopped.\nIf the \"DsrmAdminLogonBehavior\" value is set to \"2\", the administrator account can always be used.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_default_value": {
                    "Details": "DWORD (0x00000000)"
                },
                "selection": {
                    "TargetObject|endswith": "\\Control\\Lsa\\DsrmAdminLogonBehavior"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b61e87c0-50db-4b2e-8986-6a2be94b33b0",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "references": [
                "https://adsecurity.org/?p=1785",
                "https://www.sentinelone.com/blog/detecting-dsrm-account-misconfigurations/",
                "https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dsrm-credentials"
            ],
            "related": [
                {
                    "id": "53ad8e36-f573-46bf-97e4-15ba5bf4bb51",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1556"
            ],
            "title": "Directory Service Restore Mode(DSRM) Registry Value Tampering"
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "Linux",
        "macOS",
        "Network",
        "Azure AD",
        "Google Workspace",
        "IaaS",
        "Office 365",
        "SaaS"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Chris Ross @xorrior"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "credential-access"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "defense-evasion"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "persistence"
        }
    ],
    "x_mitre_detection": "Monitor for new, unfamiliar DLL files written to a domain controller and/or local computer. Monitor for changes to Registry entries for password filters (ex: <code>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Notification Packages</code>) and correlate then investigate the DLL files these files reference. \n\nPassword filters will also show up as an autorun and loaded DLL in lsass.exe.(Citation: Clymb3r Function Hook Passwords Sept 2013)\n\nMonitor for calls to <code>OpenProcess</code> that can be used to manipulate lsass.exe running on a domain controller as well as for malicious modifications to functions exported from authentication-related system DLLs (such as cryptdll.dll and samsrv.dll).(Citation: Dell Skeleton) \n\nMonitor PAM configuration and module paths (ex: <code>/etc/pam.d/</code>) for changes. Use system-integrity tools such as AIDE and monitoring tools such as auditd to monitor PAM files.\n\nMonitor for suspicious additions to the /Library/Security/SecurityAgentPlugins directory.(Citation: Xorrior Authorization Plugins)\n\nConfigure robust, consistent account activity audit policies across the enterprise and with externally accessible services. (Citation: TechNet Audit Policy) Look for suspicious account behavior across systems that share accounts, either user, admin, or service accounts. Examples: one account logged into multiple systems simultaneously; multiple accounts logged into the same machine simultaneously; accounts logged in at odd times or outside of business hours. Activity may be from interactive login sessions or process ownership from accounts being used to execute binaries on a remote system as a particular account. Correlate other security systems with login information (e.g., a user has an active login session but has not entered the building or does not have VPN access).\n\nMonitor property changes in Group Policy that manage authentication mechanisms (i.e. [Group Policy Modification](https://attack.mitre.org/techniques/T1484/001)). The <code>Store passwords using reversible encryption</code> configuration should be set to Disabled. Additionally, monitor and/or block suspicious command/script execution of <code>-AllowReversiblePasswordEncryption $true</code>, <code>Set-ADUser</code> and <code>Set-ADAccountControl</code>. Finally, monitor Fine-Grained Password Policies and regularly audit user accounts and group settings.(Citation: dump_pwd_dcsync)\n",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "2.4",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Application Log: Application Log Content",
        "Process: Process Access",
        "Logon Session: Logon Session Creation",
        "Active Directory: Active Directory Object Modification",
        "User Account: User Account Authentication",
        "Process: OS API Execution",
        "Windows Registry: Windows Registry Key Creation",
        "File: File Creation",
        "User Account: User Account Modification",
        "File: File Modification",
        "Module: Module Load",
        "Cloud Service: Cloud Service Modification",
        "Windows Registry: Windows Registry Key Modification"
    ],
    "x_mitre_permissions_required": []
}