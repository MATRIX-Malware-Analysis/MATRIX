{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--bbb8b924-c6ba-44ad-ac0b-a4fa38c31f48",
    "created": "2024-08-13T14:46:36.895206Z",
    "modified": "2024-08-13T14:46:44.837218Z",
    "name": "Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted Non-C2 Protocol",
    "description": "Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server.[1]Adversaries may opt to obfuscate this data, without the use of encryption, within network protocols that are natively unencrypted (such as HTTP, FTP, or DNS). This may include custom or publicly available encoding/compression algorithms (such as base64) as well as embedding data within protocol headers and fields.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1048/003",
            "external_id": "T1048/003"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/05/10",
            "description": "Detects suspicious DNS queries using base64 encoding",
            "detection": {
                "condition": "selection",
                "selection": {
                    "query|contains": "==."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4153a907-2451-4e4f-a578-c52bb6881432",
            "level": "medium",
            "logsource": {
                "category": "dns"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/krmaxwell/dns-exfiltration"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003",
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious DNS Query with B64 Encoded String"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/05/02",
            "description": "A General detection for WebDav user-agent being used to PUT files on a WebDav network share. This could be an indicator of exfiltration.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "id.resp_h|cidr": [
                        "10.0.0.0/8",
                        "127.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16"
                    ]
                },
                "selection": {
                    "method": "PUT",
                    "user_agent|contains": "WebDAV"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "705072a5-bb6f-4ced-95b6-ecfa6602090b",
            "level": "low",
            "logsource": {
                "product": "zeek",
                "service": "http"
            },
            "modified": "2024/03/13",
            "references": [
                "https://github.com/OTRF/detection-hackathon-apt29/issues/17"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003"
            ],
            "title": "WebDav Put Request"
        },
        {
            "author": "frack113",
            "date": "2022/01/07",
            "description": "Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.\nThe data may also be sent to an alternate network location from the main command and control server.\n",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_clients": {
                    "Image|endswith": [
                        "\\thunderbird.exe",
                        "\\outlook.exe"
                    ]
                },
                "filter_mailserver": {
                    "Image|startswith": "C:\\Program Files\\Microsoft\\Exchange Server\\"
                },
                "filter_outlook": {
                    "Image|endswith": "\\HxTsr.exe",
                    "Image|startswith": "C:\\Program Files\\WindowsApps\\microsoft.windowscommunicationsapps_"
                },
                "selection": {
                    "DestinationPort": [
                        25,
                        587,
                        465,
                        2525
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Other SMTP tools"
            ],
            "id": "9976fa64-2804-423c-8a5b-646ade840773",
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2022/09/21",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp",
                "https://www.ietf.org/rfc/rfc2821.txt"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003"
            ],
            "title": "Suspicious Outbound SMTP Connections"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)",
            "date": "2023/03/16",
            "description": "Detects \"svchost.exe\" spawning \"rundll32.exe\" with command arguments like C:\\windows\\system32\\davclnt.dll,DavSetCookie. This could be an indicator of exfiltration or use of WebDav to launch code (hosted on WebDav Server) or potentially a sign of exploitation of CVE-2023-23397\n",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_local_ips": {
                    "CommandLine|contains": [
                        "://10.",
                        "://192.168.",
                        "://172.16.",
                        "://172.17.",
                        "://172.18.",
                        "://172.19.",
                        "://172.20.",
                        "://172.21.",
                        "://172.22.",
                        "://172.23.",
                        "://172.24.",
                        "://172.25.",
                        "://172.26.",
                        "://172.27.",
                        "://172.28.",
                        "://172.29.",
                        "://172.30.",
                        "://172.31.",
                        "://127.",
                        "://169.254."
                    ]
                },
                "selection": {
                    "CommandLine|contains": "C:\\windows\\system32\\davclnt.dll,DavSetCookie",
                    "CommandLine|re": "://\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}",
                    "Image|endswith": "\\rundll32.exe",
                    "ParentCommandLine|contains": "-s WebClient",
                    "ParentImage|endswith": "\\svchost.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "982e9f2d-1a85-4d5b-aea4-31f5e97c6555",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/09/18",
            "references": [
                "https://twitter.com/aceresponder/status/1636116096506818562",
                "https://www.mdsec.co.uk/2023/03/exploiting-cve-2023-23397-microsoft-outlook-elevation-of-privilege-vulnerability/",
                "https://www.pwndefend.com/2023/03/15/the-long-game-persistent-hash-theft/",
                "https://www.microsoft.com/en-us/security/blog/wp-content/uploads/2023/03/Figure-7-sample-webdav-process-create-event.png",
                "https://www.microsoft.com/en-us/security/blog/2023/03/24/guidance-for-investigating-attacks-using-cve-2023-23397/"
            ],
            "status": "experimental",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003",
                "cve.2023.23397"
            ],
            "title": "Suspicious WebDav Client Execution Via Rundll32.EXE"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/05/02",
            "description": "Detects \"svchost.exe\" spawning \"rundll32.exe\" with command arguments like \"C:\\windows\\system32\\davclnt.dll,DavSetCookie\".\nThis could be an indicator of exfiltration or use of WebDav to launch code (hosted on a WebDav server).\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": "C:\\windows\\system32\\davclnt.dll,DavSetCookie"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    }
                ],
                "selection_parent": {
                    "ParentImage|endswith": "\\svchost.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "2dbd9d3d-9e27-42a8-b8df-f13825c6c3d5",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/09/18",
            "references": [
                "https://github.com/OTRF/detection-hackathon-apt29/issues/17",
                "https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/7.B.4_C10730EA-6345-4934-AA0F-B0EFCA0C4BA6.md"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003"
            ],
            "title": "WebDav Client Execution Via Rundll32.EXE"
        },
        {
            "author": "frack113",
            "date": "2022/09/26",
            "description": "Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.\nThe data may also be sent to an alternate network location from the main command and control server.\n",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "ScriptBlockText|contains": "CmdletsToExport"
                },
                "selection": {
                    "ScriptBlockText|contains": "Send-MailMessage"
                }
            },
            "falsepositives": [
                "Legitimate script"
            ],
            "id": "9a7afa56-4762-43eb-807d-c3dc9ffe211b",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp",
                "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.4",
                "https://www.ietf.org/rfc/rfc2821.txt"
            ],
            "status": "test",
            "title": "Powershell Exfiltration Over SMTP",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003"
            ]
        },
        {
            "author": "Bartlomiej Czyz @bczyz1, oscd.community",
            "date": "2020/10/10",
            "description": "Detects Exfiltration Over Alternative Protocol - ICMP. Adversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "New-Object",
                        "System.Net.NetworkInformation.Ping",
                        ".Send("
                    ]
                }
            },
            "falsepositives": [
                "Legitimate usage of System.Net.NetworkInformation.Ping class"
            ],
            "id": "4c4af3cd-2115-479c-8193-6b8bfce9001c",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048.003/T1048.003.md#atomic-test-2---exfiltration-over-alternative-protocol---icmp"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003"
            ],
            "title": "PowerShell ICMP Exfiltration"
        },
        {
            "author": "Pawel Mazur",
            "date": "2021/11/18",
            "description": "Detects attempts to post the file with the usage of wget utility.\nThe adversary can bypass the permission restriction with the misconfigured sudo permission for wget utility which could allow them to read files like /etc/shadow.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "a0": "wget",
                    "a1|startswith": "--post-file=",
                    "type": "EXECVE"
                }
            },
            "falsepositives": [
                "Legitimate usage of wget utility to post a file"
            ],
            "id": "cb39d16b-b3b6-4a7a-8222-1cf24b686ffc",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2022/12/25",
            "references": [
                "https://linux.die.net/man/1/wget",
                "https://gtfobins.github.io/gtfobins/wget/"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003"
            ],
            "title": "Data Exfiltration with Wget"
        }
    ]
}