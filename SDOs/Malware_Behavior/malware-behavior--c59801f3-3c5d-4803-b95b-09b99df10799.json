{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--c59801f3-3c5d-4803-b95b-09b99df10799",
    "created": "2024-08-13T14:46:36.967912Z",
    "modified": "2024-08-13T14:46:45.170071Z",
    "name": "Unsecured Credentials",
    "description": "Adversaries may search compromised systems to find and obtain insecurely stored credentials. These credentials can be stored and/or misplaced in many locations on a system, including plaintext files (e.g. Bash History), operating system or application-specific repositories (e.g. Credentials in Registry),  or other specialized files/artifacts (e.g. Private Keys).[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1552",
            "external_id": "T1552"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1552",
            "external_id": "T1552"
        },
        {
            "source_name": "Brining MimiKatz to Unix",
            "description": "Tim Wadhwa-Brown. (2018, November). Where 2 worlds collide Bringing Mimikatz et al to UNIX. Retrieved October 13, 2021.",
            "url": "https://labs.portcullis.co.uk/download/eu-18-Wadhwa-Brown-Where-2-worlds-collide-Bringing-Mimikatz-et-al-to-UNIX.pdf"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "kelnage",
            "date": "2023/04/03",
            "description": "Detects when a user has potentially entered their password into the\nusername field, which will cause the password to be retained in log files.\n",
            "detection": {
                "condition": "selection and not filter_main",
                "filter_main": {
                    "actor.alternateid|re": "(^0oa.*|[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,10})"
                },
                "selection": {
                    "legacyeventtype": "core.user_auth.login_failed"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "91b76b84-8589-47aa-9605-c837583b82a9",
            "level": "high",
            "logsource": {
                "product": "okta",
                "service": "okta"
            },
            "modified": "2023/10/25",
            "references": [
                "https://developer.okta.com/docs/reference/api/system-log/",
                "https://www.mitiga.io/blog/how-okta-passwords-can-be-compromised-uncovering-a-risk-to-user-data",
                "https://help.okta.com/en-us/Content/Topics/users-groups-profiles/usgp-create-character-restriction.htm"
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552"
            ],
            "title": "Potential Okta Password in AlternateID Field"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/11/25",
            "description": "Identifies when an admission controller is executed in GCP Kubernetes.\nA Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server.\nThe behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster.\nAn adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster.\nFor example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod. An adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials.\nAn adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "gcp.audit.method_name|contains": [
                        ".mutatingwebhookconfigurations.",
                        ".validatingwebhookconfigurations."
                    ],
                    "gcp.audit.method_name|endswith": [
                        "create",
                        "patch",
                        "replace"
                    ],
                    "gcp.audit.method_name|startswith": "admissionregistration.k8s.io.v"
                }
            },
            "falsepositives": [
                "Google Cloud Kubernetes Admission Controller may be done by a system administrator.",
                "If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "6ad91e31-53df-4826-bd27-0166171c8040",
            "level": "medium",
            "logsource": {
                "product": "gcp",
                "service": "gcp.audit"
            },
            "modified": "2022/12/18",
            "references": [
                "https://cloud.google.com/kubernetes-engine/docs"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1078",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.007"
            ],
            "title": "Google Cloud Kubernetes Admission Controller"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/08/16",
            "description": "Identifies when a Keyvault Key is modified or deleted in Azure.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName": [
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/UPDATE/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/CREATE",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/CREATE/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/IMPORT/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/RECOVER/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/RESTORE/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/DELETE",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/BACKUP/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/KEYS/PURGE/ACTION"
                    ]
                }
            },
            "falsepositives": [
                "Key being modified or deleted may be performed by a system administrator.",
                "Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "Key modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "80eeab92-0979-4152-942d-96749e11df40",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/08/23",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.001"
            ],
            "title": "Azure Keyvault Key Modified or Deleted"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/08/16",
            "description": "Identifies when secrets are modified or deleted in Azure.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName": [
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/WRITE",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/DELETE",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/BACKUP/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/PURGE/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/UPDATE/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/RECOVER/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/RESTORE/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/SECRETS/SETSECRET/ACTION"
                    ]
                }
            },
            "falsepositives": [
                "Secrets being modified or deleted may be performed by a system administrator.",
                "Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "Secrets modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "b831353c-1971-477b-abb6-2828edc3bca1",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/08/23",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.001"
            ],
            "title": "Azure Keyvault Secrets Modified or Deleted"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/08/16",
            "description": "Identifies when a key vault is modified or deleted.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName": [
                        "MICROSOFT.KEYVAULT/VAULTS/WRITE",
                        "MICROSOFT.KEYVAULT/VAULTS/DELETE",
                        "MICROSOFT.KEYVAULT/VAULTS/DEPLOY/ACTION",
                        "MICROSOFT.KEYVAULT/VAULTS/ACCESSPOLICIES/WRITE"
                    ]
                }
            },
            "falsepositives": [
                "Key Vault being modified or deleted may be performed by a system administrator.",
                "Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "Key Vault modified or deleted from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "459a2970-bb84-4e6a-a32e-ff0fbd99448d",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/08/23",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.001"
            ],
            "title": "Azure Key Vault Modified or Deleted"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/11/25",
            "description": "Identifies when an admission controller is executed in Azure Kubernetes.\nA Kubernetes Admission controller intercepts, and possibly modifies, requests to the Kubernetes API server.\nThe behavior of this admission controller is determined by an admission webhook (MutatingAdmissionWebhook or ValidatingAdmissionWebhook) that the user deploys in the cluster.\nAn adversary can use such webhooks as the MutatingAdmissionWebhook for obtaining persistence in the cluster.\nFor example, attackers can intercept and modify the pod creation operations in the cluster and add their malicious container to every created pod.\nAn adversary can use the webhook ValidatingAdmissionWebhook, which could be used to obtain access credentials.\nAn adversary could use the webhook to intercept the requests to the API server, record secrets, and other sensitive information.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName|endswith": [
                        "/MUTATINGWEBHOOKCONFIGURATIONS/WRITE",
                        "/VALIDATINGWEBHOOKCONFIGURATIONS/WRITE"
                    ],
                    "operationName|startswith": [
                        "MICROSOFT.KUBERNETES/CONNECTEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO",
                        "MICROSOFT.CONTAINERSERVICE/MANAGEDCLUSTERS/ADMISSIONREGISTRATION.K8S.IO"
                    ]
                }
            },
            "falsepositives": [
                "Azure Kubernetes Admissions Controller may be done by a system administrator.",
                "If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "a61a3c56-4ce2-4351-a079-88ae4cbd2b58",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/12/18",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftkubernetes"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1078",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.007"
            ],
            "title": "Azure Kubernetes Admission Controller"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik'",
            "date": "2022/06/02",
            "description": "Detects when a configuration change is made to an applications AppID URI.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": [
                        "Update Application",
                        "Update Service principal"
                    ]
                }
            },
            "falsepositives": [
                "When and administrator is making legitimate AppID URI configuration changes to an application. This should be a planned event."
            ],
            "id": "1b45b0d1-773f-4f23-aedc-814b759563b1",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-applications#appid-uri-added-modified-or-removed"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1552",
                "attack.t1078.004"
            ],
            "title": "Application AppID Uri Configuration Changes"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik'",
            "date": "2022/06/02",
            "description": "Detects when a new owner is added to an application. This gives that account privileges to make modifications and configuration changes to the application.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Add owner to application"
                }
            },
            "falsepositives": [
                "When a new application owner is added by an administrator"
            ],
            "id": "74298991-9fc4-460e-a92e-511aa60baec1",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-applications#new-owner"
            ],
            "status": "test",
            "tags": [
                "attack.t1552",
                "attack.credential_access"
            ],
            "title": "Added Owner To Application"
        },
        {
            "author": "kelnage",
            "date": "2024/07/11",
            "description": "Detects when a modification (create, update or replace) action is taken that affects mutating or validating webhook configurations, as they can be used by an adversary to achieve persistence or exfiltrate access credentials.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "objectRef.apiGroup": "admissionregistration.k8s.io",
                    "objectRef.resource": [
                        "mutatingwebhookconfigurations",
                        "validatingwebhookconfigurations"
                    ],
                    "verb": [
                        "create",
                        "delete",
                        "patch",
                        "replace",
                        "update"
                    ]
                }
            },
            "falsepositives": [
                "Modifying the Kubernetes Admission Controller may need to be done by a system administrator.",
                "Automated processes may need to take these actions and may need to be filtered."
            ],
            "id": "eed82177-38f5-4299-8a76-098d50d225ab",
            "level": "medium",
            "logsource": {
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://kubernetes.io/docs/reference/config-api/apiserver-audit.v1/",
                "https://security.padok.fr/en/blog/kubernetes-webhook-attackers"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "6ad91e31-53df-4826-bd27-0166171c8040"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1078",
                "attack.credential_access",
                "attack.t1552",
                "attack.t1552.007"
            ],
            "title": "Kubernetes Admission Controller Modification"
        },
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects enumeration of Kubernetes secrets.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "objectRef.resource": "secrets",
                    "verb": "list"
                }
            },
            "falsepositives": [
                "The Kubernetes dashboard occasionally accesses the kubernetes-dashboard-key-holder secret"
            ],
            "id": "eeb3e9e1-b685-44e4-9232-6bb701f925b5",
            "level": "low",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://microsoft.github.io/Threat-Matrix-for-Kubernetes/techniques/List%20K8S%20secrets/"
            ],
            "related": [
                {
                    "id": "7ee0b4aa-d8d4-4088-b661-20efdf41a04c",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.t1552.007"
            ],
            "title": "Kubernetes Secrets Enumeration"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/12",
            "description": "Show when private keys are being exported from the device, or when new certificates are installed",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "crypto pki export",
                    "crypto pki import",
                    "crypto pki trustpoint"
                ]
            },
            "falsepositives": [
                "Not commonly run by administrators. Also whitelist your known good certificates"
            ],
            "id": "1f978c6a-4415-47fb-aca5-736a44d7ca3d",
            "level": "high",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "references": [
                "https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/a1/sec-a1-cr-book/sec-a1-cr-book_chapter_0111.html"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.t1553.004",
                "attack.t1552.004"
            ],
            "title": "Cisco Crypto Commands"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/11",
            "description": "See what commands are being input into the device by other people, full credentials can be in the history",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "show history",
                    "show history all",
                    "show logging"
                ]
            },
            "falsepositives": [
                "Not commonly run by administrators, especially if remote logging is configured"
            ],
            "fields": [
                "CmdSet"
            ],
            "id": "b094d9fb-b1ad-4650-9f1a-fb7be9f1d34b",
            "level": "medium",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.003"
            ],
            "title": "Cisco Show Commands Input"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/11",
            "description": "Collect pertinent data from the configuration files",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "show running-config",
                    "show startup-config",
                    "show archive config",
                    "more"
                ]
            },
            "falsepositives": [
                "Commonly run by administrators"
            ],
            "id": "cd072b25-a418-4f98-8ebc-5093fb38fe1a",
            "level": "low",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "references": [
                "https://blog.router-switch.com/2013/11/show-running-config/",
                "https://www.cisco.com/E-Learning/bulk/public/tac/cim/cib/using_cisco_ios_software/cmdrefs/show_startup-config.htm",
                "https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/config-mgmt/configuration/15-sy/config-mgmt-15-sy-book/cm-config-diff.html"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.credential_access",
                "attack.collection",
                "attack.t1087.001",
                "attack.t1552.001",
                "attack.t1005"
            ],
            "title": "Cisco Collect Data"
        },
        {
            "author": "Igor Fits, Mikhail Larin, oscd.community",
            "date": "2020/10/19",
            "description": "Detecting attempts to extract passwords with grep and laZagne",
            "detection": {
                "condition": "1 of selection*",
                "selection1": {
                    "CommandLine|contains": "password",
                    "Image|endswith": "/grep"
                },
                "selection2": {
                    "CommandLine|contains": "laZagne"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "53b1b378-9b06-4992-b972-dde6e423d2b4",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.001/T1552.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001"
            ],
            "title": "Credentials In Files"
        },
        {
            "author": "Mikhail Larin, oscd.community",
            "date": "2020/10/17",
            "description": "Detects commandline operations on shell history files",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        ".bash_history",
                        ".zsh_history",
                        ".zhistory",
                        ".history",
                        ".sh_history",
                        "fish_history"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administrative activity",
                "Legitimate software, cleaning hist file"
            ],
            "id": "508a9374-ad52-4789-b568-fc358def2c65",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.003/T1552.003.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.003"
            ],
            "title": "Suspicious History File Operations"
        },
        {
            "author": "frack113",
            "date": "2023/12/21",
            "description": "Detects file access requests to potentially sensitive files hosted on the Windows Sysvol share.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": {
                    "Image|startswith": [
                        ":\\Program Files (x86)\\",
                        ":\\Program Files\\",
                        ":\\Windows\\explorer.exe",
                        ":\\Windows\\system32\\",
                        ":\\Windows\\SysWOW64\\"
                    ]
                },
                "selection": {
                    "FileName|contains|all": [
                        "\\sysvol\\",
                        "\\Policies\\"
                    ],
                    "FileName|endswith": [
                        "audit.csv",
                        "Files.xml",
                        "GptTmpl.inf",
                        "groups.xml",
                        "Registry.pol",
                        "Registry.xml",
                        "scheduledtasks.xml",
                        "scripts.ini",
                        "services.xml"
                    ],
                    "FileName|startswith": "\\\\"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d51694fe-484a-46ac-92d6-969e76d60d10",
            "level": "medium",
            "logsource": {
                "category": "file_access",
                "definition": "Requirements: Microsoft-Windows-Kernel-File ETW provider",
                "product": "windows"
            },
            "references": [
                "https://github.com/vletoux/pingcastle"
            ],
            "related": [
                {
                    "id": "8344c19f-a023-45ff-ad63-a01c5396aea0",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Access To Potentially Sensitive Sysvol Files By Uncommon Application"
        },
        {
            "author": "Nounou Mbeiri, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2024/06/26",
            "description": "Detects file names with specific patterns seen generated and used by tools such as Mimikatz and DSInternals related to exported or stolen DPAPI backup keys and certificates.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename|contains": [
                        "ntds_capi_",
                        "ntds_legacy_",
                        "ntds_unknown_"
                    ],
                    "TargetFilename|endswith": [
                        ".cer",
                        ".key",
                        ".pfx",
                        ".pvk"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "7892ec59-c5bb-496d-8968-e5d210ca3ac4",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://www.dsinternals.com/en/dpapi-backup-key-theft-auditing/",
                "https://github.com/MichaelGrafnetter/DSInternals/blob/39ee8a69bbdc1cfd12c9afdd7513b4788c4895d4/Src/DSInternals.Common/Data/DPAPI/DPAPIBackupKey.cs#L28-L32"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1555",
                "attack.t1552.004"
            ],
            "title": "DPAPI Backup Keys And Certificate Export Activity IOC"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/07/23",
            "description": "Detects files written by the different tools that exploit HiveNightmare",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "TargetFilename|contains": [
                            "\\hive_sam_",
                            "\\SAM-2021-",
                            "\\SAM-2022-",
                            "\\SAM-2023-",
                            "\\SAM-haxx",
                            "\\Sam.save"
                        ]
                    },
                    {
                        "TargetFilename": "C:\\windows\\temp\\sam"
                    }
                ]
            },
            "falsepositives": [
                "Files that accidentally contain these strings"
            ],
            "id": "6ea858a8-ba71-4a12-b2cc-5d83312404c7",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2024/06/27",
            "references": [
                "https://github.com/GossiTheDog/HiveNightmare",
                "https://github.com/FireFart/hivenightmare/",
                "https://github.com/WiredPulse/Invoke-HiveNightmare",
                "https://twitter.com/cube0x0/status/1418920190759378944"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001",
                "cve.2021.36934"
            ],
            "title": "HackTool - Typical HiveNightmare SAM File Export"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/05/02",
            "description": "A general detection for processes creating PFX files. This could be an indicator of an adversary exporting a local certificate to a PFX file.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_windows_tmp_key": {
                    "TargetFilename|contains|all": [
                        "\\Templates\\Windows\\Windows_TemporaryKey.pfx",
                        "\\CMake\\"
                    ]
                },
                "selection": {
                    "TargetFilename|endswith": ".pfx"
                }
            },
            "falsepositives": [
                "System administrators managing certificates."
            ],
            "id": "dca1b3e8-e043-4ec8-85d7-867f334b5724",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2022/07/07",
            "references": [
                "https://github.com/OTRF/detection-hackathon-apt29/issues/14",
                "https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/6.B.1_6392C9F1-D975-4F75-8A70-433DEDD7F622.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.004"
            ],
            "title": "Suspicious PFX File Creation"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/03/14",
            "description": "Detects the execution of Sysinternals ADExplorer with the \"-snapshot\" flag in order to save a local copy of the active directory database to a suspicious directory.",
            "detection": {
                "condition": "all of selection_*",
                "selection_flag": {
                    "CommandLine|contains": "snapshot"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\ADExplorer.exe"
                    },
                    {
                        "OriginalFileName": "AdExp"
                    }
                ],
                "selection_paths": {
                    "CommandLine|contains": [
                        "\\Downloads\\",
                        "\\Users\\Public\\",
                        "\\AppData\\",
                        "\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ef61af62-bc74-4f58-b49b-626448227652",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.documentcloud.org/documents/5743766-Global-Threat-Report-2019.html"
            ],
            "related": [
                {
                    "id": "9212f354-7775-4e28-9c9f-8f0a4544e664",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001",
                "attack.t1003.003"
            ],
            "title": "Suspicious Active Directory Database Snapshot Via ADExplorer"
        },
        {
            "author": "frack113",
            "date": "2021/12/27",
            "description": "Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "cpassword",
                        "\\sysvol\\",
                        ".xml"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "91a2c315-9ee6-4052-a853-6f6a8238f90d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/11",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.006/T1552.006.md#atomic-test-1---gpp-passwords-findstr"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Findstr GPP Passwords"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/04/23",
            "description": "Detects a \"Get-Process\" cmdlet and it's aliases on lsass process, which is in almost all cases a sign of malicious activity",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "Get-Process lsas",
                        "ps lsas",
                        "gps lsas"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b2815d0d-7481-4bf0-9b6c-a4c48a94b349",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/01/05",
            "references": [
                "https://twitter.com/PythonResponder/status/1385064506049630211"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.004"
            ],
            "title": "PowerShell Get-Process LSASS"
        },
        {
            "author": "frack113",
            "date": "2021/07/28",
            "description": "Once established within a system or network, an adversary may use automated techniques for collecting internal data.",
            "detection": {
                "condition": "selection_ext and 1 of selection_other_*",
                "selection_ext": {
                    "CommandLine|contains": [
                        ".doc",
                        ".docx",
                        ".xls",
                        ".xlsx",
                        ".ppt",
                        ".pptx",
                        ".rtf",
                        ".pdf",
                        ".txt"
                    ]
                },
                "selection_other_dir": {
                    "CommandLine|contains|all": [
                        "dir ",
                        " /b ",
                        " /s "
                    ]
                },
                "selection_other_findstr": {
                    "CommandLine|contains": [
                        " /e ",
                        " /si "
                    ],
                    "OriginalFileName": "FINDSTR.EXE"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f576a613-2392-4067-9d1a-9345fb58d8d1",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/11/11",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1119/T1119.md",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.001/T1552.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1119",
                "attack.credential_access",
                "attack.t1552.001"
            ],
            "title": "Automated Collection Command Prompt"
        },
        {
            "author": "Markus Neis, Jonhnathan Ribeiro, oscd.community",
            "date": "2018/04/09",
            "description": "Detects Access to Domain Group Policies stored in SYSVOL",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "\\SYSVOL\\",
                        "\\policies\\"
                    ]
                }
            },
            "falsepositives": [
                "Administrative activity"
            ],
            "id": "05f3c945-dcc8-4393-9f3d-af65077a8f86",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/01/07",
            "references": [
                "https://adsecurity.org/?p=2288",
                "https://www.hybrid-analysis.com/sample/f2943f5e45befa52fb12748ca7171d30096e1d4fc3c365561497c618341299d5?environmentId=100"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Suspicious SYSVOL Domain Group Policy Access"
        },
        {
            "id": "9212f354-7775-4e28-9c9f-8f0a4544e664",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/03/14",
            "description": "Detects the execution of Sysinternals ADExplorer with the \"-snapshot\" flag in order to save a local copy of the active directory database.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": "snapshot"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\ADExplorer.exe"
                    },
                    {
                        "OriginalFileName": "AdExp"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.documentcloud.org/documents/5743766-Global-Threat-Report-2019.html"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "ef61af62-bc74-4f58-b49b-626448227652"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001",
                "attack.t1003.003"
            ],
            "title": "Active Directory Database Snapshot Via ADExplorer"
        },
        {
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2023/12/04",
            "description": "Detects commandline keywords indicative of potential usge of the tool WinPwn. A tool for Windows and Active Directory reconnaissance and exploitation.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "Offline_Winpwn",
                        "WinPwn ",
                        "WinPwn.exe",
                        "WinPwn.ps1"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d557dc06-62e8-4468-a8e8-7984124908ce",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://github.com/S3cur3Th1sSh1t/WinPwn",
                "https://www.publicnow.com/view/EB87DB49C654D9B63995FAD4C9DE3D3CC4F6C3ED?1671634841",
                "https://reconshell.com/winpwn-tool-for-internal-windows-pentesting-and-ad-security/",
                "https://github.com/redcanaryco/atomic-red-team/blob/4d6c4e8e23d465af7a2388620cfe3f8c76e16cf0/atomics/T1082/T1082.md",
                "https://grep.app/search?q=winpwn&filter[repo][0]=redcanaryco/atomic-red-team"
            ],
            "related": [
                {
                    "id": "851fd622-b675-4d26-b803-14bc7baa517a",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.discovery",
                "attack.execution",
                "attack.privilege_escalation",
                "attack.t1046",
                "attack.t1082",
                "attack.t1106",
                "attack.t1518",
                "attack.t1548.002",
                "attack.t1552.001",
                "attack.t1555",
                "attack.t1555.003"
            ],
            "title": "HackTool - WinPwn Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/20",
            "description": "Detects processes that query known 3rd party registry keys that holds credentials via commandline",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "\\Software\\SimonTatham\\PuTTY\\Sessions",
                        "\\Software\\\\SimonTatham\\PuTTY\\SshHostKeys\\",
                        "\\Software\\Mobatek\\MobaXterm\\",
                        "\\Software\\WOW6432Node\\Radmin\\v3.0\\Server\\Parameters\\Radmin",
                        "\\Software\\Aerofox\\FoxmailPreview",
                        "\\Software\\Aerofox\\Foxmail\\V3.1",
                        "\\Software\\IncrediMail\\Identities",
                        "\\Software\\Qualcomm\\Eudora\\CommandLine",
                        "\\Software\\RimArts\\B2\\Settings",
                        "\\Software\\OpenVPN-GUI\\configs",
                        "\\Software\\Martin Prikryl\\WinSCP 2\\Sessions",
                        "\\Software\\FTPWare\\COREFTP\\Sites",
                        "\\Software\\DownloadManager\\Passwords",
                        "\\Software\\OpenSSH\\Agent\\Keys",
                        "\\Software\\TightVNC\\Server",
                        "\\Software\\ORL\\WinVNC3\\Password",
                        "\\Software\\RealVNC\\WinVNC4"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "87a476dc-0079-4583-a985-dee7a20a03de",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://isc.sans.edu/diary/More+Data+Exfiltration/25698",
                "https://github.com/synacktiv/Radmin3-Password-Cracker/blob/acfc87393e4b7c06353973a14a6c7126a51f36ac/regkey.txt",
                "https://github.com/HyperSine/how-does-MobaXterm-encrypt-password",
                "https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#inside-the-registry"
            ],
            "related": [
                {
                    "id": "e0b0c2ab-3d52-46d9-8cb7-049dc775fbd1",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.002"
            ],
            "title": "Enumeration for 3rd Party Creds From CLI"
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/07/20",
            "description": "Adversaries may search for private key certificate files on compromised systems for insecurely stored credential",
            "detection": {
                "condition": "selection_ext and (all of selection_cmd_* or all of selection_pwsh_* or selection_findstr)",
                "selection_cmd_cli": {
                    "CommandLine|contains": "dir "
                },
                "selection_cmd_img": [
                    {
                        "Image|endswith": "\\cmd.exe"
                    },
                    {
                        "OriginalFileName": "Cmd.Exe"
                    }
                ],
                "selection_ext": {
                    "CommandLine|contains": [
                        ".key",
                        ".pgp",
                        ".gpg",
                        ".ppk",
                        ".p12",
                        ".pem",
                        ".pfx",
                        ".cer",
                        ".p7b",
                        ".asc"
                    ]
                },
                "selection_findstr": [
                    {
                        "Image|endswith": "\\findstr.exe"
                    },
                    {
                        "OriginalFileName": "FINDSTR.EXE"
                    }
                ],
                "selection_pwsh_cli": {
                    "CommandLine|contains": "Get-ChildItem "
                },
                "selection_pwsh_img": [
                    {
                        "Image|endswith": [
                            "\\powershell.exe",
                            "\\pwsh.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "213d6a77-3d55-4ce8-ba74-fcfef741974e",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/06",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.004/T1552.004.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.004"
            ],
            "title": "Private Keys Reconnaissance Via CommandLine Tools"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/08/12",
            "description": "Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID",
            "detection": {
                "condition": "all of selection_findstr_* or selection_special",
                "selection_findstr_cli": {
                    "CommandLine|contains": "lsass"
                },
                "selection_findstr_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ],
                "selection_special": {
                    "CommandLine|contains|windash": [
                        " /i \"lsass",
                        " /i lsass.exe",
                        "findstr \"lsass",
                        "findstr lsass",
                        "findstr.exe \"lsass",
                        "findstr.exe lsass"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fe63010f-8823-4864-a96b-a7b4a0f7b929",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/06/04",
            "references": [
                "https://blog.talosintelligence.com/2022/08/recent-cyber-attack.html?m=1"
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "LSASS Process Reconnaissance Via Findstr.EXE"
        },
        {
            "id": "e0b0c2ab-3d52-46d9-8cb7-049dc775fbd1",
            "author": "frack113",
            "date": "2021/12/20",
            "description": "Adversaries may search the Registry on compromised systems for insecurely stored credentials.\nThe Windows Registry stores configuration information that can be used by the system or other programs.\nAdversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services\n",
            "detection": {
                "condition": "reg and hive",
                "hive": [
                    {
                        "CommandLine|contains|all": [
                            "/f ",
                            "HKLM"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "/f ",
                            "HKCU"
                        ]
                    },
                    {
                        "CommandLine|contains": "HKCU\\Software\\SimonTatham\\PuTTY\\Sessions"
                    }
                ],
                "reg": {
                    "CommandLine|contains|all": [
                        " query ",
                        "/t ",
                        "REG_SZ",
                        "/s"
                    ],
                    "Image|endswith": "\\reg.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.002/T1552.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.002"
            ],
            "title": "Enumeration for Credentials in Registry"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), X__Junior (Nextron Systems)",
            "date": "2022/09/09",
            "description": "Detects execution of different log query utilities and commands to search and dump the content of specific event logs or look for specific event IDs.\nThis technique is used by threat actors in order to extract sensitive information from events logs such as usernames, IP addresses, hostnames, etc.\n",
            "detection": {
                "condition": "1 of selection_logs_* and (selection_wmi or all of selection_wevtutil_* or all of selection_wmic_* or selection_cmdlet)",
                "selection_cmdlet": {
                    "CommandLine|contains": [
                        "Get-WinEvent ",
                        "get-eventlog "
                    ]
                },
                "selection_logs_eid": {
                    "CommandLine|contains": [
                        "-InstanceId 4624",
                        "System[EventID=4624]",
                        "EventCode=?4624?",
                        "EventIdentifier=?4624?",
                        "-InstanceId 4778",
                        "System[EventID=4778]",
                        "EventCode=?4778?",
                        "EventIdentifier=?4778?",
                        "-InstanceId 25",
                        "System[EventID=25]",
                        "EventCode=?25?",
                        "EventIdentifier=?25?"
                    ]
                },
                "selection_logs_name": {
                    "CommandLine|contains": [
                        "Microsoft-Windows-PowerShell",
                        "Microsoft-Windows-Security-Auditing",
                        "Microsoft-Windows-TerminalServices-LocalSessionManager",
                        "Microsoft-Windows-TerminalServices-RemoteConnectionManager",
                        "Microsoft-Windows-Windows Defender",
                        "PowerShellCore",
                        "Security",
                        "Windows PowerShell"
                    ]
                },
                "selection_wevtutil_cli": {
                    "CommandLine|contains": [
                        " qe ",
                        " query-events "
                    ]
                },
                "selection_wevtutil_img": [
                    {
                        "Image|endswith": "\\wevtutil.exe"
                    },
                    {
                        "OriginalFileName": "wevtutil.exe"
                    }
                ],
                "selection_wmi": {
                    "CommandLine|contains|all": [
                        "Select",
                        "Win32_NTLogEvent"
                    ]
                },
                "selection_wmic_cli": {
                    "CommandLine|contains": " ntevent"
                },
                "selection_wmic_img": [
                    {
                        "Image|endswith": "\\wmic.exe"
                    },
                    {
                        "OriginalFileName": "wmic.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate usage of the utility by administrators to query the event log"
            ],
            "id": "beaa66d6-aa1b-4e3c-80f5-e0145369bfaf",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/07/12",
            "references": [
                "http://blog.talosintelligence.com/2022/09/lazarus-three-rats.html",
                "https://thedfirreport.com/2023/10/30/netsupport-intrusion-results-in-domain-compromise/",
                "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-144a",
                "https://www.group-ib.com/blog/apt41-world-tour-2021/",
                "https://labs.withsecure.com/content/dam/labs/docs/f-secureLABS-tlp-white-lazarus-threat-intel-report2.pdf",
                "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.diagnostics/get-winevent?view=powershell-7.3",
                "https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-eventlog?view=powershell-5.1",
                "http://www.solomonson.com/posts/2010-07-09-reading-eventviewer-command-line/",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil"
            ],
            "related": [
                {
                    "id": "9cd55b6c-430a-4fa9-96f4-7cadf5229e9f",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.discovery",
                "attack.t1552"
            ],
            "title": "Potentially Suspicious EventLog Recon Activity Using Log Query Utilities"
        },
        {
            "author": "Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/10/05",
            "description": "Detects execution of \"findstr\" with specific flags and a remote share path. This specific set of CLI flags would allow \"findstr\" to download the content of the file located on the remote share as described in the LOLBAS entry.\n",
            "detection": {
                "condition": "selection_findstr and all of selection_cli_download_*",
                "selection_cli_download_1": {
                    "CommandLine|contains|windash": " -v "
                },
                "selection_cli_download_2": {
                    "CommandLine|contains|windash": " -l "
                },
                "selection_cli_download_3": {
                    "CommandLine|contains": "\\\\\\\\"
                },
                "selection_findstr": [
                    {
                        "CommandLine|contains": "findstr"
                    },
                    {
                        "Image|endswith": "findstr.exe"
                    },
                    {
                        "OriginalFileName": "FINDSTR.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "587254ee-a24b-4335-b3cd-065c0f1f4baa",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/05",
            "references": [
                "https://lolbas-project.github.io/lolbas/Binaries/Findstr/",
                "https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/",
                "https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f"
            ],
            "related": [
                {
                    "id": "bf6c39fc-e203-45b9-9538-05397c1b4f3f",
                    "type": "obsoletes"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218",
                "attack.t1564.004",
                "attack.t1552.001",
                "attack.t1105"
            ],
            "title": "Remote File Download Via Findstr.EXE"
        },
        {
            "author": "Furkan CALISKAN, @caliskanfurkan_, @oscd_initiative, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/10/05",
            "description": "Detects execution of findstr with the \"s\" and \"i\" flags for a \"subfolder\" and \"insensitive\" search respectively. Attackers sometimes leverage this built-in utility to search the system for interesting files or filter through results of commands.\n",
            "detection": {
                "condition": "selection_findstr and all of selection_cli_search_*",
                "selection_cli_search_insensitive": {
                    "CommandLine|contains|windash": " -i "
                },
                "selection_cli_search_subfolder": {
                    "CommandLine|contains|windash": " -s "
                },
                "selection_findstr": [
                    {
                        "CommandLine|contains": "findstr"
                    },
                    {
                        "Image|endswith": "findstr.exe"
                    },
                    {
                        "OriginalFileName": "FINDSTR.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Administrative or software activity"
            ],
            "id": "04936b66-3915-43ad-a8e5-809eadfd1141",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/05",
            "references": [
                "https://lolbas-project.github.io/lolbas/Binaries/Findstr/",
                "https://oddvar.moe/2018/04/11/putting-data-in-alternate-data-streams-and-how-to-execute-it-part-2/",
                "https://gist.github.com/api0cradle/cdd2d0d0ec9abb686f0e89306e277b8f"
            ],
            "related": [
                {
                    "id": "bf6c39fc-e203-45b9-9538-05397c1b4f3f",
                    "type": "obsoletes"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218",
                "attack.t1564.004",
                "attack.t1552.001",
                "attack.t1105"
            ],
            "title": "Insensitive Subfolder Search Via Findstr.EXE"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/08/12",
            "description": "Detects usage of findstr with the \"EVERYONE\" or \"BUILTIN\" keywords.\nThis was seen being used in combination with \"icacls\" and other utilities to spot misconfigured files or folders permissions.\n",
            "detection": {
                "condition": "all of selection_findstr_* or selection_special",
                "selection_findstr_cli": {
                    "CommandLine|contains": [
                        "\"Everyone\"",
                        "'Everyone'",
                        "\"BUILTIN\\\\\"",
                        "'BUILTIN\\'"
                    ]
                },
                "selection_findstr_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ],
                "selection_special": {
                    "CommandLine|contains|all": [
                        "icacls ",
                        "findstr ",
                        "Everyone"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "47e4bab7-c626-47dc-967b-255608c9a920",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/11",
            "references": [
                "https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/"
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Permission Misconfiguration Reconnaissance Via Findstr.EXE"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/18",
            "description": "Detects calls to cmdlets that are used to export certificates from the local certificate store. Threat actors were seen abusing this to steal private keys from compromised machines.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "Export-PfxCertificate ",
                        "Export-Certificate "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate certificate exports by administrators. Additional filters might be required."
            ],
            "id": "9e716b33-63b2-46da-86a4-bd3c3b9b5dfb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://us-cert.cisa.gov/ncas/analysis-reports/ar21-112a",
                "https://learn.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate?view=windowsserver2022-ps",
                "https://www.splunk.com/en_us/blog/security/breaking-the-chain-defending-against-certificate-services-abuse.html"
            ],
            "related": [
                {
                    "id": "aa7a3fce-bef5-4311-9cc1-5f04bb8c308c",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1552.004",
                "attack.t1059.001"
            ],
            "title": "Certificate Exported Via PowerShell"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g",
            "date": "2019/08/12",
            "description": "Detects handles requested to SAM registry hive",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4656,
                    "ObjectName|endswith": "\\SAM",
                    "ObjectType": "Key"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ComputerName",
                "SubjectDomainName",
                "SubjectUserName",
                "ProcessName",
                "ObjectName"
            ],
            "id": "f8748f2c-89dc-4d95-afb0-5a2dfdbad332",
            "level": "high",
            "modified": "2021/11/27",
            "logsource": {
                "service": "security",
                "product": "windows"
            },
            "status": "test",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/190725-SAMRegistryHiveHandleRequest/notebook.html"
            ],
            "tags": [
                "attack.discovery",
                "attack.t1012",
                "attack.credential_access",
                "attack.t1552.002"
            ],
            "title": "SAM Registry Hive Handle Request"
        },
        {
            "author": "frack113",
            "date": "2021/12/19",
            "description": "Adversaries may search local file systems and remote file shares for files containing insecurely stored credentials.\nThese can be files created by users to store their own credentials, shared credential stores for a group of individuals,\nconfiguration files containing passwords for a system or service, or source code/binary files containing embedded passwords.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "ls",
                        " -R",
                        "select-string ",
                        "-Pattern "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bd5971a7-626d-46ab-8176-ed643f694f68",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "definition": "Requirements: Script Block Logging must be enabled",
                "product": "windows"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.001/T1552.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001"
            ],
            "title": "Extracting Information with PowerShell"
        },
        {
            "id": "aa7a3fce-bef5-4311-9cc1-5f04bb8c308c",
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/04/23",
            "description": "Detects calls to cmdlets inside of PowerShell scripts that are used to export certificates from the local certificate store. Threat actors were seen abusing this to steal private keys from compromised machines.",
            "detection": {
                "condition": "selection and not 1 of filter_optional_*",
                "filter_optional_module_export": {
                    "ScriptBlockText|contains": "CmdletsToExport = @("
                },
                "selection": {
                    "ScriptBlockText|contains": [
                        "Export-PfxCertificate",
                        "Export-Certificate"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate certificate exports by administrators. Additional filters might be required."
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "definition": "Requirements: Script Block Logging must be enabled",
                "product": "windows"
            },
            "references": [
                "https://us-cert.cisa.gov/ncas/analysis-reports/ar21-112a",
                "https://learn.microsoft.com/en-us/powershell/module/pki/export-pfxcertificate?view=windowsserver2022-ps",
                "https://www.splunk.com/en_us/blog/security/breaking-the-chain-defending-against-certificate-services-abuse.html"
            ],
            "modified": "2023/05/18",
            "related": [
                {
                    "type": "similar",
                    "id": "9e716b33-63b2-46da-86a4-bd3c3b9b5dfb"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.004"
            ],
            "title": "Certificate Exported Via PowerShell - ScriptBlock"
        },
        {
            "id": "851fd622-b675-4d26-b803-14bc7baa517a",
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2023/12/04",
            "description": "Detects scriptblock text keywords indicative of potential usge of the tool WinPwn. A tool for Windows and Active Directory reconnaissance and exploitation.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "Offline_Winpwn",
                        "WinPwn ",
                        "WinPwn.exe",
                        "WinPwn.ps1"
                    ]
                }
            },
            "falsepositives": [
                "As the script block is a blob of text. False positive may occur with scripts that contain the keyword as a reference or simply use it for detection."
            ],
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "definition": "Requirements: Script Block Logging must be enabled",
                "product": "windows"
            },
            "references": [
                "https://github.com/S3cur3Th1sSh1t/WinPwn",
                "https://www.publicnow.com/view/EB87DB49C654D9B63995FAD4C9DE3D3CC4F6C3ED?1671634841",
                "https://reconshell.com/winpwn-tool-for-internal-windows-pentesting-and-ad-security/",
                "https://github.com/redcanaryco/atomic-red-team/blob/4d6c4e8e23d465af7a2388620cfe3f8c76e16cf0/atomics/T1082/T1082.md",
                "https://grep.app/search?q=winpwn&filter[repo][0]=redcanaryco/atomic-red-team"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "d557dc06-62e8-4468-a8e8-7984124908ce"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.discovery",
                "attack.execution",
                "attack.privilege_escalation",
                "attack.t1046",
                "attack.t1082",
                "attack.t1106",
                "attack.t1518",
                "attack.t1548.002",
                "attack.t1552.001",
                "attack.t1555",
                "attack.t1555.003"
            ],
            "title": "HackTool - WinPwn Execution - ScriptBlock"
        },
        {
            "author": "Joseliyo Sanchez, @Joseliyo_Jstnk",
            "date": "2023/01/31",
            "description": "Detects when the file \"passwd\" or \"shadow\" is copied from tmp path",
            "detection": {
                "condition": "all of selection_*",
                "selection_file": {
                    "CommandLine|contains": [
                        "passwd",
                        "shadow"
                    ]
                },
                "selection_img": {
                    "Image|endswith": "/cp"
                },
                "selection_path": {
                    "CommandLine|contains": "/tmp/"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fa4aaed5-4fe0-498d-bbc0-08e3346387ba",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://blogs.blackberry.com/",
                "https://twitter.com/Joseliyo_Jstnk/status/1620131033474822144"
            ],
            "status": "test",
            "title": "Copy Passwd Or Shadow From TMP Path",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/20",
            "description": "Detects events with patterns found in commands used for reconnaissance on linux systems",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        " -name .htpasswd",
                        " -perm -4000 "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "0cf7a157-8879-41a2-8f55-388dd23746b7",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://github.com/sleventyeleven/linuxprivchecker/blob/0d701080bbf92efd464e97d71a70f97c6f2cd658/linuxprivchecker.py"
            ],
            "status": "test",
            "tags": [
                "attack.reconnaissance",
                "attack.t1592.004",
                "attack.credential_access",
                "attack.t1552.001"
            ],
            "title": "Linux Recon Indicators"
        },
        {
            "author": "Mikhail Larin, oscd.community",
            "date": "2020/10/17",
            "description": "Detects commandline operations on shell history files",
            "detection": {
                "condition": "execve and history",
                "execve": {
                    "type": "EXECVE"
                },
                "history": [
                    ".bash_history",
                    ".zsh_history",
                    ".zhistory",
                    ".history",
                    ".sh_history",
                    "fish_history"
                ]
            },
            "falsepositives": [
                "Legitimate administrative activity",
                "Legitimate software, cleaning hist file"
            ],
            "fields": [
                "a0",
                "a1",
                "a2",
                "a3",
                "key"
            ],
            "id": "eae8ce9f-bde9-47a6-8e79-f20d18419910",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.003/T1552.003.md"
            ],
            "modified": "2022/11/28",
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.003"
            ],
            "title": "Suspicious History File Operations - Linux"
        },
        {
            "author": "Igor Fits, oscd.community",
            "date": "2020/10/15",
            "description": "Detecting attempts to extract passwords with grep",
            "detection": {
                "condition": "selection and keywords",
                "keywords": {
                    "|all": [
                        "grep",
                        "password"
                    ]
                },
                "selection": {
                    "type": "EXECVE"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "df3fcaea-2715-4214-99c5-0056ea59eb35",
            "level": "high",
            "modified": "2023/04/30",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.001/T1552.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.001"
            ],
            "title": "Credentials In Files - Linux"
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "Azure AD",
        "Office 365",
        "SaaS",
        "IaaS",
        "Linux",
        "macOS",
        "Google Workspace",
        "Containers",
        "Network"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Austin Clark, @c2defense"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "credential-access"
        }
    ],
    "x_mitre_detection": "While detecting adversaries accessing credentials may be difficult without knowing they exist in the environment, it may be possible to detect adversary use of credentials they have obtained. Monitor the command-line arguments of executing processes for suspicious words or regular expressions that may indicate searching for a password (for example: password, pwd, login, secure, or credentials). See [Valid Accounts](https://attack.mitre.org/techniques/T1078) for more information.\n\nMonitor for suspicious file access activity, specifically indications that a process is reading multiple files in a short amount of time and/or using command-line arguments  indicative of searching for credential material (ex: regex patterns). These may be indicators of automated/scripted credential access behavior.\n\nMonitoring when the user's <code>.bash_history</code> is read can help alert to suspicious activity. While users do typically rely on their history of commands, they often access this history through other utilities like \"history\" instead of commands like <code>cat ~/.bash_history</code>.\n\nAdditionally, monitor processes for applications that can be used to query the Registry, such as [Reg](https://attack.mitre.org/software/S0075), and collect command parameters that may indicate credentials are being searched. Correlate activity with related suspicious behavior that may indicate an active intrusion to reduce false positives.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.3",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Windows Registry: Windows Registry Key Access",
        "Application Log: Application Log Content",
        "Command: Command Execution",
        "Process: Process Creation",
        "File: File Access",
        "User Account: User Account Authentication"
    ],
    "x_mitre_permissions_required": []
}