{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--1462ccb4-c896-49e9-90f9-2d07426d2111",
    "created": "2024-08-13T14:46:36.896898Z",
    "modified": "2024-08-13T14:46:48.367414Z",
    "name": "Hide Artifacts: Hidden Window",
    "description": "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users. In some cases, windows that would typically be displayed when an application carries out an operation can be hidden. This may be utilized by system administrators to avoid disrupting user work environments when carrying out administrative tasks. Adversaries may abuse these functionalities to hide otherwise visible windows from users so as not to alert the user to adversary activity on the system.[1]On macOS, the configurations for how applications run are listed in property list (plist) files. One of the tags in these files can be apple.awt.UIElement, which allows for Java applications to prevent the application's icon from appearing in the Dock. A common use for this is when applications run in the system tray, but don't also want to show up in the Dock.Similarly, on Windows there are a variety of features in scripting languages, such as PowerShell, Jscript, and Visual Basic to make windows hidden. One example of this is powershell.exe -WindowStyle Hidden.[2]In addition, Windows supports the CreateDesktop() API that can create a hidden desktop window with its own corresponding explorer.exe process.[3][4]  All applications running on the hidden desktop window, such as a hidden VNC (hVNC) session,[3] will be invisible to other desktops windows.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1564/003",
            "external_id": "T1564/003"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "number": "0x0 = SW_HIDE"
                            },
                            {
                                "api": "user32.ShowWindow"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Hide Artifacts::Hidden Window [T1564.003]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "examples": [
                        "39C05B15E9834AC93F206BC114D0A00C357C888DB567BA8F5345DA0529CBED41:0x10007250"
                    ],
                    "name": "hide graphical window",
                    "namespace": "host-interaction/gui/window/hide",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "api": "GetWindowLongPtr"
                            },
                            {
                                "api": "SetWindowLongPtr"
                            },
                            {
                                "number": "0x0FFFFFFEC = GWL_EXSTYLE (-20)"
                            },
                            {
                                "or": [
                                    {
                                        "instruction": [
                                            {
                                                "mnemonic": "or"
                                            },
                                            {
                                                "operand[1].number": "0x80 = WS_EX_TOOLWINDOW"
                                            }
                                        ]
                                    },
                                    {
                                        "instruction": [
                                            {
                                                "mnemonic": "bts"
                                            },
                                            {
                                                "operand[1].number": 7
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Hide Artifacts::Hidden Window [T1564.003]"
                    ],
                    "authors": [
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "79252f58d486aee8c08a8a7ebd36ae11ab5798b289e7f88e71eacf8637c340cc:0x180004B22"
                    ],
                    "name": "hide graphical window from taskbar",
                    "namespace": "host-interaction/gui/window/hide",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    },
                    "references": [
                        "https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-getwindowlongptrw",
                        "https://learn.microsoft.com/en-us/windows/win32/winmsg/extended-window-styles",
                        "https://dreamlayers.blogspot.com/2010/12/hiding-window-from-taskbar-using.html"
                    ]
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/01/20",
            "description": "Detects the execution of AdvancedRun utility",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "OriginalFileName": "AdvancedRun.exe"
                    },
                    {
                        "CommandLine|contains|all": [
                            " /EXEFilename ",
                            " /Run"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            " /WindowState 0",
                            " /RunAs ",
                            " /CommandLine "
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d2b749ee-4225-417e-b20e-a8d2193cbb84",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://twitter.com/splinter_code/status/1483815103279603714",
                "https://medium.com/s2wblog/analysis-of-destructive-malware-whispergate-targeting-ukraine-9d5d158f19f3",
                "https://elastic.github.io/security-research/malware/2022/01/01.operation-bleeding-bear/article/",
                "https://www.winhelponline.com/blog/run-program-as-system-localsystem-account-windows/"
            ],
            "related": [
                {
                    "id": "fa00b701-44c6-4679-994d-5a18afa8a707",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.defense_evasion",
                "attack.privilege_escalation",
                "attack.t1564.003",
                "attack.t1134.002",
                "attack.t1059.003"
            ],
            "title": "PUA - AdvancedRun Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community",
            "date": "2020/06/04",
            "description": "Detects suspicious command lines used in Covenant luanchers",
            "detection": {
                "condition": "1 of selection_*",
                "selection_1": {
                    "CommandLine|contains": [
                        "-Command",
                        "-EncodedCommand"
                    ],
                    "CommandLine|contains|all": [
                        "-Sta",
                        "-Nop",
                        "-Window",
                        "Hidden"
                    ]
                },
                "selection_2": {
                    "CommandLine|contains": [
                        "sv o (New-Object IO.MemorySteam);sv d ",
                        "mshta file.hta",
                        "GruntHTTP",
                        "-EncodedCommand cwB2ACAAbwAgA"
                    ]
                }
            },
            "id": "c260b6db-48ba-4b4a-a76f-2f67644e99d2",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://posts.specterops.io/covenant-v0-5-eee0507b85ba"
            ],
            "modified": "2023/02/21",
            "tags": [
                "attack.execution",
                "attack.defense_evasion",
                "attack.t1059.001",
                "attack.t1564.003"
            ],
            "title": "HackTool - Covenant PowerShell Launcher",
            "status": "test"
        },
        {
            "author": "frack113, Tim Shelton (fp AWS)",
            "date": "2021/10/20",
            "description": "Adversaries may use hidden windows to conceal malicious activity from the plain sight of users.\nIn some cases, windows that would typically be displayed when an application carries out an operation can be hidden\n",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "ScriptBlockText|contains|all": [
                        ":\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\",
                        "$PSScriptRoot\\Module\\WorkspaceScriptModule\\WorkspaceScriptModule"
                    ]
                },
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "powershell",
                        "WindowStyle",
                        "Hidden"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "313fbb0a-a341-4682-848d-6d6f8c4fab7c",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2023/01/03",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.003/T1564.003.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1564.003"
            ],
            "title": "Suspicious PowerShell WindowStyle Option"
        }
    ]
}