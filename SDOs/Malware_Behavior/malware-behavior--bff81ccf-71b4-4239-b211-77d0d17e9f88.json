{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--bff81ccf-71b4-4239-b211-77d0d17e9f88",
    "created": "2024-08-13T14:46:37.006669Z",
    "modified": "2024-08-13T14:46:48.511659Z",
    "name": "Indicator Removal: Clear Windows Event Logs",
    "description": "Adversaries may clear Windows Event Logs to hide the activity of an intrusion. Windows Event Logs are a record of a computer's alerts and notifications. There are three system-defined sources of events: System, Application, and Security, with five event types: Error, Warning, Information, Success Audit, and Failure Audit.With administrator privileges, the event logs can be cleared with the following utility commands:wevtutil cl systemwevtutil cl applicationwevtutil cl securityThese logs may also be cleared through other mechanisms, such as the event viewer GUI or PowerShell. For example, adversaries may use the PowerShell command Remove-EventLog -LogName Security to delete the Security EventLog and after reboot, disable future logging.  Note: events may still be generated and logged in the .evtx file between the time the command is run and the reboot.[1]Adversaries may also attempt to clear logs by directly deleting the stored log files within C:\\Windows\\System32\\winevt\\logs\\.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1070/001",
            "external_id": "T1070/001"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "os": "windows"
                            },
                            {
                                "or": [
                                    {
                                        "and": [
                                            {
                                                "or": [
                                                    {
                                                        "api": "advapi32.ElfClearEventLogFile"
                                                    },
                                                    {
                                                        "api": "advapi32.ClearEventLog"
                                                    }
                                                ]
                                            },
                                            {
                                                "optional": [
                                                    {
                                                        "api": "advapi32.OpenEventLog"
                                                    },
                                                    {
                                                        "api": "advapi32.GetNumberOfEventLogRecords"
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "basic block": [
                                            {
                                                "and": [
                                                    {
                                                        "string": "/wevtutil(\\.exe)?\\s+(clear-log|cl)/i"
                                                    }
                                                ]
                                            }
                                        ]
                                    },
                                    {
                                        "call": [
                                            {
                                                "and": [
                                                    {
                                                        "string": "/wevtutil(\\.exe)?\\s+(clear-log|cl)/i"
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Indicator Removal::Clear Windows Event Logs [T1070.001]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "examples": [
                        "82BF6347ACF15E5D883715DC289D8A2B:0x14005E0C0",
                        "mimikatz.exe_:0x45228B"
                    ],
                    "name": "clear Windows event logs",
                    "namespace": "anti-analysis/anti-forensic/clear-logs",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Ecco, Daniil Yugoslavskiy, oscd.community, D3F7A5105",
            "date": "2019/09/26",
            "description": "Detects the clearing or configuration tampering of EventLog using utilities such as \"wevtutil\", \"powershell\" and \"wmic\".\nThis technique were seen used by threat actors and ransomware strains in order to evade defenses.\n",
            "detection": {
                "condition": "1 of selection_* and not 1 of filter_*",
                "filter_msiexec": {
                    "CommandLine|contains": " sl ",
                    "ParentImage": [
                        "C:\\Windows\\SysWOW64\\msiexec.exe",
                        "C:\\Windows\\System32\\msiexec.exe"
                    ]
                },
                "selection_other_ps": {
                    "CommandLine|contains": [
                        "Clear-EventLog ",
                        "Remove-EventLog ",
                        "Limit-EventLog ",
                        "Clear-WinEvent "
                    ],
                    "Image|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe"
                    ]
                },
                "selection_other_wmi": {
                    "CommandLine|contains": "ClearEventLog",
                    "Image|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\wmic.exe"
                    ]
                },
                "selection_wevtutil": {
                    "CommandLine|contains": [
                        "clear-log ",
                        " cl ",
                        "set-log ",
                        " sl ",
                        "lfn:"
                    ],
                    "Image|endswith": "\\wevtutil.exe"
                }
            },
            "falsepositives": [
                "Admin activity",
                "Scripts and administrative tools used in the monitored environment",
                "Maintenance activity"
            ],
            "id": "cc36992a-4671-4f21-a91d-6c2b72a2edf5",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/07/13",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.001/T1070.001.md",
                "https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil",
                "https://gist.github.com/fovtran/ac0624983c7722e80a8f5a4babb170ee",
                "https://jdhnet.wordpress.com/2017/12/19/changing-the-location-of-the-windows-event-logs/"
            ],
            "status": "stable",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.001",
                "attack.t1562.002",
                "car.2016-04-002"
            ],
            "title": "Suspicious Eventlog Clearing or Configuration Change Activity"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/02/11",
            "description": "Detects the execution of \"logman\" utility in order to disable or delete Windows trace sessions",
            "detection": {
                "condition": "all of selection*",
                "selection_action": {
                    "CommandLine|contains": [
                        "stop ",
                        "delete "
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\logman.exe"
                    },
                    {
                        "OriginalFileName": "Logman.exe"
                    }
                ],
                "selection_service": {
                    "CommandLine|contains": [
                        "Circular Kernel Context Logger",
                        "EventLog-",
                        "SYSMON TRACE",
                        "SysmonDnsEtwSession"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate deactivation by administrative staff",
                "Installer tools that disable services, e.g. before log collection agent installation"
            ],
            "id": "cd1f961e-0b96-436b-b7c6-38da4583ec00",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://twitter.com/0gtweet/status/1359039665232306183?s=21",
                "https://ss64.com/nt/logman.html"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.001",
                "attack.t1070.001"
            ],
            "title": "Suspicious Windows Trace ETW Session Tamper Via Logman.EXE"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/01/10",
            "description": "One of the Windows Eventlogs has been cleared. e.g. caused by \"wevtutil cl\" command execution",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_covered": {
                    "Channel": [
                        "Microsoft-Windows-PowerShell/Operational",
                        "Microsoft-Windows-Sysmon/Operational",
                        "PowerShellCore/Operational",
                        "Security",
                        "System",
                        "Windows PowerShell"
                    ]
                },
                "selection": {
                    "EventID": 104,
                    "Provider_Name": "Microsoft-Windows-Eventlog"
                }
            },
            "falsepositives": [
                "Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog)",
                "System provisioning (system reset before the golden image creation)"
            ],
            "id": "a62b37e0-45d3-48d9-a517-90c1a1b0186b",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2023/11/15",
            "references": [
                "https://twitter.com/deviouspolack/status/832535435960209408",
                "https://www.hybrid-analysis.com/sample/027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745?environmentId=100"
            ],
            "related": [
                {
                    "id": "f2f01843-e7b8-4f95-a35a-d23584476423",
                    "type": "obsoletes"
                },
                {
                    "id": "d99b79d2-0a6f-4f46-ad8b-260b6e17f982",
                    "type": "derived"
                },
                {
                    "id": "100ef69e-3327-481c-8e5c-6d80d9507556",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.001",
                "car.2016-04-002"
            ],
            "title": "Eventlog Cleared"
        },
        {
            "id": "100ef69e-3327-481c-8e5c-6d80d9507556",
            "author": "Florian Roth (Nextron Systems), Tim Shelton, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/05/17",
            "description": "Detects the clearing of one of the Windows Core Eventlogs. e.g. caused by \"wevtutil cl\" command execution",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 104,
                    "Channel": [
                        "Microsoft-Windows-PowerShell/Operational",
                        "Microsoft-Windows-Sysmon/Operational",
                        "PowerShellCore/Operational",
                        "Security",
                        "System",
                        "Windows PowerShell"
                    ],
                    "Provider_Name": "Microsoft-Windows-Eventlog"
                }
            },
            "falsepositives": [
                "Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog)",
                "System provisioning (system reset before the golden image creation)"
            ],
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2023/11/15",
            "references": [
                "https://twitter.com/deviouspolack/status/832535435960209408",
                "https://www.hybrid-analysis.com/sample/027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745?environmentId=100"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "a62b37e0-45d3-48d9-a517-90c1a1b0186b"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.001",
                "car.2016-04-002"
            ],
            "title": "Important Windows Eventlog Cleared"
        },
        {
            "id": "d99b79d2-0a6f-4f46-ad8b-260b6e17f982",
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/01/10",
            "description": "One of the Windows Eventlogs has been cleared. e.g. caused by \"wevtutil cl\" command execution",
            "detection": {
                "condition": "1 of selection_*",
                "selection_1102": {
                    "EventID": 1102,
                    "Provider_Name": "Microsoft-Windows-Eventlog"
                },
                "selection_517": {
                    "EventID": 517,
                    "Provider_Name": "Security"
                }
            },
            "falsepositives": [
                "Rollout of log collection agents (the setup routine often includes a reset of the local Eventlog)",
                "System provisioning (system reset before the golden image creation)"
            ],
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/02/24",
            "references": [
                "https://twitter.com/deviouspolack/status/832535435960209408",
                "https://www.hybrid-analysis.com/sample/027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745?environmentId=100",
                "https://github.com/Azure/Azure-Sentinel/blob/f99542b94afe0ad2f19a82cc08262e7ac8e1428e/Detections/SecurityEvent/SecurityEventLogCleared.yaml"
            ],
            "related": [
                {
                    "id": "f2f01843-e7b8-4f95-a35a-d23584476423",
                    "type": "obsoletes"
                },
                {
                    "id": "a122ac13-daf8-4175-83a2-72c387be339d",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.001",
                "car.2016-04-002"
            ],
            "title": "Security Eventlog Cleared"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/09/12",
            "description": "Detects usage of known powershell cmdlets such as \"Clear-EventLog\" to clear the Windows event logs",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "Clear-EventLog ",
                        "Remove-EventLog ",
                        "Limit-EventLog ",
                        "Clear-WinEvent "
                    ]
                }
            },
            "falsepositives": [
                "Rare need to clear logs before doing something. Sometimes used by installers or cleaner scripts. The script should be investigated to determine if it's legitimate"
            ],
            "id": "0f017df3-8f5a-414f-ad6b-24aff1128278",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://twitter.com/oroneequalsone/status/1568432028361830402",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.001/T1070.001.md",
                "https://eqllib.readthedocs.io/en/latest/analytics/5b223758-07d6-4100-9e11-238cfdd0fe97.html"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "cc36992a-4671-4f21-a91d-6c2b72a2edf5"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.001"
            ],
            "title": "Suspicious Eventlog Clear"
        }
    ]
}