{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--01132d65-f005-47bc-b217-a3b4b95269ee",
    "created": "2024-08-13T14:46:37.137099Z",
    "modified": "2024-08-13T14:46:46.237279Z",
    "name": "Event Triggered Execution: AppCert DLLs",
    "description": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppCert DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs Registry key under HKEY_LOCAL_MACHINE\\System\\CurrentControlSet\\Control\\Session Manager\\ are loaded into every process that calls the ubiquitously used application programming interface (API) functions CreateProcess, CreateProcessAsUser, CreateProcessWithLoginW, CreateProcessWithTokenW, or WinExec. [1]Similar to Process Injection, this value can be abused to obtain elevated privileges by causing a malicious DLL to be loaded and run in the context of separate processes on the computer. Malicious AppCert DLLs may also provide persistence by continuously being triggered by API activity.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1546/009",
            "external_id": "T1546/009"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Ilyas Ochkov, oscd.community",
            "date": "2019/10/25",
            "description": "Dynamic-link libraries (DLLs) that are specified in the AppCertDLLs value in the Registry key can be abused to obtain persistence and privilege escalation\nby causing a malicious DLL to be loaded and run in the context of separate processes on the computer.\n",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "TargetObject": "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls"
                    },
                    {
                        "NewName": "HKLM\\SYSTEM\\CurentControlSet\\Control\\Session Manager\\AppCertDlls"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "EventID",
                "Image",
                "TargetObject",
                "NewName"
            ],
            "id": "6aa1d992-5925-4e9f-a49b-845e51d1de01",
            "level": "medium",
            "logsource": {
                "category": "registry_event",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "references": [
                "http://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/",
                "https://eqllib.readthedocs.io/en/latest/analytics/14f90406-10a0-4d36-a672-31cabe149f2f.html"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1546.009"
            ],
            "title": "New DLL Added to AppCertDlls Registry Key"
        },
        {
            "author": "Victor Sergeev, Daniil Yugoslavskiy, Gleb Sukhodolskiy, Timur Zinniatullin, oscd.community, Tim Shelton, frack113 (split)",
            "date": "2019/10/25",
            "description": "Detects modification of autostart extensibility point (ASEP) in registry.",
            "detection": {
                "condition": "session_manager_base and session_manager and not filter",
                "filter": {
                    "Details": "(Empty)"
                },
                "session_manager": {
                    "TargetObject|contains": [
                        "\\SetupExecute",
                        "\\S0InitialCommand",
                        "\\KnownDlls",
                        "\\Execute",
                        "\\BootExecute",
                        "\\AppCertDlls"
                    ]
                },
                "session_manager_base": {
                    "TargetObject|contains": "\\System\\CurrentControlSet\\Control\\Session Manager"
                }
            },
            "falsepositives": [
                "Legitimate software automatically (mostly, during installation) sets up autorun keys for legitimate reason",
                "Legitimate administrator sets up autorun keys for legitimate reason"
            ],
            "fields": [
                "SecurityID",
                "ObjectName",
                "OldValueType",
                "NewValueType"
            ],
            "id": "046218bd-e0d8-4113-a3c3-895a12b2b298",
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.001/T1547.001.md",
                "https://learn.microsoft.com/en-us/sysinternals/downloads/autoruns",
                "https://gist.github.com/GlebSukhodolskiy/0fc5fa5f482903064b448890db1eaf9d"
            ],
            "related": [
                {
                    "id": "17f878b8-9968-4578-b814-c4217fc5768c",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1547.001",
                "attack.t1546.009"
            ],
            "title": "Session Manager Autorun Keys Modification"
        }
    ]
}