{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--da6b84aa-e309-4288-916b-9d4e0c66f843",
    "created": "2024-08-13T14:46:36.969989Z",
    "modified": "2024-08-13T14:46:48.443278Z",
    "name": "Scheduled Task/Job: At",
    "description": "Adversaries may abuse the at utility to perform task scheduling for initial or recurring execution of malicious code. The at utility exists as an executable within Windows, Linux, and macOS for scheduling tasks at a specified time and date. Although deprecated in favor of Scheduled Task's schtasks in Windows environments, using at requires that the Task Scheduler service be running, and the user to be logged on as a member of the local Administrators group.On Linux and macOS, at may be invoked by the superuser as well as any users added to the at.allow file. If the at.allow file does not exist, the at.deny file is checked. Every username not listed in at.deny is allowed to invoke at. If the at.deny exists and is empty, global use of at is permitted. If neither file exists (which is often the baseline) only the superuser is allowed to use at.[1]Adversaries may use at to execute programs at system startup or on a scheduled basis for Persistence. at can also be abused to conduct remote Execution as part of Lateral Movement and/or to run a process under the context of a specified account (such as SYSTEM).In Linux environments, adversaries may also abuse at to break out of restricted environments by using a task to spawn an interactive system shell or to run system commands. Similarly, at may also be used for Privilege Escalation if the binary is allowed to run as superuser via sudo.[2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1053/002",
            "external_id": "T1053/002"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "match": "host-interaction/process/create"
                            },
                            {
                                "string": "/at(|\\.exe)/i"
                            },
                            {
                                "or": [
                                    {
                                        "string": "//every:/i"
                                    },
                                    {
                                        "string": "//next:/i"
                                    },
                                    {
                                        "string": "/\\d:\\d/i"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Scheduled Task/Job::At [T1053.002]"
                    ],
                    "authors": [
                        "joren485"
                    ],
                    "examples": [
                        "0ce3bfa972ced61884ae7c1d77c7d4c45e17c7d767e669610cf2ef72b636b464:0x4051AF"
                    ],
                    "name": "schedule task via at",
                    "namespace": "persistence/scheduled-tasks",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sagie Dulce, Dekel Paz",
            "date": "2022/01/01",
            "description": "Detects remote RPC calls to create or execute a scheduled task",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "EventLog": "RPCFW",
                    "InterfaceUuid": "86d35949-83c9-4044-b424-db363231fd0c",
                    "OpNum": [
                        1,
                        3,
                        4,
                        10,
                        11,
                        12,
                        13,
                        14,
                        15
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ace3ff54-e7fd-46bd-8ea0-74b49a0aca1d",
            "level": "high",
            "logsource": {
                "category": "application",
                "definition": "Requirements: install and apply the RPC Firewall to all processes with \"audit:true action:block uuid:86d35949-83c9-4044-b424-db363231fd0c\"",
                "product": "rpc_firewall"
            },
            "modified": "2022/01/01",
            "references": [
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931",
                "https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/ddd4608fe8684fcf2fcf9b48c5f0b3c28097f8a3/documents/MS-TSCH.md",
                "https://github.com/zeronetworks/rpcfirewall",
                "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1053",
                "attack.t1053.002"
            ],
            "title": "Remote Schedule Task Lateral Movement via ITaskSchedulerService"
        },
        {
            "author": "Sagie Dulce, Dekel Paz",
            "date": "2022/01/01",
            "description": "Detects remote RPC calls to create or execute a scheduled task via ATSvc",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "EventLog": "RPCFW",
                    "InterfaceUuid": "1ff70682-0a51-30e8-076d-740be8cee98b",
                    "OpNum": [
                        0,
                        1
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "0fcd1c79-4eeb-4746-aba9-1b458f7a79cb",
            "level": "high",
            "logsource": {
                "category": "application",
                "definition": "Requirements: install and apply the RPC Firewall to all processes with \"audit:true action:block uuid:1ff70682-0a51-30e8-076d-740be8cee98b\"",
                "product": "rpc_firewall"
            },
            "modified": "2022/01/01",
            "references": [
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931",
                "https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/ddd4608fe8684fcf2fcf9b48c5f0b3c28097f8a3/documents/MS-TSCH.md",
                "https://github.com/zeronetworks/rpcfirewall",
                "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1053",
                "attack.t1053.002"
            ],
            "title": "Remote Schedule Task Lateral Movement via ATSvc"
        },
        {
            "author": "Sagie Dulce, Dekel Paz",
            "date": "2022/01/01",
            "description": "Detects remote RPC calls to create or execute a scheduled task via SASec",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "EventLog": "RPCFW",
                    "InterfaceUuid": "378e52b0-c0a9-11cf-822d-00aa0051e40f",
                    "OpNum": [
                        0,
                        1
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "aff229ab-f8cd-447b-b215-084d11e79eb0",
            "level": "high",
            "logsource": {
                "category": "application",
                "definition": "Requirements: install and apply the RPC Firewall to all processes with \"audit:true action:block uuid:378e52b0-c0a9-11cf-822d-00aa0051e40f\"",
                "product": "rpc_firewall"
            },
            "modified": "2022/01/01",
            "references": [
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-tsch/d1058a28-7e02-4948-8b8d-4a347fa64931",
                "https://github.com/jsecurity101/MSRPC-to-ATTACK/blob/ddd4608fe8684fcf2fcf9b48c5f0b3c28097f8a3/documents/MS-TSCH.md",
                "https://github.com/zeronetworks/rpcfirewall",
                "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1053",
                "attack.t1053.002"
            ],
            "title": "Remote Schedule Task Lateral Movement via SASec"
        },
        {
            "author": "@neu5ron, SOC Prime",
            "date": "2020/03/19",
            "description": "Windows DCE-RPC functions which indicate an execution techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE",
            "detection": {
                "condition": "1 of op*",
                "op1": {
                    "endpoint": "JobAdd",
                    "operation": "atsvc"
                },
                "op10": {
                    "endpoint": "svcctl",
                    "operation": "StartServiceW"
                },
                "op2": {
                    "endpoint": "ITaskSchedulerService",
                    "operation": "SchRpcEnableTask"
                },
                "op3": {
                    "endpoint": "ITaskSchedulerService",
                    "operation": "SchRpcRegisterTask"
                },
                "op4": {
                    "endpoint": "ITaskSchedulerService",
                    "operation": "SchRpcRun"
                },
                "op5": {
                    "endpoint": "IWbemServices",
                    "operation": "ExecMethod"
                },
                "op6": {
                    "endpoint": "IWbemServices",
                    "operation": "ExecMethodAsync"
                },
                "op7": {
                    "endpoint": "svcctl",
                    "operation": "CreateServiceA"
                },
                "op8": {
                    "endpoint": "svcctl",
                    "operation": "CreateServiceW"
                },
                "op9": {
                    "endpoint": "svcctl",
                    "operation": "StartServiceA"
                }
            },
            "falsepositives": [
                "Windows administrator tasks or troubleshooting",
                "Windows management scripts or software"
            ],
            "id": "b640c0b8-87f8-4daa-aef8-95a24261dd1d",
            "level": "medium",
            "logsource": {
                "product": "zeek",
                "service": "dce_rpc"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/mitre-attack/bzar#indicators-for-attck-execution"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1047",
                "attack.t1053.002",
                "attack.t1569.002"
            ],
            "title": "MITRE BZAR Indicators for Execution"
        },
        {
            "author": "Samir Bousseaden, @neu5rn",
            "date": "2020/04/03",
            "description": "Detects remote task creation via at.exe or API interacting with ATSVC namedpipe",
            "detection": {
                "condition": "selection",
                "selection": {
                    "name": "atsvc",
                    "path": "\\\\\\*\\IPC$"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "dde85b37-40cd-4a94-b00c-0b8794f956b5",
            "level": "medium",
            "logsource": {
                "product": "zeek",
                "service": "smb_files"
            },
            "modified": "2022/12/27",
            "references": [
                "https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html"
            ],
            "related": [
                {
                    "id": "f6de6525-4509-495a-8a82-1f8b0ed73a00",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.persistence",
                "car.2013-05-004",
                "car.2015-04-001",
                "attack.t1053.002"
            ],
            "title": "Remote Task Creation via ATSVC Named Pipe - Zeek"
        },
        {
            "author": "E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community",
            "date": "2019/10/24",
            "description": "Detects an interactive AT job, which may be used as a form of privilege escalation.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "interactive",
                    "Image|endswith": "\\at.exe"
                }
            },
            "falsepositives": [
                "Unlikely (at.exe deprecated as of Windows 8)"
            ],
            "id": "60fc936d-2eb0-4543-8a13-911c750a1dfc",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1053.002/T1053.002.md",
                "https://eqllib.readthedocs.io/en/latest/analytics/d8db43cf-ed52-4f5c-9fb3-c9a4b95a0b56.html"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.t1053.002"
            ],
            "title": "Interactive AT Job"
        },
        {
            "id": "f6de6525-4509-495a-8a82-1f8b0ed73a00",
            "author": "Samir Bousseaden",
            "date": "2019/04/03",
            "description": "Detects remote task creation via at.exe or API interacting with ATSVC namedpipe",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Accesses|contains": "WriteData",
                    "EventID": 5145,
                    "RelativeTargetName": "atsvc",
                    "ShareName": "\\\\\\\\\\*\\\\IPC$"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "definition": "The advanced audit policy setting \"Object Access > Audit Detailed File Share\" must be configured for Success/Failure",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/08/11",
            "references": [
                "https://blog.menasec.net/2019/03/threat-hunting-25-scheduled-tasks-for.html"
            ],
            "status": "test",
            "title": "Remote Task Creation via ATSVC Named Pipe",
            "tags": [
                "attack.lateral_movement",
                "attack.persistence",
                "car.2013-05-004",
                "car.2015-04-001",
                "attack.t1053.002"
            ]
        },
        {
            "author": "\u00d6mer G\u00fcnal, oscd.community",
            "date": "2020/10/06",
            "description": "Detects the use of at/atd which are utilities that are used to schedule tasks.\nThey are often abused by adversaries to maintain persistence or to perform task scheduling for initial or recurring execution of malicious code\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "/at",
                        "/atd"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "d2d642d7-b393-43fe-bae4-e81ed5915c4b",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/07/07",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1053.002/T1053.002.md"
            ],
            "status": "stable",
            "tags": [
                "attack.persistence",
                "attack.t1053.002"
            ],
            "title": "Scheduled Task/Job At"
        }
    ]
}