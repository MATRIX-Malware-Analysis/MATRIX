{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--caa0bb8d-7c32-4559-9ea0-557c9d8ccf2c",
    "created": "2024-08-13T14:46:36.909753Z",
    "modified": "2024-08-13T14:46:44.927733Z",
    "name": "Application Layer Protocol: DNS",
    "description": "Adversaries may communicate using the Domain Name System (DNS) application layer protocol to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. The DNS protocol serves an administrative function in computer networking and thus may be very common in environments. DNS traffic may also be allowed even before network authentication is completed. DNS packets contain many fields and headers in which data can be concealed. Often known as DNS tunneling, adversaries may abuse DNS to communicate with systems under their control within a victim network while also mimicking normal, expected traffic.[1][2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1071/004",
            "external_id": "T1071/004"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/05/10",
            "description": "Detects suspicious DNS queries using base64 encoding",
            "detection": {
                "condition": "selection",
                "selection": {
                    "query|contains": "==."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4153a907-2451-4e4f-a578-c52bb6881432",
            "level": "medium",
            "logsource": {
                "category": "dns"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/krmaxwell/dns-exfiltration"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003",
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious DNS Query with B64 Encoded String"
        },
        {
            "author": "Markus Neis",
            "date": "2018/08/08",
            "description": "Detects strings used in command execution in DNS TXT Answer",
            "detection": {
                "condition": "selection",
                "selection": {
                    "answer|contains": [
                        "IEX",
                        "Invoke-Expression",
                        "cmd.exe"
                    ],
                    "record_type": "TXT"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8ae51330-899c-4641-8125-e39f2e07da72",
            "level": "high",
            "logsource": {
                "category": "dns"
            },
            "modified": "2021/11/27",
            "references": [
                "https://twitter.com/stvemillertime/status/1024707932447854592",
                "https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Backdoors/DNS_TXT_Pwnage.ps1"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "DNS TXT Answer with Possible Execution Strings"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/05/10",
            "description": "Detects suspicious DNS queries known from Cobalt Strike beacons",
            "detection": {
                "condition": "1 of selection*",
                "selection1": {
                    "query|startswith": [
                        "aaa.stage.",
                        "post.1"
                    ]
                },
                "selection2": {
                    "query|contains": ".stage.123456."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "2975af79-28c4-4d2f-a951-9095f229df29",
            "level": "critical",
            "logsource": {
                "category": "dns"
            },
            "modified": "2022/10/09",
            "references": [
                "https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns",
                "https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Cobalt Strike DNS Beaconing"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/11/09",
            "description": "Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons",
            "detection": {
                "condition": "1 of selection*",
                "selection1": {
                    "QueryName|startswith": [
                        "aaa.stage.",
                        "post.1"
                    ]
                },
                "selection2": {
                    "QueryName|contains": ".stage.123456."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "Image",
                "CommandLine"
            ],
            "id": "f356a9c4-effd-4608-bbf8-408afd5cd006",
            "level": "critical",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "references": [
                "https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns",
                "https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/"
            ],
            "modified": "2023/01/16",
            "status": "test",
            "related": [
                {
                    "id": "0d18728b-f5bf-4381-9dcf-915539fff6c2",
                    "type": "similar"
                }
            ],
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious Cobalt Strike DNS Beaconing - Sysmon"
        },
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2019/10/24",
            "description": "Well-known DNS Exfiltration tools execution",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\iodine.exe"
                    },
                    {
                        "Image|contains": "\\dnscat2"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "98a96a5a-64a0-4c42-92c5-489da3866cb0",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/iagox86/dnscat2",
                "https://github.com/yarrick/iodine"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.001",
                "attack.command_and_control",
                "attack.t1071.004",
                "attack.t1132.001"
            ],
            "title": "DNS Exfiltration and Tunneling Tools Execution"
        },
        {
            "id": "0d18728b-f5bf-4381-9dcf-915539fff6c2",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/16",
            "description": "Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons",
            "detection": {
                "condition": "selection_eid and 1 of selection_query_*",
                "selection_eid": {
                    "EventID": 3008
                },
                "selection_query_1": {
                    "QueryName|startswith": [
                        "aaa.stage.",
                        "post.1"
                    ]
                },
                "selection_query_2": {
                    "QueryName|contains": ".stage.123456."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "critical",
            "logsource": {
                "definition": "Requirements: Microsoft-Windows-DNS Client Events/Operational Event Log must be enabled/collected in order to receive the events.",
                "product": "windows",
                "service": "dns-client"
            },
            "related": [
                {
                    "type": "similar",
                    "id": "f356a9c4-effd-4608-bbf8-408afd5cd006"
                }
            ],
            "references": [
                "https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns",
                "https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious Cobalt Strike DNS Beaconing - DNS Client"
        },
        {
            "author": "Alina Stepchenkova, Group-IB, oscd.community",
            "date": "2019/11/01",
            "description": "Detects Silence EmpireDNSAgent as described in the Group-IP report",
            "detection": {
                "condition": "empire and dnscat",
                "dnscat": {
                    "ScriptBlockText|contains|all": [
                        "set type=$LookupType`nserver",
                        "$Command | nslookup 2>&1 | Out-String",
                        "New-RandomDNSField",
                        "[Convert]::ToString($SYNOptions, 16)",
                        "$Session.Dead = $True",
                        "$Session[\"Driver\"] -eq"
                    ]
                },
                "empire": {
                    "ScriptBlockText|contains|all": [
                        "System.Diagnostics.Process",
                        "Stop-Computer",
                        "Restart-Computer",
                        "Exception in execution",
                        "$cmdargs",
                        "Close-Dnscat2Tunnel"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "3ceb2083-a27f-449a-be33-14ec1b7cc973",
            "level": "critical",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2023/04/03",
            "references": [
                "https://www.group-ib.com/resources/threat-research/silence_2.0.going_global.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.001",
                "attack.command_and_control",
                "attack.t1071.004",
                "attack.t1572",
                "attack.impact",
                "attack.t1529",
                "attack.g0091",
                "attack.s0363"
            ],
            "title": "Silence.EDA Detection"
        }
    ]
}