{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--9c7465db-c897-4054-a568-ccfd92a48ad3",
    "created": "2024-08-13T14:46:37.048484Z",
    "modified": "2024-08-13T14:46:45.680504Z",
    "name": "OS Credential Dumping: Security Account Manager",
    "description": "Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through in-memory techniques or through the Windows Registry where the SAM database is stored. The SAM is a database file that contains local accounts for the host, typically those found with the net user command. Enumerating the SAM database requires SYSTEM level access.A number of tools can be used to retrieve the SAM file through in-memory techniques:pwdumpx.exegsecdumpMimikatzsecretsdump.pyAlternatively, the SAM can be extracted from the Registry with Reg:reg save HKLM\\sam samreg save HKLM\\system systemCreddump7 can then be used to process the SAM database locally to retrieve hashes.[1]Notes: RID 500 account is the local, built-in administrator.RID 501 is the guest account.User accounts start with a RID of 1,000+.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1003/002",
            "external_id": "T1003/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/09/09",
            "description": "Detects a highly relevant Antivirus alert that reports a password dumper.",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Signature|startswith": "PWS"
                    },
                    {
                        "Signature|contains": [
                            "DumpCreds",
                            "DumpLsass",
                            "HTool/WCE",
                            "Kekeo",
                            "LsassDump",
                            "Mimikatz",
                            "Outflank",
                            "PShlSpy",
                            "PSWTool",
                            "PWCrack",
                            "PWDump",
                            "PWS.",
                            "PWSX",
                            "Rubeus",
                            "SecurityTool",
                            "SharpDump"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "78cc2dd2-7d20-4d32-93ff-057084c38b93",
            "level": "critical",
            "logsource": {
                "category": "antivirus"
            },
            "modified": "2024/07/17",
            "references": [
                "https://www.nextron-systems.com/?s=antivirus",
                "https://www.virustotal.com/gui/file/5fcda49ee7f202559a6cbbb34edb65c33c9a1e0bde9fa2af06a6f11b55ded619",
                "https://www.virustotal.com/gui/file/a4edfbd42595d5bddb442c82a02cf0aaa10893c1bf79ea08b9ce576f82749448"
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1558",
                "attack.t1003.001",
                "attack.t1003.002"
            ],
            "title": "Antivirus Password Dumper Detection"
        },
        {
            "author": "@neu5ron, Teymur Kheirkhabarov, oscd.community",
            "date": "2020/04/02",
            "description": "Transferring files with well-known filenames (sensitive files with credential data) using network shares",
            "detection": {
                "condition": "selection",
                "selection": {
                    "name": [
                        "\\mimidrv",
                        "\\lsass",
                        "\\windows\\minidump\\",
                        "\\hiberfil",
                        "\\sqldmpr",
                        "\\sam",
                        "\\ntds.dit",
                        "\\security"
                    ]
                }
            },
            "falsepositives": [
                "Transferring sensitive files for legitimate administration work by legitimate administrator"
            ],
            "id": "2e69f167-47b5-4ae7-a390-47764529eff5",
            "level": "medium",
            "logsource": {
                "product": "zeek",
                "service": "smb_files"
            },
            "modified": "2021/11/27",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "id": "910ab938-668b-401b-b08c-b596e80fdca5",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.001",
                "attack.t1003.003"
            ],
            "title": "Transferring Files with Credential Data via Network Shares - Zeek"
        },
        {
            "author": "Samir Bousseaden, @neu5ron",
            "date": "2020/03/19",
            "description": "Detect AD credential dumping using impacket secretdump HKTL. Based on the SIGMA rules/windows/builtin/win_impacket_secretdump.yml",
            "detection": {
                "condition": "selection",
                "selection": {
                    "name|contains": "SYSTEM32\\",
                    "name|endswith": ".tmp",
                    "path|contains|all": [
                        "\\",
                        "ADMIN$"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "92dae1ed-1c9d-4eff-a567-33acbd95b00e",
            "level": "high",
            "logsource": {
                "product": "zeek",
                "service": "smb_files"
            },
            "modified": "2021/11/27",
            "references": [
                "https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.003"
            ],
            "title": "Possible Impacket SecretDump Remote Activity - Zeek"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/01/11",
            "description": "Detects creation of a file named \"ntds.dit\" (Active Directory Database) by an uncommon process or a process located in a suspicious directory",
            "detection": {
                "condition": "selection_ntds and 1 of selection_process_*",
                "selection_ntds": {
                    "TargetFilename|endswith": "\\ntds.dit"
                },
                "selection_process_img": {
                    "Image|endswith": [
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\mshta.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\wscript.exe",
                        "\\wsl.exe",
                        "\\wt.exe"
                    ]
                },
                "selection_process_paths": {
                    "Image|contains": [
                        "\\AppData\\",
                        "\\Temp\\",
                        "\\Public\\",
                        "\\PerfLogs\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "11b1ed55-154d-4e82-8ad7-83739298f720",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2022/07/14",
            "references": [
                "https://stealthbits.com/blog/extracting-password-hashes-from-the-ntds-dit-file/",
                "https://adsecurity.org/?p=2398"
            ],
            "related": [
                {
                    "id": "4e7050dd-e548-483f-b7d6-527ab4fa784d",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.003"
            ],
            "title": "NTDS.DIT Creation By Uncommon Process"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/11/01",
            "description": "Files with well-known filenames (parts of credential dump software or files produced by them) creation",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "TargetFilename|contains": [
                            "\\fgdump-log",
                            "\\kirbi",
                            "\\pwdump",
                            "\\pwhashes",
                            "\\wce_ccache",
                            "\\wce_krbtkts"
                        ]
                    },
                    {
                        "TargetFilename|endswith": [
                            "\\cachedump.exe",
                            "\\cachedump64.exe",
                            "\\DumpExt.dll",
                            "\\DumpSvc.exe",
                            "\\Dumpy.exe",
                            "\\fgexec.exe",
                            "\\lsremora.dll",
                            "\\lsremora64.dll",
                            "\\NTDS.out",
                            "\\procdump64.exe",
                            "\\pstgdump.exe",
                            "\\pwdump.exe",
                            "\\SAM.out",
                            "\\SECURITY.out",
                            "\\servpw.exe",
                            "\\servpw64.exe",
                            "\\SYSTEM.out",
                            "\\test.pwd",
                            "\\wceaux.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Legitimate Administrator using tool for password recovery"
            ],
            "id": "8fbf3271-1ef6-4e94-8210-03c2317947f6",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2022/09/21",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.003",
                "attack.t1003.004",
                "attack.t1003.005"
            ],
            "title": "Cred Dump Tools Dropped Files"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/02/10",
            "description": "Detects a dump file written by QuarksPwDump password dumper",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename|contains|all": [
                        "\\AppData\\Local\\Temp\\SAM-",
                        ".dmp"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "847def9e-924d-4e90-b7c4-5f581395a2b4",
            "level": "critical",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2024/06/27",
            "references": [
                "https://jpcertcc.github.io/ToolAnalysisResultSheet/details/QuarksPWDump.htm"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "HackTool - QuarksPwDump Dump File"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/02/11",
            "description": "Detects the creation of files that look like exports of the local SAM (Security Account Manager)",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "TargetFilename|endswith": [
                            "\\Temp\\sam",
                            "\\sam.sav",
                            "\\Intel\\sam",
                            "\\sam.hive",
                            "\\Perflogs\\sam",
                            "\\ProgramData\\sam",
                            "\\Users\\Public\\sam",
                            "\\AppData\\Local\\sam",
                            "\\AppData\\Roaming\\sam",
                            "_ShadowSteal.zip",
                            "\\Documents\\SAM.export",
                            ":\\sam"
                        ]
                    },
                    {
                        "TargetFilename|contains": [
                            "\\hive_sam_",
                            "\\sam.save",
                            "\\sam.export",
                            "\\~reg_sam.save",
                            "\\sam_backup",
                            "\\sam.bck",
                            "\\sam.backup"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Rare cases of administrative activity"
            ],
            "id": "4e87b8e2-2ee9-4b2a-a715-4727d297ece0",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/01/05",
            "references": [
                "https://github.com/search?q=CVE-2021-36934",
                "https://github.com/cube0x0/CVE-2021-36934",
                "https://www.google.com/search?q=%22reg.exe+save%22+sam",
                "https://github.com/HuskyHacks/ShadowSteal",
                "https://github.com/FireFart/hivenightmare"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "Potential SAM Database Dump"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/07/29",
            "description": "Detects suspicious PowerShell scripts accessing SAM hives",
            "detection": {
                "condition": "all of selection*",
                "selection_1": {
                    "CommandLine|contains|all": [
                        "\\HarddiskVolumeShadowCopy",
                        "System32\\config\\sam"
                    ]
                },
                "selection_2": {
                    "CommandLine|contains": [
                        "Copy-Item",
                        "cp $_.",
                        "cpi $_.",
                        "copy $_.",
                        ".File]::Copy("
                    ]
                }
            },
            "falsepositives": [
                "Some rare backup scenarios",
                "PowerShell scripts fixing HiveNightmare / SeriousSAM ACLs"
            ],
            "id": "1af57a4b-460a-4738-9034-db68b880c665",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/01/06",
            "references": [
                "https://twitter.com/splinter_code/status/1420546784250769408"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "PowerShell SAM Copy"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton",
            "date": "2019/10/22",
            "description": "Detection well-known mimikatz command line arguments",
            "detection": {
                "condition": "1 of selection_*",
                "selection_function_names": {
                    "CommandLine|contains": [
                        "::aadcookie",
                        "::detours",
                        "::memssp",
                        "::mflt",
                        "::ncroutemon",
                        "::ngcsign",
                        "::printnightmare",
                        "::skeleton",
                        "::preshutdown",
                        "::mstsc",
                        "::multirdp"
                    ]
                },
                "selection_module_names": {
                    "CommandLine|contains": [
                        "rpc::",
                        "token::",
                        "crypto::",
                        "dpapi::",
                        "sekurlsa::",
                        "kerberos::",
                        "lsadump::",
                        "privilege::",
                        "process::",
                        "vault::"
                    ]
                },
                "selection_tools_name": {
                    "CommandLine|contains": [
                        "DumpCreds",
                        "mimikatz"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "a642964e-bead-4bed-8910-1bb4d63e3b4d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://tools.thehacker.recipes/mimikatz/modules"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006"
            ],
            "title": "HackTool - Mimikatz Execution"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/10/22",
            "description": "Shadow Copies storage symbolic link creation using operating systems utilities",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "mklink",
                        "HarddiskVolumeShadowCopy"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administrator working with shadow copies, access for backup purposes"
            ],
            "id": "40b19fa6-d835-400c-b301-41f3a2baacaf",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/06",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "stable",
            "title": "VolumeShadowCopy Symlink Creation Via Mklink",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.003"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/01/05",
            "description": "Detects the usage of \"pypykatz\" to obtain stored credentials. Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database through Windows registry where the SAM database is stored",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "live",
                        "registry"
                    ],
                    "Image|endswith": [
                        "\\pypykatz.exe",
                        "\\python.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a29808fd-ef50-49ff-9c7a-59a9b040b404",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/05",
            "references": [
                "https://github.com/skelsec/pypykatz",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-2---registry-parse-with-pypykatz"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "HackTool - Pypykatz Credentials Dumping Activity"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/09/05",
            "description": "Detects usage of the Quarks PwDump tool via commandline arguments",
            "detection": {
                "condition": "1 of selection_*",
                "selection_cli": {
                    "CommandLine": [
                        " -dhl",
                        " --dump-hash-local",
                        " -dhdc",
                        " --dump-hash-domain-cached",
                        " --dump-bitlocker",
                        " -dhd ",
                        " --dump-hash-domain ",
                        "--ntds-file"
                    ]
                },
                "selection_img": {
                    "Image|endswith": "\\QuarksPwDump.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "0685b176-c816-4837-8e7b-1216f346636b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/05",
            "references": [
                "https://github.com/quarkslab/quarkspwdump",
                "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/seedworm-apt-iran-middle-east"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "HackTool - Quarks PwDump Execution"
        },
        {
            "author": "Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2019/10/22",
            "description": "Shadow Copies creation using operating systems utilities, possible credential access",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "shadow",
                        "create"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\powershell.exe",
                            "\\pwsh.exe",
                            "\\wmic.exe",
                            "\\vssadmin.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll",
                            "wmic.exe",
                            "VSSADMIN.EXE"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrator working with shadow copies, access for backup purposes"
            ],
            "id": "b17ea6f7-6e90-447e-a799-e6c0a493d6ce",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/11/10",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/tutorial-for-ntds-goodness-vssadmin-wmis-ntdsdit-system/"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1003.002",
                "attack.t1003.003"
            ],
            "title": "Shadow Copies Creation Using Operating Systems Utilities"
        },
        {
            "author": "Teymur Kheirkhabarov, Endgame, JHasenbusch, Daniil Yugoslavskiy, oscd.community, frack113",
            "date": "2019/10/22",
            "description": "Detects the usage of \"reg.exe\" in order to dump sensitive registry hives. This includes SAM, SYSTEM and SECURITY hives.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli_flag": {
                    "CommandLine|contains": [
                        " save ",
                        " export ",
                        " \u02e2ave ",
                        " e\u02e3port "
                    ]
                },
                "selection_cli_hive": {
                    "CommandLine|contains": [
                        "\\system",
                        "\\sam",
                        "\\security",
                        "\\\u02e2ystem",
                        "\\sy\u02e2tem",
                        "\\\u02e2y\u02e2tem",
                        "\\\u02e2am",
                        "\\\u02e2ecurity"
                    ]
                },
                "selection_cli_hklm": {
                    "CommandLine|contains": [
                        "hklm",
                        "hk\u02eam",
                        "hkey_local_machine",
                        "hkey_\u02eaocal_machine",
                        "hkey_loca\u02ea_machine",
                        "hkey_\u02eaoca\u02ea_machine"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\reg.exe"
                    },
                    {
                        "OriginalFileName": "reg.exe"
                    }
                ]
            },
            "falsepositives": [
                "Dumping hives for legitimate purpouse i.e. backup or forensic investigation"
            ],
            "id": "fd877b94-9bb5-4191-bb25-d79cbd93c167",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/13",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://eqllib.readthedocs.io/en/latest/analytics/aed95fc6-5e3f-49dc-8b35-06508613f979.html",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003/T1003.md",
                "https://www.wietzebeukema.nl/blog/windows-command-line-obfuscation",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-1---registry-dump-of-sam-creds-and-secrets"
            ],
            "related": [
                {
                    "id": "038cd51c-3ad8-41c5-ba8f-5d1c92f3cc1e",
                    "type": "obsoletes"
                },
                {
                    "id": "4d6c9da1-318b-4edf-bcea-b6c93fa98fd0",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "car.2013-07-001"
            ],
            "title": "Dumping of Sensitive Hives Via Reg.EXE"
        },
        {
            "author": "Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2019/10/22",
            "description": "Files with well-known filenames (sensitive files with credential data) copying",
            "detection": {
                "condition": "all of selection_esent_* or selection_susp_paths",
                "selection_esent_cli": {
                    "CommandLine|contains|windash": [
                        "vss",
                        " /m ",
                        " /y "
                    ]
                },
                "selection_esent_img": [
                    {
                        "Image|endswith": "\\esentutl.exe"
                    },
                    {
                        "OriginalFileName": "\\esentutl.exe"
                    }
                ],
                "selection_susp_paths": {
                    "CommandLine|contains": [
                        "\\config\\RegBack\\sam",
                        "\\config\\RegBack\\security",
                        "\\config\\RegBack\\system",
                        "\\config\\sam",
                        "\\config\\security",
                        "\\config\\system ",
                        "\\repair\\sam",
                        "\\repair\\security",
                        "\\repair\\system",
                        "\\windows\\ntds\\ntds.dit"
                    ]
                }
            },
            "falsepositives": [
                "Copying sensitive files for legitimate use (eg. backup) or forensic investigation by legitimate incident responder or forensic investigator."
            ],
            "id": "e7be6119-fc37-43f0-ad4f-1f3f99be2f9f",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/06/04",
            "references": [
                "https://room362.com/post/2013/2013-06-10-volume-shadow-copy-ntdsdit-domain-hashes-remotely-part-1/",
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://dfironthemountain.wordpress.com/2018/12/06/locked-file-access-using-esentutl-exe/",
                "https://github.com/LOLBAS-Project/LOLBAS/blob/2cc01b01132b5c304027a658c698ae09dd6a92bf/yml/OSBinaries/Esentutl.yml"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.003",
                "car.2013-07-001",
                "attack.s0404"
            ],
            "title": "Copying Sensitive Files with Credential Data"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/11/01",
            "description": "Detects well-known credential dumping tools execution via specific named pipe creation",
            "detection": {
                "condition": "selection",
                "selection": {
                    "PipeName|contains": [
                        "\\cachedump",
                        "\\lsadump",
                        "\\wceservicepipe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate Administrator using tool for password recovery"
            ],
            "id": "961d0ba2-3eea-4303-a930-2cf78bbfcc5e",
            "level": "critical",
            "logsource": {
                "category": "pipe_created",
                "product": "windows",
                "definition": "Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575"
            },
            "modified": "2023/08/07",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://image.slidesharecdn.com/zeronights2017kheirkhabarov-171118103000/75/hunting-for-credentials-dumping-in-windows-environment-57-2048.jpg?cb=1666035799"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005"
            ],
            "title": "HackTool - Credential Dumping Tools Named Pipe Created"
        },
        {
            "author": "Florian Roth (Nextron Systems), David ANDRE (additional keywords)",
            "date": "2017/01/10",
            "description": "This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)",
            "detection": {
                "condition": "keywords and not filter",
                "filter": {
                    "EventID": 15
                },
                "keywords": [
                    "dpapi::masterkey",
                    "eo.oe.kiwi",
                    "event::clear",
                    "event::drop",
                    "gentilkiwi.com",
                    "kerberos::golden",
                    "kerberos::ptc",
                    "kerberos::ptt",
                    "kerberos::tgt",
                    "Kiwi Legit Printer",
                    "lsadump::",
                    "mimidrv.sys",
                    "\\mimilib.dll",
                    "misc::printnightmare",
                    "misc::shadowcopies",
                    "misc::skeleton",
                    "privilege::backup",
                    "privilege::debug",
                    "privilege::driver",
                    "sekurlsa::"
                ]
            },
            "falsepositives": [
                "Naughty administrators",
                "AV Signature updates",
                "Files with Mimikatz in their filename"
            ],
            "id": "06d71506-7beb-4f22-8888-e2e5e2ca7fd8",
            "level": "high",
            "logsource": {
                "product": "windows"
            },
            "modified": "2022/01/05",
            "references": [
                "https://tools.thehacker.recipes/mimikatz/modules"
            ],
            "status": "test",
            "tags": [
                "attack.s0002",
                "attack.lateral_movement",
                "attack.credential_access",
                "car.2013-07-001",
                "car.2019-04-004",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.001",
                "attack.t1003.006"
            ],
            "title": "Mimikatz Use"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR)",
            "date": "2020/10/20",
            "description": "Detects volume shadow copy mount via Windows event log",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DeviceName|contains": "HarddiskVolumeShadowCopy",
                    "EventID": 98,
                    "Provider_Name": "Microsoft-Windows-Ntfs"
                }
            },
            "falsepositives": [
                "Legitimate use of volume shadow copy mounts (backups maybe)."
            ],
            "id": "f512acbf-e662-4903-843e-97ce4652b740",
            "level": "low",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "Volume Shadow Copy Mount"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/05/15",
            "description": "Detects events from the Kernel-General ETW indicating that the access bits of a hive with a system like hive name located in the temp directory have been reset.\nThis occurs when an application tries to access a hive and the hive has not be recognized since the last 7 days (by default).\nRegistry hive dumping utilities such as QuarksPwDump were seen emitting this behavior.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 16,
                    "HiveName|contains": [
                        "\\Temp\\SAM",
                        "\\Temp\\SECURITY"
                    ],
                    "Provider_Name": "Microsoft-Windows-Kernel-General"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "39f919f3-980b-4e6f-a975-8af7e507ef2b",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2024/01/18",
            "references": [
                "https://github.com/nasbench/Misc-Research/blob/b20da2336de0f342d31ef4794959d28c8d3ba5ba/ETW/Microsoft-Windows-Kernel-General.md"
            ],
            "related": [
                {
                    "id": "839dd1e8-eda8-4834-8145-01beeee33acd",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "Critical Hive In Suspicious Location Access Bits Cleared"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2017/03/05",
            "description": "Detects well-known credential dumping tools execution via service execution events",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 7045,
                    "ImagePath|contains": [
                        "cachedump",
                        "dumpsvc",
                        "fgexec",
                        "gsecdump",
                        "mimidrv",
                        "pwdump",
                        "servpw"
                    ],
                    "Provider_Name": "Service Control Manager"
                }
            },
            "falsepositives": [
                "Legitimate Administrator using credential dumping tool for password recovery"
            ],
            "id": "4976aa50-8f41-45c6-8b15-ab3fc10e79ed",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2022/11/29",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006",
                "attack.t1569.002",
                "attack.s0005"
            ],
            "title": "Credential Dumping Tools Service Execution - System"
        },
        {
            "id": "910ab938-668b-401b-b08c-b596e80fdca5",
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/10/22",
            "description": "Transferring files with well-known filenames (sensitive files with credential data) using network shares",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 5145,
                    "RelativeTargetName|contains": [
                        "\\mimidrv",
                        "\\lsass",
                        "\\windows\\minidump\\",
                        "\\hiberfil",
                        "\\sqldmpr",
                        "\\sam",
                        "\\ntds.dit",
                        "\\security"
                    ]
                }
            },
            "falsepositives": [
                "Transferring sensitive files for legitimate administration work by legitimate administrator"
            ],
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/30",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "2e69f167-47b5-4ae7-a390-47764529eff5"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.001",
                "attack.t1003.003"
            ],
            "title": "Transferring Files with Credential Data via Network Shares"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR)",
            "date": "2020/10/20",
            "description": "Detects the registration of the security event source VSSAudit. It would usually trigger when volume shadow copy operations happen.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AuditSourceName": "VSSAudit",
                    "EventID": [
                        4904,
                        4905
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of VSSVC. Maybe backup operations. It would usually be done by C:\\Windows\\System32\\VSSVC.exe."
            ],
            "id": "e9faba72-4974-4ab2-a4c5-46e25ad59e9b",
            "level": "informational",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/04/28",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "VSSAudit Security Event Source Registration"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2017/03/05",
            "description": "Detects well-known credential dumping tools execution via service execution events",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4697,
                    "ServiceFileName|contains": [
                        "cachedump",
                        "dumpsvc",
                        "fgexec",
                        "gsecdump",
                        "mimidrv",
                        "pwdump",
                        "servpw"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate Administrator using credential dumping tool for password recovery"
            ],
            "id": "f0d1feba-4344-4ca9-8121-a6c97bd6df52",
            "level": "high",
            "logsource": {
                "definition": "The 'System Security Extension' audit subcategory need to be enabled to log the EID 4697",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/11/29",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "4976aa50-8f41-45c6-8b15-ab3fc10e79ed"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006",
                "attack.t1569.002",
                "attack.s0005"
            ],
            "title": "Credential Dumping Tools Service Execution - Security"
        },
        {
            "author": "Samir Bousseaden, wagga",
            "date": "2019/04/03",
            "description": "Detect AD credential dumping using impacket secretdump HKTL",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 5145,
                    "RelativeTargetName|contains|all": [
                        "SYSTEM32\\",
                        ".tmp"
                    ],
                    "ShareName": "\\\\\\\\\\*\\\\ADMIN$"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "252902e3-5830-4cf6-bf21-c22083dfd5cf",
            "level": "high",
            "logsource": {
                "definition": "The advanced audit policy setting \"Object Access > Audit Detailed File Share\" must be configured for Success/Failure",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/08/11",
            "references": [
                "https://blog.menasec.net/2019/02/threat-huting-10-impacketsecretdump.html"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.003"
            ],
            "title": "Possible Impacket SecretDump Remote Activity"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/10/20",
            "description": "Detects the volume shadow copy service initialization and processing via esentutl. Registry keys such as HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\VSS\\\\Diag\\\\VolSnap\\\\Volume are captured.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "TargetObject|contains": "System\\CurrentControlSet\\Services\\VSS\\Start"
                },
                "selection": {
                    "Image|endswith": "esentutl.exe",
                    "TargetObject|contains": "System\\CurrentControlSet\\Services\\VSS"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5aad0995-46ab-41bd-a9ff-724f41114971",
            "level": "high",
            "logsource": {
                "category": "registry_event",
                "product": "windows"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.002/T1003.002.md#atomic-test-3---esentutlexe-sam-copy"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002"
            ],
            "title": "Esentutl Volume Shadow Copy Service Keys"
        }
    ]
}