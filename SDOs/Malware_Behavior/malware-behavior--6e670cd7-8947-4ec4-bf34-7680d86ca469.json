{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--6e670cd7-8947-4ec4-bf34-7680d86ca469",
    "created": "2024-08-13T14:46:37.033277Z",
    "modified": "2024-08-13T14:46:45.584181Z",
    "name": "Remote Services: Remote Desktop Protocol",
    "description": "Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user.Remote desktop is a common feature in operating systems. It allows a user to log into an interactive session with a system desktop graphical user interface on a remote system. Microsoft refers to its implementation of the Remote Desktop Protocol (RDP) as Remote Desktop Services (RDS).[1] Adversaries may connect to a remote system over RDP/RDS to expand access if the service is enabled and allows access to accounts with known credentials. Adversaries will likely use Credential Access techniques to acquire credentials to use with RDP. Adversaries may also use RDP in conjunction with the Accessibility Features or Terminal Services DLL for Persistence.[2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1021/001",
            "external_id": "T1021/001"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Josh Brower @DefensiveDepth",
            "date": "2020/08/22",
            "description": "Detects connections from routable IPs to an RDP listener. Which is indicative of a publicly-accessible RDP service.\n",
            "detection": {
                "condition": "not selection",
                "selection": {
                    "id.orig_h|cidr": [
                        "::1/128",
                        "10.0.0.0/8",
                        "127.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "2620:83:8000::/48",
                        "fc00::/7",
                        "fe80::/10"
                    ]
                }
            },
            "falsepositives": [
                "Although it is recommended to NOT have RDP exposed to the internet, verify that this is a) allowed b) the server has not already been compromised via some brute force or remote exploit since it has been exposed to the internet. Work to secure the server if you are unable to remove it from being exposed to the internet."
            ],
            "id": "1fc0809e-06bf-4de3-ad52-25e5263b7623",
            "level": "high",
            "logsource": {
                "product": "zeek",
                "service": "rdp"
            },
            "modified": "2024/03/13",
            "references": [
                "https://attack.mitre.org/techniques/T1021/001/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.001"
            ],
            "title": "Publicly Accessible RDP Service"
        },
        {
            "author": "Samir Bousseaden",
            "date": "2019/02/16",
            "description": "Detects svchost hosting RDP termsvcs communicating with the loopback address and on TCP port 3389",
            "detection": {
                "condition": "all of selection_*",
                "selection_destination": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "::1/128"
                    ]
                },
                "selection_img": {
                    "Image|endswith": "\\svchost.exe",
                    "Initiated": "true",
                    "SourcePort": 3389
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5f699bc5-5446-4a4a-a0b7-5ef2885a3eb4",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/12",
            "references": [
                "https://twitter.com/cyb3rops/status/1096842275437625346"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1572",
                "attack.lateral_movement",
                "attack.t1021.001",
                "car.2013-07-002"
            ],
            "title": "RDP Over Reverse SSH Tunnel"
        },
        {
            "author": "Markus Neis",
            "date": "2019/05/15",
            "description": "Detects Non-Standard tools initiating a connection over port 3389 indicating possible lateral movement.\nAn initial baseline is required before using this utility to exclude third party RDP tooling that you might use.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_mstsc": {
                    "Image": [
                        "C:\\Windows\\System32\\mstsc.exe",
                        "C:\\Windows\\SysWOW64\\mstsc.exe"
                    ]
                },
                "filter_optional_avast": {
                    "Image|endswith": [
                        "\\Avast Software\\Avast\\AvastSvc.exe",
                        "\\Avast\\AvastSvc.exe"
                    ]
                },
                "filter_optional_chrome": {
                    "Image": "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"
                },
                "filter_optional_dns": {
                    "Image": "C:\\Windows\\System32\\dns.exe",
                    "Protocol": "udp",
                    "SourcePort": 53
                },
                "filter_optional_empty": {
                    "Image": ""
                },
                "filter_optional_firefox": {
                    "Image": "C:\\Program Files\\Mozilla Firefox\\firefox.exe"
                },
                "filter_optional_null": {
                    "Image": null
                },
                "filter_optional_sentinel_one": {
                    "Image|endswith": "\\Ranger\\SentinelRanger.exe"
                },
                "filter_optional_splunk": {
                    "Image|startswith": "C:\\Program Files\\SplunkUniversalForwarder\\bin\\"
                },
                "filter_optional_sysinternals_rdcman": {
                    "Image|endswith": "\\RDCMan.exe"
                },
                "filter_optional_third_party": {
                    "Image|endswith": [
                        "\\FSAssessment.exe",
                        "\\FSDiscovery.exe",
                        "\\MobaRTE.exe",
                        "\\mRemote.exe",
                        "\\mRemoteNG.exe",
                        "\\Passwordstate.exe",
                        "\\RemoteDesktopManager.exe",
                        "\\RemoteDesktopManager64.exe",
                        "\\RemoteDesktopManagerFree.exe",
                        "\\RSSensor.exe",
                        "\\RTS2App.exe",
                        "\\RTSApp.exe",
                        "\\spiceworks-finder.exe",
                        "\\Terminals.exe",
                        "\\ws_TunnelService.exe"
                    ]
                },
                "filter_optional_thor": {
                    "Image|endswith": [
                        "\\thor.exe",
                        "\\thor64.exe"
                    ]
                },
                "filter_optional_tsplus": {
                    "Image": [
                        "C:\\Program Files\\TSplus\\Java\\bin\\HTML5service.exe",
                        "C:\\Program Files (x86)\\TSplus\\Java\\bin\\HTML5service.exe"
                    ]
                },
                "filter_optional_unknown": {
                    "Image": "<unknown process>"
                },
                "selection": {
                    "DestinationPort": 3389,
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Third party RDP tools"
            ],
            "id": "ed74fe75-7594-4b4b-ae38-e38e3fd2eb23",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/02/09",
            "references": [
                "https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2019-0708"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.001",
                "car.2013-07-002"
            ],
            "title": "Outbound RDP Connections Over Non-Standard Tools"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/04/29",
            "description": "Detects svchost hosting RDP termsvcs communicating to target systems on TCP port 80 or 443",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\svchost.exe",
                    "DestinationPort": [
                        80,
                        443
                    ],
                    "Initiated": "true",
                    "SourcePort": 3389
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b1e5da3b-ca8e-4adf-915c-9921f3d85481",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2022/07/14",
            "references": [
                "https://twitter.com/tekdefense/status/1519711183162556416?s=12&t=OTsHCBkQOTNs1k3USz65Zg",
                "https://www.mandiant.com/resources/bypassing-network-restrictions-through-rdp-tunneling"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1572",
                "attack.lateral_movement",
                "attack.t1021.001",
                "car.2013-07-002"
            ],
            "title": "RDP to HTTP or HTTPS Target Ports"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/01/19",
            "description": "Detects suspicious Plink tunnel port forwarding to a local port",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": " -R ",
                    "Description": "Command-line SSH, Telnet, and Rlogin client"
                }
            },
            "falsepositives": [
                "Administrative activity using a remote port forwarding to a local port"
            ],
            "id": "48a61b29-389f-4032-b317-b30de6b95314",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://www.real-sec.com/2019/04/bypassing-network-restrictions-through-rdp-tunneling/",
                "https://medium.com/@informationsecurity/remote-ssh-tunneling-with-plink-exe-7831072b3d7d"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1572",
                "attack.lateral_movement",
                "attack.t1021.001"
            ],
            "title": "Suspicious Plink Port Forwarding"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/03/17",
            "description": "Detects a suspicious RDP session redirect using tscon.exe",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": " /dest:rdp-tcp#"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f72aa3e8-49f9-4c7d-bd74-f8ab84ff9bbb",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/16",
            "references": [
                "http://www.korznikov.com/2017/03/0-day-or-feature-privilege-escalation.html",
                "https://medium.com/@networksecurity/rdp-hijacking-how-to-hijack-rds-and-remoteapp-sessions-transparently-to-move-through-an-da2a1e73a5f6",
                "https://www.hackingarticles.in/rdp-session-hijacking-with-tscon/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1563.002",
                "attack.t1021.001",
                "car.2013-07-002"
            ],
            "title": "Suspicious RDP Redirect Using TSCON"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/12",
            "description": "Detects port forwarding activity via SSH.exe",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|windash": " -R ",
                    "Image|endswith": "\\ssh.exe"
                }
            },
            "falsepositives": [
                "Administrative activity using a remote port forwarding to a local port"
            ],
            "id": "327f48c1-a6db-4eb8-875a-f6981f1b0183",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/05",
            "references": [
                "https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/"
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.lateral_movement",
                "attack.t1572",
                "attack.t1021.001",
                "attack.t1021.004"
            ],
            "title": "Port Forwarding Activity Via SSH.EXE"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/12/06",
            "description": "Detects addition of users to the local Remote Desktop Users group via \"Net\" or \"Add-LocalGroupMember\".",
            "detection": {
                "condition": "all of selection_*",
                "selection_group": {
                    "CommandLine|contains": [
                        "Remote Desktop Users",
                        "Utilisateurs du Bureau \u00e0 distance",
                        "Usuarios de escritorio remoto"
                    ]
                },
                "selection_main": [
                    {
                        "CommandLine|contains|all": [
                            "localgroup ",
                            " /add"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "Add-LocalGroupMember ",
                            " -Group "
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Administrative activity"
            ],
            "id": "ffa28e60-bdb1-46e0-9f82-05f7a61cc06e",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/09/09",
            "references": [
                "https://www.microsoft.com/security/blog/2021/11/16/evolving-trends-in-iranian-threat-actor-activity-mstic-presentation-at-cyberwarcon-2021/"
            ],
            "related": [
                {
                    "id": "ad720b90-25ad-43ff-9b5e-5c841facc8e5",
                    "type": "similar"
                },
                {
                    "id": "10fb649c-3600-4d37-b1e6-56ea90bb7e09",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.lateral_movement",
                "attack.t1133",
                "attack.t1136.001",
                "attack.t1021.001"
            ],
            "title": "User Added to Remote Desktop Users Group"
        },
        {
            "author": "pH-T (Nextron Systems), @Kostastsale, @TheDFIRReport",
            "date": "2022/02/12",
            "description": "Detects the execution of \"reg.exe\" for enabling/disabling the RDP service on the host by tampering with the 'CurrentControlSet\\Control\\Terminal Server' values",
            "detection": {
                "condition": "all of selection_main_* and 1 of selection_values_*",
                "selection_main_cli": {
                    "CommandLine|contains|all": [
                        " add ",
                        "\\CurrentControlSet\\Control\\Terminal Server",
                        "REG_DWORD",
                        " /f"
                    ]
                },
                "selection_main_img": [
                    {
                        "Image|endswith": "\\reg.exe"
                    },
                    {
                        "OriginalFileName": "reg.exe"
                    }
                ],
                "selection_values_1": {
                    "CommandLine|contains|all": [
                        "Licensing Core",
                        "EnableConcurrentSessions"
                    ]
                },
                "selection_values_2": {
                    "CommandLine|contains": [
                        "WinStations\\RDP-Tcp",
                        "MaxInstanceCount",
                        "fEnableWinStation",
                        "TSUserEnabled",
                        "TSEnabled",
                        "TSAppCompat",
                        "IdleWinStationPoolCount",
                        "TSAdvertise",
                        "AllowTSConnections",
                        "fSingleSessionPerUser",
                        "fDenyTSConnections"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "0d5675be-bc88-4172-86d3-1e96a4476536",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/05",
            "references": [
                "https://thedfirreport.com/2022/02/21/qbot-and-zerologon-lead-to-full-domain-compromise/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.lateral_movement",
                "attack.t1021.001",
                "attack.t1112"
            ],
            "title": "Potential Tampering With RDP Related Registry Keys Via Reg.EXE"
        },
        {
            "author": "frack113",
            "date": "2022/01/07",
            "description": "Detects the usage of \"mstsc.exe\" with the \"/v\" flag to initiate a connection to a remote server.\nAdversaries may use valid accounts to log into a computer using the Remote Desktop Protocol (RDP). The adversary may then perform actions as the logged-on user.\n",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_optional_*",
                "filter_optional_wsl": {
                    "CommandLine|contains": "C:\\ProgramData\\Microsoft\\WSL\\wslg.rdp",
                    "ParentImage": "C:\\Windows\\System32\\lxss\\wslhost.exe"
                },
                "selection_cli": {
                    "CommandLine|contains|windash": " /v:"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\mstsc.exe"
                    },
                    {
                        "OriginalFileName": "mstsc.exe"
                    }
                ]
            },
            "falsepositives": [
                "WSL (Windows Sub System For Linux)"
            ],
            "id": "954f0af7-62dd-418f-b3df-a84bc2c7a774",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/06/04",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1021.001/T1021.001.md#t1021001---remote-desktop-protocol",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/mstsc"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.001"
            ],
            "title": "New Remote Desktop Connection Initiated Via Mstsc.EXE"
        },
        {
            "author": "Samir Bousseaden",
            "date": "2019/02/16",
            "description": "Detects svchost hosting RDP termsvcs communicating with the loopback address",
            "detection": {
                "condition": "selection and ( sourceRDP or destinationRDP ) and not 1 of filter*",
                "destinationRDP": {
                    "DestPort": 3389,
                    "SourceAddress": [
                        "127.*",
                        "::1"
                    ]
                },
                "filter_app_container": {
                    "FilterOrigin": "AppContainer Loopback"
                },
                "filter_thor": {
                    "Application|endswith": [
                        "\\thor.exe",
                        "\\thor64.exe"
                    ]
                },
                "selection": {
                    "EventID": 5156
                },
                "sourceRDP": {
                    "DestAddress": [
                        "127.*",
                        "::1"
                    ],
                    "SourcePort": 3389
                }
            },
            "falsepositives": [
                "Programs that connect locally to the RDP port"
            ],
            "id": "5bed80b6-b3e8-428e-a3ae-d3c757589e41",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/09/02",
            "references": [
                "https://twitter.com/SBousseaden/status/1096148422984384514",
                "https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/44fbe85f72ee91582876b49678f9a26292a155fb/Command%20and%20Control/DE_RDP_Tunnel_5156.evtx"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.lateral_movement",
                "attack.t1090.001",
                "attack.t1090.002",
                "attack.t1021.001",
                "car.2013-07-002"
            ],
            "title": "RDP over Reverse SSH Tunnel WFP"
        },
        {
            "author": "Pushkarev Dmitry",
            "date": "2020/06/27",
            "description": "This event is generated when an authenticated user who is not allowed to log on remotely attempts to connect to this computer through Remote Desktop.\nOften, this event can be generated by attackers when searching for available windows servers in the network.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4825
                }
            },
            "falsepositives": [
                "Valid user was not added to RDP group"
            ],
            "fields": [
                "EventCode",
                "AccountName",
                "ClientAddress"
            ],
            "id": "8e5c03fa-b7f0-11ea-b242-07e0576828d9",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/27",
            "status": "test",
            "references": [
                "https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventid=4825"
            ],
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.001"
            ],
            "title": "Denied Access To Remote Desktop"
        },
        {
            "author": "Thomas Patzke",
            "date": "2019/01/28",
            "description": "RDP login with localhost source address may be a tunnelled login",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4624,
                    "IpAddress": [
                        "::1",
                        "127.0.0.1"
                    ],
                    "LogonType": 10
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "51e33403-2a37-4d66-a574-1fda1782cc31",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/09",
            "references": [
                "https://www.fireeye.com/blog/threat-research/2019/01/bypassing-network-restrictions-through-rdp-tunneling.html"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "car.2013-07-002",
                "attack.t1021.001"
            ],
            "title": "RDP Login from Localhost"
        }
    ]
}