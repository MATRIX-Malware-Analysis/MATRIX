{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--d857519d-4df0-4c36-8b07-5a70949d2ab1",
    "created": "2024-08-13T14:46:36.920378Z",
    "modified": "2024-08-13T14:46:44.99714Z",
    "name": "Non-Standard Port",
    "description": "Adversaries may communicate using a protocol and port pairing that are typically not associated. For example, HTTPS over port 8088[1] or port 587[2] as opposed to the traditional port 443. Adversaries may make changes to the standard port used by a protocol to bypass filtering or muddle analysis/parsing of network data.Adversaries may also make changes to victim systems to abuse non-standard ports. For example, Registry keys and other configuration settings can be used to modify protocol and port pairings.[3]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1571",
            "external_id": "T1571"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1571",
            "external_id": "T1571"
        },
        {
            "source_name": "University of Birmingham C2",
            "description": "Gardiner, J.,  Cova, M., Nagaraja, S. (2014, February). Command & Control Understanding, Denying and Detecting. Retrieved April 20, 2016.",
            "url": "https://arxiv.org/ftp/arxiv/papers/1408/1408.1136.pdf"
        },
        {
            "source_name": "Symantec Elfin Mar 2019",
            "description": "Security Response attack Investigation Team. (2019, March 27). Elfin: Relentless Espionage Group Targets Multiple Organizations in Saudi Arabia and U.S.. Retrieved April 10, 2019.",
            "url": "https://www.symantec.com/blogs/threat-intelligence/elfin-apt33-espionage"
        },
        {
            "source_name": "change_rdp_port_conti",
            "description": "The DFIR Report. (2022, March 1). \"Change RDP port\" #ContiLeaks. Retrieved March 1, 2022.",
            "url": "https://twitter.com/TheDFIRReport/status/1498657772254240768"
        },
        {
            "source_name": "Fortinet Agent Tesla April 2018",
            "description": "Zhang, X. (2018, April 05). Analysis of New Agent Tesla Spyware Variant. Retrieved November 5, 2018.",
            "url": "https://www.fortinet.com/blog/threat-research/analysis-of-new-agent-tesla-spyware-variant.html"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "@neu5ron, SOC Prime Team, Corelight",
            "date": "2021/05/04",
            "description": "The DNS Z flag is bit within the DNS protocol header that is, per the IETF design, meant to be used reserved (unused).\nAlthough recently it has been used in DNSSec, the value being set to anything other than 0 should be rare.\nOtherwise if it is set to non 0 and DNSSec is being used, then excluding the legitimate domains is low effort and high reward.\nDetermine if multiple of these files were accessed in a short period of time to further enhance the possibility of seeing if this was a one off or the possibility of larger sensitive file gathering.\nThis Sigma query is designed to accompany the Corelight Threat Hunting Guide, which can be found here: https://www3.corelight.com/corelights-introductory-guide-to-threat-hunting-with-zeek-bro-logs'\n",
            "detection": {
                "condition": "not z_flag_unset and most_probable_valid_domain and not (exclude_tlds or exclude_query_types or exclude_responses or exclude_netbios)",
                "exclude_netbios": {
                    "id.resp_p": [
                        137,
                        138,
                        139
                    ]
                },
                "exclude_query_types": {
                    "qtype_name": [
                        "ns",
                        "mx"
                    ]
                },
                "exclude_responses": {
                    "answers|endswith": "\\\\x00"
                },
                "exclude_tlds": {
                    "query|endswith": [
                        ".arpa",
                        ".local",
                        ".ultradns.net",
                        ".twtrdns.net",
                        ".azuredns-prd.info",
                        ".azure-dns.com",
                        ".azuredns-ff.info",
                        ".azuredns-ff.org",
                        ".azuregov-dns.org"
                    ]
                },
                "most_probable_valid_domain": {
                    "query|contains": "."
                },
                "z_flag_unset": {
                    "Z": 0
                }
            },
            "falsepositives": [
                "Internal or legitimate external domains using DNSSec. Verify if these are legitimate DNSSec domains and then exclude them.",
                "If you work in a Public Sector then it may be good to exclude things like endswith \".edu\", \".gov\" and or \".mil\""
            ],
            "id": "ede05abc-2c9e-4624-9944-9ff17fdc0bf5",
            "level": "medium",
            "logsource": {
                "product": "zeek",
                "service": "dns"
            },
            "modified": "2022/11/29",
            "references": [
                "https://twitter.com/neu5ron/status/1346245602502443009",
                "https://tdm.socprime.com/tdm/info/eLbyj4JjI15v#sigma",
                "https://tools.ietf.org/html/rfc2929#section-2.1",
                "https://www.netresec.com/?page=Blog&month=2021-01&post=Finding-Targeted-SUNBURST-Victims-with-pDNS"
            ],
            "status": "test",
            "tags": [
                "attack.t1095",
                "attack.t1571",
                "attack.command_and_control"
            ],
            "title": "Suspicious DNS Z Flag Bit Set"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/03/19",
            "description": "Detects programs that connect to uncommon destination ports",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_local_ranges": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "10.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "::1/128",
                        "fe80::/10",
                        "fc00::/7"
                    ]
                },
                "filter_optional_sys_directories": {
                    "Image|startswith": [
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "selection": {
                    "DestinationPort": [
                        8080,
                        8888
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "6d8c3d20-a5e1-494f-8412-4571d716cf5c",
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/12",
            "references": [
                "https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo"
            ],
            "related": [
                {
                    "id": "4b89abaa-99fe-4232-afdd-8f9aa4d20382",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.command_and_control",
                "attack.t1571"
            ],
            "title": "Communication To Uncommon Destination Ports"
        },
        {
            "id": "4b89abaa-99fe-4232-afdd-8f9aa4d20382",
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/03/19",
            "description": "Detects programs that connect to known malware callback ports based on statistical analysis from two different sandbox system databases\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_local_ranges": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "10.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "::1/128",
                        "fe80::/10",
                        "fc00::/7"
                    ]
                },
                "filter_optional_sys_directories": {
                    "Image|startswith": [
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "selection": {
                    "DestinationPort": [
                        100,
                        198,
                        200,
                        243,
                        473,
                        666,
                        700,
                        743,
                        777,
                        1443,
                        1515,
                        1777,
                        1817,
                        1904,
                        1960,
                        2443,
                        2448,
                        3360,
                        3675,
                        3939,
                        4040,
                        4433,
                        4438,
                        4443,
                        4444,
                        4455,
                        5445,
                        5552,
                        5649,
                        6625,
                        7210,
                        7777,
                        8143,
                        8843,
                        9631,
                        9943,
                        10101,
                        12102,
                        12103,
                        12322,
                        13145,
                        13394,
                        13504,
                        13505,
                        13506,
                        13507,
                        14102,
                        14103,
                        14154,
                        49180,
                        65520,
                        65535
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/12",
            "references": [
                "https://docs.google.com/spreadsheets/d/17pSTDNpa0sf6pHeRhusvWG6rThciE8CsXTSlDUAZDyo"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "6d8c3d20-a5e1-494f-8412-4571d716cf5c"
                }
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.command_and_control",
                "attack.t1571"
            ],
            "title": "Potentially Suspicious Malware Callback Communication"
        },
        {
            "author": "frack113",
            "date": "2022/01/23",
            "description": "Adversaries may communicate using a protocol and port paring that are typically not associated.\nFor example, HTTPS over port 8088(Citation: Symantec Elfin Mar 2019) or port 587(Citation: Fortinet Agent Tesla April 2018) as opposed to the traditional port 443.\n",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "ScriptBlockText|contains": [
                        " 443 ",
                        " 80 "
                    ]
                },
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Test-NetConnection",
                        "-ComputerName ",
                        "-port "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administrative script"
            ],
            "id": "adf876b3-f1f8-4aa9-a4e4-a64106feec06",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1571/T1571.md#atomic-test-1---testing-usage-of-uncommonly-used-port-with-powershell",
                "https://learn.microsoft.com/en-us/powershell/module/nettcpip/test-netconnection?view=windowsserver2022-ps"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1571"
            ],
            "title": "Testing Usage of Uncommonly Used Port"
        },
        {
            "author": "hasselj",
            "date": "2024/05/10",
            "description": "Detects programs that connect to known malware callback ports based on threat intelligence reports.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_local_ranges": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "10.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "::1/128",
                        "fe80::/10",
                        "fc00::/7"
                    ]
                },
                "selection": {
                    "DestinationPort": [
                        888,
                        999,
                        2200,
                        2222,
                        4000,
                        4444,
                        6789,
                        8531,
                        50501,
                        51820
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "dbfc7c98-04ab-4ab7-aa94-c74d22aa7376",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "linux"
            },
            "references": [
                "https://www.mandiant.com/resources/blog/triton-actor-ttp-profile-custom-attack-tools-detections",
                "https://www.mandiant.com/resources/blog/ukraine-and-sandworm-team",
                "https://www.elastic.co/guide/en/security/current/potential-non-standard-port-ssh-connection.html",
                "https://thehackernews.com/2024/01/systembc-malwares-c2-server-analysis.html",
                "https://www.cybereason.com/blog/sliver-c2-leveraged-by-many-threat-actors"
            ],
            "related": [
                {
                    "id": "4b89abaa-99fe-4232-afdd-8f9aa4d20382",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "title": "Potentially Suspicious Malware Callback Communication - Linux",
            "tags": [
                "attack.persistence",
                "attack.command_and_control",
                "attack.t1571"
            ]
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "command-and-control"
        }
    ],
    "x_mitre_detection": "Analyze packet contents to detect communications that do not follow the expected protocol behavior for the port that is being used. Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious.(Citation: University of Birmingham C2)",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.1",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Network Traffic: Network Traffic Flow",
        "Network Traffic: Network Traffic Content"
    ],
    "x_mitre_permissions_required": []
}