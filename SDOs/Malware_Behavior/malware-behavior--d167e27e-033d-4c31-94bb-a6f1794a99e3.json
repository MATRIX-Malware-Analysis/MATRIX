{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--d167e27e-033d-4c31-94bb-a6f1794a99e3",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.666996Z",
    "name": "Pre-OS Boot: System Firmware",
    "description": "Adversaries may modify system firmware to persist on systems.The BIOS (Basic Input/Output System) and The Unified Extensible Firmware Interface (UEFI) or Extensible Firmware Interface (EFI) are examples of system firmware that operate as the software interface between the operating system and hardware of a computer.[1][2][3]System firmware like BIOS and (U)EFI underly the functionality of a computer and may be modified by an adversary to perform or assist in malicious activity. Capabilities exist to overwrite the system firmware, which may give sophisticated adversaries a means to install malicious firmware updates as a means of persistence on a system that may be difficult to detect.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1542/001",
            "external_id": "T1542/001"
        },
        {
            "source_name": "CAPEC 532",
            "external_id": "malware-behavior--953d1a06-50dd-496d-a9a0-18b77da14ec1"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "ntoskrn.ExSetFirmwareEnvironmentVariable"
                            },
                            {
                                "api": "kernel32.SetFirmwareEnvironmentVariable"
                            },
                            {
                                "api": "kernel32.SetFirmwareEnvironmentVariableEx"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Pre-OS Boot::System Firmware [T1542.001]"
                    ],
                    "authors": [
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "b761e060c7114448d6a5fe276d4ca882c4bd702c12c4d73f6ad79b8dfac33448:0x1400013DA"
                    ],
                    "name": "set UEFI variable",
                    "namespace": "host-interaction/bootloader",
                    "references": [
                        "https://learn.microsoft.com/en-us/windows/win32/sysinfo/access-uefi-firmware-variables-from-a-universal-windows-app"
                    ],
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "ntdll.NtEnumerateSystemEnvironmentValuesEx"
                            },
                            {
                                "api": "ntdll.NtQuerySystemEnvironmentValueEx"
                            },
                            {
                                "api": "ntdll.NtQuerySystemEnvironmentValue"
                            },
                            {
                                "api": "kernel32.GetFirmwareEnvironmentVariable"
                            },
                            {
                                "api": "kernel32.GetFirmwareEnvironmentVariableEx"
                            },
                            {
                                "api": "ntoskrnl.ExGetFirmwareEnvironmentVariable"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Pre-OS Boot::System Firmware [T1542.001]"
                    ],
                    "authors": [
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "b761e060c7114448d6a5fe276d4ca882c4bd702c12c4d73f6ad79b8dfac33448:0x14000138F"
                    ],
                    "name": "get UEFI variable",
                    "namespace": "host-interaction/bootloader",
                    "references": [
                        "https://learn.microsoft.com/en-us/windows/win32/sysinfo/access-uefi-firmware-variables-from-a-universal-windows-app"
                    ],
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/07/18",
            "description": "Detects creation of a file named \"wpbbin\" in the \"%systemroot%\\system32\\\" directory. Which could be indicative of UEFI based persistence method",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename": "C:\\Windows\\System32\\wpbbin.exe"
                }
            },
            "falsepositives": [
                "Legitimate usage of the file by hardware manufacturer such as lenovo (Thanks @0gtweet for the tip)"
            ],
            "id": "e94b9ddc-eec5-4bb8-8a58-b9dc5f4e185f",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://grzegorztworek.medium.com/using-uefi-to-inject-executable-files-into-bitlocker-protected-drives-8ff4ca59c94c",
                "https://persistence-info.github.io/Data/wpbbin.html"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.defense_evasion",
                "attack.t1542.001"
            ],
            "title": "UEFI Persistence Via Wpbbin - FileCreation"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/07/18",
            "description": "Detects execution of the binary \"wpbbin\" which is used as part of the UEFI based persistence method described in the reference section",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image": "C:\\Windows\\System32\\wpbbin.exe"
                }
            },
            "falsepositives": [
                "Legitimate usage of the file by hardware manufacturer such as lenovo (Thanks @0gtweet for the tip)"
            ],
            "id": "4abc0ec4-db5a-412f-9632-26659cddf145",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://grzegorztworek.medium.com/using-uefi-to-inject-executable-files-into-bitlocker-protected-drives-8ff4ca59c94c",
                "https://persistence-info.github.io/Data/wpbbin.html"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.defense_evasion",
                "attack.t1542.001"
            ],
            "title": "UEFI Persistence Via Wpbbin - ProcessCreation"
        }
    ]
}