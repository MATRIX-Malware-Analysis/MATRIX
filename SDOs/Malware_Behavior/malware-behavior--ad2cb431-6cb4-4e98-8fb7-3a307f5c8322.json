{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--ad2cb431-6cb4-4e98-8fb7-3a307f5c8322",
    "created": "2024-08-13T14:46:37.054232Z",
    "modified": "2024-08-13T14:46:45.715221Z",
    "name": "OS Credential Dumping: DCSync",
    "description": "Adversaries may attempt to access credentials and other sensitive information by abusing a Windows Domain Controller's application programming interface (API)[1] [2] [3] [4] to simulate the replication process from a remote domain controller using a technique called DCSync.Members of the Administrators, Domain Admins, and Enterprise Admin groups or computer accounts on the domain controller are able to run DCSync to pull password data[5] from Active Directory, which may include current and historical hashes of potentially useful accounts such as KRBTGT and Administrators. The hashes can then in turn be used to create a Golden Ticket for use in Pass the Ticket[6] or change an account's password as noted in Account Manipulation.[7]DCSync functionality has been included in the 'lsadump' module in Mimikatz.[8] Lsadump also includes NetSync, which performs DCSync over a legacy replication protocol.[9]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1003/006",
            "external_id": "T1003/006"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton",
            "date": "2019/10/22",
            "description": "Detection well-known mimikatz command line arguments",
            "detection": {
                "condition": "1 of selection_*",
                "selection_function_names": {
                    "CommandLine|contains": [
                        "::aadcookie",
                        "::detours",
                        "::memssp",
                        "::mflt",
                        "::ncroutemon",
                        "::ngcsign",
                        "::printnightmare",
                        "::skeleton",
                        "::preshutdown",
                        "::mstsc",
                        "::multirdp"
                    ]
                },
                "selection_module_names": {
                    "CommandLine|contains": [
                        "rpc::",
                        "token::",
                        "crypto::",
                        "dpapi::",
                        "sekurlsa::",
                        "kerberos::",
                        "lsadump::",
                        "privilege::",
                        "process::",
                        "vault::"
                    ]
                },
                "selection_tools_name": {
                    "CommandLine|contains": [
                        "DumpCreds",
                        "mimikatz"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "a642964e-bead-4bed-8910-1bb4d63e3b4d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://tools.thehacker.recipes/mimikatz/modules"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006"
            ],
            "title": "HackTool - Mimikatz Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems), David ANDRE (additional keywords)",
            "date": "2017/01/10",
            "description": "This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)",
            "detection": {
                "condition": "keywords and not filter",
                "filter": {
                    "EventID": 15
                },
                "keywords": [
                    "dpapi::masterkey",
                    "eo.oe.kiwi",
                    "event::clear",
                    "event::drop",
                    "gentilkiwi.com",
                    "kerberos::golden",
                    "kerberos::ptc",
                    "kerberos::ptt",
                    "kerberos::tgt",
                    "Kiwi Legit Printer",
                    "lsadump::",
                    "mimidrv.sys",
                    "\\mimilib.dll",
                    "misc::printnightmare",
                    "misc::shadowcopies",
                    "misc::skeleton",
                    "privilege::backup",
                    "privilege::debug",
                    "privilege::driver",
                    "sekurlsa::"
                ]
            },
            "falsepositives": [
                "Naughty administrators",
                "AV Signature updates",
                "Files with Mimikatz in their filename"
            ],
            "id": "06d71506-7beb-4f22-8888-e2e5e2ca7fd8",
            "level": "high",
            "logsource": {
                "product": "windows"
            },
            "modified": "2022/01/05",
            "references": [
                "https://tools.thehacker.recipes/mimikatz/modules"
            ],
            "status": "test",
            "tags": [
                "attack.s0002",
                "attack.lateral_movement",
                "attack.credential_access",
                "car.2013-07-001",
                "car.2019-04-004",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.001",
                "attack.t1003.006"
            ],
            "title": "Mimikatz Use"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2017/03/05",
            "description": "Detects well-known credential dumping tools execution via service execution events",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 7045,
                    "ImagePath|contains": [
                        "cachedump",
                        "dumpsvc",
                        "fgexec",
                        "gsecdump",
                        "mimidrv",
                        "pwdump",
                        "servpw"
                    ],
                    "Provider_Name": "Service Control Manager"
                }
            },
            "falsepositives": [
                "Legitimate Administrator using credential dumping tool for password recovery"
            ],
            "id": "4976aa50-8f41-45c6-8b15-ab3fc10e79ed",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2022/11/29",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006",
                "attack.t1569.002",
                "attack.s0005"
            ],
            "title": "Credential Dumping Tools Service Execution - System"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g",
            "date": "2019/07/26",
            "description": "Detects potential abuse of Active Directory Replication Service (ADRS) from a non machine account to request credentials.",
            "detection": {
                "condition": "selection and not filter",
                "filter": [
                    {
                        "SubjectUserName|endswith": "$"
                    },
                    {
                        "SubjectUserName|startswith": "MSOL_"
                    }
                ],
                "selection": {
                    "AccessMask": "0x100",
                    "EventID": 4662,
                    "Properties|contains": [
                        "1131f6aa-9c07-11d1-f79f-00c04fc2dcd2",
                        "1131f6ad-9c07-11d1-f79f-00c04fc2dcd2",
                        "89e95b76-444d-4c62-991a-0facbeda640c"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ComputerName",
                "SubjectDomainName",
                "SubjectUserName"
            ],
            "id": "17d619c1-e020-4347-957e-1d1207455c93",
            "level": "critical",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/27",
            "status": "test",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/180815-ADObjectAccessReplication/notebook.html",
                "https://threathunterplaybook.com/library/windows/active_directory_replication.html",
                "https://threathunterplaybook.com/hunts/windows/190101-ADModDirectoryReplication/notebook.html"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.006"
            ],
            "title": "Active Directory Replication from Non Machine Account"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2017/03/05",
            "description": "Detects well-known credential dumping tools execution via service execution events",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4697,
                    "ServiceFileName|contains": [
                        "cachedump",
                        "dumpsvc",
                        "fgexec",
                        "gsecdump",
                        "mimidrv",
                        "pwdump",
                        "servpw"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate Administrator using credential dumping tool for password recovery"
            ],
            "id": "f0d1feba-4344-4ca9-8121-a6c97bd6df52",
            "level": "high",
            "logsource": {
                "definition": "The 'System Security Extension' audit subcategory need to be enabled to log the EID 4697",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/11/29",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "4976aa50-8f41-45c6-8b15-ab3fc10e79ed"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006",
                "attack.t1569.002",
                "attack.s0005"
            ],
            "title": "Credential Dumping Tools Service Execution - Security"
        },
        {
            "author": "Benjamin Delpy, Florian Roth (Nextron Systems), Scott Dermott, Sorina Ionescu",
            "date": "2018/06/03",
            "description": "Detects Mimikatz DC sync security events",
            "detection": {
                "condition": "selection and not 1 of filter*",
                "filter1": {
                    "SubjectDomainName": "Window Manager"
                },
                "filter2": {
                    "SubjectUserName|startswith": [
                        "NT AUT",
                        "MSOL_"
                    ]
                },
                "filter3": {
                    "SubjectUserName|endswith": "$"
                },
                "selection": {
                    "AccessMask": "0x100",
                    "EventID": 4662,
                    "Properties|contains": [
                        "Replicating Directory Changes All",
                        "1131f6ad-9c07-11d1-f79f-00c04fc2dcd2",
                        "1131f6aa-9c07-11d1-f79f-00c04fc2dcd2",
                        "9923a32a-3607-11d2-b9be-0000f87a36b2",
                        "89e95b76-444d-4c62-991a-0facbeda640c"
                    ]
                }
            },
            "falsepositives": [
                "Valid DC Sync that is not covered by the filters; please report",
                "Local Domain Admin account used for Azure AD Connect"
            ],
            "id": "611eab06-a145-4dfa-a295-3ccc5c20f59a",
            "level": "high",
            "modified": "2022/04/26",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "references": [
                "https://twitter.com/gentilkiwi/status/1003236624925413376",
                "https://gist.github.com/gentilkiwi/dcc132457408cf11ad2061340dcb53c2",
                "https://blog.blacklanternsecurity.com/p/detecting-dcsync?s=r",
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4662"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.s0002",
                "attack.t1003.006"
            ],
            "title": "Mimikatz DC Sync"
        },
        {
            "author": "frack113",
            "date": "2022/02/06",
            "description": "The DSInternals PowerShell Module exposes several internal features of Active Directory and Azure Active Directory.\nThese include FIDO2 and NGC key auditing, offline ntds.dit file manipulation, password auditing, DC recovery from IFM backups and password hash calculation.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Get-ADReplAccount",
                        "-All ",
                        "-Server "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate PowerShell scripts"
            ],
            "id": "060c3ef1-fd0a-4091-bf46-e7d625f60b73",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://www.powershellgallery.com/packages/DSInternals",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.006/T1003.006.md#atomic-test-2---run-dsinternals-get-adreplaccount"
            ],
            "status": "test",
            "title": "Suspicious Get-ADReplAccount",
            "tags": [
                "attack.credential_access",
                "attack.t1003.006"
            ]
        }
    ]
}