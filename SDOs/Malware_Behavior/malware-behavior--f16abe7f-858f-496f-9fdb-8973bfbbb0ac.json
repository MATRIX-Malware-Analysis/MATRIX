{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--f16abe7f-858f-496f-9fdb-8973bfbbb0ac",
    "created": "2024-08-13T14:46:37.108388Z",
    "modified": "2024-08-13T14:46:46.059813Z",
    "name": "Hide Artifacts: Hidden Users",
    "description": "Adversaries may use hidden users to hide the presence of user accounts they create or modify. Administrators may want to hide users when there are many user accounts on a given system or if they want to hide their administrative or other management accounts from other users. In macOS, adversaries can create or modify a user to be hidden through manipulating plist files, folder attributes, and user attributes. To prevent a user from being shown on the login screen and in System Preferences, adversaries can set the userID to be under 500 and set the key value Hide500Users to TRUE in the /Library/Preferences/com.apple.loginwindow plist file.[1] Every user has a userID associated with it. When the Hide500Users key value is set to TRUE, users with a userID under 500 do not appear on the login screen and in System Preferences. Using the command line, adversaries can use the dscl utility to create hidden user accounts by setting the IsHidden attribute to 1. Adversaries can also hide a user\u2019s home folder by changing the chflags to hidden.[2] Adversaries may similarly hide user accounts in Windows. Adversaries can set the HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList Registry key value to 0 for a specific user to prevent that user from being listed on the logon screen.[3][4]On Linux systems, adversaries may hide user accounts from the login screen, also referred to as the greeter. The method an adversary may use depends on which Display Manager the distribution is currently using. For example, on an Ubuntu system using the GNOME Display Manger (GDM), accounts may be hidden from the greeter using the gsettings command (ex: sudo -u gdm gsettings set org.gnome.login-screen disable-user-list true).[5] Display Managers are not anchored to specific distributions and may be changed by a user or adversary.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1564/002",
            "external_id": "T1564/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2020/10/10",
            "description": "Detects creation of a hidden user account on macOS (UserID < 500) or with IsHidden option",
            "detection": {
                "condition": "dscl_create and id_below_500 or dscl_create and (ishidden_option_declaration and ishidden_option_confirmation)",
                "dscl_create": {
                    "CommandLine|contains": "create",
                    "Image|endswith": "/dscl"
                },
                "id_below_500": {
                    "CommandLine|contains": "UniqueID",
                    "CommandLine|re": "([0-9]|[1-9][0-9]|[1-4][0-9]{2})"
                },
                "ishidden_option_confirmation": {
                    "CommandLine|contains": [
                        "true",
                        "yes",
                        "1"
                    ]
                },
                "ishidden_option_declaration": {
                    "CommandLine|contains": "IsHidden"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "b22a5b36-2431-493a-8be1-0bae56c28ef3",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.002/T1564.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1564.002"
            ],
            "title": "Hidden User Creation"
        },
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/18",
            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
            "detection": {
                "condition": "selection_img and (1 of selection_flags_*)",
                "selection_flags_configure": {
                    "CommandLine|contains|all": [
                        "/configure",
                        "/db"
                    ]
                },
                "selection_flags_discovery": {
                    "CommandLine|contains|all": [
                        "/export",
                        "/cfg"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\secedit.exe"
                    },
                    {
                        "OriginalFileName": "SeCEdit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrative use"
            ],
            "id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1562.002",
                "attack.t1547.001",
                "attack.t1505.005",
                "attack.t1556.002",
                "attack.t1562",
                "attack.t1574.007",
                "attack.t1564.002",
                "attack.t1546.008",
                "attack.t1546.007",
                "attack.t1547.014",
                "attack.t1547.010",
                "attack.t1547.002",
                "attack.t1557",
                "attack.t1082"
            ],
            "title": "Potential Suspicious Activity Using SeCEdit"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2022/07/12",
            "description": "Detects modifications to the registry key \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\Userlist\" where the value is set to \"0\" in order to hide user account from being listed on the logon screen.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "DWORD (0x00000000)",
                    "EventType": "SetValue",
                    "TargetObject|contains": "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\SpecialAccounts\\UserList"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f8aebc67-a56d-4ec9-9fbe-7b0e8b7b4efd",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/01/26",
            "references": [
                "https://thedfirreport.com/2022/07/11/select-xmrig-from-sqlserver/",
                "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1564.002/T1564.002.md"
            ],
            "related": [
                {
                    "id": "8a58209c-7ae6-4027-afb0-307a78e4589a",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1564.002"
            ],
            "title": "Hiding User Account Via SpecialAccounts Registry Key"
        }
    ]
}