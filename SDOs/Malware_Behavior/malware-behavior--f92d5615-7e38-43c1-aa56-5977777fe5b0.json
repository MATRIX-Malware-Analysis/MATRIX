{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--f92d5615-7e38-43c1-aa56-5977777fe5b0",
    "created": "2024-08-13T14:46:36.850044Z",
    "modified": "2024-08-13T14:46:44.551065Z",
    "name": "Cloud Service Discovery",
    "description": "An adversary may attempt to enumerate the cloud services running on a system after gaining access. These methods can differ from platform-as-a-service (PaaS), to infrastructure-as-a-service (IaaS), or software-as-a-service (SaaS). Many services exist throughout the various cloud providers and can include Continuous Integration and Continuous Delivery (CI/CD), Lambda Functions, Azure AD, etc. They may also include security services, such as AWS GuardDuty and Microsoft Defender for Cloud, and logging services, such as AWS CloudTrail and Google Cloud Audit Logs.Adversaries may attempt to discover information about the services enabled throughout the environment. Azure tools and APIs, such as the Azure AD Graph API and Azure Resource Manager API, can enumerate resources and services, including applications, management groups, resources and policy definitions, and their relationships that are accessible by an identity.[1][2]For example, Stormspotter is an open source tool for enumerating and constructing a graph for Azure resources and services, and Pacu is an open source AWS exploitation framework that supports several methods for discovering cloud services.[3][4]Adversaries may use the information gained to shape follow-on behaviors, such as targeting data or credentials from enumerated services or evading identified defenses through Disable or Modify Tools or Disable or Modify Cloud Logs.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1526",
            "external_id": "T1526"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1526",
            "external_id": "T1526"
        },
        {
            "source_name": "Azure AD Graph API",
            "description": "Microsoft. (2016, March 26). Operations overview | Graph API concepts. Retrieved June 18, 2020.",
            "url": "https://docs.microsoft.com/en-us/previous-versions/azure/ad/graph/howto/azure-ad-graph-api-operations-overview"
        },
        {
            "source_name": "Azure - Resource Manager API",
            "description": "Microsoft. (2019, May 20). Azure Resource Manager. Retrieved June 17, 2020.",
            "url": "https://docs.microsoft.com/en-us/rest/api/resources/"
        },
        {
            "source_name": "Azure - Stormspotter",
            "description": "Microsoft. (2020). Azure Stormspotter GitHub. Retrieved June 17, 2020.",
            "url": "https://github.com/Azure/Stormspotter"
        },
        {
            "source_name": "GitHub Pacu",
            "description": "Rhino Security Labs. (2019, August 22). Pacu. Retrieved October 17, 2019.",
            "url": "https://github.com/RhinoSecurityLabs/pacu"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Muhammad Faisal (@faisalusuf)",
            "date": "2023/01/27",
            "description": "A self-hosted runner is a system that you deploy and manage to execute jobs from GitHub Actions on GitHub.com.\nThis rule detects changes to self-hosted runners configurations in the environment. The self-hosted runner configuration changes once detected,\nit should be validated from GitHub UI because the log entry may not provide full context.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "action": [
                        "org.remove_self_hosted_runner",
                        "org.runner_group_created",
                        "org.runner_group_removed",
                        "org.runner_group_runner_removed",
                        "org.runner_group_runners_added",
                        "org.runner_group_runners_updated",
                        "org.runner_group_updated",
                        "repo.register_self_hosted_runner",
                        "repo.remove_self_hosted_runner"
                    ]
                }
            },
            "falsepositives": [
                "Allowed self-hosted runners changes in the environment.",
                "A self-hosted runner is automatically removed from GitHub if it has not connected to GitHub Actions for more than 14 days.",
                "An ephemeral self-hosted runner is automatically removed from GitHub if it has not connected to GitHub Actions for more than 1 day."
            ],
            "id": "f8ed0e8f-7438-4b79-85eb-f358ef2fbebd",
            "level": "low",
            "logsource": {
                "definition": "Requirements: The audit log streaming feature must be enabled to be able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming",
                "product": "github",
                "service": "audit"
            },
            "references": [
                "https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners#about-self-hosted-runners",
                "https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization#search-based-on-operation"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.discovery",
                "attack.collection",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.initial_access",
                "attack.t1526",
                "attack.t1213.003",
                "attack.t1078.004"
            ],
            "title": "Github Self Hosted Runner Changes Detected"
        },
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/27",
            "description": "Detects AzureHound (A BloodHound data collector for Microsoft Azure) activity via the default User-Agent that is used during its operation after successful authentication.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ResultType": 0,
                    "userAgent|contains": "azurehound"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "35b781cc-1a08-4a5a-80af-42fd7c315c6b",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://github.com/BloodHoundAD/AzureHound"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1087.004",
                "attack.t1526"
            ],
            "title": "Discovery Using AzureHound"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/18",
            "description": "Detects the execution of the PUA/Recon tool Seatbelt via PE information of command line parameters",
            "detection": {
                "condition": "selection_img or all of selection_group_*",
                "selection_group_list": {
                    "CommandLine|contains": [
                        " -group=misc",
                        " -group=remote",
                        " -group=chromium",
                        " -group=slack",
                        " -group=system",
                        " -group=user",
                        " -group=all"
                    ]
                },
                "selection_group_output": {
                    "CommandLine|contains": " -outputfile="
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\Seatbelt.exe"
                    },
                    {
                        "OriginalFileName": "Seatbelt.exe"
                    },
                    {
                        "Description": "Seatbelt"
                    },
                    {
                        "CommandLine|contains": [
                            " DpapiMasterKeys",
                            " InterestingProcesses",
                            " InterestingFiles",
                            " CertificateThumbprints",
                            " ChromiumBookmarks",
                            " ChromiumHistory",
                            " ChromiumPresence",
                            " CloudCredentials",
                            " CredEnum",
                            " CredGuard",
                            " FirefoxHistory",
                            " ProcessCreationEvents"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "38646daa-e78f-4ace-9de0-55547b2d30da",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "status": "test",
            "references": [
                "https://github.com/GhostPack/Seatbelt",
                "https://www.bluetangle.dev/2022/08/fastening-seatbelt-on-threat-hunting.html"
            ],
            "tags": [
                "attack.discovery",
                "attack.t1526",
                "attack.t1087",
                "attack.t1083"
            ],
            "title": "PUA - Seatbelt Execution"
        }
    ],
    "x_mitre_platforms": [
        "Azure AD",
        "Office 365",
        "SaaS",
        "IaaS",
        "Google Workspace"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Suzy Schapperle - Microsoft Azure Red Team",
        "Praetorian",
        "Thanabodi Phrakhun, I-SECURE"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "discovery"
        }
    ],
    "x_mitre_detection": "Cloud service discovery techniques will likely occur throughout an operation where an adversary is targeting cloud-based systems and services. Data and events should not be viewed in isolation, but as part of a chain of behavior that could lead to other activities based on the information obtained.\n\nNormal, benign system and network events that look like cloud service discovery may be uncommon, depending on the environment and how they are used. Monitor cloud service usage for anomalous behavior that may indicate adversarial presence within the environment.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.3",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Cloud Service: Cloud Service Enumeration"
    ],
    "x_mitre_permissions_required": []
}