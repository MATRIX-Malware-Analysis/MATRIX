{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--ea0fe817-2ba9-4752-84da-abf8b4edb3e3",
    "created": "2024-08-13T14:46:37.174886Z",
    "modified": "2024-08-13T14:46:46.471198Z",
    "name": "Server Software Component: SQL Stored Procedures",
    "description": "Adversaries may abuse SQL stored procedures to establish persistent access to systems. SQL Stored Procedures are code that can be saved and reused so that database users do not waste time rewriting frequently used SQL queries. Stored procedures can be invoked via SQL statements to the database using the procedure name or via defined events (e.g. when a SQL server application is started/restarted).Adversaries may craft malicious stored procedures that can provide a persistence mechanism in SQL database servers.[1][2] To execute operating system commands through SQL syntax the adversary may have to enable additional functionality, such as xp_cmdshell for MSSQL Server.[1][2][3] Microsoft SQL Server can enable common language runtime (CLR) integration. With CLR integration enabled, application developers can write stored procedures using any .NET framework language (e.g. VB .NET, C#, etc.).[4] Adversaries may craft or modify CLR assemblies that are linked to stored procedures since these CLR assemblies can be made to execute arbitrary commands.[5]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1505/001",
            "external_id": "T1505/001"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "@juju4",
            "date": "2022/12/27",
            "description": "Detects suspicious SQL query keywrods that are often used during recon, exfiltration or destructive activities. Such as dropping tables and selecting wildcard fields",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "drop",
                    "truncate",
                    "dump",
                    "select \\*"
                ]
            },
            "falsepositives": [
                "Inventory and monitoring activity",
                "Vulnerability scanners",
                "Legitimate applications"
            ],
            "id": "d84c0ded-edd7-4123-80ed-348bb3ccc4d5",
            "level": "medium",
            "logsource": {
                "category": "database",
                "definition": "Requirements: Must be able to log the SQL queries"
            },
            "references": [
                "https://github.com/sqlmapproject/sqlmap"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.initial_access",
                "attack.privilege_escalation",
                "attack.t1190",
                "attack.t1505.001"
            ],
            "title": "Suspicious SQL Query"
        }
    ]
}