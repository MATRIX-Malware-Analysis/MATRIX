{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--c87df954-6cb6-44ee-ad1f-d76336d371fc",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.846459Z",
    "name": "Escape to Host",
    "description": "Adversaries may break out of a container to gain access to the underlying host. This can allow an adversary access to other containerized resources from the host level or to the host itself. In principle, containerized resources should provide a clear separation of application functionality and be isolated from the host environment.[1]There are multiple ways an adversary may escape to a host environment. Examples include creating a container configured to mount the host\u2019s filesystem using the bind parameter, which allows the adversary to drop payloads and execute control utilities such as cron on the host; utilizing a privileged container to run commands or load a malicious kernel module on the underlying host; or abusing system calls such as unshare and keyctl to escalate privileges and steal secrets.[2][3][4][5][6][7]Additionally, an adversary may be able to exploit a compromised container with a mounted container management socket, such as docker.sock, to break out of the container via a Container Administration Command.[5] Adversaries may also escape via Exploitation for Privilege Escalation, such as exploiting vulnerabilities in global symbolic links in order to access the root directory of a host machine.[8]Gaining access to the host may provide the adversary with the opportunity to achieve follow-on objectives, such as establishing persistence, moving laterally within the environment, accessing other containers running on the host, or setting up a command and control channel on the host.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1611",
            "external_id": "T1611"
        },
        {
            "source_name": "CAPEC 480",
            "external_id": "malware-behavior--ded3af5b-ed57-4468-b548-e14064ca98ac"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1611",
            "external_id": "T1611"
        },
        {
            "source_name": "Container Escape",
            "description": "0xn3va. (n.d.). Escaping. Retrieved May 27, 2022.",
            "url": "https://0xn3va.gitbook.io/cheat-sheets/container/escaping"
        },
        {
            "source_name": "Windows Server Containers Are Open",
            "description": "Daniel Prizmant. (2020, July 15). Windows Server Containers Are Open, and Here's How You Can Break Out. Retrieved October 1, 2021.",
            "url": "https://unit42.paloaltonetworks.com/windows-server-containers-vulnerabilities/"
        },
        {
            "source_name": "Docker Overview",
            "description": "Docker. (n.d.). Docker Overview. Retrieved March 30, 2021.",
            "url": "https://docs.docker.com/get-started/overview/"
        },
        {
            "source_name": "Docker Bind Mounts",
            "description": "Docker. (n.d.). Use Bind Mounts. Retrieved March 30, 2021.",
            "url": "https://docs.docker.com/storage/bind-mounts/"
        },
        {
            "source_name": "Trend Micro Privileged Container",
            "description": "Fiser, D., Oliveira, A.. (2019, December 20). Why a Privileged Container in Docker is a Bad Idea. Retrieved March 30, 2021.",
            "url": "https://www.trendmicro.com/en_us/research/19/l/why-running-a-privileged-container-in-docker-is-a-bad-idea.html"
        },
        {
            "source_name": "Intezer Doki July 20",
            "description": "Fishbein, N., Kajiloti, M.. (2020, July 28). Watch Your Containers: Doki Infecting Docker Servers in the Cloud. Retrieved March 30, 2021.",
            "url": "https://www.intezer.com/blog/cloud-security/watch-your-containers-doki-infecting-docker-servers-in-the-cloud/"
        },
        {
            "source_name": "Crowdstrike Kubernetes Container Escape",
            "description": "Manoj Ahuje. (2022, January 31). CVE-2022-0185: Kubernetes Container Escape Using Linux Kernel Exploit. Retrieved July 6, 2022.",
            "url": "https://www.crowdstrike.com/blog/cve-2022-0185-kubernetes-container-escape-using-linux-kernel-exploit/"
        },
        {
            "source_name": "Keyctl-unmask",
            "description": "Mark Manning. (2020, July 23). Keyctl-unmask: \"Going Florida\" on The State Of Containerizing Linux Keyrings. Retrieved July 6, 2022.",
            "url": "https://www.antitree.com/2020/07/keyctl-unmask-going-florida-on-the-state-of-containerizing-linux-keyrings/"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects the creation of a \"privileged\" container, an action which could be indicative of a threat actor mounting a container breakout attacks.\nA privileged container is a container that can access the host with all of the root capabilities of the host machine. This allows it to view, interact and modify processes, network operations, IPC calls, the file system, mount points, SELinux configurations etc. as the root user on the host.\nVarious versions of \"privileged\" containers can be specified, e.g. by setting the securityContext.privileged flag in the resource specification, setting non-standard Linux capabilities, or configuring the hostNetwork/hostPID fields\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "capabilities": "*",
                    "objectRef.resource": "pods",
                    "verb": "create"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c5cd1b20-36bb-488d-8c05-486be3d0cb97",
            "level": "low",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://microsoft.github.io/Threat-Matrix-for-Kubernetes/techniques/Privileged%20container/",
                "https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-kubernetes.html#privilegeescalation-kubernetes-privilegedcontainer",
                "https://www.elastic.co/guide/en/security/current/kubernetes-pod-created-with-hostnetwork.html",
                "https://www.elastic.co/guide/en/security/current/kubernetes-container-created-with-excessive-linux-capabilities.html"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1611"
            ],
            "title": "Privileged Container Deployed"
        },
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects creation of a container with a hostPath mount.\nA hostPath volume mounts a directory or a file from the node to the container.\nAttackers who have permissions to create a new pod in the cluster may create one with a writable hostPath volume and chroot to escape to the underlying node.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "hostPath": "*",
                    "objectRef.resource": "pods",
                    "verb": "create"
                }
            },
            "falsepositives": [
                "The DaemonSet controller creates pods with hostPath volumes within the kube-system namespace."
            ],
            "id": "402b955c-8fe0-4a8c-b635-622b4ac5f902",
            "level": "low",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://microsoft.github.io/Threat-Matrix-for-Kubernetes/techniques/Writable%20hostPath%20mount/",
                "https://blog.appsecco.com/kubernetes-namespace-breakout-using-insecure-host-path-volume-part-1-b382f2a6e216"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1611"
            ],
            "title": "Container With A hostPath Mount Created"
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "Linux",
        "Containers"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Yuval Avrahami, Palo Alto Networks",
        "Daniel Prizmant, Palo Alto Networks",
        "Alfredo Oliveira, Trend Micro",
        "David Fiser, @anu4is, Trend Micro",
        "Idan Frimark, Cisco",
        "Magno Logan, @magnologan, Trend Micro",
        "Ariel Shuper, Cisco",
        "Yossi Weizman, Azure Defender Research Team",
        "Vishwas Manral, McAfee",
        "CrowdStrike",
        "Eran Ayalon, Cybereason",
        "Oren Ofer, Cybereason",
        "Ilan Sokol, Cybereason",
        "Joas Antonio dos Santos, @C0d3Cr4zy"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "privilege-escalation"
        }
    ],
    "x_mitre_detection": "Monitor for the deployment of suspicious or unknown container images and pods in your environment, particularly containers running as root. Additionally, monitor for unexpected usage of syscalls such as <code>mount</code> (as well as resulting process activity) that may indicate an attempt to escape from a privileged container to host. In Kubernetes, monitor for cluster-level events associated with changing containers' volume configurations.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.5",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Process: Process Creation",
        "Kernel: Kernel Module Load",
        "Container: Container Creation",
        "Volume: Volume Modification",
        "Process: OS API Execution"
    ],
    "x_mitre_permissions_required": [
        "Administrator",
        "User",
        "root"
    ]
}