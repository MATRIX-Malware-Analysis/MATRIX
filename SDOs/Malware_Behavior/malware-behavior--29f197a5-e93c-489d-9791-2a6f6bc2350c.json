{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--29f197a5-e93c-489d-9791-2a6f6bc2350c",
    "created": "2024-08-13T14:46:37.094835Z",
    "modified": "2024-08-13T14:46:45.974293Z",
    "name": "Abuse Elevation Control Mechanism: Setuid and Setgid",
    "description": "An adversary may abuse configurations where an application has the setuid or setgid bits set in order to get code running in a different (and possibly more privileged) user\u2019s context. On Linux or macOS, when the setuid or setgid bits are set for an application binary, the application will run with the privileges of the owning user or group respectively.[1] Normally an application is run in the current user\u2019s context, regardless of which user or group owns the application. However, there are instances where programs need to be executed in an elevated context to function properly, but the user running them may not have the specific required privileges.Instead of creating an entry in the sudoers file, which must be done by root, any user can specify the setuid or setgid flag to be set for their own applications (i.e. Linux and Mac File and Directory Permissions Modification). The chmod command can set these bits with bitmasking, chmod 4777 [file] or via shorthand naming, chmod u+s [file]. This will enable the setuid bit. To enable the setgid bit, chmod 2775 and chmod g+s can be used.Adversaries can use this mechanism on their own malware to make sure they're able to execute in elevated contexts in the future.[2] This abuse is often part of a 'shell escape' or other actions to bypass an execution environment with restricted permissions.Alternatively, adversaries may choose to find and target vulnerable binaries with the setuid or setgid bits already enabled (i.e. File and Directory Discovery). The setuid and setguid bits are indicated with an 's' instead of an 'x' when viewing a file's attributes via ls -l. The find command can also be used to search for such files. For example, find / -perm +4000 2>/dev/null can be used to find files with setuid set and find / -perm +2000 2>/dev/null may be used for setgid. Binaries that have these bits set may then be abused by adversaries.[3]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1548/001",
            "external_id": "T1548/001"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "\u00d6mer G\u00fcnal",
            "date": "2020/06/16",
            "description": "Detects suspicious change of file privileges with chown and chmod commands",
            "detection": {
                "condition": "all of selection_*",
                "selection_perm": {
                    "CommandLine|contains": [
                        " chmod u+s",
                        " chmod g+s"
                    ]
                },
                "selection_root": {
                    "CommandLine|contains": "chown root"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "c21c4eaa-ba2e-419a-92b2-8371703cbe21",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/10/05",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1548.001/T1548.001.md",
                "https://attack.mitre.org/techniques/T1548/001/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1548.001"
            ],
            "title": "Setuid and Setgid"
        },
        {
            "author": "Sreeman",
            "date": "2022/01/26",
            "description": "Detects potential PwnKit exploitation CVE-2021-4034 in auth logs",
            "detection": {
                "condition": "keywords",
                "keywords": {
                    "|all": [
                        "pkexec",
                        "The value for environment variable XAUTHORITY contains suscipious content",
                        "[USER=root] [TTY=/dev/pts/0]"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "0506a799-698b-43b4-85a1-ac4c84c720e9",
            "level": "high",
            "logsource": {
                "product": "linux",
                "service": "auth"
            },
            "modified": "2023/01/23",
            "references": [
                "https://twitter.com/wdormann/status/1486161836961579020"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.t1548.001"
            ],
            "title": "PwnKit Local Privilege Escalation"
        }
    ]
}