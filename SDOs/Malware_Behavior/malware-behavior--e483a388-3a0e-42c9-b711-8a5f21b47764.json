{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--e483a388-3a0e-42c9-b711-8a5f21b47764",
    "created": "2024-08-13T14:46:36.901828Z",
    "modified": "2024-08-13T14:46:44.879844Z",
    "name": "User Execution: Malicious File",
    "description": "An adversary may rely upon a user opening a malicious file in order to gain execution. Users may be subjected to social engineering to get them to open a file that will lead to code execution. This user action will typically be observed as follow-on behavior from Spearphishing Attachment. Adversaries may use several types of files that require a user to execute them, including .doc, .pdf, .xls, .rtf, .scr, .exe, .lnk, .pif, and .cpl.Adversaries may employ various forms of Masquerading and Obfuscated Files or Information to increase the likelihood that a user will open and successfully execute a malicious file. These methods may include using a familiar naming convention and/or password protecting the file and supplying instructions to a user on how to open it.[1] While Malicious File frequently occurs shortly after Initial Access it may occur at other phases of an intrusion, such as when an adversary places a file in a shared directory or on a user's desktop hoping that a user will click on it. This activity may also be seen shortly after Internal Spearphishing.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1204/002",
            "external_id": "T1204/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/11/07",
            "description": "Detects download of certain file types from hosts in suspicious TLDs",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri-extension": [
                        "exe",
                        "vbs",
                        "bat",
                        "rar",
                        "ps1",
                        "doc",
                        "docm",
                        "xls",
                        "xlsm",
                        "pptm",
                        "rtf",
                        "hta",
                        "dll",
                        "ws",
                        "wsf",
                        "sct",
                        "zip"
                    ],
                    "cs-host|endswith": [
                        ".country",
                        ".stream",
                        ".gdn",
                        ".mom",
                        ".xin",
                        ".kim",
                        ".men",
                        ".loan",
                        ".download",
                        ".racing",
                        ".online",
                        ".science",
                        ".ren",
                        ".gb",
                        ".win",
                        ".top",
                        ".review",
                        ".vip",
                        ".party",
                        ".tech",
                        ".xyz",
                        ".date",
                        ".faith",
                        ".zip",
                        ".cricket",
                        ".space",
                        ".info",
                        ".vn",
                        ".cm",
                        ".am",
                        ".cc",
                        ".asia",
                        ".ws",
                        ".tk",
                        ".biz",
                        ".su",
                        ".st",
                        ".ro",
                        ".ge",
                        ".ms",
                        ".pk",
                        ".nu",
                        ".me",
                        ".ph",
                        ".to",
                        ".tt",
                        ".name",
                        ".tv",
                        ".kz",
                        ".tc",
                        ".mobi",
                        ".study",
                        ".click",
                        ".link",
                        ".trade",
                        ".accountant",
                        ".cf",
                        ".gq",
                        ".ml",
                        ".ga",
                        ".pw"
                    ]
                }
            },
            "falsepositives": [
                "All kinds of software downloads"
            ],
            "fields": [
                "ClientIP",
                "c-uri"
            ],
            "id": "00d0b5ab-1f55-4120-8e83-487c0a7baf19",
            "level": "low",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/18",
            "references": [
                "https://www.symantec.com/connect/blogs/shady-tld-research-gdn-and-our-2016-wrap",
                "https://promos.mcafee.com/en-US/PDF/MTMW_Report.pdf",
                "https://www.spamhaus.org/statistics/tlds/",
                "https://krebsonsecurity.com/2018/06/bad-men-at-work-please-dont-click/"
            ],
            "related": [
                {
                    "id": "b5de2919-b74a-4805-91a7-5049accbaefe",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.t1566",
                "attack.execution",
                "attack.t1203",
                "attack.t1204.002"
            ],
            "title": "Download From Suspicious TLD - Blacklist"
        },
        {
            "id": "b5de2919-b74a-4805-91a7-5049accbaefe",
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/03/13",
            "description": "Detects executable downloads from suspicious remote systems",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "cs-host|endswith": [
                        ".com",
                        ".org",
                        ".net",
                        ".edu",
                        ".gov",
                        ".uk",
                        ".ca",
                        ".de",
                        ".jp",
                        ".fr",
                        ".au",
                        ".us",
                        ".ch",
                        ".it",
                        ".nl",
                        ".se",
                        ".no",
                        ".es"
                    ]
                },
                "selection": {
                    "c-uri-extension": [
                        "exe",
                        "vbs",
                        "bat",
                        "rar",
                        "ps1",
                        "doc",
                        "docm",
                        "xls",
                        "xlsm",
                        "pptm",
                        "rtf",
                        "hta",
                        "dll",
                        "ws",
                        "wsf",
                        "sct",
                        "zip"
                    ]
                }
            },
            "falsepositives": [
                "All kind of software downloads"
            ],
            "fields": [
                "ClientIP",
                "c-uri"
            ],
            "level": "low",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/18",
            "references": [
                "Internal Research"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "00d0b5ab-1f55-4120-8e83-487c0a7baf19"
                }
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.t1566",
                "attack.execution",
                "attack.t1203",
                "attack.t1204.002"
            ],
            "title": "Download From Suspicious TLD - Whitelist"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/10/25",
            "description": "Detects a flashplayer update from an unofficial location",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "cs-host|endswith": ".adobe.com"
                },
                "selection": [
                    {
                        "c-uri|contains": "/flash_install.php"
                    },
                    {
                        "c-uri|endswith": "/install_flash_player.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown flash download locations"
            ],
            "id": "4922a5dd-6743-4fc2-8e81-144374280997",
            "level": "high",
            "modified": "2022/08/08",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://gist.github.com/roycewilliams/a723aaf8a6ac3ba4f817847610935cfb"
            ],
            "tags": [
                "attack.initial_access",
                "attack.t1189",
                "attack.execution",
                "attack.t1204.002",
                "attack.defense_evasion",
                "attack.t1036.005"
            ],
            "title": "Flash Player Update from Suspicious Location",
            "status": "test"
        },
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/01/31",
            "description": "Detects suspicious child processes spawning from microsoft office suite applications such as word or excel. This could indicates malicious macro execution",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "/bash",
                        "/curl",
                        "/dash",
                        "/fish",
                        "/osacompile",
                        "/osascript",
                        "/sh",
                        "/zsh",
                        "/python",
                        "/python3",
                        "/wget"
                    ],
                    "ParentImage|contains": [
                        "Microsoft Word",
                        "Microsoft Excel",
                        "Microsoft PowerPoint",
                        "Microsoft OneNote"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "69483748-1525-4a6c-95ca-90dc8d431b68",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2023/02/04",
            "references": [
                "https://redcanary.com/blog/applescript/",
                "https://objective-see.org/blog/blog_0x4B.html"
            ],
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1059.002",
                "attack.t1137.002",
                "attack.t1204.002"
            ],
            "title": "Suspicious Microsoft Office Child Process - MacOS",
            "status": "test"
        },
        {
            "author": "Christian Burkard (Nextron Systems)",
            "date": "2021/08/09",
            "description": "Detects the process injection of a LittleCorporal generated Maldoc.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CallTrace|contains|all": [
                        ":\\Windows\\Microsoft.NET\\Framework64\\v2.",
                        "UNKNOWN"
                    ],
                    "SourceImage|endswith": "\\winword.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "7bdde3bf-2a42-4c39-aa31-a92b3e17afac",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/28",
            "references": [
                "https://github.com/connormcgarr/LittleCorporal"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002",
                "attack.t1055.003"
            ],
            "title": "HackTool - LittleCorporal Generated Maldoc Injection",
            "status": "test"
        },
        {
            "author": "Antonlovesdnb",
            "date": "2020/02/19",
            "description": "Detects any GAC DLL being loaded by an Office Product",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|startswith": "C:\\Windows\\Microsoft.NET\\assembly\\GAC_MSIL",
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\mspub.exe",
                        "\\onenote.exe",
                        "\\onenoteim.exe",
                        "\\outlook.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate macro usage. Add the appropriate filter according to your environment"
            ],
            "id": "90217a70-13fc-48e4-b3db-0d836c5824ac",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/02/10",
            "references": [
                "https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "GAC DLL Loaded Via Office Applications",
            "status": "test"
        },
        {
            "author": "Antonlovesdnb",
            "date": "2020/02/19",
            "description": "Detects any assembly DLL being loaded by an Office Product",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|startswith": "C:\\Windows\\assembly\\",
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\mspub.exe",
                        "\\onenote.exe",
                        "\\onenoteim.exe",
                        "\\outlook.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ff0f2b05-09db-4095-b96d-1b75ca24894a",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/03/29",
            "references": [
                "https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "DotNET Assembly DLL Loaded Via Office Application",
            "status": "test"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/09/18",
            "description": "Detects a remote DLL load event via \"rundll32.exe\".",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|startswith": "\\\\\\\\",
                    "Image|endswith": "\\rundll32.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f40017b3-cb2e-4335-ab5d-3babf679c1de",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "references": [
                "https://github.com/gabe-k/themebleed",
                "Internal Research"
            ],
            "status": "experimental",
            "title": "Remote DLL Load Via Rundll32.EXE",
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/12",
            "description": "Detects Microsoft Excel loading an Add-In (.xll) file from an uncommon location",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|contains": [
                        "\\Desktop\\",
                        "\\Downloads\\",
                        "\\Perflogs\\",
                        "\\Temp\\",
                        "\\Users\\Public\\",
                        "\\Windows\\Tasks\\"
                    ],
                    "ImageLoaded|endswith": ".xll",
                    "Image|endswith": "\\excel.exe"
                }
            },
            "falsepositives": [
                "Some tuning might be required to allow or remove certain locations used by the rule if you consider them as safe locations"
            ],
            "id": "af4c4609-5755-42fe-8075-4effb49f5d44",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "references": [
                "https://www.mandiant.com/resources/blog/lnk-between-browsers",
                "https://wazuh.com/blog/detecting-xll-files-used-for-dropping-fin7-jssloader-with-wazuh/"
            ],
            "related": [
                {
                    "id": "c5f4b5cb-4c25-4249-ba91-aa03626e3185",
                    "type": "derived"
                }
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "Microsoft Excel Add-In Loaded From Uncommon Location",
            "status": "test"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/02/08",
            "description": "Detects outlvba (Microsoft VBA for Outlook Addin) DLL being loaded by the outlook process",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|endswith": "\\outlvba.dll",
                    "Image|endswith": "\\outlook.exe"
                }
            },
            "falsepositives": [
                "Legitimate macro usage. Add the appropriate filter according to your environment"
            ],
            "id": "9a0b8719-cd3c-4f0a-90de-765a4cb3f5ed",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2024/03/12",
            "references": [
                "https://speakerdeck.com/heirhabarov/hunting-for-persistence-via-microsoft-exchange-server-or-outlook?slide=58"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "Microsoft VBA For Outlook Addin Loaded Via Outlook",
            "status": "test"
        },
        {
            "author": "Antonlovesdnb",
            "date": "2020/02/19",
            "description": "Detects CLR DLL being loaded by an Office Product",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|contains": "\\clr.dll",
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\mspub.exe",
                        "\\outlook.exe",
                        "\\onenote.exe",
                        "\\onenoteim.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d13c43f0-f66b-4279-8b2c-5912077c1780",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/03/29",
            "references": [
                "https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "CLR DLL Loaded Via Office Applications",
            "status": "test"
        },
        {
            "author": "Antonlovesdnb",
            "date": "2020/02/19",
            "description": "Detects Kerberos DLL being loaded by an Office Product",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|endswith": "\\kerberos.dll",
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\mspub.exe",
                        "\\onenote.exe",
                        "\\onenoteim.exe",
                        "\\outlook.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "7417e29e-c2e7-4cf6-a2e8-767228c64837",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/03/28",
            "references": [
                "https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "Active Directory Kerberos DLL Loaded Via Office Application",
            "status": "test"
        },
        {
            "author": "Antonlovesdnb",
            "date": "2020/02/19",
            "description": "Detects VB DLL's loaded by an office application. Which could indicate the presence of VBA Macros.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|endswith": [
                        "\\VBE7.DLL",
                        "\\VBEUI.DLL",
                        "\\VBE7INTL.DLL"
                    ],
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\mspub.exe",
                        "\\onenote.exe",
                        "\\onenoteim.exe",
                        "\\outlook.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate macro usage. Add the appropriate filter according to your environment"
            ],
            "id": "e6ce8457-68b1-485b-9bdd-3c2b5d679aa9",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/02/10",
            "references": [
                "https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "VBA DLL Loaded Via Office Application",
            "status": "test"
        },
        {
            "author": "Antonlovesdnb",
            "date": "2020/02/19",
            "description": "Detects DSParse DLL being loaded by an Office Product",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|contains": "\\dsparse.dll",
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\mspub.exe",
                        "\\onenote.exe",
                        "\\onenoteim.exe",
                        "\\outlook.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a2a3b925-7bb0-433b-b508-db9003263cc4",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/03/28",
            "references": [
                "https://medium.com/threatpunter/detecting-adversary-tradecraft-with-image-load-event-logging-and-eql-8de93338c16"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "Active Directory Parsing DLL Loaded Via Office Application",
            "status": "test"
        },
        {
            "author": "Vadim Khrykov (ThreatIntel), Cyb3rEng (Rule), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/08/23",
            "description": "Detects the creation of files with an executable or script extension by an Office application.",
            "detection": {
                "condition": "all of selection* and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_localassembly": {
                    "TargetFilename|contains": "\\AppData\\Local\\assembly\\tmp\\",
                    "TargetFilename|endswith": ".dll"
                },
                "filter_optional_webex": {
                    "Image|endswith": "\\winword.exe",
                    "TargetFilename|contains": "\\AppData\\Local\\Temp\\webexdelta\\",
                    "TargetFilename|endswith": [
                        ".dll",
                        ".exe"
                    ]
                },
                "filter_optional_webservicecache": {
                    "TargetFilename|contains|all": [
                        "C:\\Users\\",
                        "\\AppData\\Local\\Microsoft\\Office\\",
                        "\\WebServiceCache\\AllUsers"
                    ],
                    "TargetFilename|endswith": ".com"
                },
                "selection1": {
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\msaccess.exe",
                        "\\mspub.exe",
                        "\\powerpnt.exe",
                        "\\visio.exe",
                        "\\winword.exe"
                    ]
                },
                "selection2": {
                    "TargetFilename|endswith": [
                        ".bat",
                        ".cmd",
                        ".com",
                        ".dll",
                        ".exe",
                        ".hta",
                        ".ocx",
                        ".proj",
                        ".ps1",
                        ".scf",
                        ".scr",
                        ".sys",
                        ".vbe",
                        ".vbs",
                        ".wsf",
                        ".wsh"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c7a74c80-ba5a-486e-9974-ab9e682bc5e4",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/06/22",
            "references": [
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml"
            ],
            "tags": [
                "attack.t1204.002",
                "attack.execution"
            ],
            "title": "File With Uncommon Extension Created By An Office Application",
            "status": "test"
        },
        {
            "author": "Florian Roth (Nextron Systems), Markus Neis, FPT.EagleEye Team, Vadim Khrykov, Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, @scythe_io",
            "date": "2018/04/06",
            "description": "Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)",
            "detection": {
                "condition": "selection_parent and 1 of selection_child_*",
                "selection_child_processes": [
                    {
                        "OriginalFileName": [
                            "bitsadmin.exe",
                            "CertOC.exe",
                            "CertUtil.exe",
                            "Cmd.Exe",
                            "CMSTP.EXE",
                            "cscript.exe",
                            "curl.exe",
                            "HH.exe",
                            "IEExec.exe",
                            "InstallUtil.exe",
                            "javaw.exe",
                            "Microsoft.Workflow.Compiler.exe",
                            "msdt.exe",
                            "MSHTA.EXE",
                            "msiexec.exe",
                            "Msxsl.exe",
                            "odbcconf.exe",
                            "pcalua.exe",
                            "PowerShell.EXE",
                            "RegAsm.exe",
                            "RegSvcs.exe",
                            "REGSVR32.exe",
                            "RUNDLL32.exe",
                            "schtasks.exe",
                            "ScriptRunner.exe",
                            "wmic.exe",
                            "WorkFolders.exe",
                            "wscript.exe"
                        ]
                    },
                    {
                        "Image|endswith": [
                            "\\AppVLP.exe",
                            "\\bash.exe",
                            "\\bitsadmin.exe",
                            "\\certoc.exe",
                            "\\certutil.exe",
                            "\\cmd.exe",
                            "\\cmstp.exe",
                            "\\control.exe",
                            "\\cscript.exe",
                            "\\curl.exe",
                            "\\forfiles.exe",
                            "\\hh.exe",
                            "\\ieexec.exe",
                            "\\installutil.exe",
                            "\\javaw.exe",
                            "\\mftrace.exe",
                            "\\Microsoft.Workflow.Compiler.exe",
                            "\\msbuild.exe",
                            "\\msdt.exe",
                            "\\mshta.exe",
                            "\\msidb.exe",
                            "\\msiexec.exe",
                            "\\msxsl.exe",
                            "\\odbcconf.exe",
                            "\\pcalua.exe",
                            "\\powershell.exe",
                            "\\pwsh.exe",
                            "\\regasm.exe",
                            "\\regsvcs.exe",
                            "\\regsvr32.exe",
                            "\\rundll32.exe",
                            "\\schtasks.exe",
                            "\\scrcons.exe",
                            "\\scriptrunner.exe",
                            "\\sh.exe",
                            "\\svchost.exe",
                            "\\verclsid.exe",
                            "\\wmic.exe",
                            "\\workfolders.exe",
                            "\\wscript.exe"
                        ]
                    }
                ],
                "selection_child_susp_paths": {
                    "Image|contains": [
                        "\\AppData\\",
                        "\\Users\\Public\\",
                        "\\ProgramData\\",
                        "\\Windows\\Tasks\\",
                        "\\Windows\\Temp\\",
                        "\\Windows\\System32\\Tasks\\"
                    ]
                },
                "selection_parent": {
                    "ParentImage|endswith": [
                        "\\EQNEDT32.EXE",
                        "\\EXCEL.EXE",
                        "\\MSACCESS.EXE",
                        "\\MSPUB.exe",
                        "\\ONENOTE.EXE",
                        "\\POWERPNT.exe",
                        "\\VISIO.exe",
                        "\\WINWORD.EXE",
                        "\\wordpad.exe",
                        "\\wordview.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "438025f9-5856-4663-83f7-52f878a70a50",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/24",
            "references": [
                "https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100",
                "https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html",
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml",
                "https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_spawning_control.yml",
                "https://twitter.com/andythevariable/status/1576953781581144064?s=20&t=QiJILvK4ZiBdR8RJe24u-A",
                "https://www.elastic.co/security-labs/exploring-the-ref2731-intrusion-set",
                "https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/defense_evasion_execution_msbuild_started_by_office_app.toml",
                "https://www.vmray.com/analyses/2d2fa29185ad/report/overview.html",
                "https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/"
            ],
            "related": [
                {
                    "id": "c27515df-97a9-4162-8a60-dc0eeb51b775",
                    "type": "derived"
                },
                {
                    "id": "e1693bc8-7168-4eab-8718-cdcaa68a1738",
                    "type": "derived"
                },
                {
                    "id": "23daeb52-e6eb-493c-8607-c4f0246cb7d8",
                    "type": "obsoletes"
                },
                {
                    "id": "518643ba-7d9c-4fa5-9f37-baed36059f6a",
                    "type": "obsoletes"
                },
                {
                    "id": "04f5363a-6bca-42ff-be70-0d28bf629ead",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1047",
                "attack.t1204.002",
                "attack.t1218.010"
            ],
            "title": "Suspicious Microsoft Office Child Process"
        },
        {
            "id": "e1693bc8-7168-4eab-8718-cdcaa68a1738",
            "author": "Vadim Khrykov, Cyb3rEng",
            "date": "2021/08/23",
            "description": "Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin).",
            "detection": {
                "condition": "all of selection_*",
                "selection_parent": {
                    "ParentImage|endswith": [
                        "\\WINWORD.EXE",
                        "\\EXCEL.EXE",
                        "\\POWERPNT.exe",
                        "\\MSPUB.exe",
                        "\\VISIO.exe",
                        "\\MSACCESS.EXE",
                        "\\EQNEDT32.EXE",
                        "\\ONENOTE.EXE",
                        "\\wordpad.exe",
                        "\\wordview.exe"
                    ]
                },
                "selection_wmic_cli": {
                    "CommandLine|contains": [
                        "regsvr32",
                        "rundll32",
                        "msiexec",
                        "mshta",
                        "verclsid",
                        "wscript",
                        "cscript"
                    ],
                    "CommandLine|contains|all": [
                        "process",
                        "create",
                        "call"
                    ]
                },
                "selection_wmic_img": [
                    {
                        "Image|endswith": "\\wbem\\WMIC.exe"
                    },
                    {
                        "OriginalFileName": "wmic.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "438025f9-5856-4663-83f7-52f878a70a50"
                },
                {
                    "id": "518643ba-7d9c-4fa5-9f37-baed36059f6a",
                    "type": "obsoletes"
                },
                {
                    "id": "9d1c72f5-43f0-4da5-9320-648cf2099dd0",
                    "type": "obsoletes"
                },
                {
                    "id": "c0e1c3d5-4381-4f18-8145-2583f06a1fe5",
                    "type": "obsoletes"
                },
                {
                    "id": "04f5363a-6bca-42ff-be70-0d28bf629ead",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.t1204.002",
                "attack.t1047",
                "attack.t1218.010",
                "attack.execution",
                "attack.defense_evasion"
            ],
            "title": "Suspicious WMIC Execution Via Office Process"
        },
        {
            "author": "Vadim Khrykov (ThreatIntel), Cyb3rEng, Florian Roth (Nextron Systems)",
            "date": "2021/08/23",
            "description": "Detects suspicious and uncommon child processes of WmiPrvSE",
            "detection": {
                "condition": "selection_parent and 1 of selection_children_* and not 1 of filter_main_*",
                "filter_main_msiexec": {
                    "CommandLine|contains": "/i ",
                    "Image|endswith": "\\msiexec.exe"
                },
                "filter_main_werfault": {
                    "Image|endswith": "\\WerFault.exe"
                },
                "filter_main_wmiprvse": {
                    "Image|endswith": "\\WmiPrvSE.exe"
                },
                "selection_children_1": {
                    "Image|endswith": [
                        "\\certutil.exe",
                        "\\cscript.exe",
                        "\\mshta.exe",
                        "\\msiexec.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\verclsid.exe",
                        "\\wscript.exe"
                    ]
                },
                "selection_children_2": {
                    "CommandLine|contains": [
                        "cscript",
                        "mshta",
                        "powershell",
                        "pwsh",
                        "regsvr32",
                        "rundll32",
                        "wscript"
                    ],
                    "Image|endswith": "\\cmd.exe"
                },
                "selection_parent": {
                    "ParentImage|endswith": "\\wbem\\WmiPrvSE.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8a582fe2-0882-4b89-a82a-da6b2dc32937",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/10",
            "references": [
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml",
                "https://blog.osarmor.com/319/onenote-attachment-delivers-asyncrat-malware/",
                "https://twitter.com/ForensicITGuy/status/1334734244120309760"
            ],
            "related": [
                {
                    "id": "692f0bec-83ba-4d04-af7e-e884a96059b6",
                    "type": "similar"
                },
                {
                    "id": "d21374ff-f574-44a7-9998-4a8c8bf33d7d",
                    "type": "similar"
                },
                {
                    "id": "18cf6cf0-39b0-4c22-9593-e244bdc9a2d4",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.defense_evasion",
                "attack.t1047",
                "attack.t1204.002",
                "attack.t1218.010"
            ],
            "title": "Suspicious WmiPrvSE Child Process"
        },
        {
            "author": "Joseph Kamau",
            "date": "2024/05/27",
            "description": "Detects when a browser process or browser tab is launched from an application that handles document files such as Adobe, Microsoft Office, etc. And connects to a web application over http(s), this could indicate a possible phishing attempt.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "http",
                    "Image|endswith": [
                        "\\brave.exe",
                        "\\chrome.exe",
                        "\\firefox.exe",
                        "\\msedge.exe",
                        "\\opera.exe",
                        "\\maxthon.exe",
                        "\\seamonkey.exe",
                        "\\vivaldi.exe",
                        ""
                    ],
                    "ParentImage|contains": [
                        "Acrobat Reader",
                        "Microsoft Office",
                        "PDF Reader"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely in most cases, further investigation should be done in the commandline of the browser process to determine the context of the URL accessed."
            ],
            "id": "1193d960-2369-499f-a158-7b50a31df682",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://app.any.run/tasks/69c5abaa-92ad-45ba-8c53-c11e23e05d04/",
                "https://app.any.run/tasks/64043a79-165f-4052-bcba-e6e49f847ec1/"
            ],
            "status": "experimental",
            "title": "Potential Suspicious Browser Launch From Document Reader Process",
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ]
        },
        {
            "author": "Michael Haag, Florian Roth (Nextron Systems), Markus Neis, Elastic, FPT.EagleEye Team",
            "date": "2022/02/28",
            "description": "Detects a suspicious process spawning from an Outlook process.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "\\AppVLP.exe",
                        "\\bash.exe",
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\forfiles.exe",
                        "\\hh.exe",
                        "\\mftrace.exe",
                        "\\msbuild.exe",
                        "\\msdt.exe",
                        "\\mshta.exe",
                        "\\msiexec.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regsvr32.exe",
                        "\\schtasks.exe",
                        "\\scrcons.exe",
                        "\\scriptrunner.exe",
                        "\\sh.exe",
                        "\\svchost.exe",
                        "\\wmic.exe",
                        "\\wscript.exe"
                    ],
                    "ParentImage|endswith": "\\OUTLOOK.EXE"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "208748f7-881d-47ac-a29c-07ea84bf691d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100",
                "https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "438025f9-5856-4663-83f7-52f878a70a50"
                },
                {
                    "id": "e212d415-0e93-435f-9e1a-f29005bb4723",
                    "type": "derived"
                }
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "status": "test",
            "title": "Suspicious Outlook Child Process"
        },
        {
            "author": "Jason Lynch",
            "date": "2019/04/02",
            "description": "Detects an executable in the users directory started from one of the Microsoft Office suite applications (Word, Excel, PowerPoint, Publisher, Visio)",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "Image|endswith": "\\Teams.exe"
                },
                "selection": {
                    "Image|endswith": ".exe",
                    "Image|startswith": "C:\\users\\",
                    "ParentImage|endswith": [
                        "\\WINWORD.EXE",
                        "\\EXCEL.EXE",
                        "\\POWERPNT.exe",
                        "\\MSPUB.exe",
                        "\\VISIO.exe",
                        "\\MSACCESS.exe",
                        "\\EQNEDT32.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "aa3a6f94-890e-4e22-b634-ffdfd54792cc",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign",
                "https://www.virustotal.com/gui/file/23160972c6ae07f740800fa28e421a81d7c0ca5d5cab95bc082b4a986fbac57"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1204.002",
                "attack.g0046",
                "car.2013-05-002"
            ],
            "title": "Suspicious Binary In User Directory Spawned From Office Application"
        },
        {
            "author": "Pushkarev Dmitry",
            "date": "2020/06/28",
            "description": "Detect run not allowed files. Applocker is a very useful tool, especially on servers where unprivileged users have access. For example terminal servers. You need configure applocker and log collect to receive these events.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        8004,
                        8007,
                        8022,
                        8025
                    ]
                }
            },
            "falsepositives": [
                "Need tuning applocker or add exceptions in SIEM"
            ],
            "fields": [
                "PolicyName",
                "RuleId",
                "RuleName",
                "TargetUser",
                "TargetProcessId",
                "FilePath",
                "FileHash",
                "Fqbn"
            ],
            "id": "401e5d00-b944-11ea-8f9a-00163ecd60ae",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "applocker"
            },
            "modified": "2021/11/27",
            "references": [
                "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/what-is-applocker",
                "https://learn.microsoft.com/en-us/windows/security/application-security/application-control/windows-defender-application-control/applocker/using-event-viewer-with-applocker",
                "https://nxlog.co/documentation/nxlog-user-guide/applocker.html"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1204.002",
                "attack.t1059.001",
                "attack.t1059.003",
                "attack.t1059.005",
                "attack.t1059.006",
                "attack.t1059.007"
            ],
            "title": "File Was Not Allowed To Run"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/05/02",
            "description": "A General detection for a new application in AppCompat. This indicates an application executing for the first time on an endpoint.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetObject|contains": "\\AppCompatFlags\\Compatibility Assistant\\Store\\"
                }
            },
            "falsepositives": [
                "This rule is to explore new applications on an endpoint. False positives depends on the organization.",
                "Newly setup system.",
                "Legitimate installation of new application."
            ],
            "id": "60936b49-fca0-4f32-993d-7415edcf9a5d",
            "level": "informational",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/OTRF/detection-hackathon-apt29/issues/1",
                "https://github.com/OTRF/ThreatHunter-Playbook/blob/2d4257f630f4c9770f78d0c1df059f891ffc3fec/docs/evals/apt29/detections/1.A.1_DFD6A782-9BDB-4550-AB6B-525E825B095E.md"
            ],
            "tags": [
                "attack.execution",
                "attack.t1204.002"
            ],
            "title": "New Application in AppCompat",
            "status": "test"
        }
    ]
}