{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--8838742c-146e-47fd-bf9a-6e57b2c84952",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.611945Z",
    "name": "Input Capture",
    "description": "Adversaries may use methods of capturing user input to obtain credentials or collect information. During normal system usage, users often provide credentials to various different locations, such as login pages/portals or system dialog boxes. Input capture mechanisms may be transparent to the user (e.g. Credential API Hooking) or rely on deceiving the user into providing input into what they believe to be a genuine service (e.g. Web Portal Capture).",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1056",
            "external_id": "T1056"
        },
        {
            "source_name": "CAPEC 569",
            "external_id": "malware-behavior--2eea8286-2103-4af0-b29c-950e9adedd25"
        },
        {
            "source_name": "CAPEC 654",
            "external_id": "malware-behavior--a92e508d-d26b-469b-9408-7b34f43cd9a6"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1056",
            "external_id": "T1056"
        },
        {
            "source_name": "Adventures of a Keystroke",
            "description": "Tinaztepe,  E. (n.d.). The Adventures of a Keystroke:  An in-depth look into keyloggers on Windows. Retrieved April 27, 2016.",
            "url": "http://opensecuritytraining.info/Keylogging_files/The%20Adventures%20of%20a%20Keystroke.pdf"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Gavin Knapp",
            "date": "2023/03/16",
            "description": "Detects connections to interplanetary file system (IPFS) containing a user's email address which mirrors behaviours observed in recent phishing campaigns leveraging IPFS to host credential harvesting webpages.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "cs-uri|re": "(?i)(ipfs\\.io/|ipfs\\.io\\s).+\\..+@.+\\.[a-z]+"
                }
            },
            "falsepositives": [
                "Legitimate use of IPFS being used in the organisation. However the cs-uri regex looking for a user email will likely negate this."
            ],
            "id": "eb6c2004-1cef-427f-8885-9042974e5eb6",
            "level": "low",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://blog.talosintelligence.com/ipfs-abuse/",
                "https://github.com/Cisco-Talos/IOCs/tree/80caca039988252fbb3f27a2e89c2f2917f582e0/2022/11",
                "https://isc.sans.edu/diary/IPFS%20phishing%20and%20the%20need%20for%20correctly%20set%20HTTP%20security%20headers/29638"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1056"
            ],
            "title": "Suspicious Network Communication With IPFS"
        },
        {
            "author": "remotephone, oscd.community",
            "date": "2020/10/13",
            "description": "Detects attempts to use system dialog prompts to capture user credentials",
            "detection": {
                "condition": "all of selection*",
                "selection1": {
                    "Image": "/usr/sbin/osascript"
                },
                "selection2": {
                    "CommandLine|contains|all": [
                        "-e",
                        "display",
                        "dialog",
                        "answer"
                    ]
                },
                "selection3": {
                    "CommandLine|contains": [
                        "admin",
                        "administrator",
                        "authenticate",
                        "authentication",
                        "credentials",
                        "pass",
                        "password",
                        "unlock"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate administration tools and activities"
            ],
            "id": "60f1ce20-484e-41bd-85f4-ac4afec2c541",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2022/12/25",
            "status": "test",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1056.002/T1056.002.md",
                "https://scriptingosx.com/2018/08/user-interaction-from-bash-scripts/"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1056.002"
            ],
            "title": "GUI Input Capture - macOS"
        },
        {
            "author": "Josh Nickels",
            "date": "2024/02/26",
            "description": "Detects DNS query requests to \"update.onelaunch.com\". This domain is associated with the OneLaunch adware application.\nWhen the OneLaunch application is installed it will attempt to get updates from this domain.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\OneLaunch.exe",
                    "QueryName": "update.onelaunch.com"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "df68f791-ad95-447f-a271-640a0dab9cf8",
            "level": "low",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "references": [
                "https://www.malwarebytes.com/blog/detections/pup-optional-onelaunch-silentcf",
                "https://www.myantispyware.com/2020/12/14/how-to-uninstall-onelaunch-browser-removal-guide/",
                "https://malware.guide/browser-hijacker/remove-onelaunch-virus/"
            ],
            "status": "experimental",
            "tags": [
                "attack.collection",
                "attack.t1056"
            ],
            "title": "DNS Query Request To OneLaunch Update Service"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/10/20",
            "description": "Detects loading of \"credui.dll\" and related DLLs by an uncommon process. Attackers might leverage this DLL for potential use of \"CredUIPromptForCredentials\" or \"CredUnPackAuthenticationBufferW\".",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_full": {
                    "Image": [
                        "C:\\Windows\\explorer.exe",
                        "C:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe",
                        "C:\\Windows\\regedit.exe"
                    ]
                },
                "filter_main_generic": {
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\",
                        "C:\\Program Files\\",
                        "C:\\Windows\\System32\\",
                        "C:\\Windows\\SysWOW64\\"
                    ]
                },
                "filter_optional_onedrive": {
                    "Image|contains": "\\AppData\\Local\\Microsoft\\OneDrive\\",
                    "Image|startswith": "C:\\Users\\"
                },
                "filter_optional_opera": {
                    "Image|endswith": "\\opera_autoupdate.exe"
                },
                "filter_optional_process_explorer": {
                    "Image|endswith": [
                        "\\procexp64.exe",
                        "\\procexp.exe"
                    ]
                },
                "filter_optional_teams": {
                    "Image|contains": "\\AppData\\Local\\Microsoft\\Teams\\",
                    "Image|endswith": "\\Teams.exe",
                    "Image|startswith": "C:\\Users\\"
                },
                "selection": [
                    {
                        "ImageLoaded|endswith": [
                            "\\credui.dll",
                            "\\wincredui.dll"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "credui.dll",
                            "wincredui.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Other legitimate processes loading those DLLs in your environment."
            ],
            "id": "9ae01559-cf7e-4f8e-8e14-4c290a1b4784",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/07/28",
            "status": "test",
            "references": [
                "https://securitydatasets.com/notebooks/atomic/windows/credential_access/SDWIN-201020013208.html",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1056.002/T1056.002.md#atomic-test-2---powershell---prompt-user-for-password",
                "https://learn.microsoft.com/en-us/windows/win32/api/wincred/nf-wincred-creduipromptforcredentialsa",
                "https://github.com/S12cybersecurity/RDPCredentialStealer"
            ],
            "tags": [
                "attack.credential_access",
                "attack.collection",
                "attack.t1056.002"
            ],
            "title": "CredUI.DLL Loaded By Uncommon Process"
        },
        {
            "author": "Cian Heasley",
            "date": "2020/08/13",
            "description": "In Kaspersky's 2020 Incident Response Analyst Report they listed legitimate tool \"Mouse Lock\" as being used for both credential access and collection in security incidents.",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Product|contains": "Mouse Lock"
                    },
                    {
                        "Company|contains": "Misc314"
                    },
                    {
                        "CommandLine|contains": "Mouse Lock_"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate uses of Mouse Lock software"
            ],
            "fields": [
                "Product",
                "Company",
                "CommandLine"
            ],
            "id": "c9192ad9-75e5-43eb-8647-82a0a5b493e3",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "status": "test",
            "modified": "2023/02/21",
            "references": [
                "https://github.com/klsecservices/Publications/blob/657deb6a6eb6e00669afd40173f425fb49682eaa/Incident-Response-Analyst-Report-2020.pdf",
                "https://sourceforge.net/projects/mouselock/"
            ],
            "tags": [
                "attack.credential_access",
                "attack.collection",
                "attack.t1056.002"
            ],
            "title": "PUA - Mouse Lock Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/04",
            "description": "Detects PowerShell scripts that contains reference to keystroke capturing functions",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": "[Windows.Input.Keyboard]::IsKeyDown([System.Windows.Input.Key]::"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "965e2db9-eddb-4cf6-a986-7a967df651e4",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://twitter.com/ScumBots/status/1610626724257046529",
                "https://www.virustotal.com/gui/file/d4486b63512755316625230e0c9c81655093be93876e0d80732e7eeaf7d83476/content",
                "https://www.virustotal.com/gui/file/720a7ee9f2178c70501d7e3f4bcc28a4f456e200486dbd401b25af6da3b4da62/content",
                "https://learn.microsoft.com/en-us/dotnet/api/system.windows.input.keyboard.iskeydown?view=windowsdesktop-7.0"
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.credential_access",
                "attack.t1056.001"
            ],
            "title": "Potential Keylogger Activity"
        },
        {
            "author": "frack113",
            "date": "2021/07/30",
            "description": "Adversaries may log user keystrokes to intercept credentials as the user types them.",
            "detection": {
                "condition": "1 of selection_*",
                "selection_basic": {
                    "ScriptBlockText|contains": "Get-Keystrokes"
                },
                "selection_high": {
                    "ScriptBlockText|contains|all": [
                        "Get-ProcAddress user32.dll GetAsyncKeyState",
                        "Get-ProcAddress user32.dll GetForegroundWindow"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "34f90d3c-c297-49e9-b26d-911b05a4866c",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/07/11",
            "status": "test",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218/T1218.md",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1056.001/src/Get-Keystrokes.ps1"
            ],
            "tags": [
                "attack.collection",
                "attack.t1056.001"
            ],
            "title": "Powershell Keylogging"
        },
        {
            "author": "Pawel Mazur",
            "date": "2021/05/24",
            "description": "Detect attempt to enable auditing of TTY input",
            "detection": {
                "condition": "1 of selection_*",
                "selection_path_events": {
                    "name": [
                        "/etc/pam.d/system-auth",
                        "/etc/pam.d/password-auth"
                    ],
                    "type": "PATH"
                },
                "selection_tty_events": {
                    "type": [
                        "TTY",
                        "USER_TTY"
                    ]
                }
            },
            "falsepositives": [
                "Administrative work"
            ],
            "id": "49aae26c-450e-448b-911d-b3c13d178dfc",
            "level": "high",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2022/12/18",
            "status": "test",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1056.001/T1056.001.md",
                "https://linux.die.net/man/8/pam_tty_audit",
                "https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/security_guide/sec-configuring_pam_for_auditing",
                "https://access.redhat.com/articles/4409591#audit-record-types-2"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1056.001"
            ],
            "title": "Linux Keylogging with Pam.d"
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows",
        "Network"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "John Lambert, Microsoft Threat Intelligence Center"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "collection"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "credential-access"
        }
    ],
    "x_mitre_detection": "Detection may vary depending on how input is captured but may include monitoring for certain Windows API calls (e.g. `SetWindowsHook`, `GetKeyState`, and `GetAsyncKeyState`)(Citation: Adventures of a Keystroke), monitoring for malicious instances of [Command and Scripting Interpreter](https://attack.mitre.org/techniques/T1059), and ensuring no unauthorized drivers or kernel modules that could indicate keylogging or API hooking are present.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.2",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "File: File Modification",
        "Process: Process Creation",
        "Windows Registry: Windows Registry Key Modification",
        "Process: Process Metadata",
        "Process: OS API Execution",
        "Driver: Driver Load"
    ],
    "x_mitre_permissions_required": [
        "Administrator",
        "SYSTEM",
        "root",
        "User"
    ]
}