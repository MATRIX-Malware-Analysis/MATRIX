{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--f45c2822-589e-425e-a0ef-11567034cb16",
    "created": "2024-08-13T14:46:37.080673Z",
    "modified": "2024-08-13T14:46:45.884532Z",
    "name": "Hide Artifacts: Run Virtual Instance",
    "description": "Adversaries may carry out malicious operations using a virtual instance to avoid detection. A wide variety of virtualization technologies exist that allow for the emulation of a computer or computing environment. By running malicious code inside of a virtual instance, adversaries can hide artifacts associated with their behavior from security tools that are unable to monitor activity inside the virtual instance. Additionally, depending on the virtual networking implementation (ex: bridged adapter), network traffic generated by the virtual instance can be difficult to trace back to the compromised host as the IP address and hostname might not match known values.[1]Adversaries may utilize native support for virtualization (ex: Hyper-V) or drop the necessary files to run a virtual instance (ex: VirtualBox binaries). After running a virtual instance, adversaries may create a shared folder between the guest and host with permissions that enable the virtual instance to interact with the host file system.[2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1564/006",
            "external_id": "T1564/006"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Janantha Marasinghe",
            "date": "2020/09/26",
            "description": "Adversaries can carry out malicious operations using a virtual instance to avoid detection. This rule is built to detect the registration of the Virtualbox driver or start of a Virtualbox VM.",
            "detection": {
                "condition": "1 of selection_*",
                "selection_1": {
                    "CommandLine|contains": [
                        "VBoxRT.dll,RTR3Init",
                        "VBoxC.dll",
                        "VBoxDrv.sys"
                    ]
                },
                "selection_2": {
                    "CommandLine|contains": [
                        "startvm",
                        "controlvm"
                    ]
                }
            },
            "falsepositives": [
                "This may have false positives on hosts where Virtualbox is legitimately being used for operations"
            ],
            "fields": [
                "ComputerName",
                "User",
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "bab049ca-7471-4828-9024-38279a4c04da",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/07/14",
            "references": [
                "https://news.sophos.com/en-us/2020/05/21/ragnar-locker-ransomware-deploys-virtual-machine-to-dodge-security/",
                "https://threatpost.com/maze-ransomware-ragnar-locker-virtual-machine/159350/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1564.006",
                "attack.t1564"
            ],
            "title": "Detect Virtualbox Driver Installation OR Starting Of VMs"
        },
        {
            "author": "frack113",
            "date": "2022/04/09",
            "description": "Adversaries may carry out malicious operations using a virtual instance to avoid detection",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "New-VM",
                        "Set-VMFirmware",
                        "Start-VM"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate PowerShell scripts"
            ],
            "id": "42d36aa1-3240-4db0-8257-e0118dcdd9cd",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://learn.microsoft.com/en-us/virtualization/hyper-v-on-windows/quick-start/enable-hyper-v",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1564.006/T1564.006.md#atomic-test-3---create-and-start-hyper-v-virtual-machine"
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1564.006"
            ],
            "title": "Suspicious Hyper-V Cmdlets",
            "status": "test"
        }
    ]
}