{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--fd202f47-45f7-4953-8ba1-25e7ed7b6ffb",
    "created": "2024-08-13T14:46:36.988194Z",
    "modified": "2024-08-13T14:46:45.299448Z",
    "name": "Web Service",
    "description": "Adversaries may use an existing, legitimate external Web service as a means for relaying data to/from a compromised system. Popular websites and social media acting as a mechanism for C2 may give a significant amount of cover due to the likelihood that hosts within a network are already communicating with them prior to a compromise. Using common services, such as those offered by Google or Twitter, makes it easier for adversaries to hide in expected noise. Web service providers commonly use SSL/TLS encryption, giving adversaries an added level of protection.Use of Web services may also protect back-end C2 infrastructure from discovery through malware binary analysis while also enabling operational resiliency (since this infrastructure may be dynamically changed).",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1102",
            "external_id": "T1102"
        },
        {
            "source_name": "mitre-attack",
            "external_id": "T1102",
            "url": "https://attack.mitre.org/techniques/T1102"
        },
        {
            "url": "https://arxiv.org/ftp/arxiv/papers/1408/1408.1136.pdf",
            "description": "Gardiner, J.,  Cova, M., Nagaraja, S. (2014, February). Command & Control Understanding, Denying and Detecting. Retrieved April 20, 2016.",
            "source_name": "University of Birmingham C2"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2020/04/15",
            "description": "Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri|contains": "/pwndrop/"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "2b1ee7e4-89b6-4739-b7bb-b811b6607e5e",
            "level": "critical",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2021/11/27",
            "references": [
                "https://breakdev.org/pwndrop/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.t1102.001",
                "attack.t1102.003"
            ],
            "title": "PwnDrp Access"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/06/05",
            "description": "Detects suspicious requests to Telegram API without the usual Telegram User-Agent",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "c-useragent|contains": [
                        "Telegram",
                        "Bot"
                    ]
                },
                "selection": {
                    "cs-host": "api.telegram.org"
                }
            },
            "falsepositives": [
                "Legitimate use of Telegram bots in the company"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "b494b165-6634-483d-8c47-2026a6c52372",
            "level": "medium",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/18",
            "references": [
                "https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/",
                "https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/",
                "https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.t1102.002"
            ],
            "title": "Telegram API Access"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/05",
            "description": "Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri|contains": [
                        ".paste.ee/r/",
                        ".pastebin.com/raw/",
                        ".hastebin.com/raw/",
                        ".ghostbin.co/paste/*/raw/",
                        "pastetext.net/",
                        "pastebin.pl/",
                        "paste.ee/"
                    ]
                }
            },
            "falsepositives": [
                "User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy & paste)"
            ],
            "id": "5468045b-4fcc-4d1a-973c-c9c9578edacb",
            "level": "high",
            "modified": "2023/01/19",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://www.virustotal.com/gui/domain/paste.ee/relations"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.t1102.001",
                "attack.t1102.003",
                "attack.defense_evasion"
            ],
            "title": "Raw Paste Service Access"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/06/05",
            "description": "Detects suspicious DNS queries to api.telegram.org used by Telegram Bots of any kind",
            "detection": {
                "condition": "selection",
                "selection": {
                    "query": "api.telegram.org"
                }
            },
            "falsepositives": [
                "Legitimate use of Telegram bots in the company"
            ],
            "id": "c64c5175-5189-431b-a55e-6d9882158251",
            "logsource": {
                "category": "dns"
            },
            "level": "medium",
            "modified": "2022/10/09",
            "references": [
                "https://core.telegram.org/bots/faq",
                "https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/",
                "https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/",
                "https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1102.002"
            ],
            "title": "Telegram Bot API Request"
        },
        {
            "author": "Sorina Ionescu, X__Junior (Nextron Systems)",
            "date": "2022/08/17",
            "description": "Detects an executable, which is not an internet browser or known application, initiating network connections to legit popular websites, which were seen to be used as dead drop resolvers in previous attacks.\nIn this context attackers leverage known websites such as \"facebook\", \"youtube\", etc. In order to pass through undetected.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_avant": {
                    "Image|endswith": "\\avant.exe",
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Avant Browser\\",
                        "C:\\Program Files\\Avant Browser\\"
                    ]
                },
                "filter_main_brave": {
                    "Image|endswith": "\\brave.exe",
                    "Image|startswith": "C:\\Program Files\\BraveSoftware\\"
                },
                "filter_main_chrome": {
                    "Image": [
                        "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe",
                        "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_main_chrome_appdata": {
                    "Image|endswith": "\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe",
                    "Image|startswith": "C:\\Users\\"
                },
                "filter_main_defender": {
                    "Image|contains": [
                        "C:\\Program Files\\Windows Defender Advanced Threat Protection\\",
                        "C:\\Program Files\\Windows Defender\\",
                        "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\"
                    ],
                    "Image|endswith": [
                        "\\MsMpEng.exe",
                        "\\MsSense.exe"
                    ]
                },
                "filter_main_discord": {
                    "DestinationHostname|endswith": [
                        "discord.com",
                        "cdn.discordapp.com"
                    ],
                    "Image|contains": "\\AppData\\Local\\Discord\\",
                    "Image|endswith": "\\Discord.exe"
                },
                "filter_main_dropbox": {
                    "DestinationHostname|endswith": "dropbox.com",
                    "Image|endswith": [
                        "\\Dropbox.exe",
                        "\\DropboxInstaller.exe"
                    ],
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Dropbox\\Client\\",
                        "C:\\Program Files\\Dropbox\\Client\\"
                    ]
                },
                "filter_main_edge_1": [
                    {
                        "Image|startswith": "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\"
                    },
                    {
                        "Image|endswith": "\\WindowsApps\\MicrosoftEdge.exe"
                    },
                    {
                        "Image": [
                            "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe",
                            "C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"
                        ]
                    }
                ],
                "filter_main_edge_2": {
                    "Image|endswith": [
                        "\\msedge.exe",
                        "\\msedgewebview2.exe"
                    ],
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\",
                        "C:\\Program Files\\Microsoft\\EdgeCore\\"
                    ]
                },
                "filter_main_empty": {
                    "Image": ""
                },
                "filter_main_falkon": {
                    "Image|endswith": "\\falkon.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\Falkon\\",
                        "C:\\Program Files (x86)\\Falkon\\"
                    ]
                },
                "filter_main_firefox": {
                    "Image": [
                        "C:\\Program Files\\Mozilla Firefox\\firefox.exe",
                        "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_main_firefox_appdata": {
                    "Image|endswith": "\\AppData\\Local\\Mozilla Firefox\\firefox.exe",
                    "Image|startswith": "C:\\Users\\"
                },
                "filter_main_flock": {
                    "Image|contains": "\\AppData\\Local\\Flock\\",
                    "Image|endswith": "\\Flock.exe"
                },
                "filter_main_googledrive": {
                    "DestinationHostname|endswith": "drive.google.com",
                    "Image|contains": [
                        "C:\\Program Files\\Google\\Drive File Stream\\",
                        "C:\\Program Files (x86)\\Google\\Drive File Stream\\"
                    ],
                    "Image|endswith": "GoogleDriveFS.exe"
                },
                "filter_main_ie": {
                    "Image": [
                        "C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe",
                        "C:\\Program Files\\Internet Explorer\\iexplore.exe"
                    ]
                },
                "filter_main_maxthon": {
                    "Image|contains": "\\AppData\\Local\\Maxthon\\",
                    "Image|endswith": "\\maxthon.exe"
                },
                "filter_main_mega": {
                    "DestinationHostname|endswith": [
                        "mega.co.nz",
                        "mega.nz"
                    ],
                    "Image|endswith": [
                        "\\MEGAsync.exe",
                        "\\MEGAsyncSetup32_*RC.exe",
                        "\\MEGAsyncSetup32.exe",
                        "\\MEGAsyncSetup64.exe",
                        "\\MEGAupdater.exe"
                    ]
                },
                "filter_main_midori": {
                    "Image|contains": "\\AppData\\Local\\Programs\\midori-ng\\",
                    "Image|endswith": "\\Midori Next Generation.exe"
                },
                "filter_main_null": {
                    "Image": null
                },
                "filter_main_onedrive": {
                    "DestinationHostname|endswith": "onedrive.com",
                    "Image|contains": "\\AppData\\Local\\Microsoft\\OneDrive\\",
                    "Image|endswith": "\\OneDrive.exe"
                },
                "filter_main_opera": {
                    "Image|contains": "\\AppData\\Local\\Programs\\Opera\\",
                    "Image|endswith": "\\opera.exe"
                },
                "filter_main_phoebe": {
                    "Image|contains": "\\AppData\\Local\\Phoebe\\",
                    "Image|endswith": "\\Phoebe.exe"
                },
                "filter_main_prtg": {
                    "Image|endswith": [
                        "C:\\Program Files (x86)\\PRTG Network Monitor\\PRTG Probe.exe",
                        "C:\\Program Files\\PRTG Network Monitor\\PRTG Probe.exe"
                    ]
                },
                "filter_main_qtweb": {
                    "Image|endswith": "\\QtWeb.exe",
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\QtWeb\\",
                        "C:\\Program Files\\QtWeb\\"
                    ]
                },
                "filter_main_safari": {
                    "Image|contains": [
                        "C:\\Program Files (x86)\\Safari\\",
                        "C:\\Program Files\\Safari\\"
                    ],
                    "Image|endswith": "\\safari.exe"
                },
                "filter_main_seamonkey": {
                    "Image|endswith": "\\seamonkey.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\SeaMonkey\\",
                        "C:\\Program Files (x86)\\SeaMonkey\\"
                    ]
                },
                "filter_main_slimbrowser": {
                    "Image|endswith": "\\slimbrowser.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\SlimBrowser\\",
                        "C:\\Program Files (x86)\\SlimBrowser\\"
                    ]
                },
                "filter_main_telegram": {
                    "DestinationHostname|endswith": ".t.me",
                    "Image|contains": "\\AppData\\Roaming\\Telegram Desktop\\",
                    "Image|endswith": "\\Telegram.exe"
                },
                "filter_main_vivaldi": {
                    "Image|contains": "\\AppData\\Local\\Vivaldi\\",
                    "Image|endswith": "\\vivaldi.exe"
                },
                "filter_main_whale": {
                    "Image|endswith": "\\whale.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\Naver\\Naver Whale\\",
                        "C:\\Program Files (x86)\\Naver\\Naver Whale\\"
                    ]
                },
                "filter_main_whaterfox": {
                    "Image|endswith": "\\Waterfox.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\Waterfox\\",
                        "C:\\Program Files (x86)\\Waterfox\\"
                    ]
                },
                "filter_main_whatsapp": {
                    "DestinationHostname|endswith": "facebook.com",
                    "Image|endswith": "\\WhatsApp.exe",
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\WindowsApps\\",
                        "C:\\Program Files\\WindowsApps\\"
                    ]
                },
                "selection": {
                    "DestinationHostname|endswith": [
                        ".t.me",
                        "4shared.com",
                        "anonfiles.com",
                        "cdn.discordapp.com",
                        "cloudflare.com",
                        "ddns.net",
                        "discord.com",
                        "docs.google.com",
                        "drive.google.com",
                        "dropbox.com",
                        "dropmefiles.com",
                        "facebook.com",
                        "feeds.rapidfeeds.com",
                        "fotolog.com",
                        "ghostbin.co/",
                        "githubusercontent.com",
                        "gofile.io",
                        "hastebin.com",
                        "imgur.com",
                        "livejournal.com",
                        "mediafire.com",
                        "mega.co.nz",
                        "mega.nz",
                        "onedrive.com",
                        "paste.ee",
                        "pastebin.com",
                        "pastebin.pl",
                        "pastetext.net",
                        "privatlab.com",
                        "privatlab.net",
                        "reddit.com",
                        "send.exploit.in",
                        "sendspace.com",
                        "steamcommunity.com",
                        "storage.googleapis.com",
                        "technet.microsoft.com",
                        "temp.sh",
                        "transfer.sh",
                        "twitter.com",
                        "ufile.io",
                        "abuse.ch",
                        "vimeo.com",
                        "wetransfer.com",
                        "youtube.com"
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "One might need to exclude other internet browsers found in it's network or other applications like ones mentioned above from Microsoft Defender.",
                "Ninite contacting githubusercontent.com"
            ],
            "id": "297ae038-edc2-4b2e-bb3e-7c5fc94dd5c7",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/07/16",
            "references": [
                "https://content.fireeye.com/apt-41/rpt-apt41",
                "https://securelist.com/the-tetrade-brazilian-banking-malware/97779/",
                "https://blog.bushidotoken.net/2021/04/dead-drop-resolvers-espionage-inspired.html",
                "https://github.com/kleiton0x00/RedditC2",
                "https://twitter.com/kleiton0x7e/status/1600567316810551296",
                "https://www.linkedin.com/posts/kleiton-kurti_github-kleiton0x00redditc2-abusing-reddit-activity-7009939662462984192-5DbI/?originalSubdomain=al"
            ],
            "related": [
                {
                    "id": "d7b09985-95a3-44be-8450-b6eadf49833e",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1102",
                "attack.t1102.001"
            ],
            "title": "Potential Dead Drop Resolvers"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/19",
            "description": "Detects an a non-browser process interacting with the Telegram API which could indicate use of a covert C2",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_brave": {
                    "Image|endswith": "\\brave.exe"
                },
                "filter_main_chrome": {
                    "Image": [
                        "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe",
                        "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_main_maxthon": {
                    "Image|endswith": "\\maxthon.exe"
                },
                "filter_main_edge_1": [
                    {
                        "Image|startswith": "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\"
                    },
                    {
                        "Image|endswith": "\\WindowsApps\\MicrosoftEdge.exe"
                    },
                    {
                        "Image": [
                            "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe",
                            "C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"
                        ]
                    }
                ],
                "filter_main_opera": {
                    "Image|endswith": "\\opera.exe"
                },
                "filter_main_edge_2": {
                    "Image|endswith": [
                        "\\msedge.exe",
                        "\\msedgewebview2.exe"
                    ],
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\",
                        "C:\\Program Files\\Microsoft\\EdgeCore\\"
                    ]
                },
                "filter_main_safari": {
                    "Image|endswith": "\\safari.exe"
                },
                "filter_main_seamonkey": {
                    "Image|endswith": "\\seamonkey.exe"
                },
                "filter_main_vivaldi": {
                    "Image|endswith": "\\vivaldi.exe"
                },
                "filter_main_firefox": {
                    "Image": [
                        "C:\\Program Files\\Mozilla Firefox\\firefox.exe",
                        "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_main_whale": {
                    "Image|endswith": "\\whale.exe"
                },
                "selection": {
                    "DestinationHostname|contains": "api.telegram.org"
                },
                "filter_main_ie": {
                    "Image": [
                        "C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe",
                        "C:\\Program Files\\Internet Explorer\\iexplore.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate applications communicating with the Telegram API e.g. web browsers not in the exclusion list, app with an RSS  etc."
            ],
            "id": "c3dbbc9f-ef1d-470a-a90a-d343448d5875",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://www.ncsc.gov.uk/static-assets/documents/malware-analysis-reports/small-sieve/NCSC-MAR-Small-Sieve.pdf"
            ],
            "tags": [
                "attack.command_and_control",
                "attack.t1102"
            ],
            "title": "Suspicious Non-Browser Network Communication With Telegram API",
            "status": "test"
        },
        {
            "author": "Gavin Knapp",
            "date": "2023/05/03",
            "description": "Detects a non-browser process communicating with the Notion API. This could indicate potential use of a covert C2 channel such as \"OffensiveNotion C2\"",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_brave": {
                    "Image|endswith": "\\brave.exe"
                },
                "filter_main_chrome": {
                    "Image": [
                        "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe",
                        "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_main_maxthon": {
                    "Image|endswith": "\\maxthon.exe"
                },
                "filter_main_notion": {
                    "Image|endswith": "\\AppData\\Local\\Programs\\Notion\\Notion.exe"
                },
                "filter_main_edge_1": [
                    {
                        "Image|startswith": "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\"
                    },
                    {
                        "Image|endswith": "\\WindowsApps\\MicrosoftEdge.exe"
                    },
                    {
                        "Image": [
                            "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe",
                            "C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"
                        ]
                    }
                ],
                "filter_main_opera": {
                    "Image|endswith": "\\opera.exe"
                },
                "filter_main_edge_2": {
                    "Image|endswith": [
                        "\\msedge.exe",
                        "\\msedgewebview2.exe"
                    ],
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\",
                        "C:\\Program Files\\Microsoft\\EdgeCore\\"
                    ]
                },
                "filter_main_safari": {
                    "Image|endswith": "\\safari.exe"
                },
                "filter_main_seamonkey": {
                    "Image|endswith": "\\seamonkey.exe"
                },
                "filter_main_vivaldi": {
                    "Image|endswith": "\\vivaldi.exe"
                },
                "filter_main_firefox": {
                    "Image": [
                        "C:\\Program Files\\Mozilla Firefox\\firefox.exe",
                        "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_main_whale": {
                    "Image|endswith": "\\whale.exe"
                },
                "selection": {
                    "DestinationHostname|contains": "api.notion.com"
                },
                "filter_main_ie": {
                    "Image": [
                        "C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe",
                        "C:\\Program Files\\Internet Explorer\\iexplore.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate applications communicating with the \"api.notion.com\" endpoint that are not already in the exclusion list. The desktop and browser applications do not appear to be using the API by default unless integrations are configured."
            ],
            "id": "7e9cf7b6-e827-11ed-a05b-15959c120003",
            "level": "low",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "references": [
                "https://github.com/mttaggart/OffensiveNotion",
                "https://medium.com/@huskyhacks.mk/we-put-a-c2-in-your-notetaking-app-offensivenotion-3e933bace332"
            ],
            "tags": [
                "attack.command_and_control",
                "attack.t1102"
            ],
            "title": "Potentially Suspicious Network Connection To Notion API",
            "status": "test"
        },
        {
            "author": "Gavin Knapp",
            "date": "2023/05/01",
            "description": "Detects a non-browser process interacting with the Google API which could indicate the use of a covert C2 such as Google Sheet C2 (GC2-sheet)\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_optional_brave": {
                    "Image|endswith": "\\brave.exe"
                },
                "filter_optional_chrome": {
                    "Image|endswith": [
                        ":\\Program Files\\Google\\Chrome\\Application\\chrome.exe",
                        ":\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_optional_edge_1": [
                    {
                        "Image|contains": ":\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\"
                    },
                    {
                        "Image|endswith": [
                            ":\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe",
                            ":\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe",
                            "\\WindowsApps\\MicrosoftEdge.exe"
                        ]
                    }
                ],
                "filter_optional_edge_2": {
                    "Image|contains": [
                        ":\\Program Files (x86)\\Microsoft\\EdgeCore\\",
                        ":\\Program Files\\Microsoft\\EdgeCore\\"
                    ],
                    "Image|endswith": [
                        "\\msedge.exe",
                        "\\msedgewebview2.exe"
                    ]
                },
                "filter_optional_firefox": {
                    "Image|endswith": [
                        ":\\Program Files\\Mozilla Firefox\\firefox.exe",
                        ":\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_optional_google_drive": {
                    "Image|contains": ":\\Program Files\\Google\\Drive File Stream\\",
                    "Image|endswith": "\\GoogleDriveFS.exe"
                },
                "filter_optional_googleupdate": {
                    "Image|endswith": "\\GoogleUpdate.exe"
                },
                "filter_optional_ie": {
                    "Image|endswith": [
                        ":\\Program Files (x86)\\Internet Explorer\\iexplore.exe",
                        ":\\Program Files\\Internet Explorer\\iexplore.exe"
                    ]
                },
                "filter_main_empty": {
                    "Image": ""
                },
                "filter_optional_maxthon": {
                    "Image|endswith": "\\maxthon.exe"
                },
                "filter_optional_opera": {
                    "Image|endswith": "\\opera.exe"
                },
                "filter_optional_outlook.exe": {
                    "Image|endswith": "\\outlook.exe"
                },
                "filter_optional_safari": {
                    "Image|endswith": "\\safari.exe"
                },
                "filter_optional_seamonkey": {
                    "Image|endswith": "\\seamonkey.exe"
                },
                "filter_optional_vivaldi": {
                    "Image|endswith": "\\vivaldi.exe"
                },
                "filter_optional_whale": {
                    "Image|endswith": "\\whale.exe"
                },
                "selection": {
                    "DestinationHostname|contains": [
                        "drive.googleapis.com",
                        "oauth2.googleapis.com",
                        "sheets.googleapis.com",
                        "www.googleapis.com"
                    ]
                },
                "filter_main_null": {
                    "Image": null
                }
            },
            "falsepositives": [
                "Legitimate applications communicating with the \"googleapis.com\" endpoints that are not already in the exclusion list. This is environmental dependent and requires further testing and tuning."
            ],
            "id": "7e9cf7b6-e827-11ed-a05b-0242ac120003",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2024/07/16",
            "references": [
                "https://github.com/looCiprian/GC2-sheet",
                "https://youtu.be/n2dFlSaBBKo",
                "https://services.google.com/fh/files/blogs/gcat_threathorizons_full_apr2023.pdf",
                "https://www.tanium.com/blog/apt41-deploys-google-gc2-for-attacks-cyber-threat-intelligence-roundup/",
                "https://www.bleepingcomputer.com/news/security/hackers-abuse-google-command-and-control-red-team-tool-in-attacks/"
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1102"
            ],
            "title": "Suspicious Non-Browser Network Communication With Google API"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/11/03",
            "description": "Detects an executable initiating a network connection to \"ngrok\" tunneling domains.\nAttackers were seen using this \"ngrok\" in order to store their second stage payloads and malware.\nWhile communication with such domains can be legitimate, often times is a sign of either data exfiltration by malicious actors or additional download.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DestinationHostname|contains": [
                        "tunnel.us.ngrok.com",
                        "tunnel.eu.ngrok.com",
                        "tunnel.ap.ngrok.com",
                        "tunnel.au.ngrok.com",
                        "tunnel.sa.ngrok.com",
                        "tunnel.jp.ngrok.com",
                        "tunnel.in.ngrok.com"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of the ngrok service."
            ],
            "id": "1d08ac94-400d-4469-a82f-daee9a908849",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/02/02",
            "references": [
                "https://twitter.com/hakluke/status/1587733971814977537/photo/1",
                "https://ngrok.com/docs/secure-tunnels/tunnels/ssh-reverse-tunnel-agent"
            ],
            "related": [
                {
                    "id": "18249279-932f-45e2-b37a-8925f2597670",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.command_and_control",
                "attack.t1567",
                "attack.t1568.002",
                "attack.t1572",
                "attack.t1090",
                "attack.t1102",
                "attack.s0508"
            ],
            "title": "Communication To Ngrok Tunneling Service Initiated"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2024/06/24",
            "description": "Detects an initiated network connection by a non browser process on the system to \"azurewebsites.net\". The latter was often used by threat actors as a malware hosting and exfiltration site.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_avant": {
                    "Image|endswith": "\\avant.exe",
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Avant Browser\\",
                        "C:\\Program Files\\Avant Browser\\"
                    ]
                },
                "filter_main_brave": {
                    "Image|endswith": "\\brave.exe",
                    "Image|startswith": "C:\\Program Files\\BraveSoftware\\"
                },
                "filter_main_chrome": {
                    "Image": [
                        "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe",
                        "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_main_chrome_appdata": {
                    "Image|endswith": "\\AppData\\Local\\Google\\Chrome\\Application\\chrome.exe",
                    "Image|startswith": "C:\\Users\\"
                },
                "filter_main_defender": {
                    "Image|contains": [
                        "C:\\Program Files\\Windows Defender Advanced Threat Protection\\",
                        "C:\\Program Files\\Windows Defender\\",
                        "C:\\ProgramData\\Microsoft\\Windows Defender\\Platform\\"
                    ],
                    "Image|endswith": [
                        "\\MsMpEng.exe",
                        "\\MsSense.exe"
                    ]
                },
                "filter_main_discord": {
                    "Image|contains": "\\AppData\\Local\\Discord\\",
                    "Image|endswith": "\\Discord.exe"
                },
                "filter_main_edge_1": [
                    {
                        "Image|startswith": "C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\"
                    },
                    {
                        "Image|endswith": "\\WindowsApps\\MicrosoftEdge.exe"
                    },
                    {
                        "Image": [
                            "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe",
                            "C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe"
                        ]
                    }
                ],
                "filter_main_edge_2": {
                    "Image|endswith": [
                        "\\msedge.exe",
                        "\\msedgewebview2.exe"
                    ],
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\Microsoft\\EdgeCore\\",
                        "C:\\Program Files\\Microsoft\\EdgeCore\\"
                    ]
                },
                "filter_main_empty": {
                    "Image": ""
                },
                "filter_main_falkon": {
                    "Image|endswith": "\\falkon.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\Falkon\\",
                        "C:\\Program Files (x86)\\Falkon\\"
                    ]
                },
                "filter_main_firefox": {
                    "Image": [
                        "C:\\Program Files\\Mozilla Firefox\\firefox.exe",
                        "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_main_firefox_appdata": {
                    "Image|endswith": "\\AppData\\Local\\Mozilla Firefox\\firefox.exe",
                    "Image|startswith": "C:\\Users\\"
                },
                "filter_main_flock": {
                    "Image|contains": "\\AppData\\Local\\Flock\\",
                    "Image|endswith": "\\Flock.exe"
                },
                "filter_main_ie": {
                    "Image": [
                        "C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe",
                        "C:\\Program Files\\Internet Explorer\\iexplore.exe"
                    ]
                },
                "filter_main_maxthon": {
                    "Image|contains": "\\AppData\\Local\\Maxthon\\",
                    "Image|endswith": "\\maxthon.exe"
                },
                "filter_main_null": {
                    "Image": null
                },
                "filter_main_opera": {
                    "Image|contains": "\\AppData\\Local\\Programs\\Opera\\",
                    "Image|endswith": "\\opera.exe"
                },
                "filter_main_phoebe": {
                    "Image|contains": "\\AppData\\Local\\Phoebe\\",
                    "Image|endswith": "\\Phoebe.exe"
                },
                "filter_main_prtg": {
                    "Image|endswith": [
                        "C:\\Program Files (x86)\\PRTG Network Monitor\\PRTG Probe.exe",
                        "C:\\Program Files\\PRTG Network Monitor\\PRTG Probe.exe"
                    ]
                },
                "filter_main_qtweb": {
                    "Image|endswith": "\\QtWeb.exe",
                    "Image|startswith": [
                        "C:\\Program Files (x86)\\QtWeb\\",
                        "C:\\Program Files\\QtWeb\\"
                    ]
                },
                "filter_main_safari": {
                    "Image|contains": [
                        "C:\\Program Files (x86)\\Safari\\",
                        "C:\\Program Files\\Safari\\"
                    ],
                    "Image|endswith": "\\safari.exe"
                },
                "selection": {
                    "DestinationHostname|endswith": "azurewebsites.net",
                    "Initiated": "true"
                },
                "filter_main_seamonkey": {
                    "Image|endswith": "\\seamonkey.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\SeaMonkey\\",
                        "C:\\Program Files (x86)\\SeaMonkey\\"
                    ]
                },
                "filter_main_slimbrowser": {
                    "Image|endswith": "\\slimbrowser.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\SlimBrowser\\",
                        "C:\\Program Files (x86)\\SlimBrowser\\"
                    ]
                },
                "filter_main_vivaldi": {
                    "Image|contains": "\\AppData\\Local\\Vivaldi\\",
                    "Image|endswith": "\\vivaldi.exe"
                },
                "filter_main_whale": {
                    "Image|endswith": "\\whale.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\Naver\\Naver Whale\\",
                        "C:\\Program Files (x86)\\Naver\\Naver Whale\\"
                    ]
                },
                "filter_main_whaterfox": {
                    "Image|endswith": "\\Waterfox.exe",
                    "Image|startswith": [
                        "C:\\Program Files\\Waterfox\\",
                        "C:\\Program Files (x86)\\Waterfox\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5c80b618-0dbb-46e6-acbb-03d90bcb6d83",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2024/07/16",
            "references": [
                "https://www.sentinelone.com/labs/wip26-espionage-threat-actors-abuse-cloud-infrastructure-in-targeted-telco-attacks/",
                "https://symantec-enterprise-blogs.security.com/threat-intelligence/harvester-new-apt-attacks-asia",
                "https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/",
                "https://intezer.com/blog/research/how-we-escaped-docker-in-azure-functions/"
            ],
            "related": [
                {
                    "id": "e043f529-8514-4205-8ab0-7f7d2927b400",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1102",
                "attack.t1102.001"
            ],
            "title": "Network Connection Initiated To AzureWebsites.NET By Non-Browser Process"
        },
        {
            "author": "Andreas Braathen (mnemonic.io)",
            "date": "2024/06/17",
            "description": "Detects an executable initiating a network connection to \"LocaltoNet\" tunneling sub-domains.\nLocaltoNet is a reverse proxy that enables localhost services to be exposed to the Internet.\nAttackers have been seen to use this service for command-and-control activities to bypass MFA and perimeter controls.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DestinationHostname|endswith": [
                        ".localto.net",
                        ".localtonet.com"
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Legitimate use of the LocaltoNet service."
            ],
            "id": "3ab65069-d82a-4d44-a759-466661a082d1",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "references": [
                "https://localtonet.com/documents/supported-tunnels",
                "https://cloud.google.com/blog/topics/threat-intelligence/unc3944-targets-saas-applications"
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1572",
                "attack.t1090",
                "attack.t1102"
            ],
            "title": "Communication To LocaltoNet Tunneling Service Initiated"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2023/01/18",
            "description": "Detects suspicious child processes of the \"Manage Engine ServiceDesk Plus\" Java web service",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_net": {
                    "CommandLine|contains": " stop",
                    "Image|endswith": [
                        "\\net.exe",
                        "\\net1.exe"
                    ]
                },
                "selection": {
                    "Image|endswith": [
                        "\\AppVLP.exe",
                        "\\bash.exe",
                        "\\bitsadmin.exe",
                        "\\calc.exe",
                        "\\certutil.exe",
                        "\\cscript.exe",
                        "\\curl.exe",
                        "\\forfiles.exe",
                        "\\mftrace.exe",
                        "\\mshta.exe",
                        "\\net.exe",
                        "\\net1.exe",
                        "\\notepad.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\query.exe",
                        "\\reg.exe",
                        "\\schtasks.exe",
                        "\\scrcons.exe",
                        "\\sh.exe",
                        "\\systeminfo.exe",
                        "\\whoami.exe",
                        "\\wmic.exe",
                        "\\wscript.exe"
                    ],
                    "ParentImage|contains|all": [
                        "\\ManageEngine\\ServiceDesk\\",
                        "\\java.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate sub processes started by Manage Engine ServiceDesk Pro"
            ],
            "id": "cea2b7ea-792b-405f-95a1-b903ea06458f",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/08/29",
            "references": [
                "https://www.horizon3.ai/manageengine-cve-2022-47966-technical-deep-dive/",
                "https://github.com/horizon3ai/CVE-2022-47966/blob/3a51c6b72ebbd87392babd955a8fbeaee2090b35/CVE-2022-47966.py",
                "https://blog.viettelcybersecurity.com/saml-show-stopper/"
            ],
            "tags": [
                "attack.command_and_control",
                "attack.t1102"
            ],
            "status": "test",
            "title": "Suspicious Child Process Of Manage Engine ServiceDesk"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/17",
            "description": "Detects execution of the \"cloudflared\" tool with the tunnel \"cleanup\" flag in order to cleanup tunnel connections.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "-config ",
                        "-connector-id "
                    ],
                    "CommandLine|contains|all": [
                        " tunnel ",
                        "cleanup "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate usage of Cloudflared."
            ],
            "id": "7050bba1-1aed-454e-8f73-3f46f09ce56a",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2023/12/21",
            "references": [
                "https://github.com/cloudflare/cloudflared",
                "https://developers.cloudflare.com/cloudflare-one/connections/connect-apps"
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1102",
                "attack.t1090",
                "attack.t1572"
            ],
            "title": "Cloudflared Tunnel Connections Cleanup"
        },
        {
            "author": "Janantha Marasinghe, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/17",
            "description": "Detects execution of the \"cloudflared\" tool to connect back to a tunnel. This was seen used by threat actors to maintain persistence and remote access to compromised networks.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "-config ",
                        "-credentials-contents ",
                        "-credentials-file ",
                        "-token "
                    ],
                    "CommandLine|contains|all": [
                        " tunnel ",
                        " run "
                    ]
                }
            },
            "falsepositives": [
                "Legitimate usage of Cloudflared tunnel."
            ],
            "id": "9a019ffc-3580-4c9d-8d87-079f7e8d3fd4",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2023/12/20",
            "references": [
                "https://blog.reconinfosec.com/emergence-of-akira-ransomware-group",
                "https://github.com/cloudflare/cloudflared",
                "https://developers.cloudflare.com/cloudflare-one/connections/connect-apps"
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1102",
                "attack.t1090",
                "attack.t1572"
            ],
            "title": "Cloudflared Tunnel Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/11/03",
            "description": "Detects an executable accessing an ngrok tunneling endpoint, which could be a sign of forbidden exfiltration of data exfiltration by malicious actors",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DestinationHostname|contains": [
                        "tunnel.us.ngrok.com",
                        "tunnel.eu.ngrok.com",
                        "tunnel.ap.ngrok.com",
                        "tunnel.au.ngrok.com",
                        "tunnel.sa.ngrok.com",
                        "tunnel.jp.ngrok.com",
                        "tunnel.in.ngrok.com"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of ngrok"
            ],
            "id": "19bf6fdb-7721-4f3d-867f-53467f6a5db6",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "linux"
            },
            "references": [
                "https://twitter.com/hakluke/status/1587733971814977537/photo/1",
                "https://ngrok.com/docs/secure-tunnels/tunnels/ssh-reverse-tunnel-agent"
            ],
            "title": "Communication To Ngrok Tunneling Service - Linux",
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.command_and_control",
                "attack.t1567",
                "attack.t1568.002",
                "attack.t1572",
                "attack.t1090",
                "attack.t1102",
                "attack.s0508"
            ]
        },
        {
            "author": "Andreas Braathen (mnemonic.io)",
            "date": "2024/06/17",
            "description": "Detects an executable initiating a network connection to \"LocaltoNet\" tunneling sub-domains.\nLocaltoNet is a reverse proxy that enables localhost services to be exposed to the Internet.\nAttackers have been seen to use this service for command-and-control activities to bypass MFA and perimeter controls.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DestinationHostname|endswith": [
                        ".localto.net",
                        ".localtonet.com"
                    ],
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Legitimate use of the LocaltoNet service."
            ],
            "id": "c4568f5d-131f-4e78-83d4-45b2da0ec4f1",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "linux"
            },
            "references": [
                "https://localtonet.com/documents/supported-tunnels",
                "https://cloud.google.com/blog/topics/threat-intelligence/unc3944-targets-saas-applications"
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1572",
                "attack.t1090",
                "attack.t1102"
            ],
            "title": "Communication To LocaltoNet Tunneling Service Initiated - Linux"
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Anastasios Pingios"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "command-and-control"
        }
    ],
    "x_mitre_detection": "Host data that can relate unknown or suspicious process activity using a network connection is important to supplement any existing indicators of compromise based on malware command and control signatures and infrastructure or the presence of strong encryption. Packet capture analysis will require SSL/TLS inspection if data is encrypted. Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). User behavior monitoring may help to detect abnormal patterns of activity.(Citation: University of Birmingham C2)",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.1",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Network Traffic: Network Traffic Flow",
        "Network Traffic: Network Traffic Content",
        "Network Traffic: Network Connection Creation"
    ],
    "x_mitre_permissions_required": [
        "User"
    ]
}