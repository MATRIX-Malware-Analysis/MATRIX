{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--03aec0ce-ebc5-4024-ae2b-d340e0aa7427",
    "created": "2024-08-13T14:46:36.897951Z",
    "modified": "2024-08-13T14:46:48.368903Z",
    "name": "Process Hollowing: ",
    "description": "Adversaries may inject malicious code into suspended and hollowed processes in order to evade process-based defenses. Process hollowing is a method of executing arbitrary code in the address space of a separate live process.  Process hollowing is commonly performed by creating a process in a suspended state then unmapping/hollowing its memory, which can then be replaced with malicious code. A victim process can be created with native Windows API calls such as CreateProcess, which includes a flag to suspend the processes primary thread. At this point the process can be unmapped using APIs calls such as ZwUnmapViewOfSection or NtUnmapViewOfSection  before being written to, realigned to the injected code, and resumed via VirtualAllocEx, WriteProcessMemory, SetThreadContext, then ResumeThread respectively.[1][2]This is very similar to Thread Local Storage but creates a new process rather than targeting an existing process. This behavior will likely not result in elevated privileges since the injected process was spawned from (and thus inherits the security context) of the injecting process. However, execution via process hollowing may also evade detection from security products since the execution is masked under a legitimate process.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1055/012",
            "external_id": "T1055/012"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "match": "create process suspended"
                            },
                            {
                                "match": "write process memory"
                            },
                            {
                                "match": "resume thread"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Process Injection::Process Hollowing [T1055.012]",
                        "Defense Evasion::Reflective Code Loading [T1620]"
                    ],
                    "authors": [
                        "william.ballenthin@mandiant.com"
                    ],
                    "examples": [
                        "Practical Malware Analysis Lab 12-02.exe_:0x4010EA"
                    ],
                    "name": "use process replacement",
                    "namespace": "host-interaction/process/inject",
                    "references": [
                        "http://www.autosectools.com/process-hollowing.pdf",
                        "https://www.andreafortuna.org/2017/10/09/understanding-process-hollowing/"
                    ],
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "@SBousseaden (detection), Thomas Patzke (rule)",
            "date": "2019/02/01",
            "description": "Detects remote thread creation from CACTUSTORCH as described in references.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "SourceImage|endswith": [
                        "\\System32\\cscript.exe",
                        "\\System32\\wscript.exe",
                        "\\System32\\mshta.exe",
                        "\\winword.exe",
                        "\\excel.exe"
                    ],
                    "StartModule": null,
                    "TargetImage|contains": "\\SysWOW64\\"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "2e4e488a-6164-4811-9ea1-f960c7359c40",
            "level": "high",
            "logsource": {
                "category": "create_remote_thread",
                "product": "windows"
            },
            "modified": "2023/05/05",
            "references": [
                "https://twitter.com/SBousseaden/status/1090588499517079552",
                "https://github.com/mdsecactivebreach/CACTUSTORCH"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1055.012",
                "attack.t1059.005",
                "attack.t1059.007",
                "attack.t1218.005"
            ],
            "title": "HackTool - CACTUSTORCH Remote Thread Creation"
        },
        {
            "author": "Christopher Peacock '@securepeacock', SCYTHE '@scythe_io', Sittikorn S",
            "date": "2022/01/25",
            "description": "Detects when a memory process image does not match the disk image, indicative of process hollowing.",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_generic": {
                    "Image|contains": [
                        ":\\Program Files (x86)",
                        ":\\Program Files\\",
                        ":\\Windows\\System32\\wbem\\WMIADAP.exe",
                        ":\\Windows\\SysWOW64\\wbem\\WMIADAP.exe"
                    ]
                },
                "filter_optional_edge": {
                    "Image|endswith": "\\WindowsApps\\MicrosoftEdge.exe"
                },
                "filter_optional_opera": {
                    "Image|contains": "\\AppData\\Local\\Programs\\Opera\\",
                    "Image|endswith": "\\opera.exe"
                },
                "selection": {
                    "Type": "Image is replaced"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c4b890e5-8d8c-4496-8c66-c805753817cd",
            "level": "medium",
            "logsource": {
                "category": "process_tampering",
                "product": "windows"
            },
            "modified": "2023/11/28",
            "references": [
                "https://twitter.com/SecurePeacock/status/1486054048390332423?s=20",
                "https://www.bleepingcomputer.com/news/microsoft/microsoft-sysmon-now-detects-malware-process-tampering-attempts/"
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.privilege_escalation",
                "attack.t1055.012"
            ],
            "title": "Potential Process Hollowing Activity"
        }
    ]
}