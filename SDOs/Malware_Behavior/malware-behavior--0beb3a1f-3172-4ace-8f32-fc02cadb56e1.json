{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--0beb3a1f-3172-4ace-8f32-fc02cadb56e1",
    "created": "2024-08-13T14:46:36.8946Z",
    "modified": "2024-08-13T14:46:48.364713Z",
    "name": "Credentials from Web Browsers: ",
    "description": "Adversaries may acquire credentials from web browsers by reading files specific to the target browser.[1] Web browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future. Web browsers typically store the credentials in an encrypted format within a credential store; however, methods exist to extract plaintext credentials from web browsers.For example, on Windows systems, encrypted credentials may be obtained from Google Chrome by reading a database file, AppData\\Local\\Google\\Chrome\\User Data\\Default\\Login Data and executing a SQL query: SELECT action_url, username_value, password_value FROM logins;. The plaintext password can then be obtained by passing the encrypted credentials to the Windows API function CryptUnprotectData, which uses the victim\u2019s cached logon credentials as the decryption key.[2]Adversaries have executed similar procedures for common web browsers such as FireFox, Safari, Edge, etc.[3][4] Windows stores Internet Explorer and Microsoft Edge credentials in Credential Lockers managed by the Windows Credential Manager.Adversaries may also acquire credentials by searching web browser process memory for patterns that commonly match credentials.[5]After acquiring credentials from web browsers, adversaries may attempt to recycle the credentials across different systems and/or accounts in order to expand access. This can result in significantly furthering an adversary's objective in cases where credentials gained from web browsers overlap with privileged accounts (e.g. domain administrator).",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1555/003",
            "external_id": "T1555/003"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "string": "/\\\\+(Edge|Chrome|Chromium|Brave\\-Browser|YandexBrowser|Kometa|Orbitum|Dragon|Torch|Amigo)\\\\+User Data\\\\+Default(\\\\+Network)?\\\\+(Cookies|Login Data)/i"
                                    },
                                    {
                                        "string": "/\\\\Opera Software\\\\Opera Stable\\\\(Login Data|Cookies)/i"
                                    }
                                ]
                            },
                            {
                                "or": [
                                    {
                                        "string": "/SELECT ((date_created|username_element|password_element|origin_url|signon_realm|action_url|username_value|password_value),?\\s?)+ FROM logins/i"
                                    },
                                    {
                                        "string": "/SELECT ((creation_utc|encrypted_value),?\\s?)+ FROM cookies/i"
                                    },
                                    {
                                        "2 or more": [
                                            {
                                                "substring": "date_created"
                                            },
                                            {
                                                "substring": "encrypted_value"
                                            },
                                            {
                                                "substring": "creation_utc"
                                            },
                                            {
                                                "substring": "username_element"
                                            },
                                            {
                                                "substring": "username_value"
                                            },
                                            {
                                                "substring": "password_element"
                                            },
                                            {
                                                "substring": "origin_url"
                                            },
                                            {
                                                "substring": "signon_realm"
                                            },
                                            {
                                                "substring": "action_url"
                                            },
                                            {
                                                "substring": "password_value"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Credential Access::Credentials from Password Stores::Credentials from Web Browsers [T1555.003]"
                    ],
                    "authors": [
                        "@_re_fox",
                        "still@teamt5.org"
                    ],
                    "examples": [
                        "2fd45662e3d0ec0077ea2fa66b6378f0:0x6000039",
                        "54390bda109aab7fc006b8b4ead5b6c2:0x1006E8D3"
                    ],
                    "name": "gather chrome based browser login information",
                    "namespace": "collection/browser",
                    "scopes": {
                        "dynamic": "file",
                        "static": "file"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "2 or more": [
                                    {
                                        "string": "/\\\\Mozilla\\\\Firefox\\\\profiles(\\.ini)?/i"
                                    },
                                    {
                                        "string": "/\\\\(signons|cookies)\\.sqlite/i"
                                    },
                                    {
                                        "string": "/SELECT\\s+[a-z,\\s]{5,}FROM moz_(logins|cookies)/i"
                                    },
                                    {
                                        "string": "/FROM moz_(logins|cookies)/i"
                                    },
                                    {
                                        "substring": "WHERE moz_cookies.host LIKE"
                                    }
                                ]
                            },
                            {
                                "optional": [
                                    {
                                        "or": [
                                            {
                                                "string": "encryptedUsername"
                                            },
                                            {
                                                "string": "encryptedPassword"
                                            },
                                            {
                                                "string": "usernameField"
                                            },
                                            {
                                                "string": "formSubmitURL"
                                            },
                                            {
                                                "string": "httpRealm"
                                            },
                                            {
                                                "string": "passwordField"
                                            },
                                            {
                                                "string": "timeCreated"
                                            },
                                            {
                                                "string": "timeLastUsed"
                                            },
                                            {
                                                "string": "timePasswordChanged"
                                            },
                                            {
                                                "string": "timesUsed"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Credential Access::Credentials from Password Stores::Credentials from Web Browsers [T1555.003]"
                    ],
                    "authors": [
                        "@_re_fox",
                        "still@teamt5.org"
                    ],
                    "examples": [
                        "7204e3efc2434012e13ca939db0d0b02:0x4073c0",
                        "54390bda109aab7fc006b8b4ead5b6c2:0x1006e58b"
                    ],
                    "name": "gather firefox profile information",
                    "namespace": "collection/browser",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "TropChaud",
            "date": "2022/12/19",
            "description": "Detect usage of the \"sqlite\" binary to query databases in Chromium-based browsers for potential data stealing.",
            "detection": {
                "condition": "all of selection_*",
                "selection_chromium": {
                    "CommandLine|contains": [
                        "\\User Data\\",
                        "\\Opera Software\\",
                        "\\ChromiumViewer\\"
                    ]
                },
                "selection_data": {
                    "CommandLine|contains": [
                        "Login Data",
                        "Cookies",
                        "Web Data",
                        "History",
                        "Bookmarks"
                    ]
                },
                "selection_sql": [
                    {
                        "Product": "SQLite"
                    },
                    {
                        "Image|endswith": [
                            "\\sqlite.exe",
                            "\\sqlite3.exe"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "24c77512-782b-448a-8950-eddb0785fc71",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/01/19",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/84d9edaaaa2c5511144521b0e4af726d1c7276ce/atomics/T1539/T1539.md#atomic-test-2---steal-chrome-cookies-windows",
                "https://blog.cyble.com/2022/04/21/prynt-stealer-a-new-info-stealer-performing-clipper-and-keylogger-activities/"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1539",
                "attack.t1555.003",
                "attack.collection",
                "attack.t1005"
            ],
            "title": "SQLite Chromium Profile Data DB Access"
        },
        {
            "author": "frack113",
            "date": "2022/08/20",
            "description": "Detects the execution of WebBrowserPassView.exe. A password recovery tool that reveals the passwords stored by the following Web browsers, Internet Explorer (Version 4.0 - 11.0), Mozilla Firefox (All Versions), Google Chrome, Safari, and Opera",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Description": "Web Browser Password Viewer"
                    },
                    {
                        "Image|endswith": "\\WebBrowserPassView.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate use"
            ],
            "id": "d0dae994-26c6-4d2d-83b5-b3c8b79ae513",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1555.003/T1555.003.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1555.003"
            ],
            "title": "PUA - WebBrowserPassView Execution"
        },
        {
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2023/12/04",
            "description": "Detects commandline keywords indicative of potential usge of the tool WinPwn. A tool for Windows and Active Directory reconnaissance and exploitation.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "Offline_Winpwn",
                        "WinPwn ",
                        "WinPwn.exe",
                        "WinPwn.ps1"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d557dc06-62e8-4468-a8e8-7984124908ce",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://github.com/S3cur3Th1sSh1t/WinPwn",
                "https://www.publicnow.com/view/EB87DB49C654D9B63995FAD4C9DE3D3CC4F6C3ED?1671634841",
                "https://reconshell.com/winpwn-tool-for-internal-windows-pentesting-and-ad-security/",
                "https://github.com/redcanaryco/atomic-red-team/blob/4d6c4e8e23d465af7a2388620cfe3f8c76e16cf0/atomics/T1082/T1082.md",
                "https://grep.app/search?q=winpwn&filter[repo][0]=redcanaryco/atomic-red-team"
            ],
            "related": [
                {
                    "id": "851fd622-b675-4d26-b803-14bc7baa517a",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.discovery",
                "attack.execution",
                "attack.privilege_escalation",
                "attack.t1046",
                "attack.t1082",
                "attack.t1106",
                "attack.t1518",
                "attack.t1548.002",
                "attack.t1552.001",
                "attack.t1555",
                "attack.t1555.003"
            ],
            "title": "HackTool - WinPwn Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/23",
            "description": "Adversaries may acquire credentials from web browsers by reading files specific to the target browser.\nWeb browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.\nWeb browsers typically store the credentials in an encrypted format within a credential store.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmd": [
                    {
                        "CommandLine|contains": [
                            "copy-item",
                            "copy ",
                            "cpi ",
                            " cp ",
                            "move ",
                            "move-item",
                            " mi ",
                            " mv "
                        ]
                    },
                    {
                        "Image|endswith": [
                            "\\xcopy.exe",
                            "\\robocopy.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "XCOPY.EXE",
                            "robocopy.exe"
                        ]
                    }
                ],
                "selection_path": {
                    "CommandLine|contains": [
                        "\\Amigo\\User Data",
                        "\\BraveSoftware\\Brave-Browser\\User Data",
                        "\\CentBrowser\\User Data",
                        "\\Chromium\\User Data",
                        "\\CocCoc\\Browser\\User Data",
                        "\\Comodo\\Dragon\\User Data",
                        "\\Elements Browser\\User Data",
                        "\\Epic Privacy Browser\\User Data",
                        "\\Google\\Chrome Beta\\User Data",
                        "\\Google\\Chrome SxS\\User Data",
                        "\\Google\\Chrome\\User Data\\",
                        "\\Kometa\\User Data",
                        "\\Maxthon5\\Users",
                        "\\Microsoft\\Edge\\User Data",
                        "\\Mozilla\\Firefox\\Profiles",
                        "\\Nichrome\\User Data",
                        "\\Opera Software\\Opera GX Stable\\",
                        "\\Opera Software\\Opera Neon\\User Data",
                        "\\Opera Software\\Opera Stable\\",
                        "\\Orbitum\\User Data",
                        "\\QIP Surf\\User Data",
                        "\\Sputnik\\User Data",
                        "\\Torch\\User Data",
                        "\\uCozMedia\\Uran\\User Data",
                        "\\Vivaldi\\User Data"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "47147b5b-9e17-4d76-b8d2-7bac24c5ce1b",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/08/29",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1555.003/T1555.003.md"
            ],
            "related": [
                {
                    "id": "fc028194-969d-4122-8abe-0470d5b8f12f",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1555.003"
            ],
            "title": "Potential Browser Data Stealing"
        },
        {
            "id": "851fd622-b675-4d26-b803-14bc7baa517a",
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2023/12/04",
            "description": "Detects scriptblock text keywords indicative of potential usge of the tool WinPwn. A tool for Windows and Active Directory reconnaissance and exploitation.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "Offline_Winpwn",
                        "WinPwn ",
                        "WinPwn.exe",
                        "WinPwn.ps1"
                    ]
                }
            },
            "falsepositives": [
                "As the script block is a blob of text. False positive may occur with scripts that contain the keyword as a reference or simply use it for detection."
            ],
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/S3cur3Th1sSh1t/WinPwn",
                "https://www.publicnow.com/view/EB87DB49C654D9B63995FAD4C9DE3D3CC4F6C3ED?1671634841",
                "https://reconshell.com/winpwn-tool-for-internal-windows-pentesting-and-ad-security/",
                "https://github.com/redcanaryco/atomic-red-team/blob/4d6c4e8e23d465af7a2388620cfe3f8c76e16cf0/atomics/T1082/T1082.md",
                "https://grep.app/search?q=winpwn&filter[repo][0]=redcanaryco/atomic-red-team"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "d557dc06-62e8-4468-a8e8-7984124908ce"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.discovery",
                "attack.execution",
                "attack.privilege_escalation",
                "attack.t1046",
                "attack.t1082",
                "attack.t1106",
                "attack.t1518",
                "attack.t1548.002",
                "attack.t1552.001",
                "attack.t1555",
                "attack.t1555.003"
            ],
            "title": "HackTool - WinPwn Execution - ScriptBlock"
        },
        {
            "id": "fc028194-969d-4122-8abe-0470d5b8f12f",
            "author": "frack113",
            "date": "2022/01/30",
            "description": "Adversaries may acquire credentials from web browsers by reading files specific to the target browser.\nWeb browsers commonly save credentials such as website usernames and passwords so that they do not need to be entered manually in the future.\nWeb browsers typically store the credentials in an encrypted format within a credential store.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmd": {
                    "ScriptBlockText|contains|all": [
                        "Copy-Item",
                        "-Destination"
                    ]
                },
                "selection_path": {
                    "ScriptBlockText|contains": [
                        "\\Opera Software\\Opera Stable\\Login Data",
                        "\\Mozilla\\Firefox\\Profiles",
                        "\\Microsoft\\Edge\\User Data\\Default",
                        "\\Google\\Chrome\\User Data\\Default\\Login Data",
                        "\\Google\\Chrome\\User Data\\Default\\Login Data For Account"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "related": [
                {
                    "id": "98f4c75c-3089-44f3-b733-b327b9cd9c9d",
                    "type": "obsoletes"
                },
                {
                    "type": "similar",
                    "id": "47147b5b-9e17-4d76-b8d2-7bac24c5ce1b"
                }
            ],
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1555.003/T1555.003.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1555.003"
            ],
            "title": "Access to Browser Login Data"
        }
    ]
}