{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--11c77c7c-c7c9-43a1-aed3-a7459a5ace64",
    "created": "2024-08-13T14:46:37.049585Z",
    "modified": "2024-08-13T14:46:45.687389Z",
    "name": "Remote Services: Distributed Component Object Model",
    "description": "Adversaries may use Valid Accounts to interact with remote machines by taking advantage of Distributed Component Object Model (DCOM). The adversary may then perform actions as the logged-on user.The Windows Component Object Model (COM) is a component of the native Windows application programming interface (API) that enables interaction between software objects, or executable code that implements one or more interfaces. Through COM, a client object can call methods of server objects, which are typically Dynamic Link Libraries (DLL) or executables (EXE). Distributed COM (DCOM) is transparent middleware that extends the functionality of COM beyond a local computer using remote procedure call (RPC) technology.[1][2]Permissions to interact with local and remote server COM objects are specified by access control lists (ACL) in the Registry.[3] By default, only Administrators may remotely activate and launch COM objects through DCOM.[4]Through DCOM, adversaries operating in the context of an appropriately privileged user can remotely obtain arbitrary and even direct shellcode execution through Office applications[5] as well as other Windows objects that contain insecure methods.[6][7] DCOM can also execute macros in existing documents[8] and may also invoke Dynamic Data Exchange (DDE) execution directly through a COM created instance of a Microsoft Office application[9], bypassing the need for a malicious document. DCOM can be used as a method of remotely interacting with Windows Management Instrumentation. [10]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1021/003",
            "external_id": "T1021/003"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sagie Dulce, Dekel Paz",
            "date": "2022/01/01",
            "description": "Detects remote RPC calls that performs remote DCOM operations. These could be abused for lateral movement via DCOM or WMI.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3,
                    "EventLog": "RPCFW",
                    "InterfaceUuid": [
                        "4d9f4ab8-7d1c-11cf-861e-0020af6e7c57",
                        "99fcfec4-5260-101b-bbcb-00aa0021347a",
                        "000001a0-0000-0000-c000-000000000046",
                        "00000131-0000-0000-c000-000000000046",
                        "00000143-0000-0000-c000-000000000046",
                        "00000000-0000-0000-c000-000000000046"
                    ]
                }
            },
            "falsepositives": [
                "Some administrative tasks on remote host"
            ],
            "id": "68050b10-e477-4377-a99b-3721b422d6ef",
            "level": "high",
            "logsource": {
                "category": "application",
                "definition": "Requirements: install and apply the RPC Firewall to all processes with \"audit:true action:block uuid:367abb81-9844-35f1-ad32-98f038001003",
                "product": "rpc_firewall"
            },
            "modified": "2022/01/01",
            "references": [
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-srvs/accf23b0-0f57-441c-9185-43041f1b0ee9",
                "https://github.com/zeronetworks/rpcfirewall",
                "https://zeronetworks.com/blog/stopping-lateral-movement-via-the-rpc-firewall/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.003",
                "attack.t1047"
            ],
            "title": "Remote DCOM/WMI Lateral Movement"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga",
            "date": "2020/10/12",
            "description": "Detects potential DLL hijack of \"iertutil.dll\" found in the DCOM InternetExplorer.Application Class",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|endswith": "\\Internet Explorer\\iertutil.dll",
                    "Image|endswith": "\\Internet Explorer\\iexplore.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f354eba5-623b-450f-b073-0b5b2773b6aa",
            "level": "critical",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2022/12/18",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/201009-RemoteDCOMIErtUtilDLLHijack/notebook.html"
            ],
            "related": [
                {
                    "id": "e554f142-5cf3-4e55-ace9-a1b59e0def65",
                    "type": "obsoletes"
                },
                {
                    "id": "2f7979ae-f82b-45af-ac1d-2b10e93b0baa",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.002",
                "attack.t1021.003"
            ],
            "title": "Potential DCOM InternetExplorer.Application DLL Hijack - Image Load"
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/06/24",
            "description": "Detects signs of potential use of the WSMAN provider from uncommon processes locally and remote execution.",
            "detection": {
                "commandline_null": {
                    "CommandLine": null
                },
                "condition": "( request_client or respond_server ) and not 1 of filter* and not ( svchost and commandline_null )",
                "filter_citrix": {
                    "Image|startswith": "C:\\Program Files\\Citrix\\"
                },
                "filter_general": {
                    "Image|endswith": [
                        "\\powershell.exe",
                        "C:\\Windows\\System32\\sdiagnhost.exe",
                        "C:\\Windows\\System32\\services.exe"
                    ]
                },
                "filter_mscorsvw": {
                    "Image|endswith": "\\mscorsvw.exe",
                    "Image|startswith": [
                        "C:\\Windows\\Microsoft.NET\\Framework64\\v",
                        "C:\\Windows\\Microsoft.NET\\Framework\\v"
                    ]
                },
                "filter_nextron": {
                    "Image|startswith": "C:\\Windows\\Temp\\asgard2-agent\\"
                },
                "filter_ps_ise": {
                    "Image|endswith": "\\powershell_ise.exe"
                },
                "filter_svchost": {
                    "CommandLine|contains": [
                        "svchost.exe -k netsvcs -p -s BITS",
                        "svchost.exe -k GraphicsPerfSvcGroup -s GraphicsPerfSvc",
                        "svchost.exe -k NetworkService -p -s Wecsvc",
                        "svchost.exe -k netsvcs"
                    ]
                },
                "filter_svr_2019": {
                    "Image": [
                        "C:\\Windows\\System32\\Configure-SMRemoting.exe",
                        "C:\\Windows\\System32\\ServerManager.exe"
                    ]
                },
                "filter_upgrade": {
                    "Image|startswith": "C:\\$WINDOWS.~BT\\Sources\\"
                },
                "request_client": [
                    {
                        "ImageLoaded|endswith": [
                            "\\WsmSvc.dll",
                            "\\WsmAuto.dll",
                            "\\Microsoft.WSMan.Management.ni.dll"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "WsmSvc.dll",
                            "WSMANAUTOMATION.DLL",
                            "Microsoft.WSMan.Management.dll"
                        ]
                    }
                ],
                "respond_server": {
                    "Image|endswith": "\\svchost.exe",
                    "OriginalFileName": "WsmWmiPl.dll"
                },
                "svchost": {
                    "Image|endswith": "\\svchost.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ad1f4bb9-8dfb-4765-adb6-2a7cfb6c0f94",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2022/10/07",
            "references": [
                "https://twitter.com/chadtilbury/status/1275851297770610688",
                "https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/",
                "https://learn.microsoft.com/en-us/windows/win32/winrm/windows-remote-management-architecture",
                "https://github.com/bohops/WSMan-WinRM"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.001",
                "attack.lateral_movement",
                "attack.t1021.003"
            ],
            "title": "Suspicious WSMAN Provider Image Loads"
        },
        {
            "id": "2f7979ae-f82b-45af-ac1d-2b10e93b0baa",
            "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR), wagga",
            "date": "2020/10/12",
            "description": "Detects potential DLL hijack of \"iertutil.dll\" found in the DCOM InternetExplorer.Application Class over the network",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image": "System",
                    "TargetFilename|endswith": "\\Internet Explorer\\iertutil.dll"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "critical",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2022/12/18",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/201009-RemoteDCOMIErtUtilDLLHijack/notebook.html"
            ],
            "related": [
                {
                    "id": "e554f142-5cf3-4e55-ace9-a1b59e0def65",
                    "type": "obsoletes"
                },
                {
                    "type": "similar",
                    "id": "f354eba5-623b-450f-b073-0b5b2773b6aa"
                }
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.002",
                "attack.t1021.003"
            ],
            "title": "Potential DCOM InternetExplorer.Application DLL Hijack"
        },
        {
            "author": "Ecco, oscd.community, Jonhnathan Ribeiro, Tim Rauch",
            "date": "2019/09/03",
            "description": "Detects wmiexec/dcomexec/atexec/smbexec from Impacket framework",
            "detection": {
                "condition": "1 of selection_*",
                "selection_atexec": {
                    "CommandLine|contains|all": [
                        "cmd.exe",
                        "/C",
                        "Windows\\Temp\\",
                        "&1"
                    ],
                    "ParentCommandLine|contains": [
                        "svchost.exe -k netsvcs",
                        "taskeng.exe"
                    ]
                },
                "selection_other": {
                    "CommandLine|contains|all": [
                        "cmd.exe",
                        "/Q",
                        "/c",
                        "\\\\\\\\127.0.0.1\\\\",
                        "&1"
                    ],
                    "ParentImage|endswith": [
                        "\\wmiprvse.exe",
                        "\\mmc.exe",
                        "\\explorer.exe",
                        "\\services.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "10c14723-61c7-4c75-92ca-9af245723ad2",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/wmiexec.py",
                "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/atexec.py",
                "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/smbexec.py",
                "https://github.com/SecureAuthCorp/impacket/blob/8b1a99f7c715702eafe3f24851817bb64721b156/examples/dcomexec.py",
                "https://www.elastic.co/guide/en/security/current/suspicious-cmd-execution-via-wmi.html"
            ],
            "related": [
                {
                    "id": "e31f89f7-36fb-4697-8ab6-48823708353b",
                    "type": "obsoletes"
                }
            ],
            "status": "stable",
            "tags": [
                "attack.execution",
                "attack.t1047",
                "attack.lateral_movement",
                "attack.t1021.003"
            ],
            "title": "HackTool - Potential Impacket Lateral Movement Activity"
        },
        {
            "author": "@2xxeformyshirt (Security Risk Advisors) - rule; Teymur Kheirkhabarov (idea)",
            "date": "2020/03/04",
            "description": "Detects MMC20.Application Lateral Movement; specifically looks for the spawning of the parent MMC.exe with a command line of \"-Embedding\" as a child of svchost.exe",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "-Embedding",
                    "Image|endswith": "\\mmc.exe",
                    "ParentImage|endswith": "\\svchost.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "f1f3bf22-deb2-418d-8cce-e1a45e46a5bd",
            "level": "high",
            "modified": "2021/11/27",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/",
                "https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view?usp=sharing"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1021.003"
            ],
            "title": "MMC20 Lateral Movement"
        },
        {
            "author": "Karneades, Swisscom CSIRT",
            "date": "2019/08/05",
            "description": "Detects a Windows command line executable started from MMC",
            "detection": {
                "condition": "all of selection*",
                "selection1": {
                    "ParentImage|endswith": "\\mmc.exe"
                },
                "selection2": [
                    {
                        "Image|endswith": [
                            "\\cmd.exe",
                            "\\powershell.exe",
                            "\\pwsh.exe",
                            "\\wscript.exe",
                            "\\cscript.exe",
                            "\\sh.exe",
                            "\\bash.exe",
                            "\\reg.exe",
                            "\\regsvr32.exe"
                        ]
                    },
                    {
                        "Image|contains": "\\BITSADMIN"
                    }
                ]
            },
            "fields": [
                "CommandLine",
                "Image",
                "ParentCommandLine"
            ],
            "id": "05a2ab7e-ce11-4b63-86db-ab32e763e11d",
            "level": "high",
            "modified": "2022/07/14",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.003"
            ],
            "title": "MMC Spawning Windows Shell"
        },
        {
            "author": "Aaron Stratton",
            "date": "2023/11/13",
            "description": "Detects suspicious child processes of Excel which could be an indicator of lateral movement leveraging the \"ActivateMicrosoftApp\" Excel DCOM object.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_child": [
                    {
                        "OriginalFileName": [
                            "foxprow.exe",
                            "schdplus.exe",
                            "winproj.exe"
                        ]
                    },
                    {
                        "Image|endswith": [
                            "\\foxprow.exe",
                            "\\schdplus.exe",
                            "\\winproj.exe"
                        ]
                    }
                ],
                "selection_parent": {
                    "ParentImage|endswith": "\\excel.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "551d9c1f-816c-445b-a7a6-7a3864720d60",
            "level": "high",
            "references": [
                "https://posts.specterops.io/lateral-movement-abuse-the-power-of-dcom-excel-application-3c016d0d9922",
                "https://github.com/grayhatkiller/SharpExShell",
                "https://learn.microsoft.com/en-us/office/vba/api/excel.xlmsapplication"
            ],
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "status": "experimental",
            "tags": [
                "attack.t1021.003",
                "attack.lateral_movement"
            ],
            "title": "Potential Excel.EXE DCOM Lateral Movement Via ActivateMicrosoftApp"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g, Open Threat Research (OTR)",
            "date": "2020/10/12",
            "description": "Detects a threat actor creating a file named `iertutil.dll` in the `C:\\Program Files\\Internet Explorer\\` directory over the network for a DCOM InternetExplorer DLL Hijack scenario.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "SubjectUserName|endswith": "$"
                },
                "selection": {
                    "EventID": 5145,
                    "RelativeTargetName|endswith": "\\Internet Explorer\\iertutil.dll"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c39f0c81-7348-4965-ab27-2fde35a1b641",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/11/26",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/201009-RemoteDCOMIErtUtilDLLHijack/notebook.html"
            ],
            "status": "test",
            "title": "DCOM InternetExplorer.Application Iertutil DLL Hijack - Security",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.002",
                "attack.t1021.003"
            ]
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/06/24",
            "description": "Detects suspicious use of the WSMAN provider without PowerShell.exe as the host application.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_ps": {
                    "Data|contains": [
                        "HostApplication=powershell",
                        "HostApplication=C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell",
                        "HostApplication=C:\\Windows\\SysWOW64\\WindowsPowerShell\\v1.0\\powershell",
                        "HostApplication=C:/Windows/System32/WindowsPowerShell/v1.0/powershell",
                        "HostApplication=C:/Windows/SysWOW64/WindowsPowerShell/v1.0/powershell"
                    ]
                },
                "selection": {
                    "Data|contains": "ProviderName=WSMan"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "df9a0e0e-fedb-4d6c-8668-d765dfc92aa7",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "powershell-classic"
            },
            "modified": "2023/10/27",
            "references": [
                "https://twitter.com/chadtilbury/status/1275851297770610688",
                "https://bohops.com/2020/05/12/ws-management-com-another-approach-for-winrm-lateral-movement/",
                "https://github.com/bohops/WSMan-WinRM"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.001",
                "attack.lateral_movement",
                "attack.t1021.003"
            ],
            "title": "Suspicious Non PowerShell WSMAN COM Provider"
        }
    ]
}