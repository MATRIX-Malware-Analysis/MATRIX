{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--66dbe820-e481-4dfc-b3e4-f18b560e9821",
    "created": "2024-08-13T14:46:37.043422Z",
    "modified": "2024-08-13T14:46:45.648951Z",
    "name": "Application Layer Protocol",
    "description": "Adversaries may communicate using OSI application layer protocols to avoid detection/network filtering by blending in with existing traffic. Commands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server. Adversaries may utilize many different protocols, including those used for web browsing, transferring files, electronic mail, or DNS. For connections that occur internally within an enclave (such as those between a proxy or pivot node and other nodes), commonly used protocols are SMB, SSH, or RDP.[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1071",
            "external_id": "T1071"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1071",
            "external_id": "T1071"
        },
        {
            "source_name": "University of Birmingham C2",
            "description": "Gardiner, J.,  Cova, M., Nagaraja, S. (2014, February). Command & Control Understanding, Denying and Detecting. Retrieved April 20, 2016.",
            "url": "https://arxiv.org/ftp/arxiv/papers/1408/1408.1136.pdf"
        },
        {
            "source_name": "Mandiant APT29 Eye Spy Email Nov 22",
            "description": "Mandiant. (2022, May 2). UNC3524: Eye Spy on Your Email. Retrieved August 17, 2023.",
            "url": "https://www.mandiant.com/resources/blog/unc3524-eye-spy-email"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2020/04/15",
            "description": "Detects downloads from PwnDrp web servers developed for red team testing and most likely also used for criminal activity",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri|contains": "/pwndrop/"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "2b1ee7e4-89b6-4739-b7bb-b811b6607e5e",
            "level": "critical",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2021/11/27",
            "references": [
                "https://breakdev.org/pwndrop/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.t1102.001",
                "attack.t1102.003"
            ],
            "title": "PwnDrp Access"
        },
        {
            "author": "Florian Roth (Nextron Systems), X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2017/07/08",
            "description": "Detects suspicious user agent strings used by malware in proxy logs",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent": [
                        "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)",
                        "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR  1.1.4322)",
                        "HttpBrowser/1.0",
                        "*<|>*",
                        "nsis_inetc (mozilla)",
                        "Wget/1.9+cvs-stable (Red Hat modified)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)",
                        "*zeroup*",
                        "Mozilla/5.0 (Windows NT 5.1 ; v.*",
                        "* adlib/*",
                        "* tiny",
                        "* BGroom *",
                        "* changhuatong",
                        "* CholTBAgent",
                        "Mozilla/5.0 WinInet",
                        "RookIE/1.0",
                        "M",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)",
                        "Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)",
                        "backdoorbot",
                        "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)",
                        "Opera/8.81 (Windows NT 6.0; U; en)",
                        "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)",
                        "Opera",
                        "Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)",
                        "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)",
                        "MSIE",
                        "*(Charon; Inferno)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)",
                        "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)",
                        "Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)",
                        "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64)",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)",
                        "Mozilla/5.0 (Windows NT 6.1)",
                        "AppleWebkit/587.38 (KHTML, like Gecko)",
                        "Chrome/91.0.4472.77",
                        "Safari/537.36",
                        "Edge/91.0.864.37",
                        "Firefox/89.0",
                        "Gecko/20100101",
                        "* pxyscand*",
                        "* asd",
                        "* mdms",
                        "sample",
                        "nocase",
                        "Moxilla",
                        "Win32 *",
                        "*Microsoft Internet Explorer*",
                        "agent *",
                        "AutoIt",
                        "IczelionDownLoad",
                        "Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)",
                        "record",
                        "mozzzzzzzzzzz",
                        "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0",
                        "Havana/0.1",
                        "antSword/v2.1",
                        "rqwrwqrqwrqw",
                        "qwrqrwrqwrqwr",
                        "rc2.0/client",
                        "TakeMyPainBack",
                        "xxx",
                        "20112211",
                        "23591",
                        "901785252112",
                        "1235125521512",
                        "125122112551",
                        "B1D3N_RIM_MY_ASS",
                        "AYAYAYAY1337",
                        "iMightJustPayMySelfForAFeature",
                        "ForAFeature",
                        "Ares_ldr_v_*",
                        "Microsoft Internet Explorer",
                        "CLCTR",
                        "uploader",
                        "agent",
                        "License",
                        "vb wininet",
                        "Client",
                        "Lilith-Bot/3.0",
                        "svc/1.0",
                        "WSHRAT",
                        "ZeroStresser Botnet/1.5",
                        "OK",
                        "Project1sqlite",
                        "Project1",
                        "DuckTales",
                        "Zadanie",
                        "GunnaWunnaBlueTips",
                        "Xlmst",
                        "GeekingToTheMoon",
                        "SunShineMoonLight",
                        "BunnyRequester",
                        "BunnyTasks",
                        "BunnyStealer",
                        "BunnyLoader_Dropper",
                        "BunnyLoader",
                        "BunnyShell",
                        "SPARK-COMMIT",
                        "4B4DB4B3",
                        "SouthSide",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Tob 1.1)"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5c84856b-55a5-45f1-826f-13f37250cf4e",
            "level": "high",
            "modified": "2024/04/14",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "http://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-user_agents.rules",
                "http://www.botopedia.org/search?searchword=scan&searchphrase=all",
                "https://networkraptor.blogspot.com/2015/01/user-agent-strings.html",
                "https://perishablepress.com/blacklist/ua-2013.txt",
                "https://www.bluecoat.com/en-gb/security-blog/2015-05-05/know-your-agents",
                "https://twitter.com/kladblokje_88/status/1614673320124743681?s=12&t=joEpeVa5d58aHYNGA_To7Q",
                "https://pbs.twimg.com/media/FtYbfsDXoAQ1Y8M?format=jpg&name=large",
                "https://twitter.com/crep1x/status/1635034100213112833"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Malware User Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/06/09",
            "description": "Detects Baby Shark C2 Framework default communication patterns",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri|contains": "momyshark\\?key="
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "304810ed-8853-437f-9e36-c4975c3dfd7e",
            "level": "critical",
            "modified": "2024/02/15",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://nasbench.medium.com/understanding-detecting-c2-frameworks-babyshark-641be4595845"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "HackTool - BabyShark Agent Default URL Pattern"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/06/05",
            "description": "Detects suspicious requests to Telegram API without the usual Telegram User-Agent",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "c-useragent|contains": [
                        "Telegram",
                        "Bot"
                    ]
                },
                "selection": {
                    "cs-host": "api.telegram.org"
                }
            },
            "falsepositives": [
                "Legitimate use of Telegram bots in the company"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "b494b165-6634-483d-8c47-2026a6c52372",
            "level": "medium",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/18",
            "references": [
                "https://researchcenter.paloaltonetworks.com/2018/03/unit42-telerat-another-android-trojan-leveraging-telegrams-bot-api-to-target-iranian-users/",
                "https://blog.malwarebytes.com/threat-analysis/2016/11/telecrypt-the-ransomware-abusing-telegram-api-defeated/",
                "https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.t1102.002"
            ],
            "title": "Telegram API Access"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2020/07/13",
            "description": "Detects user agent and URI paths used by empire agents",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent": "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko",
                    "cs-method": "POST",
                    "cs-uri": [
                        "/admin/get.php",
                        "/news.php",
                        "/login/process.php"
                    ]
                }
            },
            "falsepositives": [
                "Valid requests with this exact user agent to server scripts of the defined names"
            ],
            "id": "b923f7d6-ac89-4a50-a71a-89fb846b4aa8",
            "level": "high",
            "modified": "2024/02/26",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://github.com/BC-SECURITY/Empire"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "HackTool - Empire UserAgent URI Combo"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/10/21",
            "description": "Detects suspicious user agent strings used by crypto miners in proxy logs",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|startswith": [
                        "XMRig ",
                        "ccminer"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "fa935401-513b-467b-81f4-f9e77aa0dd78",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/xmrig/xmrig/blob/da22b3e6c45825f3ac1f208255126cb8585cd4fc/src/base/kernel/Platform_win.cpp#L65",
                "https://github.com/xmrig/xmrig/blob/427b6516e0550200c17ca28675118f0fffcc323f/src/version.h"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Crypto Miner User Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/07/08",
            "description": "Detects suspicious malformed user agent strings in proxy logs",
            "detection": {
                "condition": "1 of selection* and not falsepositives",
                "falsepositives": [
                    {
                        "c-useragent": "Mozilla/3.0 * Acrobat *"
                    },
                    {
                        "cs-host|endswith": [
                            ".acrobat.com",
                            ".adobe.com",
                            ".adobe.io"
                        ]
                    }
                ],
                "selection1": {
                    "c-useragent|startswith": [
                        "user-agent",
                        "Mozilla/3.0 ",
                        "Mozilla/2.0 ",
                        "Mozilla/1.0 ",
                        "Mozilla ",
                        " Mozilla/",
                        "Mozila/",
                        "Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol"
                    ]
                },
                "selection2": {
                    "c-useragent|contains": [
                        " (compatible;MSIE ",
                        ".0;Windows NT ",
                        "loader"
                    ]
                },
                "selection3": {
                    "c-useragent": [
                        "_",
                        "CertUtil URL Agent",
                        "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0)",
                        "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0",
                        "HTTPS",
                        "Erbium-UA-4ce7c27cb4be9d32e333bf032c88235a",
                        "x",
                        "xxx"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "7195a772-4b3f-43a4-a210-6a003d65caa1",
            "level": "high",
            "modified": "2022/10/31",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://github.com/fastly/waf_testbed/blob/8bfc406551f3045e418cbaad7596cff8da331dfc/templates/default/scanners-user-agents.data.erb"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Suspicious User Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems), Brian Ingram (update)",
            "date": "2022/07/08",
            "description": "Detects User Agent strings that end with an equal sign, which can be a sign of base64 encoding.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|endswith": "="
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "894a8613-cf12-48b3-8e57-9085f54aa0c3",
            "level": "medium",
            "modified": "2023/05/04",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://blogs.jpcert.or.jp/en/2022/07/yamabot.html",
                "https://deviceatlas.com/blog/list-of-user-agent-strings#desktop"
            ],
            "related": [
                {
                    "id": "d443095b-a221-4957-a2c4-cd1756c9b747",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Potential Base64 Encoded User-Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/04/06",
            "description": "Detects WebDav DownloadCradle",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|startswith": "Microsoft-WebDAV-MiniRedir/",
                    "cs-method": "GET"
                }
            },
            "falsepositives": [
                "Administrative scripts that download files from the Internet",
                "Administrative scripts that retrieve certain website contents",
                "Legitimate WebDAV administration"
            ],
            "id": "e09aed7a-09e0-4c9a-90dd-f0d52507347e",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html"
            ],
            "modified": "2021/11/27",
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Windows WebDAV User Agent"
        },
        {
            "author": "Markus Neis, Florian Roth (Nextron Systems)",
            "date": "2024/02/15",
            "description": "Detects cobalt strike malleable profiles patterns (URI, User-Agents, Methods).",
            "detection": {
                "condition": "1 of selection_* and not 1 of filter_main_*",
                "filter_main_onedrive": {
                    "c-uri|contains": "://onedrive.live.com/",
                    "c-uri|startswith": "http"
                },
                "selection_amazon_1": {
                    "c-useragent": "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko",
                    "c-uri": "/s/ref=nb_sb_noss_1/167-3294888-0262949/field-keywords=books",
                    "cs-method": "GET",
                    "cs-cookie|endswith": "=csm-hit=s-24KU11BB82RZSYGJ3BDK|1419899012996",
                    "cs-host": "www.amazon.com"
                },
                "selection_amazon_2": {
                    "c-useragent": "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko",
                    "c-uri": "/N4215/adj/amzn.us.sr.aps",
                    "cs-method": "POST",
                    "cs-host": "www.amazon.com"
                },
                "selection_generic_1": {
                    "c-useragent": [
                        "Mozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.1)",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E )",
                        "Mozilla/5.0 (Windows; U; MSIE 7.0; Windows NT 5.2) Java/1.5.0_08"
                    ]
                },
                "selection_generic_2": {
                    "c-useragent|endswith": "; MANM; MANM)"
                },
                "selection_onedrive": {
                    "c-uri|endswith": "\\?manifest=wac",
                    "cs-method": "GET",
                    "cs-host": "onedrive.live.com"
                },
                "selection_oscp": {
                    "c-uri|contains": "/oscp/",
                    "cs-host": "ocsp.verisign.com"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f3f21ce1-cdef-4bfc-8328-ed2e826f5fac",
            "level": "high",
            "references": [
                "https://github.com/rsmudge/Malleable-C2-Profiles/blob/26323784672913923d20c5a638c6ca79459e8529/normal/amazon.profile",
                "https://www.hybrid-analysis.com/sample/ee5eca8648e45e2fea9dac0d920ef1a1792d8690c41ee7f20343de1927cc88b9?environmentId=100",
                "https://github.com/rsmudge/Malleable-C2-Profiles/blob/26323784672913923d20c5a638c6ca79459e8529/normal/ocsp.profile",
                "https://github.com/yeyintminthuhtut/Malleable-C2-Profiles-Collection/",
                "https://github.com/rsmudge/Malleable-C2-Profiles/blob/26323784672913923d20c5a638c6ca79459e8529/normal/onedrive_getonly.profile"
            ],
            "logsource": {
                "category": "proxy"
            },
            "related": [
                {
                    "id": "953b895e-5cc9-454b-b183-7f3db555452e",
                    "type": "obsoletes"
                },
                {
                    "id": "41b42a36-f62c-4c34-bd40-8cb804a34ad8",
                    "type": "obsoletes"
                },
                {
                    "id": "37325383-740a-403d-b1a2-b2b4ab7992e7",
                    "type": "obsoletes"
                },
                {
                    "id": "c9b33401-cc6a-4cf6-83bb-57ddcb2407fc",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "HackTool - CobaltStrike Malleable Profile Patterns - Proxy"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/05",
            "description": "Detects direct access to raw pastes in different paste services often used by malware in their second stages to download malicious code in encrypted or encoded form",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-uri|contains": [
                        ".paste.ee/r/",
                        ".pastebin.com/raw/",
                        ".hastebin.com/raw/",
                        ".ghostbin.co/paste/*/raw/",
                        "pastetext.net/",
                        "pastebin.pl/",
                        "paste.ee/"
                    ]
                }
            },
            "falsepositives": [
                "User activity (e.g. developer that shared and copied code snippets and used the raw link instead of just copy & paste)"
            ],
            "id": "5468045b-4fcc-4d1a-973c-c9c9578edacb",
            "level": "high",
            "modified": "2023/01/19",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://www.virustotal.com/gui/domain/paste.ee/relations"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.t1102.001",
                "attack.t1102.003",
                "attack.defense_evasion"
            ],
            "title": "Raw Paste Service Access"
        },
        {
            "author": "Florian Roth (Nextron Systems), Markus Neis",
            "date": "2019/11/12",
            "description": "Detects suspicious user agent strings used in APT malware in proxy logs",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent": [
                        "SJZJ (compatible; MSIE 6.0; Win32)",
                        "Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0",
                        "User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC",
                        "Mozilla/4.0 (compatible; MSIE 7.4; Win32;32-bit)",
                        "webclient",
                        "Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200",
                        "Mozilla/4.0 (compatible; MSI 6.0;",
                        "Mozilla/5.0 (Windows NT 6.3; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0",
                        "Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/",
                        "Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2",
                        "Mozilla/4.0",
                        "Netscape",
                        "Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7",
                        "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.13) Firefox/3.6.13 GTB7.1",
                        "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NETCLR 2.0.50727)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; SV1)",
                        "Mozilla/4.0 (compatible; MSIE 11.0; Windows NT 6.1; SV1)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Win32)",
                        "Mozilla v5.1 (Windows NT 6.1; rv:6.0.1) Gecko/20100101 Firefox/6.0.1",
                        "Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)",
                        "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30; .NET CLR 3.0.04506.648; InfoPath.1)",
                        "Mozilla/5.0 (Windows NT 6.1; WOW64) WinHttp/1.6.3.8 (WinHTTP/5.1) like Gecko",
                        "Mozilla v5.1 *",
                        "MSIE 8.0",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; InfoPath.2)",
                        "Mozilla/4.0 (compatible; RMS)",
                        "Mozilla/4.0 (compatible; MSIE 6.0; DynGate)",
                        "O/9.27 (W; U; Z)",
                        "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.0; Trident/5.0;  Trident/5.0*",
                        "Mozilla/5.0 (Windows NT 9; *",
                        "hots scot",
                        "Mozilla/5.0 (compatible; MSIE 10.0; Windows NT)",
                        "Mozilla/5.0 (Windows NT 6.1; WOW64) Chrome/28.0.1500.95 Safari/537.36",
                        "Mozilla/5.0 (Windows NT 6.2; Win32; rv:47.0)",
                        "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;SV1;",
                        "Mozilla/5.0 (X11; Linux i686; rv:22.0) Firefox/22.0",
                        "Mozilla/5.0 Chrome/72.0.3626.109 Safari/537.36",
                        "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:FTS_06) Gecko/22.36.35.06 Firefox/2.0",
                        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36 Edg/100.0.1185.39",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; InfoPath.3; .NET4.0C; .NET4.0E)",
                        "Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)",
                        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36 Edge/12.246001"
                    ]
                }
            },
            "falsepositives": [
                "Old browsers"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "6ec820f2-e963-4801-9127-d8b2dce4d31b",
            "level": "high",
            "modified": "2024/02/15",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "Internal Research"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "APT User Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/03/13",
            "description": "Detects Windows PowerShell Web Access",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|contains": " WindowsPowerShell/"
                }
            },
            "falsepositives": [
                "Administrative scripts that download files from the Internet",
                "Administrative scripts that retrieve certain website contents"
            ],
            "id": "c8557060-9221-4448-8794-96320e6f3e74",
            "level": "medium",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.utility/Invoke-WebRequest"
            ],
            "modified": "2021/11/27",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Windows PowerShell User Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/10",
            "description": "Detects Bitsadmin connections to IP addresses instead of FQDN names",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|startswith": "Microsoft BITS/",
                    "cs-host|endswith": [
                        "1",
                        "2",
                        "3",
                        "4",
                        "5",
                        "6",
                        "7",
                        "8",
                        "9"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8ccd35a2-1c7c-468b-b568-ac6cdf80eec3",
            "level": "high",
            "modified": "2022/08/24",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://isc.sans.edu/diary/Microsoft+BITS+Used+to+Download+Payloads/21027"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190"
            ],
            "title": "Bitsadmin to Uncommon IP Server Address"
        },
        {
            "author": "Florian Roth (Nextron Systems), Tim Shelton",
            "date": "2019/03/07",
            "description": "Detects Bitsadmin connections to domains with uncommon TLDs",
            "detection": {
                "condition": "selection and not falsepositives",
                "falsepositives": {
                    "cs-host|endswith": [
                        ".com",
                        ".net",
                        ".org",
                        ".scdn.co",
                        ".sfx.ms"
                    ]
                },
                "selection": {
                    "c-useragent|startswith": "Microsoft BITS/"
                }
            },
            "falsepositives": [
                "Rare programs that use Bitsadmin and update from regional TLDs e.g. .uk or .ca"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "9eb68894-7476-4cd6-8752-23b51f5883a7",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2023/05/17",
            "references": [
                "https://twitter.com/jhencinski/status/1102695118455349248",
                "https://isc.sans.edu/forums/diary/Investigating+Microsoft+BITS+Activity/23281/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1197",
                "attack.s0190"
            ],
            "title": "Bitsadmin to Uncommon TLD"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/07/08",
            "description": "Detects suspicious user agent strings used by exploit / pentest frameworks like Metasploit in proxy logs",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent": [
                        "Internet Explorer *",
                        "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; InfoPath.2)",
                        "Mozilla/4.0 (compatible; Metasploit RSPEC)",
                        "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)",
                        "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)",
                        "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)",
                        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Trident/4.0; SIMBAR={7DB0F6DE-8DE7-4841-9084-28FA914B0F2E}; SLCC1; .N",
                        "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)",
                        "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) AppleWebKit/525.13 (KHTML, like Gecko) Chrome/4.0.221.6 Safari/525.13",
                        "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MAAU)",
                        "Mozilla/5.0",
                        "Mozilla/4.0 (compatible; SPIPE/1.0",
                        "Mozilla/5.0 (Windows NT 6.3; rv:39.0) Gecko/20100101 Firefox/35.0",
                        "Sametime Community Agent",
                        "X-FORWARDED-FOR",
                        "DotDotPwn v2.1",
                        "SIPDROID",
                        "Mozilla/5.0 (Windows NT 10.0; Win32; x32; rv:60.0)",
                        "Mozilla/6.0 (X11; Linux x86_64; rv:24.0) Gecko/20140205     Firefox/27.0 Iceweasel/25.3.0",
                        "*wordpress hash grabber*",
                        "*exploit*"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ClientIP",
                "c-uri",
                "c-useragent"
            ],
            "id": "fdd1bfb5-f60b-4a35-910e-f36ed3d0b32f",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2021/11/27",
            "references": [
                "https://blog.didierstevens.com/2015/03/16/quickpost-metasploit-user-agent-strings/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Exploit Framework User Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/07/08",
            "description": "Detects a potentially suspicious empty user agent strings in proxy log.\nCould potentially indicate an uncommon request method.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent": ""
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "21e44d78-95e7-421b-a464-ffd8395659c4",
            "level": "medium",
            "logsource": {
                "category": "proxy"
            },
            "references": [
                "https://twitter.com/Carlos_Perez/status/883455096645931008"
            ],
            "modified": "2021/11/27",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "HTTP Request With Empty User Agent"
        },
        {
            "id": "d443095b-a221-4957-a2c4-cd1756c9b747",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/04",
            "description": "Detects suspicious encoded User-Agent strings, as seen used by some malware.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "c-useragent|startswith": [
                        "Q2hyb21l",
                        "QXBwbGVXZWJLaX",
                        "RGFsdmlr",
                        "TW96aWxsY"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "references": [
                "https://deviceatlas.com/blog/list-of-user-agent-strings#desktop"
            ],
            "logsource": {
                "category": "proxy"
            },
            "related": [
                {
                    "type": "derived",
                    "id": "894a8613-cf12-48b3-8e57-9085f54aa0c3"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Suspicious Base64 Encoded User-Agent"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/05/10",
            "description": "Detects suspicious DNS queries using base64 encoding",
            "detection": {
                "condition": "selection",
                "selection": {
                    "query|contains": "==."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4153a907-2451-4e4f-a578-c52bb6881432",
            "logsource": {
                "category": "dns"
            },
            "level": "medium",
            "modified": "2022/10/09",
            "references": [
                "https://github.com/krmaxwell/dns-exfiltration"
            ],
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.003",
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious DNS Query with B64 Encoded String"
        },
        {
            "author": "Mike Wade",
            "date": "2020/09/16",
            "description": "Detects wannacry killswitch domain dns queries",
            "detection": {
                "condition": "selection",
                "selection": {
                    "query": [
                        "ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.testing",
                        "ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.test",
                        "ifferfsodp9ifjaposdfjhgosurijfaewrwergwea.com",
                        "ayylmaotjhsstasdfasdfasdfasdfasdfasdfasdf.com",
                        "iuqssfsodp9ifjaposdfjhgosurijfaewrwergwea.com"
                    ]
                }
            },
            "falsepositives": [
                "Analyst testing"
            ],
            "id": "3eaf6218-3bed-4d8a-8707-274096f12a18",
            "level": "high",
            "logsource": {
                "category": "dns"
            },
            "modified": "2022/03/24",
            "references": [
                "https://www.mandiant.com/resources/blog/wannacry-ransomware-campaign"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Wannacry Killswitch Domain"
        },
        {
            "author": "Markus Neis",
            "date": "2018/08/08",
            "description": "Detects strings used in command execution in DNS TXT Answer",
            "detection": {
                "condition": "selection",
                "selection": {
                    "answer|contains": [
                        "IEX",
                        "Invoke-Expression",
                        "cmd.exe"
                    ],
                    "record_type": "TXT"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8ae51330-899c-4641-8125-e39f2e07da72",
            "level": "high",
            "logsource": {
                "category": "dns"
            },
            "references": [
                "https://twitter.com/stvemillertime/status/1024707932447854592",
                "https://github.com/samratashok/nishang/blob/414ee1104526d7057f9adaeee196d91ae447283e/Backdoors/DNS_TXT_Pwnage.ps1"
            ],
            "modified": "2021/11/27",
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "DNS TXT Answer with Possible Execution Strings"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/05/10",
            "description": "Detects suspicious DNS queries known from Cobalt Strike beacons",
            "detection": {
                "condition": "1 of selection*",
                "selection1": {
                    "query|startswith": [
                        "aaa.stage.",
                        "post.1"
                    ]
                },
                "selection2": {
                    "query|contains": ".stage.123456."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "2975af79-28c4-4d2f-a951-9095f229df29",
            "logsource": {
                "category": "dns"
            },
            "level": "critical",
            "modified": "2022/10/09",
            "references": [
                "https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns",
                "https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Cobalt Strike DNS Beaconing"
        },
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/02/18",
            "description": "Detects the execution of suspicious child processes from macOS installer package parent process. This includes osascript, JXA, curl and wget amongst other interpreters",
            "detection": {
                "condition": "selection_installer",
                "selection_installer": {
                    "CommandLine|contains": [
                        "preinstall",
                        "postinstall"
                    ],
                    "Image|endswith": [
                        "/sh",
                        "/bash",
                        "/dash",
                        "/python",
                        "/ruby",
                        "/perl",
                        "/php",
                        "/javascript",
                        "/osascript",
                        "/tclsh",
                        "/curl",
                        "/wget"
                    ],
                    "ParentImage|endswith": [
                        "/package_script_service",
                        "/installer"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate software uses the scripts (preinstall, postinstall)"
            ],
            "id": "e0cfaecd-602d-41af-988d-f6ccebb2af26",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "level": "medium",
            "references": [
                "https://redcanary.com/blog/clipping-silver-sparrows-wings/",
                "https://github.com/elastic/detection-rules/blob/4312d8c9583be524578a14fe6295c3370b9a9307/rules/macos/execution_installer_package_spawned_network_event.toml"
            ],
            "tags": [
                "attack.t1059",
                "attack.t1059.007",
                "attack.t1071",
                "attack.t1071.001",
                "attack.execution",
                "attack.command_and_control"
            ],
            "title": "Suspicious Installer Package Child Process",
            "status": "test"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/12/20",
            "description": "Detects DNS requests to Cloudflared tunnels domains.\nAttackers can abuse that feature to establish a reverse shell or persistence on a machine.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "QueryName|endswith": [
                        ".v2.argotunnel.com",
                        "protocol-v2.argotunnel.com",
                        "trycloudflare.com",
                        "update.argotunnel.com"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of cloudflare tunnels will also trigger this."
            ],
            "id": "a1d9eec5-33b2-4177-8d24-27fe754d0812",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://www.guidepointsecurity.com/blog/tunnel-vision-cloudflared-abused-in-the-wild/",
                "Internal Research"
            ],
            "related": [
                {
                    "id": "7cd1dcdc-6edf-4896-86dc-d1f19ad64903",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Cloudflared Tunnels Related DNS Requests"
        },
        {
            "author": "citron_ninja",
            "date": "2023/10/25",
            "description": "Detects DNS query requests to Visual Studio Code tunnel domains. Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "QueryName|endswith": ".tunnels.api.visualstudio.com"
                }
            },
            "falsepositives": [
                "Legitimate use of Visual Studio Code tunnel will also trigger this."
            ],
            "id": "b3e6418f-7c7a-4fad-993a-93b65027a9f1",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2023/11/20",
            "references": [
                "https://ipfyx.fr/post/visual-studio-code-tunnel/",
                "https://badoption.eu/blog/2023/01/31/code_c2.html",
                "https://cydefops.com/vscode-data-exfiltration"
            ],
            "related": [
                {
                    "id": "9501f8e6-8e3d-48fc-a8a6-1089dd5d7ef4",
                    "type": "similar"
                },
                {
                    "id": "4b657234-038e-4ad5-997c-4be42340bce4",
                    "type": "similar"
                },
                {
                    "id": "1cb0c6ce-3d00-44fc-ab9c-6d6d577bf20b",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "DNS Query To Visual Studio Code Tunnels Domain"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/11/09",
            "description": "Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons",
            "detection": {
                "condition": "1 of selection*",
                "selection1": {
                    "QueryName|startswith": [
                        "aaa.stage.",
                        "post.1"
                    ]
                },
                "selection2": {
                    "QueryName|contains": ".stage.123456."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "Image",
                "CommandLine"
            ],
            "id": "f356a9c4-effd-4608-bbf8-408afd5cd006",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "level": "critical",
            "references": [
                "https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns",
                "https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/"
            ],
            "modified": "2023/01/16",
            "related": [
                {
                    "id": "0d18728b-f5bf-4381-9dcf-915539fff6c2",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious Cobalt Strike DNS Beaconing - Sysmon"
        },
        {
            "id": "1cb0c6ce-3d00-44fc-ab9c-6d6d577bf20b",
            "author": "citron_ninja",
            "date": "2023/10/25",
            "description": "Detects DNS query requests to Devtunnels domains. Attackers can abuse that feature to establish a reverse shell or persistence on a machine.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "QueryName|endswith": ".devtunnels.ms"
                }
            },
            "falsepositives": [
                "Legitimate use of Devtunnels will also trigger this."
            ],
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "level": "medium",
            "modified": "2023/11/20",
            "references": [
                "https://blueteamops.medium.com/detecting-dev-tunnels-16f0994dc3e2",
                "https://learn.microsoft.com/en-us/azure/developer/dev-tunnels/security",
                "https://cydefops.com/devtunnels-unleashed"
            ],
            "related": [
                {
                    "id": "9501f8e6-8e3d-48fc-a8a6-1089dd5d7ef4",
                    "type": "similar"
                },
                {
                    "id": "4b657234-038e-4ad5-997c-4be42340bce4",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "b3e6418f-7c7a-4fad-993a-93b65027a9f1"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "DNS Query To Devtunnels Domain"
        },
        {
            "author": "CertainlyP",
            "date": "2024/04/26",
            "description": "Detects outbound network connection initiated by Microsoft Dialer.\nThe Microsoft Dialer, also known as Phone Dialer, is a built-in utility application included in various versions of the Microsoft Windows operating system. Its primary function is to provide users with a graphical interface for managing phone calls via a modem or a phone line connected to the computer.\nThis is an outdated process in the current conext of it's usage and is a common target for info stealers for process injection, and is used to make C2 connections, common example is \"Rhadamanthys\"\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_local_ranges": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "10.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "::1/128",
                        "fe80::/10",
                        "fc00::/7"
                    ]
                },
                "selection": {
                    "Image|endswith": ":\\Windows\\System32\\dialer.exe",
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "In Modern Windows systems, unable to see legitimate usage of this process, However, if an organization has legitimate purpose for this there can be false positives."
            ],
            "id": "37e4024a-6c80-4d8f-b95d-2e7e94f3a8d1",
            "level": "high",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "references": [
                "hhttps://tria.ge/240301-rk34sagf5x/behavioral2",
                "https://app.any.run/tasks/6720b85b-9c53-4a12-b1dc-73052a78477d",
                "https://research.checkpoint.com/2023/rhadamanthys-v0-5-0-a-deep-dive-into-the-stealers-components/",
                "https://strontic.github.io/xcyclopedia/library/dialer.exe-0B69655F912619756C704A0BF716B61F.html"
            ],
            "status": "experimental",
            "tags": [
                "attack.execution",
                "attack.t1071.001"
            ],
            "title": "Outbound Network Connection Initiated By Microsoft Dialer"
        },
        {
            "author": "Aleksey Potapov, oscd.community",
            "date": "2019/10/22",
            "description": "Detects SILENTTRINITY stager dll loading activity",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Description|contains": "st2stager"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "75c505b1-711d-4f68-a357-8c3fe37dbf2d",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/02/17",
            "references": [
                "https://github.com/byt3bl33d3r/SILENTTRINITY"
            ],
            "related": [
                {
                    "id": "03552375-cc2c-4883-bbe4-7958d5a980be",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071"
            ],
            "title": "HackTool - SILENTTRINITY Stager DLL Load"
        },
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2019/10/24",
            "description": "Well-known DNS Exfiltration tools execution",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\iodine.exe"
                    },
                    {
                        "Image|contains": "\\dnscat2"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "98a96a5a-64a0-4c42-92c5-489da3866cb0",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://github.com/iagox86/dnscat2",
                "https://github.com/yarrick/iodine"
            ],
            "modified": "2021/11/27",
            "status": "test",
            "tags": [
                "attack.exfiltration",
                "attack.t1048.001",
                "attack.command_and_control",
                "attack.t1071.004",
                "attack.t1132.001"
            ],
            "title": "DNS Exfiltration and Tunneling Tools Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), citron_ninja",
            "date": "2023/10/25",
            "description": "Detects Visual Studio Code tunnel execution. Attackers can abuse this functionality to establish a C2 channel",
            "detection": {
                "condition": "1 of selection_*",
                "selection_only_tunnel": {
                    "CommandLine|endswith": ".exe tunnel",
                    "OriginalFileName": null
                },
                "selection_parent_tunnel": {
                    "CommandLine|contains|all": [
                        "/d /c ",
                        "\\servers\\Stable-",
                        "code-server.cmd"
                    ],
                    "Image|endswith": "\\cmd.exe",
                    "ParentCommandLine|endswith": " tunnel"
                },
                "selection_tunnel_args": {
                    "CommandLine|contains|all": [
                        ".exe tunnel",
                        "--name ",
                        "--accept-server-license-terms"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of Visual Studio Code tunnel"
            ],
            "id": "90d6bd71-dffb-4989-8d86-a827fedd6624",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://ipfyx.fr/post/visual-studio-code-tunnel/",
                "https://badoption.eu/blog/2023/01/31/code_c2.html",
                "https://code.visualstudio.com/docs/remote/tunnels"
            ],
            "status": "experimental",
            "title": "Visual Studio Code Tunnel Execution",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/09/28",
            "description": "Detects renamed Visual Studio Code tunnel execution. Attackers can abuse this functionality to establish a C2 channel",
            "detection": {
                "condition": "(1 of selection_image_* and not 1 of filter_main_image_*) or (selection_parent_tunnel and not 1 of filter_main_parent_*)",
                "filter_main_image_code": {
                    "Image|endswith": [
                        "\\code-tunnel.exe",
                        "\\code.exe"
                    ]
                },
                "selection_parent_tunnel": {
                    "CommandLine|contains|all": [
                        "/d /c ",
                        "\\servers\\Stable-",
                        "code-server.cmd"
                    ],
                    "Image|endswith": "\\cmd.exe",
                    "ParentCommandLine|endswith": " tunnel"
                },
                "filter_main_parent_code": {
                    "ParentImage|endswith": [
                        "\\code-tunnel.exe",
                        "\\code.exe"
                    ]
                },
                "selection_image_only_tunnel": {
                    "CommandLine|endswith": ".exe tunnel",
                    "OriginalFileName": null
                },
                "selection_image_tunnel_args": {
                    "CommandLine|contains|all": [
                        ".exe tunnel",
                        "--name ",
                        "--accept-server-license-terms"
                    ]
                },
                "selection_image_tunnel_service": {
                    "CommandLine|contains|all": [
                        "tunnel ",
                        "service",
                        "internal-run",
                        "tunnel-service.log"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "2cf29f11-e356-4f61-98c0-1bdb9393d6da",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://ipfyx.fr/post/visual-studio-code-tunnel/",
                "https://badoption.eu/blog/2023/01/31/code_c2.html",
                "https://code.visualstudio.com/docs/remote/tunnels"
            ],
            "status": "experimental",
            "title": "Renamed Visual Studio Code Tunnel Execution",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ]
        },
        {
            "id": "03552375-cc2c-4883-bbe4-7958d5a980be",
            "author": "Aleksey Potapov, oscd.community",
            "date": "2019/10/22",
            "description": "Detects SILENTTRINITY stager use via PE metadata",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Description|contains": "st2stager"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/13",
            "references": [
                "https://github.com/byt3bl33d3r/SILENTTRINITY"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "75c505b1-711d-4f68-a357-8c3fe37dbf2d"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071"
            ],
            "title": "HackTool - SILENTTRINITY Stager Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/10/25",
            "description": "Detects the execution of a shell (powershell, bash, wsl...) via Visual Studio Code tunnel. Attackers can abuse this functionality to establish a C2 channel and execute arbitrary commands on the system.",
            "detection": {
                "condition": "selection_parent and 1 of selection_child_*",
                "selection_child_1": {
                    "CommandLine|contains": "\\terminal\\browser\\media\\shellIntegration.ps1",
                    "Image|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe"
                    ]
                },
                "selection_child_2": {
                    "Image|endswith": [
                        "\\wsl.exe",
                        "\\bash.exe"
                    ]
                },
                "selection_parent": {
                    "ParentCommandLine|contains": ".vscode-server",
                    "ParentImage|contains": "\\servers\\Stable-",
                    "ParentImage|endswith": "\\server\\node.exe"
                }
            },
            "falsepositives": [
                "Legitimate use of Visual Studio Code tunnel and running code from there"
            ],
            "id": "f4a623c2-4ef5-4c33-b811-0642f702c9f1",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://ipfyx.fr/post/visual-studio-code-tunnel/",
                "https://badoption.eu/blog/2023/01/31/code_c2.html",
                "https://code.visualstudio.com/docs/remote/tunnels"
            ],
            "status": "experimental",
            "title": "Visual Studio Code Tunnel Shell Execution",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/10/25",
            "description": "Detects the installation of VsCode tunnel (code-tunnel) as a service.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "tunnel ",
                        "service",
                        "internal-run",
                        "tunnel-service.log"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate installation of code-tunnel as a service"
            ],
            "id": "30bf1789-379d-4fdc-900f-55cd0a90a801",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "level": "medium",
            "references": [
                "https://ipfyx.fr/post/visual-studio-code-tunnel/",
                "https://badoption.eu/blog/2023/01/31/code_c2.html",
                "https://code.visualstudio.com/docs/remote/tunnels"
            ],
            "status": "experimental",
            "title": "Visual Studio Code Tunnel Service Installation",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ]
        },
        {
            "id": "0d18728b-f5bf-4381-9dcf-915539fff6c2",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/16",
            "description": "Detects a program that invoked suspicious DNS queries known from Cobalt Strike beacons",
            "detection": {
                "condition": "selection_eid and 1 of selection_query_*",
                "selection_eid": {
                    "EventID": 3008
                },
                "selection_query_1": {
                    "QueryName|startswith": [
                        "aaa.stage.",
                        "post.1"
                    ]
                },
                "selection_query_2": {
                    "QueryName|contains": ".stage.123456."
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "logsource": {
                "definition": "Requirements: Microsoft-Windows-DNS Client Events/Operational Event Log must be enabled/collected in order to receive the events.",
                "product": "windows",
                "service": "dns-client"
            },
            "level": "critical",
            "related": [
                {
                    "type": "similar",
                    "id": "f356a9c4-effd-4608-bbf8-408afd5cd006"
                }
            ],
            "references": [
                "https://www.icebrg.io/blog/footprints-of-fin7-tracking-actor-patterns",
                "https://www.sekoia.io/en/hunting-and-detecting-cobalt-strike/"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.004"
            ],
            "title": "Suspicious Cobalt Strike DNS Beaconing - DNS Client"
        },
        {
            "author": "frack113",
            "date": "2022/01/23",
            "description": "Adversaries may communicate using application layer protocols associated with web traffic to avoid detection/network filtering by blending in with existing traffic.\nCommands to the remote system, and often the results of those commands, will be embedded within the protocol traffic between the client and server.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Invoke-WebRequest",
                        "-UserAgent "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d4488827-73af-4f8d-9244-7b7662ef046e",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "level": "medium",
            "modified": "2023/01/02",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1071.001/T1071.001.md#t1071001---web-protocols"
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Change User Agents with WebRequest"
        },
        {
            "author": "Alina Stepchenkova, Group-IB, oscd.community",
            "date": "2019/11/01",
            "description": "Detects Silence EmpireDNSAgent as described in the Group-IP report",
            "detection": {
                "condition": "empire and dnscat",
                "dnscat": {
                    "ScriptBlockText|contains|all": [
                        "set type=$LookupType`nserver",
                        "$Command | nslookup 2>&1 | Out-String",
                        "New-RandomDNSField",
                        "[Convert]::ToString($SYNOptions, 16)",
                        "$Session.Dead = $True",
                        "$Session[\"Driver\"] -eq"
                    ]
                },
                "empire": {
                    "ScriptBlockText|contains|all": [
                        "System.Diagnostics.Process",
                        "Stop-Computer",
                        "Restart-Computer",
                        "Exception in execution",
                        "$cmdargs",
                        "Close-Dnscat2Tunnel"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "3ceb2083-a27f-449a-be33-14ec1b7cc973",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "level": "critical",
            "modified": "2023/04/03",
            "references": [
                "https://www.group-ib.com/resources/threat-research/silence_2.0.going_global.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.001",
                "attack.command_and_control",
                "attack.t1071.004",
                "attack.t1572",
                "attack.impact",
                "attack.t1529",
                "attack.g0091",
                "attack.s0363"
            ],
            "title": "Silence.EDA Detection"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/09/15",
            "description": "Detects a suspicious curl process start on linux with set useragent options",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        " -A ",
                        " --user-agent "
                    ],
                    "Image|endswith": "/curl"
                }
            },
            "falsepositives": [
                "Scripts created by developers and admins",
                "Administrative activity"
            ],
            "id": "b86d356d-6093-443d-971c-9b07db583c68",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "level": "medium",
            "references": [
                "https://curl.se/docs/manpage.html"
            ],
            "related": [
                {
                    "id": "3286d37a-00fd-41c2-a624-a672dcd34e60",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.command_and_control",
                "attack.t1071.001"
            ],
            "title": "Suspicious Curl Change User Agents - Linux"
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows",
        "Network"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Duane Michael"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "command-and-control"
        }
    ],
    "x_mitre_detection": "Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious. Analyze packet contents to detect application layer protocols that do not follow the expected protocol standards regarding syntax, structure, or any other variable adversaries could leverage to conceal data.(Citation: University of Birmingham C2)",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "2.2",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Network Traffic: Network Traffic Flow",
        "Network Traffic: Network Traffic Content"
    ],
    "x_mitre_permissions_required": []
}