{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--ab71ed19-fc11-4fee-9978-6217331b8eba",
    "created": "2024-08-13T14:46:37.008327Z",
    "modified": "2024-08-13T14:46:48.514304Z",
    "name": "Subvert Trust Controls: Code Signing Policy Modification",
    "description": "Adversaries may modify code signing policies to enable execution of unsigned or self-signed code. Code signing provides a level of authenticity on a program from a developer and a guarantee that the program has not been tampered with. Security controls can include enforcement mechanisms to ensure that only valid, signed code can be run on an operating system. Some of these security controls may be enabled by default, such as Driver Signature Enforcement (DSE) on Windows or System Integrity Protection (SIP) on macOS.[1][2] Other such controls may be disabled by default but are configurable through application controls, such as only allowing signed Dynamic-Link Libraries (DLLs) to execute on a system. Since it can be useful for developers to modify default signature enforcement policies during the development and testing of applications, disabling of these features may be possible with elevated permissions.[3][2]Adversaries may modify code signing policies in a number of ways, including through use of command-line or GUI utilities, Modify Registry, rebooting the computer in a debug/recovery mode, or by altering the value of variables in kernel memory.[4][2][5][6] Examples of commands that can modify the code signing policy of a system include bcdedit.exe -set TESTSIGNING ON on Windows and csrutil disable on macOS.[4][2] Depending on the implementation, successful modification of a signing policy may require reboot of the compromised system. Additionally, some implementations can introduce visible artifacts for the user (ex: a watermark in the corner of the screen stating the system is in Test Mode). Adversaries may attempt to remove such artifacts.[7]To gain access to kernel memory to modify variables related to signature checks, such as modifying g_CiOptions to disable Driver Signature Enforcement, adversaries may conduct Exploitation for Privilege Escalation using a signed, but vulnerable driver.[8][6]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1553/006",
            "external_id": "T1553/006"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "description": "disable DLL code signature enforcement",
                                "string": "/RequireSignedAppInit_DLLs/i"
                            },
                            {
                                "number": "0 = state disabled"
                            },
                            {
                                "or": [
                                    {
                                        "match": "set registry value"
                                    },
                                    {
                                        "number": "0x80000002 = HKEY_LOCAL_MACHINE"
                                    }
                                ]
                            },
                            {
                                "or": [
                                    {
                                        "string": "/Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows/i"
                                    },
                                    {
                                        "string": "/Software\\\\Wow6432Node\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows/i"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Event Triggered Execution::AppInit DLLs [T1546.010]",
                        "Defense Evasion::Subvert Trust Controls::Code Signing Policy Modification [T1553.006]"
                    ],
                    "authors": [
                        "william.ballenthin@fireye.com"
                    ],
                    "examples": [
                        "58ADC2E97FBEE01B71073CCD7FF1B9A4:0x401350"
                    ],
                    "name": "disable AppInit_DLLs code signature enforcement",
                    "namespace": "persistence/registry/appinitdlls",
                    "references": [
                        "https://docs.microsoft.com/en-us/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2"
                    ],
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "match": "host-interaction/process/create"
                            },
                            {
                                "string": "/^bcdedit(\\.exe)? -set TESTSIGNING ON/i"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Defense Evasion::Subvert Trust Controls::Code Signing Policy Modification [T1553.006]"
                    ],
                    "authors": [
                        "william.ballenthin@mandiant.com"
                    ],
                    "examples": [
                        "0596C4EA5AA8DEF47F22C85D75AACA95:0x10710B3"
                    ],
                    "name": "disable code signing",
                    "namespace": "host-interaction/bootloader",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ]
}