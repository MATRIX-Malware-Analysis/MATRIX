{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--75edafa6-d7b9-4919-9bce-2fbd51a232bf",
    "created": "2024-08-13T14:46:37.1308Z",
    "modified": "2024-08-13T14:46:46.199183Z",
    "name": "Use Alternate Authentication Material",
    "description": "Adversaries may use alternate authentication material, such as password hashes, Kerberos tickets, and application access tokens, in order to move laterally within an environment and bypass normal system access controls. Authentication processes generally require a valid identity (e.g., username) along with one or more authentication factors (e.g., password, pin, physical smart card, token generator, etc.). Alternate authentication material is legitimately generated by systems after a user or application successfully authenticates by providing a valid identity and the required authentication factor(s). Alternate authentication material may also be generated during the identity creation process.[1][2]Caching alternate authentication material allows the system to verify an identity has successfully authenticated without asking the user to reenter authentication factor(s). Because the alternate authentication must be maintained by the system\u2014either in memory or on disk\u2014it may be at risk of being stolen through Credential Access techniques. By stealing alternate authentication material, adversaries are able to bypass system access controls and authenticate to systems without knowing the plaintext password or any additional authentication factors.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1550",
            "external_id": "T1550"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1550",
            "external_id": "T1550"
        },
        {
            "source_name": "TechNet Audit Policy",
            "description": "Microsoft. (2016, April 15). Audit Policy Recommendations. Retrieved June 3, 2016.",
            "url": "https://technet.microsoft.com/en-us/library/dn487457.aspx"
        },
        {
            "source_name": "NIST Authentication",
            "description": "NIST. (n.d.). Authentication. Retrieved January 30, 2020.",
            "url": "https://csrc.nist.gov/glossary/term/authentication"
        },
        {
            "source_name": "NIST MFA",
            "description": "NIST. (n.d.). Multi-Factor Authentication (MFA). Retrieved January 30, 2020.",
            "url": "https://csrc.nist.gov/glossary/term/Multi_Factor-Authentication"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/07/24",
            "description": "Identifies the suspicious use of GetSessionToken. Tokens could be created and used by attackers to move laterally and escalate privileges.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": "GetSessionToken",
                    "eventSource": "sts.amazonaws.com",
                    "userIdentity.type": "IAMUser"
                }
            },
            "falsepositives": [
                "GetSessionToken may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment. GetSessionToken from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "b45ab1d2-712f-4f01-a751-df3826969807",
            "level": "low",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/elastic/detection-rules/pull/1213",
                "https://docs.aws.amazon.com/STS/latest/APIReference/API_GetSessionToken.html"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.privilege_escalation",
                "attack.t1548",
                "attack.t1550",
                "attack.t1550.001"
            ],
            "title": "AWS STS GetSessionToken Misuse"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/07/24",
            "description": "Identifies the suspicious use of AssumeRole. Attackers could move laterally and escalate privileges.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "userIdentity.sessionContext.sessionIssuer.type": "Role",
                    "userIdentity.type": "AssumedRole"
                }
            },
            "falsepositives": [
                "AssumeRole may be done by a system or network administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "AssumeRole from unfamiliar users or hosts should be investigated. If known behavior is causing false positives, it can be exempted from the rule.",
                "Automated processes that uses Terraform may lead to false positives."
            ],
            "id": "905d389b-b853-46d0-9d3d-dea0d3a3cd49",
            "level": "low",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/elastic/detection-rules/pull/1214",
                "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.privilege_escalation",
                "attack.t1548",
                "attack.t1550",
                "attack.t1550.001"
            ],
            "title": "AWS STS AssumeRole Misuse"
        },
        {
            "author": "Austin Songer",
            "date": "2021/09/22",
            "description": "Identifies when suspicious SAML activity has occurred in AWS. An adversary could gain backdoor access via SAML.",
            "detection": {
                "condition": "1 of selection_*",
                "selection_iam": {
                    "eventName": "UpdateSAMLProvider",
                    "eventSource": "iam.amazonaws.com"
                },
                "selection_sts": {
                    "eventName": "AssumeRoleWithSAML",
                    "eventSource": "sts.amazonaws.com"
                }
            },
            "falsepositives": [
                "Automated processes that uses Terraform may lead to false positives.",
                "SAML Provider could be updated by a system administrator. Verify whether the user identity, user agent, and/or hostname should be making changes in your environment.",
                "SAML Provider being updated from unfamiliar users should be investigated. If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "f43f5d2f-3f2a-4cc8-b1af-81fde7dbaf0e",
            "level": "medium",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "modified": "2022/12/18",
            "references": [
                "https://docs.aws.amazon.com/IAM/latest/APIReference/API_UpdateSAMLProvider.html",
                "https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.t1078",
                "attack.lateral_movement",
                "attack.t1548",
                "attack.privilege_escalation",
                "attack.t1550",
                "attack.t1550.001"
            ],
            "title": "AWS Suspicious SAML Activity"
        },
        {
            "author": "Chester Le Bron (@123Le_Bron)",
            "date": "2024/02/26",
            "description": "Detects potentially suspicious events involving \"GetSigninToken\".\nAn adversary using the \"aws_consoler\" tool can leverage this console API to create temporary federated credential that help obfuscate which AWS credential is compromised (the original access key) and enables the adversary to pivot from the AWS CLI to console sessions without the need for MFA using the new access key issued in this request.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_console_ua": {
                    "userAgent|contains": "Jersey/${project.version}"
                },
                "selection": {
                    "eventName": "GetSigninToken",
                    "eventSource": "signin.amazonaws.com"
                }
            },
            "falsepositives": [
                "GetSigninToken events will occur when using AWS SSO portal to login and will generate false positives if you do not filter for the expected user agent(s), see filter. Non-SSO configured roles would be abnormal and should be investigated."
            ],
            "id": "f8103686-e3e8-46f3-be72-65f7fcb4aa53",
            "level": "medium",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "references": [
                "https://github.com/NetSPI/aws_consoler",
                "https://www.crowdstrike.com/blog/analysis-of-intrusion-campaign-targeting-telecom-and-bpo-companies/"
            ],
            "status": "experimental",
            "tags": [
                "attack.lateral_movement",
                "attack.t1021.007",
                "attack.t1550.001"
            ],
            "title": "AWS Console GetSigninToken Potential Abuse"
        },
        {
            "author": "Ilyas Ochkov, oscd.community",
            "date": "2019/10/24",
            "description": "Detects uncommon outbound network activity via Kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_lsass": {
                    "Image": "C:\\Windows\\System32\\lsass.exe"
                },
                "filter_optional_chrome": {
                    "Image": [
                        "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe",
                        "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_optional_firefox": {
                    "Image": [
                        "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe",
                        "C:\\Program Files\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_optional_tomcat": {
                    "Image|endswith": "\\tomcat\\bin\\tomcat8.exe"
                },
                "selection": {
                    "DestinationPort": 88,
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Web Browsers and third party application might generate similar activity. An initial baseline is required."
            ],
            "id": "e54979bd-c5f9-4d6c-967b-a04b19ac4c74",
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/15",
            "references": [
                "https://github.com/GhostPack/Rubeus"
            ],
            "related": [
                {
                    "id": "eca91c7c-9214-47b9-b4c5-cb1d7e4f2350",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1558",
                "attack.lateral_movement",
                "attack.t1550.003"
            ],
            "title": "Uncommon Outbound Kerberos Connection"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/12/19",
            "description": "Detects the execution of the hacktool Rubeus via PE information of command line parameters",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\Rubeus.exe"
                    },
                    {
                        "OriginalFileName": "Rubeus.exe"
                    },
                    {
                        "Description": "Rubeus"
                    },
                    {
                        "CommandLine|contains": [
                            "asreproast ",
                            "dump /service:krbtgt ",
                            "dump /luid:0x",
                            "kerberoast ",
                            "createnetonly /program:",
                            "ptt /ticket:",
                            "/impersonateuser:",
                            "renew /ticket:",
                            "asktgt /user:",
                            "harvest /interval:",
                            "s4u /user:",
                            "s4u /ticket:",
                            "hash /password:",
                            "golden /aes256:",
                            "silver /user:"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "7ec2c172-dceb-4c10-92c9-87c1881b7e18",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/20",
            "references": [
                "https://blog.harmj0y.net/redteaming/from-kekeo-to-rubeus",
                "https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html",
                "https://github.com/GhostPack/Rubeus"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "7ec2c172-dceb-4c10-92c9-87c1881b7e18"
                }
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1558.003",
                "attack.lateral_movement",
                "attack.t1550.003"
            ],
            "title": "HackTool - Rubeus Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/04/26",
            "description": "Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in Windows domain environments where LDAP signing is not enforced",
            "detection": {
                "condition": "1 of selection_*",
                "selection_cli_1": {
                    "CommandLine|contains|all": [
                        " relay ",
                        " -Domain ",
                        " -ComputerName "
                    ]
                },
                "selection_cli_2": {
                    "CommandLine|contains|all": [
                        " krbscm ",
                        " -sc "
                    ]
                },
                "selection_cli_3": {
                    "CommandLine|contains|all": [
                        " spawn ",
                        " -d ",
                        " -cn ",
                        " -cp "
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\KrbRelayUp.exe"
                    },
                    {
                        "OriginalFileName": "KrbRelayUp.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "12827a56-61a4-476a-a9cb-f3068f191073",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/Dec0ne/KrbRelayUp"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1558.003",
                "attack.lateral_movement",
                "attack.t1550.003"
            ],
            "title": "HackTool - KrbRelayUp Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/06/08",
            "description": "Detects logons using NTLM, which could be caused by a legacy source or attackers",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 8002
                }
            },
            "falsepositives": [
                "Legacy hosts"
            ],
            "id": "98c3bcf1-56f2-49dc-9d8d-c66cf190238b",
            "level": "low",
            "logsource": {
                "definition": "Requires events from Microsoft-Windows-NTLM/Operational",
                "product": "windows",
                "service": "ntlm"
            },
            "modified": "2024/07/22",
            "references": [
                "https://twitter.com/JohnLaTwC/status/1004895028995477505"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1550.002"
            ],
            "title": "NTLM Logon"
        },
        {
            "author": "Tim Shelton, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/04/26",
            "description": "Detects the reporting of NTLMv1 being used between a client and server. NTLMv1 is insecure as the underlying encryption algorithms can be brute-forced by modern hardware.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": [
                        6038,
                        6039
                    ],
                    "Provider_Name": "LsaSrv"
                }
            },
            "falsepositives": [
                "Environments that use NTLMv1"
            ],
            "id": "e9d4ab66-a532-4ef7-a502-66a9e4a34f5d",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2023/06/06",
            "references": [
                "https://github.com/nasbench/EVTX-ETW-Resources/blob/f1b010ce0ee1b71e3024180de1a3e67f99701fe4/ETWProvidersManifests/Windows10/22H2/W10_22H2_Pro_20230321_19045.2728/WEPExplorer/LsaSrv.xml"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.lateral_movement",
                "attack.t1550.002"
            ],
            "title": "NTLMv1 Logon Between Client and Server"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/05/31",
            "description": "This events that are generated when using the hacktool Ruler by Sensepost",
            "detection": {
                "condition": "(1 of selection*)",
                "selection1": {
                    "EventID": 4776,
                    "Workstation": "RULER"
                },
                "selection2": {
                    "EventID": [
                        4624,
                        4625
                    ],
                    "WorkstationName": "RULER"
                }
            },
            "falsepositives": [
                "Go utilities that use staaldraad awesome NTLM library"
            ],
            "id": "24549159-ac1b-479c-8175-d42aea947cae",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/sensepost/ruler",
                "https://github.com/sensepost/ruler/issues/47",
                "https://github.com/staaldraad/go-ntlm/blob/cd032d41aa8ce5751c07cb7945400c0f5c81e2eb/ntlm/ntlmv1.go#L427",
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4776",
                "https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4624"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.execution",
                "attack.t1087",
                "attack.t1114",
                "attack.t1059",
                "attack.t1550.002"
            ],
            "title": "Hacktool Ruler"
        },
        {
            "author": "Dave Kennedy, Jeff Warren (method) / David Vassallo (rule)",
            "date": "2019/06/14",
            "description": "Detects the attack technique pass the hash which is used to move laterally inside the network",
            "detection": {
                "condition": "1 of selection_* and not filter",
                "filter": {
                    "TargetUserName": "ANONYMOUS LOGON"
                },
                "selection_logon3": {
                    "EventID": 4624,
                    "KeyLength": 0,
                    "LogonProcessName": "NtLmSsp",
                    "LogonType": 3,
                    "SubjectUserSid": "S-1-0-0"
                },
                "selection_logon9": {
                    "EventID": 4624,
                    "LogonProcessName": "seclogo",
                    "LogonType": 9
                }
            },
            "falsepositives": [
                "Administrator activity"
            ],
            "id": "8eef149c-bd26-49f2-9e5a-9b00e3af499b",
            "level": "medium",
            "logsource": {
                "definition": "The successful use of PtH for lateral movement between workstations would trigger event ID 4624",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/05",
            "references": [
                "https://github.com/iadgov/Event-Forwarding-Guidance/tree/master/Events",
                "https://web.archive.org/web/20170909091934/https://blog.binarydefense.com/reliably-detecting-pass-the-hash-through-event-log-analysis",
                "https://blog.stealthbits.com/how-to-detect-pass-the-hash-attacks/"
            ],
            "status": "stable",
            "tags": [
                "attack.lateral_movement",
                "attack.t1550.002"
            ],
            "title": "Pass the Hash Activity 2"
        },
        {
            "author": "Max Altgelt (Nextron Systems)",
            "date": "2022/04/06",
            "description": "Detects logon events that specify new credentials",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4624,
                    "LogonType": 9
                }
            },
            "falsepositives": [
                "Legitimate remote administration activity"
            ],
            "id": "def8b624-e08f-4ae1-8612-1ba21190da6b",
            "level": "low",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "references": [
                "https://go.recordedfuture.com/hubfs/reports/mtp-2021-0914.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.lateral_movement",
                "attack.t1550"
            ],
            "title": "Outgoing Logon with New Credentials"
        },
        {
            "author": "Roberto Rodriguez (source), Dominik Schaudel (rule)",
            "date": "2018/02/12",
            "description": "Detects successful logon with logon type 9 (NewCredentials) which matches the Overpass the Hash behavior of e.g Mimikatz's sekurlsa::pth module.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4624,
                    "AuthenticationPackageName": "Negotiate",
                    "LogonProcessName": "seclogo",
                    "LogonType": 9
                }
            },
            "falsepositives": [
                "Runas command-line tool using /netonly parameter"
            ],
            "id": "192a0330-c20b-4356-90b6-7b7049ae0b87",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/27",
            "references": [
                "https://web.archive.org/web/20220419045003/https://cyberwardog.blogspot.com/2017/04/chronicles-of-threat-hunter-hunting-for.html"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.s0002",
                "attack.t1550.002"
            ],
            "title": "Successful Overpass the Hash Attempt"
        },
        {
            "author": "Christian Burkard (Nextron Systems), Florian Roth (Nextron Systems)",
            "date": "2023/04/27",
            "description": "Detects the execution of the hacktool Rubeus using specific command line flags",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "asreproast ",
                        "dump /service:krbtgt ",
                        "dump /luid:0x",
                        "kerberoast ",
                        "createnetonly /program:",
                        "ptt /ticket:",
                        "/impersonateuser:",
                        "renew /ticket:",
                        "asktgt /user:",
                        "harvest /interval:",
                        "s4u /user:",
                        "s4u /ticket:",
                        "hash /password:",
                        "golden /aes256:",
                        "silver /user:"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "3245cd30-e015-40ff-a31d-5cadd5f377ec",
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://blog.harmj0y.net/redteaming/from-kekeo-to-rubeus",
                "https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html",
                "https://github.com/GhostPack/Rubeus"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "7ec2c172-dceb-4c10-92c9-87c1881b7e18"
                }
            ],
            "status": "test",
            "title": "HackTool - Rubeus Execution - ScriptBlock",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1558.003",
                "attack.lateral_movement",
                "attack.t1550.003"
            ]
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "Office 365",
        "SaaS",
        "Google Workspace",
        "IaaS",
        "Containers"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Blake Strom, Microsoft Threat Intelligence",
        "Pawel Partyka, Microsoft Threat Intelligence"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "defense-evasion"
        },
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "lateral-movement"
        }
    ],
    "x_mitre_detection": "Configure robust, consistent account activity audit policies across the enterprise and with externally accessible services.(Citation: TechNet Audit Policy) Look for suspicious account behavior across systems that share accounts, either user, admin, or service accounts. Examples: one account logged into multiple systems simultaneously; multiple accounts logged into the same machine simultaneously; accounts logged in at odd times or outside of business hours. Activity may be from interactive login sessions or process ownership from accounts being used to execute binaries on a remote system as a particular account. Correlate other security systems with login information (e.g., a user has an active login session but has not entered the building or does not have VPN access).",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.3",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Application Log: Application Log Content",
        "Logon Session: Logon Session Creation",
        "Active Directory: Active Directory Credential Request",
        "Web Credential: Web Credential Usage",
        "User Account: User Account Authentication"
    ],
    "x_mitre_permissions_required": []
}