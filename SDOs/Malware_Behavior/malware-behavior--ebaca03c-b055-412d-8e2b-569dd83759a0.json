{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--ebaca03c-b055-412d-8e2b-569dd83759a0",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.502285Z",
    "name": "Security Software Discovery: ",
    "description": "Adversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as cloud monitoring agents and anti-virus. Adversaries may use the information from Security Software Discovery during automated discovery to shape follow-on behaviors, including whether or not the adversary fully infects the target and/or attempts specific actions.Example commands that can be used to obtain security software information are netsh, reg query with Reg, dir with cmd, and Tasklist, but other indicators of discovery behavior may be more specific to the type of software or security system the adversary is looking for. It is becoming more common to see macOS malware perform checks for LittleSnitch and KnockKnock software.Adversaries may also utilize the Cloud API to discover cloud-native security software installed on compute infrastructure, such as the AWS CloudWatch agent, Azure VM Agent, and Google Cloud Monitor agent. These agents  may collect  metrics and logs from the VM, which may be centrally aggregated in a cloud-based monitoring platform.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1518/001",
            "external_id": "T1518/001"
        },
        {
            "source_name": "CAPEC 581",
            "external_id": "malware-behavior--c68a02fd-417d-45da-b54b-c9a55f034862"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "os": "linux"
                            },
                            {
                                "api": "system"
                            },
                            {
                                "substring": "iptables"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Software Discovery::Security Software Discovery [T1518.001]",
                        "Defense Evasion::Impair Defenses::Disable or Modify System Firewall [T1562.004]"
                    ],
                    "authors": [
                        "joakim@intezer.com"
                    ],
                    "name": "interact with iptables",
                    "namespace": "host-interaction/firewall",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "api": "ole32.CoCreateInstance"
                            },
                            {
                                "bytes": "42 E9 4C 30 39 6E D8 40 94 3A B9 13 C4 0C 9C D4 = CLSID_NetFwMgr"
                            },
                            {
                                "bytes": "F5 8A 89 F7 C4 CA 32 46 A2 EC DA 06 E5 11 1A F2 = IID_INetFwMgr"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Software Discovery::Security Software Discovery [T1518.001]",
                        "Defense Evasion::Impair Defenses::Disable or Modify System Firewall [T1562.004]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "EB355BD63BDDCE02955792B4CD6539FB:0x10003927"
                    ],
                    "name": "access firewall settings via INetFwMgr",
                    "namespace": "host-interaction/firewall/modify",
                    "scopes": {
                        "dynamic": "unsupported",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2020/10/19",
            "description": "Detects usage of system utilities (only grep for now) to discover security software discovery",
            "detection": {
                "condition": "image and 1 of selection_cli_*",
                "image": {
                    "Image": "/usr/bin/grep"
                },
                "selection_cli_1": {
                    "CommandLine|contains": [
                        "nessusd",
                        "santad",
                        "CbDefense",
                        "falcond",
                        "td-agent",
                        "packetbeat",
                        "filebeat",
                        "auditbeat",
                        "osqueryd",
                        "BlockBlock",
                        "LuLu"
                    ]
                },
                "selection_cli_2": {
                    "CommandLine|contains|all": [
                        "Little",
                        "Snitch"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate activities"
            ],
            "id": "0ed75b9c-c73b-424d-9e7d-496cd565fbe0",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2022/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518.001/T1518.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ],
            "title": "Security Software Discovery - MacOs"
        },
        {
            "author": "Joseliyo Sanchez, @Joseliyo_Jstnk",
            "date": "2024/01/02",
            "description": "Detects the use of csrutil to disable the Configure System Integrity Protection (SIP). This technique is used in post-exploit scenarios.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "disable",
                    "Image|endswith": "/csrutil"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "3603f18a-ec15-43a1-9af2-d196c8a7fec6",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://ss64.com/osx/csrutil.html",
                "https://objective-see.org/blog/blog_0x6D.html",
                "https://www.welivesecurity.com/2017/10/20/osx-proton-supply-chain-attack-elmedia/",
                "https://www.virustotal.com/gui/file/05a2adb266ec6c0ba9ed176d87d8530e71e845348c13caf9f60049760c312cd3/behavior"
            ],
            "status": "experimental",
            "title": "System Integrity Protection (SIP) Disabled",
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ]
        },
        {
            "author": "Joseliyo Sanchez, @Joseliyo_Jstnk",
            "date": "2024/01/02",
            "description": "Detects the use of csrutil to view the Configure System Integrity Protection (SIP) status. This technique is used in post-exploit scenarios.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "status",
                    "Image|endswith": "/csrutil"
                }
            },
            "falsepositives": [
                "Legitimate administration activities"
            ],
            "id": "53821412-17b0-4147-ade0-14faae67d54b",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://ss64.com/osx/csrutil.html",
                "https://objective-see.org/blog/blog_0x6D.html",
                "https://www.welivesecurity.com/2017/10/20/osx-proton-supply-chain-attack-elmedia/",
                "https://www.virustotal.com/gui/file/05a2adb266ec6c0ba9ed176d87d8530e71e845348c13caf9f60049760c312cd3/behavior"
            ],
            "status": "experimental",
            "title": "System Integrity Protection (SIP) Enumeration",
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2023/10/20",
            "description": "Detects execution of \"findstr\" to search for common names of security tools. Attackers often pipe the results of recon commands such as \"tasklist\" or \"whoami\" to \"findstr\" in order to filter out the results.\nThis detection focuses on the keywords that the attacker might use as a filter.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|endswith": [
                        " avira",
                        " avira\"",
                        " cb",
                        " cb\"",
                        " cylance",
                        " cylance\"",
                        " defender",
                        " defender\"",
                        " kaspersky",
                        " kaspersky\"",
                        " kes",
                        " kes\"",
                        " mc",
                        " mc\"",
                        " sec",
                        " sec\"",
                        " sentinel",
                        " sentinel\"",
                        " symantec",
                        " symantec\"",
                        " virus",
                        " virus\""
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4fe074b4-b833-4081-8f24-7dcfeca72b42",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/14",
            "status": "experimental",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/987e3ca988ae3cff4b9f6e388c139c05bf44bbb8/atomics/T1518.001/T1518.001.md#atomic-test-1---security-software-discovery",
                "https://www.microsoft.com/en-us/security/blog/2023/10/18/multiple-north-korean-threat-actors-exploiting-the-teamcity-cve-2023-42793-vulnerability/",
                "https://www.hhs.gov/sites/default/files/manage-engine-vulnerability-sector-alert-tlpclear.pdf"
            ],
            "related": [
                {
                    "id": "fe63010f-8823-4864-a96b-a7b4a0f7b929",
                    "type": "derived"
                }
            ],
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ],
            "title": "Security Tools Keyword Lookup Via Findstr.EXE"
        },
        {
            "author": "frack113",
            "date": "2021/12/16",
            "description": "Detects usage of \"findstr\" with the argument \"385201\". Which could indicate potential discovery of an installed Sysinternals Sysmon service using the default driver altitude (even if the name is changed).",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": " 385201"
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "37db85d1-b089-490a-a59a-c7b6f984f480",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/14",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518.001/T1518.001.md#atomic-test-5---security-software-discovery---sysmon-service"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ],
            "title": "Sysmon Discovery Via Default Driver Altitude Using Findstr.EXE"
        },
        {
            "author": "frack113, Anish Bogati, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/12/16",
            "description": "Detects calls to \"get-process\" where the output is piped to a \"where-object\" filter to search for security solution processes.\nAdversaries may attempt to get a listing of security software, configurations, defensive tools, and sensors that are installed on a system or in a cloud environment. This may include things such as firewall rules and anti-virus\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmdlet": {
                    "ScriptBlockText|contains": [
                        "get-process | \\?",
                        "get-process | where",
                        "gps | \\?",
                        "gps | where"
                    ]
                },
                "selection_field": {
                    "ScriptBlockText|contains": [
                        "Company -like",
                        "Description -like",
                        "Name -like",
                        "Path -like",
                        "Product -like"
                    ]
                },
                "selection_keywords": {
                    "ScriptBlockText|contains": [
                        "\\*avira\\*",
                        "\\*carbonblack\\*",
                        "\\*cylance\\*",
                        "\\*defender\\*",
                        "\\*kaspersky\\*",
                        "\\*malware\\*",
                        "\\*sentinel\\*",
                        "\\*symantec\\*",
                        "\\*virus\\*"
                    ]
                }
            },
            "falsepositives": [
                "False positives might occur due to the nature of the ScriptBlock being ingested as a big blob. Initial tuning is required.",
                "As the \"selection_cmdlet\" is common in scripts the matching engine might slow down the search. Change into regex or a more accurate string to avoid heavy resource consumption if experienced"
            ],
            "id": "904e8e61-8edf-4350-b59c-b905fc8e810c",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2023/10/24",
            "status": "experimental",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518.001/T1518.001.md#atomic-test-2---security-software-discovery---powershell"
            ],
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ],
            "title": "Security Software Discovery Via Powershell Script"
        },
        {
            "author": "Daniil Yugoslavskiy, oscd.community",
            "date": "2020/10/19",
            "description": "Detects usage of system utilities (only grep and egrep for now) to discover security software discovery",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "nessusd",
                        "td-agent",
                        "packetbeat",
                        "filebeat",
                        "auditbeat",
                        "osqueryd",
                        "cbagentd",
                        "falcond"
                    ],
                    "Image|endswith": [
                        "/grep",
                        "/egrep"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate activities"
            ],
            "id": "c9d8b7fd-78e4-44fe-88f6-599135d46d60",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1518.001/T1518.001.md"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1518.001"
            ],
            "title": "Security Software Discovery - Linux"
        }
    ]
}