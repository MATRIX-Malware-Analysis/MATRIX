{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--5e512c54-ffb2-4957-abd7-a003518a7309",
    "created": "2024-08-13T14:46:37.053078Z",
    "modified": "2024-08-13T14:46:48.573289Z",
    "name": "Boot or Logon Autostart Execution: Security Support Provider",
    "description": "Adversaries may abuse security support providers (SSPs) to execute DLLs when the system boots. Windows SSP DLLs are loaded into the Local Security Authority (LSA) process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs.The SSP configuration is stored in two Registry keys: HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Security Packages and HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\Security Packages. An adversary may modify these Registry keys to add new SSPs, which will be loaded the next time the system boots, or when the AddSecurityPackage Windows API function is called.[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1547/005",
            "external_id": "T1547/005"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "export": "SpLsaModeInitialize"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Boot or Logon Autostart Execution::Security Support Provider [T1547.005]"
                    ],
                    "authors": [
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "36f506a34b99bf4c199b3c9ec8aa02bd631feafdca20e69e33e714c269ddb8c5"
                    ],
                    "name": "act as Security Support Provider DLL",
                    "namespace": "persistence/authentication-process",
                    "references": [
                        "https://learn.microsoft.com/en-us/windows/win32/secauthn/lsa-mode-initialization",
                        "https://github.com/Hagrid29/DuplicateDump/blob/main/LSAPlugin/LSASSP/dllmain.cpp"
                    ],
                    "scopes": {
                        "dynamic": "file",
                        "static": "file"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "iwillkeepwatch",
            "date": "2019/01/18",
            "description": "Detects the addition of a SSP to the registry. Upon a reboot or API call, SSP DLLs gain access to encrypted and plaintext passwords stored in Windows.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_msiexec": {
                    "Image": [
                        "C:\\Windows\\system32\\msiexec.exe",
                        "C:\\Windows\\syswow64\\MsiExec.exe"
                    ]
                },
                "selection": {
                    "TargetObject|endswith": [
                        "\\Control\\Lsa\\Security Packages",
                        "\\Control\\Lsa\\OSConfig\\Security Packages"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "eeb30123-9fbd-4ee8-aaa0-2e545bbed6dc",
            "level": "high",
            "logsource": {
                "category": "registry_event",
                "product": "windows"
            },
            "modified": "2022/08/09",
            "references": [
                "https://powersploit.readthedocs.io/en/latest/Persistence/Install-SSP/",
                "https://github.com/EmpireProject/Empire/blob/08cbd274bef78243d7a8ed6443b8364acd1fc48b/data/module_source/persistence/Install-SSP.ps1#L157"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1547.005"
            ],
            "title": "Security Support Provider (SSP) Added to LSA Configuration"
        }
    ]
}