{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--9c6b2054-f0a2-4bd6-b313-eed85c61ed13",
    "created": "2024-08-13T14:46:37.085553Z",
    "modified": "2024-08-13T14:46:45.915605Z",
    "name": "SID-History Injection: ",
    "description": "Adversaries may use SID-History Injection to escalate privileges and bypass access controls. The Windows security identifier (SID) is a unique value that identifies a user or group account. SIDs are used by Windows security in both security descriptors and access tokens. [1] An account can hold additional SIDs in the SID-History Active Directory attribute [2], allowing inter-operable account migration between domains (e.g., all values in SID-History are included in access tokens).With Domain Administrator (or equivalent) rights, harvested or well-known SID values [3] may be inserted into SID-History to enable impersonation of arbitrary users/groups such as Enterprise Administrators. This manipulation may result in elevated access to local resources and/or access to otherwise inaccessible domains via lateral movement techniques such as Remote Services, SMB/Windows Admin Shares, or Windows Remote Management.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1134/005",
            "external_id": "T1134/005"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Thomas Patzke, @atc_project (improvements)",
            "date": "2017/02/19",
            "description": "An attacker can use the SID history attribute to gain additional privileges.",
            "detection": {
                "condition": "selection1 or (selection2 and not selection3 and not filter_null)",
                "filter_null": {
                    "SidHistory": null
                },
                "selection1": {
                    "EventID": [
                        4765,
                        4766
                    ]
                },
                "selection2": {
                    "EventID": 4738
                },
                "selection3": {
                    "SidHistory": [
                        "-",
                        "%%1793"
                    ]
                }
            },
            "falsepositives": [
                "Migration of an account into a new domain"
            ],
            "id": "2632954e-db1c-49cb-9936-67d1ef1d17d2",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "references": [
                "https://adsecurity.org/?p=1772"
            ],
            "status": "stable",
            "tags": [
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.t1134.005"
            ],
            "title": "Addition of SID History to Active Directory Object"
        }
    ]
}