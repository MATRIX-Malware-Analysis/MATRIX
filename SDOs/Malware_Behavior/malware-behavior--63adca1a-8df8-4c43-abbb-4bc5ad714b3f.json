{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--63adca1a-8df8-4c43-abbb-4bc5ad714b3f",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.138814Z",
    "name": "Server Software Component: Web Shell",
    "description": "Adversaries may backdoor web servers with web shells to establish persistent access to systems. A Web shell is a Web script that is placed on an openly accessible Web server to allow an adversary to access the Web server as a gateway into a network. A Web shell may provide a set of functions to execute or a command-line interface on the system that hosts the Web server.[1]In addition to a server-side script, a Web shell may have a client interface program that is used to talk to the Web server (e.g. China Chopper Web shell client).[2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1505/003",
            "external_id": "T1505/003"
        },
        {
            "source_name": "CAPEC 650",
            "external_id": "malware-behavior--aa94ceef-d940-4adc-95f1-a420f6c9fc61"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems), Arnim Rupp",
            "date": "2018/09/09",
            "description": "Detects a highly relevant Antivirus alert that reports a web shell.\nIt's highly recommended to tune this rule to the specific strings used by your anti virus solution by downloading a big WebShell repository from e.g. github and checking the matches.\n",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Signature|startswith": [
                            "ASP.",
                            "IIS/BackDoor",
                            "JAVA/Backdoor",
                            "JSP.",
                            "Perl.",
                            "PHP.",
                            "Troj/ASP",
                            "Troj/JSP",
                            "Troj/PHP",
                            "VBS/Uxor"
                        ]
                    },
                    {
                        "Signature|contains": [
                            "ASP_",
                            "ASP:",
                            "ASP.Agent",
                            "ASP/",
                            "ASP/Agent",
                            "Aspdoor",
                            "ASPXSpy",
                            "Backdoor.ASP",
                            "Backdoor.Java",
                            "Backdoor.JSP",
                            "Backdoor.PHP",
                            "Backdoor.VBS",
                            "Backdoor/ASP",
                            "Backdoor/Java",
                            "Backdoor/JSP",
                            "Backdoor/PHP",
                            "Backdoor/VBS",
                            "C99shell",
                            "Chopper",
                            "filebrowser",
                            "JSP_",
                            "JSP:",
                            "JSP.Agent",
                            "JSP/",
                            "JSP/Agent",
                            "Perl:",
                            "Perl/",
                            "PHP_",
                            "PHP:",
                            "PHP.Agent",
                            "PHP/",
                            "PHP/Agent",
                            "PHPShell",
                            "PShlSpy",
                            "SinoChoper",
                            "Trojan.ASP",
                            "Trojan.JSP",
                            "Trojan.PHP",
                            "Trojan.VBS",
                            "VBS.Agent",
                            "VBS/Agent",
                            "Webshell"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "fdf135a2-9241-4f96-a114-bb404948f736",
            "level": "high",
            "logsource": {
                "category": "antivirus"
            },
            "modified": "2024/07/17",
            "references": [
                "https://www.nextron-systems.com/?s=antivirus",
                "https://github.com/tennc/webshell",
                "https://www.virustotal.com/gui/file/bd1d52289203866645e556e2766a21d2275877fbafa056a76fe0cf884b7f8819/detection",
                "https://www.virustotal.com/gui/file/308487ed28a3d9abc1fec7ebc812d4b5c07ab025037535421f64c60d3887a3e8/detection",
                "https://www.virustotal.com/gui/file/7d3cb8a8ff28f82b07f382789247329ad2d7782a72dde9867941f13266310c80/detection",
                "https://www.virustotal.com/gui/file/e841675a4b82250c75273ebf0861245f80c6a1c3d5803c2d995d9d3b18d5c4b5/detection",
                "https://www.virustotal.com/gui/file/a80042c61a0372eaa0c2c1e831adf0d13ef09feaf71d1d20b216156269045801/detection",
                "https://www.virustotal.com/gui/file/b219f7d3c26f8bad7e175934cd5eda4ddb5e3983503e94ff07d39c0666821b7e/detection",
                "https://www.virustotal.com/gui/file/b8702acf32fd651af9f809ed42d15135f842788cd98d81a8e1b154ee2a2b76a2/detection",
                "https://www.virustotal.com/gui/file/13ae8bfbc02254b389ab052aba5e1ba169b16a399d9bc4cb7414c4a73cd7dc78/detection"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Antivirus Web Shell Detection"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2017/02/19",
            "description": "Detects common commands used in Windows webshells",
            "detection": {
                "condition": "all of selection_*",
                "selection_keywords": [
                    "=whoami",
                    "=net%20user",
                    "=net+user",
                    "=net%2Buser",
                    "=cmd%20/c%",
                    "=cmd+/c+",
                    "=cmd%2B/c%",
                    "=cmd%20/r%",
                    "=cmd+/r+",
                    "=cmd%2B/r%",
                    "=cmd%20/k%",
                    "=cmd+/k+",
                    "=cmd%2B/k%",
                    "=powershell%",
                    "=powershell+",
                    "=tasklist%",
                    "=tasklist+",
                    "=wmic%",
                    "=wmic+",
                    "=ssh%",
                    "=ssh+",
                    "=python%",
                    "=python+",
                    "=python3%",
                    "=python3+",
                    "=ipconfig",
                    "=wget%",
                    "=wget+",
                    "=curl%",
                    "=curl+",
                    "=certutil",
                    "=copy%20%5C%5C",
                    "=dsquery%",
                    "=dsquery+",
                    "=nltest%",
                    "=nltest+"
                ],
                "selection_method": {
                    "cs-method": "GET"
                }
            },
            "falsepositives": [
                "Web sites like wikis with articles on os commands and pages that include the os commands in the URLs",
                "User searches in search boxes of the respective website"
            ],
            "fields": [
                "client_ip",
                "vhost",
                "url",
                "response"
            ],
            "id": "7ff9db12-1b94-4a79-ba68-a2402c5d6729",
            "level": "high",
            "logsource": {
                "category": "webserver"
            },
            "modified": "2022/11/18",
            "status": "test",
            "references": [
                "https://bad-jubies.github.io/RCE-NOW-WHAT/",
                "https://m365internals.com/2022/10/07/hunting-in-on-premises-exchange-server-logs/"
            ],
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Windows Webshell Strings"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/06",
            "description": "Detects suspicious Windows strings in URI which could indicate possible exfiltration or webshell communication",
            "detection": {
                "condition": "selection",
                "selection": {
                    "cs-uri-query|contains": [
                        "=C:/Users",
                        "=C:/Program%20Files",
                        "=C:/Windows",
                        "=C%3A%5CUsers",
                        "=C%3A%5CProgram%20Files",
                        "=C%3A%5CWindows"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate application and websites that use windows paths in their URL"
            ],
            "id": "9f6a34b4-2688-4eb7-a7f5-e39fef573d0e",
            "level": "high",
            "modified": "2023/01/02",
            "logsource": {
                "category": "webserver"
            },
            "references": [
                "https://thedfirreport.com/2022/06/06/will-the-real-msiexec-please-stand-up-exploit-leads-to-data-exfiltration/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.exfiltration",
                "attack.t1505.003"
            ],
            "title": "Suspicious Windows Strings In URI"
        },
        {
            "author": "Cian Heasley",
            "date": "2020/08/04",
            "description": "Certain strings in the uri_query field when combined with null referer and null user agent can indicate activity associated with the webshell ReGeorg.",
            "detection": {
                "condition": "selection and filter",
                "filter": {
                    "cs-method": "POST",
                    "cs-referer": null,
                    "cs-user-agent": null
                },
                "selection": {
                    "cs-uri-query|contains": [
                        "cmd=read",
                        "connect&target",
                        "cmd=connect",
                        "cmd=disconnect",
                        "cmd=forward"
                    ]
                }
            },
            "falsepositives": [
                "Web applications that use the same URL parameters as ReGeorg"
            ],
            "fields": [
                "cs-uri-query",
                "cs-referer",
                "cs-method",
                "cs-User-Agent"
            ],
            "id": "2ea44a60-cfda-11ea-87d0-0242ac130003",
            "level": "high",
            "modified": "2023/01/02",
            "logsource": {
                "category": "webserver"
            },
            "status": "test",
            "references": [
                "https://community.rsa.com/community/products/netwitness/blog/2019/02/19/web-shells-and-netwitness-part-3",
                "https://github.com/sensepost/reGeorg"
            ],
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Webshell ReGeorg Detection Via Web Logs"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/10/04",
            "description": "Detects suspicious file type dropped by an Exchange component in IIS",
            "detection": {
                "condition": "all of selection*",
                "selection": {
                    "CommandLine|contains": "MSExchange",
                    "Image|endswith": "\\w3wp.exe"
                },
                "selection_types": {
                    "TargetFilename|endswith": [
                        ".aspx",
                        ".asp",
                        ".ashx",
                        ".ps1",
                        ".bat",
                        ".exe",
                        ".dll",
                        ".vbs"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "6b269392-9eba-40b5-acb6-55c882b20ba6",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/",
                "https://www.gteltsc.vn/blog/canh-bao-chien-dich-tan-cong-su-dung-lo-hong-zero-day-tren-microsoft-exchange-server-12714.html",
                "https://en.gteltsc.vn/blog/cap-nhat-nhe-ve-lo-hong-bao-mat-0day-microsoft-exchange-dang-duoc-su-dung-de-tan-cong-cac-to-chuc-tai-viet-nam-9685.html"
            ],
            "related": [
                {
                    "id": "bd1212e5-78da-431e-95fa-c58e3237a8e6",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1190",
                "attack.initial_access",
                "attack.t1505.003"
            ],
            "title": "Suspicious File Drop by Exchange"
        },
        {
            "id": "bd1212e5-78da-431e-95fa-c58e3237a8e6",
            "author": "Florian Roth (Nextron Systems), MSTI (query, idea)",
            "date": "2022/10/01",
            "description": "Detects suspicious file type dropped by an Exchange component in IIS into a suspicious folder",
            "detection": {
                "condition": "all of selection*",
                "selection": {
                    "CommandLine|contains": "MSExchange",
                    "Image|endswith": "\\w3wp.exe",
                    "TargetFilename|contains": [
                        "FrontEnd\\HttpProxy\\",
                        "\\inetpub\\wwwroot\\aspnet_client\\"
                    ]
                },
                "selection_types": {
                    "TargetFilename|endswith": [
                        ".aspx",
                        ".asp",
                        ".ashx"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/",
                "https://www.gteltsc.vn/blog/canh-bao-chien-dich-tan-cong-su-dung-lo-hong-zero-day-tren-microsoft-exchange-server-12714.html",
                "https://en.gteltsc.vn/blog/cap-nhat-nhe-ve-lo-hong-bao-mat-0day-microsoft-exchange-dang-duoc-su-dung-de-tan-cong-cac-to-chuc-tai-viet-nam-9685.html"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "6b269392-9eba-40b5-acb6-55c882b20ba6"
                }
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Suspicious ASPX File Drop by Exchange"
        },
        {
            "author": "Beyu Denis, oscd.community, Tim Shelton, Thurein Oo",
            "date": "2019/10/22",
            "description": "Detects the creation of files with certain extensions on a static web site. This can be indicative of potential uploads of a web shell.",
            "detection": {
                "condition": "(all of selection_wwwroot_* or all of selection_htdocs_*) and not 1 of filter_main_*",
                "filter_main_legitimate": {
                    "TargetFilename|contains": "\\xampp"
                },
                "filter_main_system": {
                    "Image": "System"
                },
                "filter_main_temp": {
                    "TargetFilename|contains": [
                        "\\AppData\\Local\\Temp\\",
                        "\\Windows\\Temp\\"
                    ]
                },
                "selection_htdocs_ext": {
                    "TargetFilename|contains": ".ph"
                },
                "selection_htdocs_path": {
                    "TargetFilename|contains": [
                        "\\www\\",
                        "\\htdocs\\",
                        "\\html\\"
                    ]
                },
                "selection_wwwroot_ext": {
                    "TargetFilename|contains": [
                        ".ashx",
                        ".asp",
                        ".ph",
                        ".soap"
                    ]
                },
                "selection_wwwroot_path": {
                    "TargetFilename|contains": "\\inetpub\\wwwroot\\"
                }
            },
            "falsepositives": [
                "Legitimate administrator or developer creating legitimate executable files in a web application folder"
            ],
            "id": "39f1f9f2-9636-45de-98f6-a4046aa8e4b9",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/10/15",
            "references": [
                "PT ESC rule and personal experience",
                "https://github.com/swisskyrepo/PayloadsAllTheThings/blob/c95a0a1a2855dc0cd7f7327614545fe30482a636/Upload%20Insecure%20Files/README.md"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Potential Webshell Creation On Static Website"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/02/25",
            "description": "Detects suspicious activity in which the MSExchangeMailboxReplication process writes .asp and .apsx files to disk, which could be a sign of ProxyShell exploitation",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\MSExchangeMailboxReplication.exe",
                    "TargetFilename|endswith": [
                        ".aspx",
                        ".asp"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "7280c9f3-a5af-45d0-916a-bc01cb4151c9",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://redcanary.com/blog/blackbyte-ransomware/"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.t1190",
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Suspicious MSExchangeMailboxReplication ASPX Write"
        },
        {
            "author": "Florian Roth (Nextron Systems), Jonhnathan Ribeiro, Anton Kutepov, oscd.community",
            "date": "2017/01/01",
            "description": "Detects certain command line parameters often used during reconnaissance activity via web shells",
            "detection": {
                "condition": "1 of selection_webserver_* and 1 of selection_susp_*",
                "selection_susp_change_dir": {
                    "CommandLine|contains": [
                        "&cd&echo",
                        "cd /d "
                    ]
                },
                "selection_susp_misc_discovery_binaries": [
                    {
                        "Image|endswith": [
                            "\\dsquery.exe",
                            "\\find.exe",
                            "\\findstr.exe",
                            "\\ipconfig.exe",
                            "\\netstat.exe",
                            "\\nslookup.exe",
                            "\\pathping.exe",
                            "\\quser.exe",
                            "\\schtasks.exe",
                            "\\systeminfo.exe",
                            "\\tasklist.exe",
                            "\\tracert.exe",
                            "\\ver.exe",
                            "\\wevtutil.exe",
                            "\\whoami.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "dsquery.exe",
                            "find.exe",
                            "findstr.exe",
                            "ipconfig.exe",
                            "netstat.exe",
                            "nslookup.exe",
                            "pathping.exe",
                            "quser.exe",
                            "schtasks.exe",
                            "sysinfo.exe",
                            "tasklist.exe",
                            "tracert.exe",
                            "ver.exe",
                            "VSSADMIN.EXE",
                            "wevtutil.exe",
                            "whoami.exe"
                        ]
                    }
                ],
                "selection_susp_misc_discovery_commands": {
                    "CommandLine|contains": [
                        " Test-NetConnection ",
                        "dir \\"
                    ]
                },
                "selection_susp_net_utility": {
                    "CommandLine|contains": [
                        " user ",
                        " use ",
                        " group "
                    ],
                    "OriginalFileName": [
                        "net.exe",
                        "net1.exe"
                    ]
                },
                "selection_susp_ping_utility": {
                    "CommandLine|contains": " -n ",
                    "OriginalFileName": "ping.exe"
                },
                "selection_susp_wmic_utility": {
                    "CommandLine|contains": " /node:",
                    "OriginalFileName": "wmic.exe"
                },
                "selection_webserver_characteristics_tomcat1": {
                    "ParentImage|contains": [
                        "-tomcat-",
                        "\\tomcat"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat2": {
                    "CommandLine|contains": [
                        "catalina.jar",
                        "CATALINA_HOME"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_image": {
                    "ParentImage|endswith": [
                        "\\w3wp.exe",
                        "\\php-cgi.exe",
                        "\\nginx.exe",
                        "\\httpd.exe",
                        "\\caddy.exe",
                        "\\ws_tomcatservice.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bed2a484-9348-4143-8a8a-b801c979301c",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/05/13",
            "references": [
                "https://www.fireeye.com/blog/threat-research/2013/08/breaking-down-the-china-chopper-web-shell-part-ii.html",
                "https://unit42.paloaltonetworks.com/bumblebee-webshell-xhunt-campaign/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1018",
                "attack.t1033",
                "attack.t1087"
            ],
            "title": "Webshell Detection With Command Line Keywords"
        },
        {
            "author": "FPT.EagleEye Team, wagga",
            "date": "2020/12/11",
            "description": "Detects suspicious child processes of the SQLServer process. This could indicate potential RCE or SQL Injection.",
            "detection": {
                "condition": "selection and not 1 of filter_optional_*",
                "filter_optional_datev": {
                    "CommandLine|startswith": "\"C:\\Windows\\system32\\cmd.exe\" ",
                    "Image": "C:\\Windows\\System32\\cmd.exe",
                    "ParentImage|endswith": "DATEV_DBENGINE\\MSSQL\\Binn\\sqlservr.exe",
                    "ParentImage|startswith": "C:\\Program Files\\Microsoft SQL Server\\"
                },
                "selection": {
                    "Image|endswith": [
                        "\\bash.exe",
                        "\\bitsadmin.exe",
                        "\\cmd.exe",
                        "\\netstat.exe",
                        "\\nltest.exe",
                        "\\ping.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\sh.exe",
                        "\\systeminfo.exe",
                        "\\tasklist.exe",
                        "\\wsl.exe"
                    ],
                    "ParentImage|endswith": "\\sqlservr.exe"
                }
            },
            "id": "869b9ca7-9ea2-4a5a-8325-e80e62f75445",
            "level": "high",
            "modified": "2023/05/04",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "Internal Research"
            ],
            "related": [
                {
                    "id": "344482e4-a477-436c-aa70-7536d18a48c7",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.t1505.003",
                "attack.t1190",
                "attack.initial_access",
                "attack.persistence",
                "attack.privilege_escalation"
            ],
            "title": "Suspicious Child Process Of SQL Server"
        },
        {
            "author": "Cian Heasley, Florian Roth (Nextron Systems)",
            "date": "2020/07/22",
            "description": "Detects processes spawned from web servers (PHP, Tomcat, IIS, etc.) that perform reconnaissance looking for the existence of popular scripting tools (perl, python, wget) on the system via the help commands\n",
            "detection": {
                "condition": "1 of selection_webserver_* and selection_recon",
                "selection_recon": {
                    "CommandLine|contains": [
                        "perl --help",
                        "perl -h",
                        "python --help",
                        "python -h",
                        "python3 --help",
                        "python3 -h",
                        "wget --help"
                    ]
                },
                "selection_webserver_characteristics_tomcat2": {
                    "CommandLine|contains": [
                        "CATALINA_HOME",
                        "catalina.jar"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_image": {
                    "ParentImage|endswith": [
                        "\\caddy.exe",
                        "\\httpd.exe",
                        "\\nginx.exe",
                        "\\php-cgi.exe",
                        "\\w3wp.exe",
                        "\\ws_tomcatservice.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat1": {
                    "ParentImage|contains": [
                        "-tomcat-",
                        "\\tomcat"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f64e5c19-879c-4bae-b471-6d84c8339677",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/09",
            "references": [
                "https://ragged-lab.blogspot.com/2020/07/webshells-automating-reconnaissance.html"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Webshell Tool Reconnaissance Activity"
        },
        {
            "author": "Florian Roth (Nextron Systems), MSTI (query)",
            "date": "2022/10/01",
            "description": "Detects patterns found in process executions cause by China Chopper like tiny (ASPX) webshells",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmdline": {
                    "CommandLine|contains": [
                        "&ipconfig&echo",
                        "&quser&echo",
                        "&whoami&echo",
                        "&c:&echo",
                        "&cd&echo",
                        "&dir&echo",
                        "&echo [E]",
                        "&echo [S]"
                    ]
                },
                "selection_origin": [
                    {
                        "Image|endswith": "\\w3wp.exe"
                    },
                    {
                        "ParentImage|endswith": "\\w3wp.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fa3c117a-bc0d-416e-a31b-0c0e80653efb",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/"
            ],
            "status": "test",
            "title": "Chopper Webshell Process Pattern",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1018",
                "attack.t1033",
                "attack.t1087"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/11",
            "description": "Detects suspicious IIS native-code module installations via command line",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_*",
                "filter_iis_setup": {
                    "ParentImage": "C:\\Windows\\System32\\inetsrv\\iissetup.exe"
                },
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "install",
                        "module"
                    ],
                    "CommandLine|contains|windash": "-name:"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\appcmd.exe"
                    },
                    {
                        "OriginalFileName": "appcmd.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown as it may vary from organisation to organisation how admins use to install IIS modules"
            ],
            "id": "9465ddf4-f9e4-4ebd-8d98-702df3a93239",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://researchcenter.paloaltonetworks.com/2018/01/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/",
                "https://www.microsoft.com/security/blog/2022/07/26/malicious-iis-extensions-quietly-open-persistent-backdoors-into-servers/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "IIS Native-Code Module Command Line Installation"
        },
        {
            "author": "Thomas Patzke, Florian Roth (Nextron Systems), Zach Stanford @svch0st, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2019/01/16",
            "description": "Detects potentially suspicious processes being spawned by a web server process which could be the result of a successfully placed web shell or exploitation\n",
            "detection": {
                "condition": "1 of selection_webserver_* and selection_anomaly_children and not 1 of filter_main_*",
                "filter_main_fp_1": {
                    "CommandLine|endswith": "Windows\\system32\\cmd.exe /c C:\\ManageEngine\\ADManager \"Plus\\ES\\bin\\elasticsearch.bat -Enode.name=RMP-NODE1 -pelasticsearch-pid.txt",
                    "ParentImage|endswith": "\\java.exe"
                },
                "filter_main_fp_2": {
                    "CommandLine|contains|all": [
                        "sc query",
                        "ADManager Plus"
                    ],
                    "ParentImage|endswith": "\\java.exe"
                },
                "selection_anomaly_children": {
                    "Image|endswith": [
                        "\\arp.exe",
                        "\\at.exe",
                        "\\bash.exe",
                        "\\bitsadmin.exe",
                        "\\certutil.exe",
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\dsget.exe",
                        "\\hostname.exe",
                        "\\nbtstat.exe",
                        "\\net.exe",
                        "\\net1.exe",
                        "\\netdom.exe",
                        "\\netsh.exe",
                        "\\nltest.exe",
                        "\\ntdutil.exe",
                        "\\powershell_ise.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\qprocess.exe",
                        "\\query.exe",
                        "\\qwinsta.exe",
                        "\\reg.exe",
                        "\\rundll32.exe",
                        "\\sc.exe",
                        "\\sh.exe",
                        "\\wmic.exe",
                        "\\wscript.exe",
                        "\\wusa.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat2": {
                    "ParentCommandLine|contains": [
                        "CATALINA_HOME",
                        "catalina.home",
                        "catalina.jar"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_image": {
                    "ParentImage|endswith": [
                        "\\caddy.exe",
                        "\\httpd.exe",
                        "\\nginx.exe",
                        "\\php-cgi.exe",
                        "\\php.exe",
                        "\\tomcat.exe",
                        "\\UMWorkerProcess.exe",
                        "\\w3wp.exe",
                        "\\ws_TomcatService.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat1": {
                    "ParentImage|contains": [
                        "-tomcat-",
                        "\\tomcat"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                }
            },
            "falsepositives": [
                "Particular web applications may spawn a shell process legitimately"
            ],
            "id": "8202070f-edeb-4d31-a010-a26c72ac5600",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/11",
            "references": [
                "https://media.defense.gov/2020/Jun/09/2002313081/-1/-1/0/CSI-DETECT-AND-PREVENT-WEB-SHELL-MALWARE-20200422.PDF"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1190"
            ],
            "title": "Suspicious Process By Web Server Process"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/03/17",
            "description": "Detects certain parent child patterns found in cases in which a web shell is used to perform certain credential dumping or exfiltration activities on a compromised system\n",
            "detection": {
                "condition": "1 of selection_webserver_* and 1 of selection_child_*",
                "selection_child_1": {
                    "CommandLine|contains|all": [
                        "rundll32",
                        "comsvcs"
                    ]
                },
                "selection_child_2": {
                    "CommandLine|contains|all": [
                        " -hp",
                        " a ",
                        " -m"
                    ]
                },
                "selection_child_3": {
                    "CommandLine|contains|all": [
                        "net",
                        " user ",
                        " /add"
                    ]
                },
                "selection_webserver_image": {
                    "ParentImage|endswith": [
                        "\\caddy.exe",
                        "\\httpd.exe",
                        "\\nginx.exe",
                        "\\php-cgi.exe",
                        "\\w3wp.exe",
                        "\\ws_tomcatservice.exe"
                    ]
                },
                "selection_child_4": {
                    "CommandLine|contains|all": [
                        "net",
                        " localgroup ",
                        " administrators ",
                        "/add"
                    ]
                },
                "selection_child_5": {
                    "Image|endswith": [
                        "\\ntdsutil.exe",
                        "\\ldifde.exe",
                        "\\adfind.exe",
                        "\\procdump.exe",
                        "\\Nanodump.exe",
                        "\\vssadmin.exe",
                        "\\fsutil.exe"
                    ]
                },
                "selection_child_6": {
                    "CommandLine|contains": [
                        " -decode ",
                        " -NoP ",
                        " -W Hidden ",
                        " /decode ",
                        " /ticket:",
                        " sekurlsa",
                        ".dmp full",
                        ".downloadfile(",
                        ".downloadstring(",
                        "FromBase64String",
                        "process call create",
                        "reg save ",
                        "whoami /priv"
                    ]
                },
                "selection_webserver_characteristics_tomcat1": {
                    "ParentImage|contains": [
                        "-tomcat-",
                        "\\tomcat"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                },
                "selection_webserver_characteristics_tomcat2": {
                    "CommandLine|contains": [
                        "catalina.jar",
                        "CATALINA_HOME"
                    ],
                    "ParentImage|endswith": [
                        "\\java.exe",
                        "\\javaw.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "4ebc877f-4612-45cb-b3a5-8e3834db36c9",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/09",
            "references": [
                "https://youtu.be/7aemGhaE9ds?t=641"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003",
                "attack.t1018",
                "attack.t1033",
                "attack.t1087"
            ],
            "title": "Webshell Hacking Activity Patterns"
        },
        {
            "author": "Max Altgelt (Nextron Systems)",
            "date": "2021/08/23",
            "description": "Detects a write of an Exchange CSR to an untypical directory or with aspx name suffix which can be used to place a webshell",
            "detection": {
                "condition": "keywords_export_command and keywords_export_params",
                "keywords_export_command": {
                    "|all": [
                        "New-ExchangeCertificate",
                        " -GenerateRequest",
                        " -BinaryEncoded",
                        " -RequestFile"
                    ]
                },
                "keywords_export_params": [
                    "\\\\\\\\localhost\\\\C$",
                    "\\\\\\\\127.0.0.1\\\\C$",
                    "C:\\\\inetpub",
                    ".aspx"
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "b7bc7038-638b-4ffd-880c-292c692209ef",
            "level": "critical",
            "logsource": {
                "service": "msexchange-management",
                "product": "windows"
            },
            "modified": "2023/01/23",
            "references": [
                "https://twitter.com/GossiTheDog/status/1429175908905127938"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Certificate Request Export to Exchange Webserver"
        },
        {
            "author": "Florian Roth (Nextron Systems), Rich Warren, Christian Burkard (Nextron Systems)",
            "date": "2021/08/09",
            "description": "Detects a successful export of an Exchange mailbox to untypical directory or with aspx name suffix which can be used to place a webshell or the needed role assignment for it",
            "detection": {
                "condition": "(export_command and export_params) or role_assignment",
                "export_command": {
                    "|all": [
                        "New-MailboxExportRequest",
                        " -Mailbox "
                    ]
                },
                "export_params": [
                    "-FilePath \"\\\\\\\\",
                    ".aspx"
                ],
                "role_assignment": {
                    "|all": [
                        "New-ManagementRoleAssignment",
                        " -Role \"Mailbox Import Export\"",
                        " -User "
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "516376b4-05cd-4122-bae0-ad7641c38d48",
            "level": "critical",
            "logsource": {
                "service": "msexchange-management",
                "product": "windows"
            },
            "modified": "2023/04/30",
            "references": [
                "https://blog.orange.tw/2021/08/proxylogon-a-new-attack-surface-on-ms-exchange-part-1.html"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Mailbox Export to Exchange Webserver"
        },
        {
            "author": "Jose Rodriguez @Cyb3rPandaH",
            "date": "2021/03/15",
            "description": "Rule to detect an adversary setting OabVirtualDirectory External URL property to a script in Exchange Management log",
            "detection": {
                "condition": "keywords",
                "keywords": {
                    "|all": [
                        "Set-OabVirtualDirectory",
                        "ExternalUrl",
                        "Page_Load",
                        "script"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "9db37458-4df2-46a5-95ab-307e7f29e675",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "msexchange-management"
            },
            "modified": "2023/01/23",
            "references": [
                "https://twitter.com/OTR_Community/status/1371053369071132675"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Exchange Set OabVirtualDirectory ExternalUrl Property"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/10/15",
            "description": "Detects suspicious sub processes of web server processes",
            "detection": {
                "condition": "1 of selection_* and sub_processes",
                "selection_general": {
                    "ParentImage|endswith": [
                        "/httpd",
                        "/lighttpd",
                        "/nginx",
                        "/apache2",
                        "/node",
                        "/caddy"
                    ]
                },
                "selection_tomcat": {
                    "ParentCommandLine|contains|all": [
                        "/bin/java",
                        "tomcat"
                    ]
                },
                "selection_websphere": {
                    "ParentCommandLine|contains|all": [
                        "/bin/java",
                        "websphere"
                    ]
                },
                "sub_processes": {
                    "Image|endswith": [
                        "/whoami",
                        "/ifconfig",
                        "/ip",
                        "/bin/uname",
                        "/bin/cat",
                        "/bin/crontab",
                        "/hostname",
                        "/iptables",
                        "/netstat",
                        "/pwd",
                        "/route"
                    ]
                }
            },
            "falsepositives": [
                "Web applications that invoke Linux command line tools"
            ],
            "id": "818f7b24-0fba-4c49-a073-8b755573b9c7",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "modified": "2022/12/28",
            "references": [
                "https://www.acunetix.com/blog/articles/web-shells-101-using-php-introduction-web-shells-part-2/",
                "https://media.defense.gov/2020/Jun/09/2002313081/-1/-1/0/CSI-DETECT-AND-PREVENT-WEB-SHELL-MALWARE-20200422.PDF"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Linux Webshell Indicators"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/03/14",
            "description": "Detects shellshock expressions in log files",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "(){:;};",
                    "() {:;};",
                    "() { :;};",
                    "() { :; };"
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c67e0c98-4d39-46ee-8f6b-437ebf6b950e",
            "level": "high",
            "logsource": {
                "product": "linux"
            },
            "modified": "2022/10/09",
            "references": [
                "https://owasp.org/www-pdf-archive/Shellshock_-_Tudor_Enache.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Shellshock Expression"
        },
        {
            "author": "Ilyas Ochkov, Beyu Denis, oscd.community",
            "date": "2019/10/12",
            "description": "Detects possible command execution by web application/web shell",
            "detection": {
                "condition": "selection",
                "selection": {
                    "key": "detect_execve_www",
                    "syscall": "execve",
                    "type": "SYSCALL"
                }
            },
            "falsepositives": [
                "Admin activity",
                "Crazy web applications"
            ],
            "id": "c0d3734d-330f-4a03-aae2-65dacc6a8222",
            "level": "critical",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2022/12/25",
            "references": [
                "Personal Experience of the Author"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1505.003"
            ],
            "title": "Webshell Remote Command Execution"
        }
    ]
}