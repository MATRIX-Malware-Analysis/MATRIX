{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--e2697b50-3405-47b7-9ece-888b07b0fa43",
    "created": "2024-08-13T14:46:37.129091Z",
    "modified": "2024-08-13T14:46:46.188954Z",
    "name": "Valid Accounts: Cloud Accounts",
    "description": "Valid accounts in cloud environments may allow adversaries to perform actions to achieve Initial Access, Persistence, Privilege Escalation, or Defense Evasion. Cloud accounts are those created and configured by an organization for use by users, remote support, services, or for administration of resources within a cloud service provider or SaaS application. Cloud Accounts can exist solely in the cloud; alternatively, they may be hybrid-joined between on-premises systems and the cloud through syncing or federation with other identity sources such as Windows Active Directory. [1][2][3]Service or user accounts may be targeted by adversaries through Brute Force, Phishing, or various other means to gain access to the environment. Federated or synced accounts may be a pathway for the adversary to affect both on-premises systems and cloud environments - for example, by leveraging shared credentials to log onto Remote Services. High privileged cloud accounts, whether federated, synced, or cloud-only, may also allow pivoting to on-premises environments by leveraging SaaS-based Software Deployment Tools to run commands on hybrid-joined devices.An adversary may create long lasting Additional Cloud Credentials on a compromised cloud account to maintain persistence in the environment. Such credentials may also be used to bypass security controls such as multi-factor authentication. Cloud accounts may also be able to assume Temporary Elevated Cloud Access or other privileges through various means within the environment. Misconfigurations in role assignments or role assumption policies may allow an adversary to use these mechanisms to leverage permissions outside the intended scope of the account. Such over privileged accounts may be used to harvest sensitive data from online storage accounts and databases through Cloud API or other methods.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1078/004",
            "external_id": "T1078/004"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Muhammad Faisal (@faisalusuf)",
            "date": "2024/02/25",
            "description": "Detects user authentication failure events.\nPlease note that this rule can be noisy and it is recommended to use with correlation based on \"author.name\" field.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "auditType.action": "User login failed",
                    "auditType.category": "Authentication"
                }
            },
            "falsepositives": [
                "Legitimate user wrong password attempts."
            ],
            "id": "70ed1d26-0050-4b38-a599-92c53d57d45a",
            "level": "medium",
            "logsource": {
                "definition": "Requirements: \"Advance\" log level is required to receive these audit events.",
                "product": "bitbucket",
                "service": "audit"
            },
            "references": [
                "https://confluence.atlassian.com/bitbucketserver/audit-log-events-776640423.html"
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110"
            ],
            "title": "Bitbucket User Login Failure"
        },
        {
            "author": "Muhammad Faisal (@faisalusuf)",
            "date": "2023/01/27",
            "description": "A self-hosted runner is a system that you deploy and manage to execute jobs from GitHub Actions on GitHub.com.\nThis rule detects changes to self-hosted runners configurations in the environment. The self-hosted runner configuration changes once detected,\nit should be validated from GitHub UI because the log entry may not provide full context.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "action": [
                        "org.remove_self_hosted_runner",
                        "org.runner_group_created",
                        "org.runner_group_removed",
                        "org.runner_group_runner_removed",
                        "org.runner_group_runners_added",
                        "org.runner_group_runners_updated",
                        "org.runner_group_updated",
                        "repo.register_self_hosted_runner",
                        "repo.remove_self_hosted_runner"
                    ]
                }
            },
            "falsepositives": [
                "Allowed self-hosted runners changes in the environment.",
                "A self-hosted runner is automatically removed from GitHub if it has not connected to GitHub Actions for more than 14 days.",
                "An ephemeral self-hosted runner is automatically removed from GitHub if it has not connected to GitHub Actions for more than 1 day."
            ],
            "id": "f8ed0e8f-7438-4b79-85eb-f358ef2fbebd",
            "level": "low",
            "logsource": {
                "definition": "Requirements: The audit log streaming feature must be enabled to be able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming",
                "product": "github",
                "service": "audit"
            },
            "references": [
                "https://docs.github.com/en/actions/hosting-your-own-runners/about-self-hosted-runners#about-self-hosted-runners",
                "https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization#search-based-on-operation"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.discovery",
                "attack.collection",
                "attack.defense_evasion",
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.initial_access",
                "attack.t1526",
                "attack.t1213.003",
                "attack.t1078.004"
            ],
            "title": "Github Self Hosted Runner Changes Detected"
        },
        {
            "author": "Muhammad Faisal (@faisalusuf)",
            "date": "2023/01/20",
            "description": "Detects when a user creates action secret for the organization, environment, codespaces or repository.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "action": [
                        "codespaces.create_an_org_secret",
                        "environment.create_actions_secret",
                        "org.create_actions_secret",
                        "repo.create_actions_secret"
                    ]
                }
            },
            "falsepositives": [
                "This detection cloud be noisy depending on the environment. It is recommended to keep a check on the new secrets when created and validate the \"actor\"."
            ],
            "id": "f9405037-bc97-4eb7-baba-167dad399b83",
            "level": "low",
            "logsource": {
                "definition": "Requirements: The audit log streaming feature must be enabled to be able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming",
                "product": "github",
                "service": "audit"
            },
            "references": [
                "https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization#audit-log-actions"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.initial_access",
                "attack.t1078.004"
            ],
            "title": "Github New Secret Created"
        },
        {
            "author": "Romain Gaillard (@romain-gaillard)",
            "date": "2024/07/29",
            "description": "Detects when changes are made to the SSH certificate configuration of the organization.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "action": [
                        "ssh_certificate_authority.create",
                        "ssh_certificate_requirement.disable"
                    ]
                }
            },
            "falsepositives": [
                "Allowed administrative activities."
            ],
            "id": "2f575940-d85e-4ddc-af13-17dad6f1a0ef",
            "level": "medium",
            "logsource": {
                "definition": "Requirements: The audit log streaming feature must be enabled to be able to receive such logs. You can enable following the documentation here: https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/streaming-the-audit-log-for-your-enterprise#setting-up-audit-log-streaming",
                "product": "github",
                "service": "audit"
            },
            "references": [
                "https://docs.github.com/en/enterprise-cloud@latest/organizations/managing-git-access-to-your-organizations-repositories/about-ssh-certificate-authorities",
                "https://docs.github.com/en/enterprise-cloud@latest/admin/monitoring-activity-in-your-enterprise/reviewing-audit-logs-for-your-enterprise/audit-log-events-for-your-enterprise#ssh_certificate_authority"
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.t1078.004"
            ],
            "title": "Github SSH Certificate Configuration Changed"
        },
        {
            "author": "kelnage",
            "date": "2023/09/07",
            "description": "Detects when Okta identifies new activity in the Admin Console.",
            "detection": {
                "condition": "all of selection_*",
                "selection_event": {
                    "eventtype": "policy.evaluate_sign_on",
                    "target.displayname": "Okta Admin Console"
                },
                "selection_positive": [
                    {
                        "debugcontext.debugdata.behaviors|contains": "POSITIVE"
                    },
                    {
                        "debugcontext.debugdata.logonlysecuritydata|contains": "POSITIVE"
                    }
                ]
            },
            "falsepositives": [
                "When an admin begins using the Admin Console and one of Okta's heuristics incorrectly identifies the behavior as being unusual."
            ],
            "id": "a0b38b70-3cb5-484b-a4eb-c4d8e7bcc0a9",
            "level": "high",
            "logsource": {
                "product": "okta",
                "service": "okta"
            },
            "modified": "2024/06/26",
            "status": "experimental",
            "references": [
                "https://developer.okta.com/docs/reference/api/system-log/",
                "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection"
            ],
            "tags": [
                "attack.initial_access",
                "attack.t1078.004"
            ],
            "title": "Okta New Admin Console Behaviours"
        },
        {
            "author": "vitaliy0x1",
            "date": "2020/01/21",
            "description": "Detects AWS root account usage",
            "detection": {
                "condition": "selection_usertype and not selection_eventtype",
                "selection_eventtype": {
                    "eventType": "AwsServiceEvent"
                },
                "selection_usertype": {
                    "userIdentity.type": "Root"
                }
            },
            "falsepositives": [
                "AWS Tasks That Require AWS Account Root User Credentials https://docs.aws.amazon.com/general/latest/gr/aws_tasks-that-require-root.html"
            ],
            "id": "8ad1600d-e9dc-4251-b0ee-a65268f29add",
            "level": "medium",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "modified": "2022/10/09",
            "status": "test",
            "references": [
                "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_root-user.html"
            ],
            "tags": [
                "attack.privilege_escalation",
                "attack.t1078.004"
            ],
            "title": "AWS Root Credentials"
        },
        {
            "author": "daniel.bohannon@permiso.io (@danielhbohannon)",
            "date": "2023/05/17",
            "description": "Detects S3 browser utility creating Inline IAM policy containing default S3 bucket name placeholder value of \"<YOUR-BUCKET-NAME>\".",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": "PutUserPolicy",
                    "eventSource": "iam.amazonaws.com",
                    "requestParameters|contains|all": [
                        "\"arn:aws:s3:::<YOUR-BUCKET-NAME>/*\"",
                        "\"s3:GetObject\"",
                        "\"Allow\""
                    ],
                    "userAgent|contains": "S3 Browser"
                }
            },
            "falsepositives": [
                "Valid usage of S3 browser with accidental creation of default Inline IAM policy without changing default S3 bucket name placeholder value"
            ],
            "id": "db014773-7375-4f4e-b83b-133337c0ffee",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "modified": "2023/05/17",
            "status": "test",
            "references": [
                "https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor"
            ],
            "tags": [
                "attack.execution",
                "attack.t1059.009",
                "attack.persistence",
                "attack.t1078.004"
            ],
            "title": "AWS IAM S3Browser Templated S3 Bucket Policy Creation"
        },
        {
            "author": "daniel.bohannon@permiso.io (@danielhbohannon)",
            "date": "2023/05/17",
            "description": "Detects S3 Browser utility creating IAM User or AccessKey.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": [
                        "CreateUser",
                        "CreateAccessKey"
                    ],
                    "eventSource": "iam.amazonaws.com",
                    "userAgent|contains": "S3 Browser"
                }
            },
            "falsepositives": [
                "Valid usage of S3 Browser for IAM User and/or AccessKey creation"
            ],
            "id": "db014773-d9d9-4792-91e5-133337c0ffee",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "status": "test",
            "references": [
                "https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor"
            ],
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1059.009",
                "attack.t1078.004"
            ],
            "title": "AWS IAM S3Browser User or AccessKey Creation"
        },
        {
            "author": "daniel.bohannon@permiso.io (@danielhbohannon)",
            "date": "2023/05/17",
            "description": "Detects S3 Browser utility performing reconnaissance looking for existing IAM Users without a LoginProfile defined then (when found) creating a LoginProfile.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": [
                        "GetLoginProfile",
                        "CreateLoginProfile"
                    ],
                    "eventSource": "iam.amazonaws.com",
                    "userAgent|contains": "S3 Browser"
                }
            },
            "falsepositives": [
                "Valid usage of S3 Browser for IAM LoginProfile listing and/or creation"
            ],
            "id": "db014773-b1d3-46bd-ba26-133337c0ffee",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "status": "test",
            "references": [
                "https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor"
            ],
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1059.009",
                "attack.t1078.004"
            ],
            "title": "AWS IAM S3Browser LoginProfile Creation"
        },
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/11/26",
            "description": "Detects when a user has been elevated to manage all Azure Subscriptions.\nThis change should be investigated immediately if it isn't planned.\nThis setting could allow an attacker access to Azure subscriptions in your environment.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "operationName": "MICROSOFT.AUTHORIZATION/ELEVATEACCESS/ACTION"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "09438caa-07b1-4870-8405-1dbafe3dad95",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "activitylogs"
            },
            "modified": "2022/08/23",
            "status": "test",
            "references": [
                "https://learn.microsoft.com/en-us/azure/role-based-access-control/resource-provider-operations#microsoftauthorization"
            ],
            "tags": [
                "attack.initial_access",
                "attack.t1078.004"
            ],
            "title": "Azure Subscription Permission Elevation Via ActivityLogs"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'",
            "date": "2022/08/10",
            "description": "Detects when a temporary access pass (TAP) is added to an account. TAPs added to priv accounts should be investigated",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Status": "Admin registered temporary access pass method for user",
                    "properties.message": "Admin registered security info"
                }
            },
            "falsepositives": [
                "Administrator adding a legitimate temporary access pass"
            ],
            "id": "fa84aaf5-8142-43cd-9ec2-78cfebf878ce",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts#changes-to-privileged-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1078.004"
            ],
            "title": "Temporary Access Pass Added To An Account"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik'",
            "date": "2022/06/02",
            "description": "Detects when a configuration change is made to an applications URI.\nURIs for domain names that no longer exist (dangling URIs), not using HTTPS, wildcards at the end of the domain, URIs that are no unique to that app, or URIs that point to domains you do not control should be investigated.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Update Application Sucess- Property Name AppAddress"
                }
            },
            "falsepositives": [
                "When and administrator is making legitimate URI configuration changes to an application. This should be a planned event."
            ],
            "id": "0055ad1f-be85-4798-83cf-a6da17c993b3",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-applications#application-configuration-changes"
            ],
            "status": "test",
            "tags": [
                "attack.t1528",
                "attack.t1078.004",
                "attack.persistence",
                "attack.credential_access",
                "attack.privilege_escalation"
            ],
            "title": "Application URI Configuration Changes"
        },
        {
            "author": "MikeDuddington, '@dudders1'",
            "date": "2022/06/30",
            "description": "Detects the change of user type from \"Guest\" to \"Member\" for potential elevation of privilege.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Category": "UserManagement",
                    "OperationName": "Update user",
                    "properties.message": "\"displayName\":\"UserType\",\"oldValue\":\"[\\\"Guest\\\"]\",\"newValue\":\"[\\\"Member\\\"]\""
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "8dee7a0d-43fd-4b3c-8cd1-605e189d195e",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-user-accounts#monitoring-external-user-sign-ins"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.initial_access",
                "attack.t1078.004"
            ],
            "title": "User State Changed From Guest To Member"
        },
        {
            "author": "YochanaHenderson, '@Yochana-H'",
            "date": "2022/08/03",
            "description": "Detect when a user has reset their password in Azure AD",
            "detection": {
                "condition": "selection and filter",
                "filter": {
                    "ActivityType|contains": "Password reset",
                    "Target|contains": "UPN"
                },
                "selection": {
                    "Category": "UserManagement",
                    "Initiatedby": "UPN",
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator or confirmed user action."
            ],
            "id": "340ee172-4b67-4fb4-832f-f961bdc1f3aa",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.credential_access",
                "attack.t1078.004"
            ],
            "title": "Password Reset By User Account"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'",
            "date": "2022/08/09",
            "description": "Detects when a PIM elevation is approved or denied. Outside of normal operations should be investigated.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Request Approved/Denied"
                }
            },
            "falsepositives": [
                "Actual admin using PIM."
            ],
            "id": "039a7469-0296-4450-84c0-f6966b16dc6d",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-identity-management#azure-ad-roles-assignment"
            ],
            "status": "test",
            "title": "PIM Approvals And Deny Elevation",
            "tags": [
                "attack.privilege_escalation",
                "attack.t1078.004"
            ]
        },
        {
            "author": "Michael Epping, '@mepples21'",
            "date": "2022/06/28",
            "description": "Monitor and alert for users added to device admin roles.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Category": "RoleManagement",
                    "OperationName|contains|all": [
                        "Add",
                        "member to role"
                    ],
                    "TargetResources|contains": [
                        "7698a772-787b-4ac8-901f-60d6b08affd2",
                        "62e90394-69f5-4237-9190-012177145e10"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "11c767ae-500b-423b-bae3-b234450736ed",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-devices#device-administrator-roles"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.privilege_escalation",
                "attack.t1078.004"
            ],
            "title": "Users Added to Global or Device Admin Roles"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'",
            "date": "2022/08/09",
            "description": "Detects when changes are made to PIM roles",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": "Update role setting in PIM"
                }
            },
            "falsepositives": [
                "Legit administrative PIM setting configuration changes"
            ],
            "id": "db6c06c4-bf3b-421c-aa88-15672b88c743",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-identity-management#azure-ad-roles-assignment"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.persistence",
                "attack.t1078.004"
            ],
            "title": "Changes To PIM Settings"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Bailey Bercik '@baileybercik'",
            "date": "2022/06/02",
            "description": "Detects when a configuration change is made to an applications AppID URI.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": [
                        "Update Application",
                        "Update Service principal"
                    ]
                }
            },
            "falsepositives": [
                "When and administrator is making legitimate AppID URI configuration changes to an application. This should be a planned event."
            ],
            "id": "1b45b0d1-773f-4f23-aedc-814b759563b1",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-applications#appid-uri-added-modified-or-removed"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1552",
                "attack.t1078.004"
            ],
            "title": "Application AppID Uri Configuration Changes"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'",
            "date": "2022/08/10",
            "description": "Detects when a user that doesn't have permissions to invite a guest user attempts to invite one.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Status": "failure",
                    "properties.message": "Invite external user"
                }
            },
            "falsepositives": [
                "A non malicious user is unaware of the proper process"
            ],
            "id": "0b4b72e3-4c53-4d5b-b198-2c58cfef39a9",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts#things-to-monitor"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.defense_evasion",
                "attack.t1078.004"
            ],
            "title": "Guest User Invited By Non Approved Inviters"
        },
        {
            "author": "Michael Epping, '@mepples21'",
            "date": "2022/06/28",
            "description": "Monitor and alert for Bitlocker key retrieval.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Category": "KeyManagement",
                    "OperationName": "Read BitLocker key"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a0413867-daf3-43dd-9245-734b3a787942",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-devices#bitlocker-key-retrieval"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1078.004"
            ],
            "title": "Bitlocker Key Retrieval"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H', Tim Shelton",
            "date": "2022/08/11",
            "description": "Detects when a new admin is created.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message|contains|all": [
                        "Add user",
                        "Add member to role"
                    ],
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "A legitimate new admin account being created"
            ],
            "id": "f7b5b004-dece-46e4-a4a5-f6fd0e1c6947",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts#changes-to-privileged-accounts"
            ],
            "modified": "2022/08/16",
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.t1078.004"
            ],
            "title": "Privileged Account Creation"
        },
        {
            "author": "Mark Morowczynski '@markmorow', Yochana Henderson, '@Yochana-H'",
            "date": "2022/08/06",
            "description": "Detects when a user is added to a privileged role.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "properties.message": [
                        "Add eligible member (permanent)",
                        "Add eligible member (eligible)"
                    ]
                }
            },
            "falsepositives": [
                "Legtimate administrator actions of adding members from a role"
            ],
            "id": "49a268a4-72f4-4e38-8a7b-885be690c5b5",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "auditlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-identity-management#azure-ad-roles-assignment"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.defense_evasion",
                "attack.t1078.004"
            ],
            "title": "User Added To Privilege Role"
        },
        {
            "author": "Yochana Henderson, '@Yochana-H'",
            "date": "2022/06/17",
            "description": "Alert on when legacy authentication has been used on an account",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ActivityDetails": "Sign-ins",
                    "ClientApp": [
                        "Other client",
                        "IMAP",
                        "POP3",
                        "MAPI",
                        "SMTP",
                        "Exchange ActiveSync",
                        "Exchange Web Services"
                    ],
                    "Username": "UPN"
                }
            },
            "falsepositives": [
                "User has been put in acception group so they can use legacy authentication"
            ],
            "id": "60f6535a-760f-42a9-be3f-c9a0a025906e",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-privileged-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110"
            ],
            "title": "Use of Legacy Authentication Protocols"
        },
        {
            "author": "Michael Epping, '@mepples21'",
            "date": "2022/06/28",
            "description": "Monitor and alert for device registration or join events where MFA was not performed.",
            "detection": {
                "condition": "selection and not filter_mfa",
                "filter_mfa": {
                    "AuthenticationRequirement": "multiFactorAuthentication"
                },
                "selection": {
                    "ResourceDisplayName": "Device Registration Service",
                    "conditionalAccessStatus": "success"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5afa454e-030c-4ab4-9253-a90aa7fcc581",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-devices#device-registrations-and-joins-outside-policy"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1078.004"
            ],
            "title": "Device Registration or Join Without MFA"
        },
        {
            "author": "MikeDuddington, '@dudders1'",
            "date": "2022/06/30",
            "description": "Detect when users in your Azure AD tenant are authenticating to other Azure AD Tenants.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "ResourceTenantId|contains": "HomeTenantID"
                },
                "selection": {
                    "HomeTenantId": "HomeTenantID",
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "5f521e4b-0105-4b72-845b-2198a54487b9",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-user-accounts#monitoring-external-user-sign-ins"
            ],
            "status": "test",
            "title": "Users Authenticating To Other Azure AD Tenants",
            "tags": [
                "attack.initial_access",
                "attack.t1078.004"
            ]
        },
        {
            "author": "Yochana Henderson, '@Yochana-H'",
            "date": "2022/06/01",
            "description": "Define a baseline threshold for failed sign-ins due to Conditional Access failures",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ResultType": 53003,
                    "Resultdescription": "Blocked by Conditional Access"
                }
            },
            "falsepositives": [
                "Service Account misconfigured",
                "Misconfigured Systems",
                "Vulnerability Scanners"
            ],
            "id": "b4a6d707-9430-4f5f-af68-0337f52d5c42",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-privileged-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1110",
                "attack.t1078.004"
            ],
            "title": "Sign-in Failure Due to Conditional Access Requirements Not Met"
        },
        {
            "author": "AlertIQ",
            "date": "2021/10/10",
            "description": "Detect failed attempts to sign in to disabled accounts.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ResultDescription": "User account is disabled. The account has been disabled by an administrator.",
                    "ResultType": 50057
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "908655e0-25cf-4ae1-b775-1c8ce9cf43d8",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts"
            ],
            "modified": "2022/12/25",
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.t1078.004"
            ],
            "title": "Login to Disabled Account"
        },
        {
            "author": "AlertIQ",
            "date": "2022/03/24",
            "description": "User has indicated they haven't instigated the MFA prompt and could indicate an attacker has the password for the account.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AuthenticationRequirement": "multiFactorAuthentication",
                    "Status|contains": "MFA Denied"
                }
            },
            "falsepositives": [
                "Users actually login but miss-click into the Deny button when MFA prompt."
            ],
            "id": "e40f4962-b02b-4192-9bfe-245f7ece1f99",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://www.microsoft.com/security/blog/2022/03/22/dev-0537-criminal-actor-targeting-organizations-for-data-exfiltration-and-destruction/"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110",
                "attack.t1621"
            ],
            "title": "Multifactor Authentication Denied"
        },
        {
            "author": "AlertIQ",
            "date": "2021/10/10",
            "description": "Detect access has been blocked by Conditional Access policies.\nThe access policy does not allow token issuance which might be sights\u2248 of unauthorizeed login to valid accounts.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ResultType": 53003
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "9a60e676-26ac-44c3-814b-0c2a8b977adf",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts"
            ],
            "modified": "2022/12/25",
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.initial_access",
                "attack.t1110",
                "attack.t1078.004"
            ],
            "title": "User Access Blocked by Azure Conditional Access"
        },
        {
            "author": "Yochana Henderson, '@Yochana-H'",
            "date": "2022/06/17",
            "description": "Detects when an account is disabled or blocked for sign in but tried to log in",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ResultDescription": "Failure",
                    "ResultType": 50057
                }
            },
            "falsepositives": [
                "Account disabled or blocked in error",
                "Automation account has been blocked or disabled"
            ],
            "id": "4afac85c-224a-4dd7-b1af-8da40e1c60bd",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-privileged-accounts"
            ],
            "status": "test",
            "title": "Account Disabled or Blocked for Sign in Attempts",
            "tags": [
                "attack.initial_access",
                "attack.t1078.004"
            ]
        },
        {
            "author": "Michael Epping, '@mepples21'",
            "date": "2022/06/28",
            "description": "Monitor and alert for sign-ins where the device was non-compliant.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "DeviceDetail.isCompliant": "false"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4f77e1d7-3982-4ee0-8489-abf2d6b75284",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-devices#non-compliant-device-sign-in"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1078.004"
            ],
            "title": "Sign-ins from Non-Compliant Devices"
        },
        {
            "author": "MikeDuddington, '@dudders1'",
            "date": "2022/07/28",
            "description": "Detect successful authentications from countries you do not operate out of.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "Location|contains": "<Countries you DO operate out of e,g GB, use OR for multiple>"
                },
                "selection": {
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "8c944ecb-6970-4541-8496-be554b8e2846",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-user-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110"
            ],
            "title": "Successful Authentications From Countries You Do Not Operate Out Of"
        },
        {
            "author": "MikeDuddington, '@dudders1'",
            "date": "2022/07/27",
            "description": "Detect when users are authenticating without MFA being required.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AuthenticationRequirement": "singleFactorAuthentication",
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "28eea407-28d7-4e42-b0be-575d5ba60b2c",
            "level": "low",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-user-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1556.006"
            ],
            "title": "Azure AD Only Single Factor Authentication Required"
        },
        {
            "author": "MikeDuddington, '@dudders1'",
            "date": "2022/07/28",
            "description": "Detect failed authentications from countries you do not operate out of.",
            "detection": {
                "condition": "not selection and not selection1",
                "selection": {
                    "Status": "Success"
                },
                "selection1": {
                    "Location|contains": "<Countries you DO operate out of e,g GB, use OR for multiple>"
                }
            },
            "falsepositives": [
                "If this was approved by System Administrator."
            ],
            "id": "28870ae4-6a13-4616-bd1a-235a7fad7458",
            "level": "low",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-gb/entra/architecture/security-operations-user-accounts"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110"
            ],
            "title": "Failed Authentications From Countries You Do Not Operate Out Of"
        },
        {
            "author": "AlertIQ",
            "date": "2021/10/10",
            "description": "Identifies user login with multifactor authentication failures, which might be an indication an attacker has the password for the account but can't pass the MFA challenge.",
            "detection": {
                "condition": "1 of selection_*",
                "selection_500121": {
                    "ResultDescription|contains": "Authentication failed during strong authentication request",
                    "ResultType": 500121
                },
                "selection_50074": {
                    "ResultDescription|contains": "Strong Auth required",
                    "ResultType": 50074
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5496ff55-42ec-4369-81cb-00f417029e25",
            "level": "medium",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-privileged-accounts"
            ],
            "modified": "2022/12/18",
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110",
                "attack.t1621"
            ],
            "title": "Multifactor Authentication Interrupted"
        },
        {
            "author": "Michael Epping, '@mepples21'",
            "date": "2022/06/28",
            "description": "Monitor and alert for Sign-ins by unknown devices from non-Trusted locations.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AuthenticationRequirement": "singleFactorAuthentication",
                    "DeviceDetail.deviceId": "",
                    "NetworkLocationDetails": "[]",
                    "ResultType": 0
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4d136857-6a1a-432a-82fc-5dd497ee5e7c",
            "level": "low",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://learn.microsoft.com/en-us/entra/architecture/security-operations-devices#non-compliant-device-sign-in"
            ],
            "modified": "2022/10/05",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1078.004"
            ],
            "title": "Sign-ins by Unknown Devices"
        },
        {
            "author": "Harjot Singh, '@cyb3rjy0t'",
            "date": "2023/03/20",
            "description": "Detects successful authentication from potential clients using legacy authentication via user agent strings. This could be a sign of MFA bypass using a password spray attack.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "userAgent|contains": [
                        "BAV2ROPC",
                        "CBAinPROD",
                        "CBAinTAR"
                    ],
                    "Status": "Success"
                }
            },
            "falsepositives": [
                "Known Legacy Accounts"
            ],
            "id": "53bb4f7f-48a8-4475-ac30-5a82ddfdf6fc",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://blooteem.com/march-2022",
                "https://www.microsoft.com/en-us/security/blog/2021/10/26/protect-your-business-from-password-sprays-with-microsoft-dart-recommendations/"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.credential_access",
                "attack.t1078.004",
                "attack.t1110"
            ],
            "title": "Potential MFA Bypass Using Legacy Client Authentication"
        }
    ]
}