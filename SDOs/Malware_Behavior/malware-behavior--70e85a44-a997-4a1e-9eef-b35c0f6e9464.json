{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--70e85a44-a997-4a1e-9eef-b35c0f6e9464",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.103858Z",
    "name": "Match Legitimate Name or Location: ",
    "description": "Adversaries may match or approximate the name or location of legitimate files or resources when naming/placing them. This is done for the sake of evading defenses and observation. This may be done by placing an executable in a commonly trusted directory (ex: under System32) or giving it the name of a legitimate, trusted program (ex: svchost.exe). In containerized environments, this may also be done by creating a resource in a namespace that matches the naming convention of a container pod or cluster. Alternatively, a file or container image name given may be a close approximation to legitimate programs/images or something innocuous.Adversaries may also use the same icon of the file they are trying to mimic.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1036/005",
            "external_id": "T1036/005"
        },
        {
            "source_name": "CAPEC 543",
            "external_id": "malware-behavior--c846d5f5-68f7-4988-a0d0-bebb12c86d07"
        },
        {
            "source_name": "CAPEC 616",
            "external_id": "malware-behavior--88d93de1-e336-4e5e-a43b-1938030a0c03"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/10/25",
            "description": "Detects a flashplayer update from an unofficial location",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "cs-host|endswith": ".adobe.com"
                },
                "selection": [
                    {
                        "c-uri|contains": "/flash_install.php"
                    },
                    {
                        "c-uri|endswith": "/install_flash_player.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown flash download locations"
            ],
            "id": "4922a5dd-6743-4fc2-8e81-144374280997",
            "level": "high",
            "logsource": {
                "category": "proxy"
            },
            "modified": "2022/08/08",
            "references": [
                "https://gist.github.com/roycewilliams/a723aaf8a6ac3ba4f817847610935cfb"
            ],
            "status": "test",
            "tags": [
                "attack.initial_access",
                "attack.t1189",
                "attack.execution",
                "attack.t1204.002",
                "attack.defense_evasion",
                "attack.t1036.005"
            ],
            "title": "Flash Player Update from Suspicious Location"
        },
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects deployments of pods within the kube-system namespace, which could be intended to imitate system pods.\nSystem pods, created by controllers such as Deployments or DaemonSets have random suffixes in their names.\nAttackers can use this fact and name their backdoor pods as if they were created by these controllers to avoid detection.\nDeployment of such a backdoor container e.g. named kube-proxy-bv61v, could be attempted in the kube-system namespace alongside the other administrative containers.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "objectRef.namespace": "kube-system",
                    "objectRef.resource": "pods",
                    "verb": "create"
                }
            },
            "falsepositives": [
                "System components such as daemon-set-controller and kube-scheduler also create pods in the kube-system namespace"
            ],
            "id": "a80d927d-ac6e-443f-a867-e8d6e3897318",
            "level": "medium",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://microsoft.github.io/Threat-Matrix-for-Kubernetes/techniques/Pod%20or%20container%20name%20similarily/"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1036.005"
            ],
            "title": "Creation Of Pod In System Namespace"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2024/06/24",
            "description": "Detects the creation of a file with the \".dll\" extension that has the name of a System DLL in uncommon or unsuspected locations. (Outisde of \"System32\", \"SysWOW64\", etc.).\nIt is highly recommended to perform an initial baseline before using this rule in production.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": {
                    "TargetFilename|contains": [
                        "C:\\$WINDOWS.~BT\\",
                        "C:\\$WinREAgent\\",
                        "C:\\Windows\\SoftwareDistribution\\",
                        "C:\\Windows\\System32\\",
                        "C:\\Windows\\SysWOW64\\",
                        "C:\\Windows\\WinSxS\\",
                        "C:\\Windows\\uus\\"
                    ]
                },
                "selection": {
                    "TargetFilename|endswith": [
                        "\\secur32.dll",
                        "\\tdh.dll"
                    ]
                }
            },
            "falsepositives": [
                "Third party software might bundle specific versions of system DLLs."
            ],
            "id": "13c02350-4177-4e45-ac17-cf7ca628ff5e",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "Internal Research"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.005"
            ],
            "title": "Files With System DLL Name In Unsuspected Locations"
        },
        {
            "author": "Sander Wiebing, Tim Shelton, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/05/26",
            "description": "Detects the creation of an executable with a system process name in folders other than the system ones (System32, SysWOW64, etc.).\nIt is highly recommended to perform an initial baseline before using this rule in production.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": {
                    "TargetFilename|contains": [
                        "C:\\$WINDOWS.~BT\\",
                        "C:\\$WinREAgent\\",
                        "C:\\Windows\\SoftwareDistribution\\",
                        "C:\\Windows\\System32\\",
                        "C:\\Windows\\SysWOW64\\",
                        "C:\\Windows\\WinSxS\\",
                        "C:\\Windows\\uus\\"
                    ]
                },
                "filter_main_explorer": {
                    "TargetFilename|endswith": "C:\\Windows\\explorer.exe"
                },
                "filter_main_healtray": {
                    "Image|endswith": "\\SecurityHealthSetup.exe",
                    "TargetFilename|contains": "C:\\Windows\\System32\\SecurityHealth\\",
                    "TargetFilename|endswith": "\\SecurityHealthSystray.exe"
                },
                "filter_main_msiexec": {
                    "Image|endswith": "C:\\WINDOWS\\system32\\msiexec.exe",
                    "TargetFilename|endswith": [
                        "C:\\Program Files\\PowerShell\\7\\pwsh.exe",
                        "C:\\Program Files\\PowerShell\\7-preview\\pwsh.exe"
                    ]
                },
                "filter_main_svchost": {
                    "Image|endswith": "C:\\Windows\\system32\\svchost.exe",
                    "TargetFilename|contains": "C:\\Program Files\\WindowsApps\\"
                },
                "filter_main_wuauclt": {
                    "Image|endswith": "C:\\Windows\\System32\\wuauclt.exe"
                },
                "selection": {
                    "TargetFilename|endswith": [
                        "\\AtBroker.exe",
                        "\\audiodg.exe",
                        "\\backgroundTaskHost.exe",
                        "\\bcdedit.exe",
                        "\\bitsadmin.exe",
                        "\\cmdl32.exe",
                        "\\cmstp.exe",
                        "\\conhost.exe",
                        "\\csrss.exe",
                        "\\dasHost.exe",
                        "\\dfrgui.exe",
                        "\\dllhost.exe",
                        "\\dwm.exe",
                        "\\eventcreate.exe",
                        "\\eventvwr.exe",
                        "\\explorer.exe",
                        "\\extrac32.exe",
                        "\\fontdrvhost.exe",
                        "\\ipconfig.exe",
                        "\\iscsicli.exe",
                        "\\iscsicpl.exe",
                        "\\logman.exe",
                        "\\LogonUI.exe",
                        "\\LsaIso.exe",
                        "\\lsass.exe",
                        "\\lsm.exe",
                        "\\msiexec.exe",
                        "\\msinfo32.exe",
                        "\\mstsc.exe",
                        "\\nbtstat.exe",
                        "\\odbcconf.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regini.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\RuntimeBroker.exe",
                        "\\schtasks.exe",
                        "\\SearchFilterHost.exe",
                        "\\SearchIndexer.exe",
                        "\\SearchProtocolHost.exe",
                        "\\SecurityHealthService.exe",
                        "\\SecurityHealthSystray.exe",
                        "\\services.exe",
                        "\\ShellAppRuntime.exe",
                        "\\sihost.exe",
                        "\\smartscreen.exe",
                        "\\smss.exe",
                        "\\spoolsv.exe",
                        "\\svchost.exe",
                        "\\SystemSettingsBroker.exe",
                        "\\taskhost.exe",
                        "\\taskhostw.exe",
                        "\\Taskmgr.exe",
                        "\\TiWorker.exe",
                        "\\vssadmin.exe",
                        "\\w32tm.exe",
                        "\\WerFault.exe",
                        "\\WerFaultSecure.exe",
                        "\\wermgr.exe",
                        "\\wevtutil.exe",
                        "\\wininit.exe",
                        "\\winlogon.exe",
                        "\\winrshost.exe",
                        "\\WinRTNetMUAHostServer.exe",
                        "\\wlanext.exe",
                        "\\wlrmdr.exe",
                        "\\WmiPrvSE.exe",
                        "\\wslhost.exe",
                        "\\WSReset.exe",
                        "\\WUDFHost.exe",
                        "\\WWAHost.exe"
                    ]
                }
            },
            "falsepositives": [
                "System processes copied outside their default folders for testing purposes",
                "Third party software naming their software with the same names as the processes mentioned here"
            ],
            "id": "d5866ddf-ce8f-4aea-b28e-d96485a20d3d",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "Internal Research"
            ],
            "modified": "2024/06/24",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.005"
            ],
            "title": "Files With System Process Name In Unsuspected Locations"
        },
        {
            "author": "elhoim",
            "date": "2022/04/28",
            "description": "Detects the creation of copy of suspicious files (EXE/DLL) to the default GPO storage folder",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename|contains": "\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\",
                    "TargetFilename|endswith": [
                        ".dll",
                        ".exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5f87308a-0a5b-4623-ae15-d8fa1809bc60",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://redcanary.com/blog/intelligence-insights-november-2021/"
            ],
            "status": "test",
            "tags": [
                "attack.t1036.005",
                "attack.defense_evasion"
            ],
            "title": "Suspicious Files in Default GPO Folder"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/11/14",
            "description": "Detects the execution of msiexec.exe from an uncommon directory",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "Image|startswith": [
                        "C:\\Windows\\System32\\",
                        "C:\\Windows\\SysWOW64\\",
                        "C:\\Windows\\WinSxS\\"
                    ]
                },
                "selection": [
                    {
                        "Image|endswith": "\\msiexec.exe"
                    },
                    {
                        "OriginalFileName": "\\msiexec.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "e22a6eb2-f8a5-44b5-8b44-a2dbd47b1144",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://twitter.com/200_okay_/status/1194765831911215104"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.005"
            ],
            "title": "Potential MsiExec Masquerading"
        },
        {
            "author": "vburov",
            "date": "2019/02/23",
            "description": "Detect suspicious parent processes of well-known Windows processes",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_msmpeng": {
                    "ParentImage|contains": [
                        "\\Windows Defender\\",
                        "\\Microsoft Security Client\\"
                    ],
                    "ParentImage|endswith": "\\MsMpEng.exe"
                },
                "filter_null": [
                    {
                        "ParentImage": null
                    },
                    {
                        "ParentImage": "-"
                    }
                ],
                "filter_sys": [
                    {
                        "ParentImage|endswith": [
                            "\\SavService.exe",
                            "\\ngen.exe"
                        ]
                    },
                    {
                        "ParentImage|contains": [
                            "\\System32\\",
                            "\\SysWOW64\\"
                        ]
                    }
                ],
                "selection": {
                    "Image|endswith": [
                        "\\svchost.exe",
                        "\\taskhost.exe",
                        "\\lsm.exe",
                        "\\lsass.exe",
                        "\\services.exe",
                        "\\lsaiso.exe",
                        "\\csrss.exe",
                        "\\wininit.exe",
                        "\\winlogon.exe"
                    ]
                }
            },
            "falsepositives": [
                "Some security products seem to spawn these"
            ],
            "id": "96036718-71cc-4027-a538-d1587e0006a7",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/02/14",
            "references": [
                "https://securitybytes.io/blue-team-fundamentals-part-two-windows-processes-759fe15965e2",
                "https://www.carbonblack.com/2014/06/10/screenshot-demo-hunt-evil-faster-than-ever-with-carbon-black/",
                "https://www.13cubed.com/downloads/windows_process_genealogy_v2.pdf"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.003",
                "attack.t1036.005"
            ],
            "title": "Windows Processes Suspicious Parent Directory"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/08/15",
            "description": "Detects an uncommon svchost parent process",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": {
                    "ParentImage|endswith": [
                        "\\Mrt.exe",
                        "\\MsMpEng.exe",
                        "\\ngen.exe",
                        "\\rpcnet.exe",
                        "\\services.exe",
                        "\\TiWorker.exe"
                    ]
                },
                "filter_main_parent_empty": {
                    "ParentImage": [
                        "-",
                        ""
                    ]
                },
                "filter_main_parent_null": {
                    "ParentImage": null
                },
                "selection": {
                    "Image|endswith": "\\svchost.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "01d2e2a1-5f09-44f7-9fc1-24faa7479b6d",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "Internal Research"
            ],
            "modified": "2022/06/28",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.005"
            ],
            "title": "Uncommon Svchost Parent Process"
        },
        {
            "author": "Swachchhanda Shrawan Poudel, Elastic (idea)",
            "date": "2023/04/20",
            "description": "Detects the creation of a scheduled task using the \"-XML\" flag with a file without the '.xml' extension. This behavior could be indicative of potential defense evasion attempt during persistence",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_extension_xml": {
                    "CommandLine|contains": ".xml"
                },
                "filter_main_rundll32": {
                    "ParentCommandLine|contains|all": [
                        ":\\WINDOWS\\Installer\\MSI",
                        ".tmp,zzzzInvokeManagedCustomActionOutOfProc"
                    ],
                    "ParentImage|endswith": "\\rundll32.exe"
                },
                "filter_main_system_process": {
                    "IntegrityLevel": "System"
                },
                "filter_optional_third_party": {
                    "ParentImage|endswith": [
                        ":\\ProgramData\\OEM\\UpgradeTool\\CareCenter_*\\BUnzip\\Setup_msi.exe",
                        ":\\Program Files\\Axis Communications\\AXIS Camera Station\\SetupActions.exe",
                        ":\\Program Files\\Axis Communications\\AXIS Device Manager\\AdmSetupActions.exe",
                        ":\\Program Files (x86)\\Zemana\\AntiMalware\\AntiMalware.exe",
                        ":\\Program Files\\Dell\\SupportAssist\\pcdrcui.exe"
                    ]
                },
                "selection_cli_create": {
                    "CommandLine|contains": [
                        "/create",
                        "-create"
                    ]
                },
                "selection_cli_xml": {
                    "CommandLine|contains": [
                        "/xml",
                        "-xml"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\schtasks.exe"
                    },
                    {
                        "OriginalFileName": "schtasks.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "dd2a821e-3b07-4d3b-a9ac-929fe4c6ca0c",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://learn.microsoft.com/en-us/windows/win32/taskschd/daily-trigger-example--xml-",
                "https://github.com/elastic/protections-artifacts/blob/084067123d3328a823b1c3fdde305b694275c794/behavior/rules/persistence_suspicious_scheduled_task_creation_via_masqueraded_xml_file.toml"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.persistence",
                "attack.t1036.005",
                "attack.t1053.005"
            ],
            "title": "Suspicious Scheduled Task Creation via Masqueraded XML File"
        }
    ]
}