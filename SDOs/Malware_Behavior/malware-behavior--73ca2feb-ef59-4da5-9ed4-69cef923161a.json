{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--73ca2feb-ef59-4da5-9ed4-69cef923161a",
    "created": "2024-08-13T14:46:37.051337Z",
    "modified": "2024-08-13T14:46:45.697713Z",
    "name": "Valid Accounts: Domain Accounts",
    "description": "Adversaries may obtain and abuse credentials of a domain account as a means of gaining Initial Access, Persistence, Privilege Escalation, or Defense Evasion.[1] Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain. Domain accounts can cover users, administrators, and services.[2]Adversaries may compromise domain accounts, some with a high level of privileges, through various means such as OS Credential Dumping or password reuse, allowing access to privileged resources of the domain.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1078/002",
            "external_id": "T1078/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "jamesc-grafana",
            "date": "2024/07/11",
            "description": "Detects when an instance identity has taken an action that isn't inside SSM.\nThis can indicate that a compromised EC2 instance is being used as a pivot point.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": [
                    {
                        "eventSource": "ssm.amazonaws.com"
                    },
                    {
                        "eventName": "RegisterManagedInstance"
                    },
                    {
                        "sourceIPAddress": "AWS Internal"
                    }
                ],
                "selection": {
                    "userIdentity.arn|re": ".+:assumed-role/aws:.+"
                }
            },
            "falsepositives": [
                "A team has configured an EC2 instance to use instance profiles that grant the option for the EC2 instance to talk to other AWS Services"
            ],
            "id": "352a918a-34d8-4882-8470-44830c507aa3",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "references": [
                "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-identity-roles.html",
                "https://ermetic.com/blog/aws/aws-ec2-imds-what-you-need-to-know/",
                "https://www.packetmischief.ca/2023/07/31/amazon-ec2-credential-exfiltration-how-it-happens-and-how-to-mitigate-it/#lifting-credentials-from-imds-this-is-why-we-cant-have-nice-things"
            ],
            "status": "experimental",
            "tags": [
                "attack.privilege_escalation",
                "attack.defense_evasion",
                "attack.t1078",
                "attack.t1078.002"
            ],
            "title": "Malicious Usage Of IMDS Credentials Outside Of AWS Infrastructure"
        },
        {
            "author": "juju4",
            "date": "2017/10/29",
            "description": "Detect remote login by Administrator user (depending on internal pattern).",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AuthenticationPackageName": "Negotiate",
                    "EventID": 4624,
                    "LogonType": 10,
                    "TargetUserName|startswith": "Admin"
                }
            },
            "falsepositives": [
                "Legitimate administrative activity."
            ],
            "id": "0f63e1ef-1eb9-4226-9d54-8927ca08520a",
            "level": "low",
            "logsource": {
                "definition": "Requirements: Identifiable administrators usernames (pattern or special unique character. ex: \"Admin-*\"), internal policy mandating use only as secondary account",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/09",
            "references": [
                "https://car.mitre.org/wiki/CAR-2016-04-005"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.t1078.001",
                "attack.t1078.002",
                "attack.t1078.003",
                "car.2016-04-005"
            ],
            "title": "Admin User Remote Logon"
        }
    ]
}