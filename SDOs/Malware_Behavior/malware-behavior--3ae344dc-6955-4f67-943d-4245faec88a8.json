{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--3ae344dc-6955-4f67-943d-4245faec88a8",
    "created": "2024-08-13T14:46:36.84845Z",
    "modified": "2024-08-13T14:46:44.540684Z",
    "name": "Account Discovery: Cloud Account",
    "description": "Adversaries may attempt to get a listing of cloud accounts. Cloud accounts are those created and configured by an organization for use by users, remote support, services, or for administration of resources within a cloud service provider or SaaS application.With authenticated access there are several tools that can be used to find accounts. The Get-MsolRoleMember PowerShell cmdlet can be used to obtain account names given a role or permissions group in Office 365.[1][2] The Azure CLI (AZ CLI) also provides an interface to obtain user accounts with authenticated access to a domain. The command az ad user list will list all users within a domain.[3][4] The AWS command aws iam list-users may be used to obtain a list of users in the current account while aws iam list-roles can obtain IAM roles that have a specified path prefix.[5][6] In GCP, gcloud iam service-accounts list and gcloud projects get-iam-policy may be used to obtain a listing of service accounts and users in a project.[7]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1087/004",
            "external_id": "T1087/004"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/27",
            "description": "Detects AzureHound (A BloodHound data collector for Microsoft Azure) activity via the default User-Agent that is used during its operation after successful authentication.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ResultType": 0,
                    "userAgent|contains": "azurehound"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "35b781cc-1a08-4a5a-80af-42fd7c315c6b",
            "level": "high",
            "logsource": {
                "product": "azure",
                "service": "signinlogs"
            },
            "references": [
                "https://github.com/BloodHoundAD/AzureHound"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.t1087.004",
                "attack.t1526"
            ],
            "title": "Discovery Using AzureHound"
        },
        {
            "author": "Leo Tsaousis (@laripping)",
            "date": "2024/03/26",
            "description": "Detects identities attempting to enumerate their Kubernetes RBAC permissions.\nIn the early stages of a breach, attackers will aim to list the permissions they have within the compromised environment.\nIn a Kubernetes cluster, this can be achieved by interacting with the API server, and querying the SelfSubjectAccessReview API via e.g. a \"kubectl auth can-i --list\" command.\nThis will enumerate the Role-Based Access Controls (RBAC) rules defining the compromised user's authorization.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "apiGroup": "authorization.k8s.io",
                    "objectRef.resource": "selfsubjectrulesreviews",
                    "verb": "create"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "84b777bd-c946-4d17-aa2e-c39f5a454325",
            "level": "low",
            "logsource": {
                "category": "application",
                "product": "kubernetes",
                "service": "audit"
            },
            "references": [
                "https://www.elastic.co/guide/en/security/current/kubernetes-suspicious-self-subject-review.html"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1069.003",
                "attack.t1087.004"
            ],
            "title": "RBAC Permission Enumeration Attempt"
        }
    ]
}