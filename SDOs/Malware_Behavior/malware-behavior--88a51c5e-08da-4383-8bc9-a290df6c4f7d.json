{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--88a51c5e-08da-4383-8bc9-a290df6c4f7d",
    "created": "2024-08-13T14:46:37.141479Z",
    "modified": "2024-08-13T14:46:46.264045Z",
    "name": "Event Triggered Execution: Netsh Helper DLL",
    "description": "Adversaries may establish persistence by executing malicious content triggered by Netsh Helper DLLs. Netsh.exe (also referred to as Netshell) is a command-line scripting utility used to interact with the network configuration of a system. It contains functionality to add helper DLLs for extending functionality of the utility.[1] The paths to registered netsh.exe helper DLLs are entered into the Windows Registry at HKLM\\SOFTWARE\\Microsoft\\Netsh.Adversaries can use netsh.exe helper DLLs to trigger execution of arbitrary code in a persistent manner. This execution would take place anytime netsh.exe is executed, which could happen automatically, with another persistence technique, or if other software (ex: VPN) is present on the system that executes netsh.exe as part of its normal functionality.[2][3]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1546/007",
            "external_id": "T1546/007"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Victor Sergeev, oscd.community",
            "date": "2019/10/25",
            "description": "Detects the execution of netsh with \"add helper\" flag in order to add a custom helper DLL. This technique can be abused to add a malicious helper DLL that can be used as a persistence proxy that gets called when netsh.exe is executed.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "add",
                        "helper"
                    ]
                },
                "selection_img": [
                    {
                        "OriginalFileName": "netsh.exe"
                    },
                    {
                        "Image|endswith": "\\netsh.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "56321594-9087-49d9-bf10-524fe8479452",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/28",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1546.007/T1546.007.md",
                "https://github.com/outflanknl/NetshHelperBeacon",
                "https://web.archive.org/web/20160928212230/https://www.adaptforward.com/2016/09/using-netshell-to-execute-evil-dlls-and-persist-on-a-host/"
            ],
            "related": [
                {
                    "id": "c90362e0-2df3-4e61-94fe-b37615814cb1",
                    "type": "similar"
                },
                {
                    "id": "e7b18879-676e-4a0e-ae18-27039185a8e7",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.persistence",
                "attack.t1546.007",
                "attack.s0108"
            ],
            "title": "Potential Persistence Via Netsh Helper DLL"
        },
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/18",
            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
            "detection": {
                "condition": "selection_img and (1 of selection_flags_*)",
                "selection_flags_configure": {
                    "CommandLine|contains|all": [
                        "/configure",
                        "/db"
                    ]
                },
                "selection_flags_discovery": {
                    "CommandLine|contains|all": [
                        "/export",
                        "/cfg"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\secedit.exe"
                    },
                    {
                        "OriginalFileName": "SeCEdit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrative use"
            ],
            "id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1562.002",
                "attack.t1547.001",
                "attack.t1505.005",
                "attack.t1556.002",
                "attack.t1562",
                "attack.t1574.007",
                "attack.t1564.002",
                "attack.t1546.008",
                "attack.t1546.007",
                "attack.t1547.014",
                "attack.t1547.010",
                "attack.t1547.002",
                "attack.t1557",
                "attack.t1082"
            ],
            "title": "Potential Suspicious Activity Using SeCEdit"
        },
        {
            "id": "e7b18879-676e-4a0e-ae18-27039185a8e7",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/11/28",
            "description": "Detects changes to the Netsh registry key to add a new DLL value that is located on a suspicious location. This change might be an indication of a potential persistence attempt by adding a malicious Netsh helper\n",
            "detection": {
                "condition": "selection_target and 1 of selection_folders_*",
                "selection_folders_1": {
                    "Details|contains": [
                        ":\\Perflogs\\",
                        ":\\Users\\Public\\",
                        ":\\Windows\\Temp\\",
                        "\\AppData\\Local\\Temp\\",
                        "\\Temporary Internet"
                    ]
                },
                "selection_folders_2": [
                    {
                        "Details|contains|all": [
                            ":\\Users\\",
                            "\\Favorites\\"
                        ]
                    },
                    {
                        "Details|contains|all": [
                            ":\\Users\\",
                            "\\Favourites\\"
                        ]
                    },
                    {
                        "Details|contains|all": [
                            ":\\Users\\",
                            "\\Contacts\\"
                        ]
                    },
                    {
                        "Details|contains|all": [
                            ":\\Users\\",
                            "\\Pictures\\"
                        ]
                    }
                ],
                "selection_target": {
                    "TargetObject|contains": "\\SOFTWARE\\Microsoft\\NetSh"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "references": [
                "https://www.ired.team/offensive-security/persistence/t1128-netsh-helper-dll",
                "https://pentestlab.blog/2019/10/29/persistence-netsh-helper-dll/"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "56321594-9087-49d9-bf10-524fe8479452"
                },
                {
                    "id": "c90362e0-2df3-4e61-94fe-b37615814cb1",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1546.007"
            ],
            "title": "New Netsh Helper DLL Registered From A Suspicious Location"
        },
        {
            "id": "c90362e0-2df3-4e61-94fe-b37615814cb1",
            "author": "Anish Bogati",
            "date": "2023/11/28",
            "description": "Detects changes to the Netsh registry key to add a new DLL value. This change might be an indication of a potential persistence attempt by adding a malicious Netsh helper\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetObject|contains": "\\SOFTWARE\\Microsoft\\NetSh",
                    "Details|contains": ".dll"
                }
            },
            "falsepositives": [
                "Legitimate helper added by different programs and the OS"
            ],
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "references": [
                "https://www.ired.team/offensive-security/persistence/t1128-netsh-helper-dll",
                "https://pentestlab.blog/2019/10/29/persistence-netsh-helper-dll/"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "56321594-9087-49d9-bf10-524fe8479452"
                },
                {
                    "id": "e7b18879-676e-4a0e-ae18-27039185a8e7",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.persistence",
                "attack.t1546.007"
            ],
            "title": "Potential Persistence Via Netsh Helper DLL - Registry"
        }
    ]
}