{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--65a966fb-6dbc-4dc7-b545-6a9640163b71",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:46.277873Z",
    "name": "Unsecured Credentials: Group Policy Preferences",
    "description": "Adversaries may attempt to find unsecured credentials in Group Policy Preferences (GPP). GPP are tools that allow administrators to create domain policies with embedded credentials. These policies allow administrators to set local accounts.[1]These group policies are stored in SYSVOL on a domain controller. This means that any domain user can view the SYSVOL share and decrypt the password (using the AES key that has been made public).[2]The following tools and scripts can be used to gather and decrypt the password file from Group Policy Preference XML files:Metasploit\u2019s post exploitation module: post/windows/gather/credentials/gppGet-GPPPassword[3]gpprefdecrypt.pyOn the SYSVOL share, adversaries may use the following command to enumerate potential GPP XML files: dir /s * .xml",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1552/006",
            "external_id": "T1552/006"
        },
        {
            "source_name": "CAPEC 639",
            "external_id": "malware-behavior--efd72166-96bf-49d1-b3c6-934f26b4f578"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "frack113",
            "date": "2023/12/21",
            "description": "Detects file access requests to potentially sensitive files hosted on the Windows Sysvol share.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_generic": {
                    "Image|startswith": [
                        ":\\Program Files (x86)\\",
                        ":\\Program Files\\",
                        ":\\Windows\\explorer.exe",
                        ":\\Windows\\system32\\",
                        ":\\Windows\\SysWOW64\\"
                    ]
                },
                "selection": {
                    "FileName|contains|all": [
                        "\\sysvol\\",
                        "\\Policies\\"
                    ],
                    "FileName|endswith": [
                        "audit.csv",
                        "Files.xml",
                        "GptTmpl.inf",
                        "groups.xml",
                        "Registry.pol",
                        "Registry.xml",
                        "scheduledtasks.xml",
                        "scripts.ini",
                        "services.xml"
                    ],
                    "FileName|startswith": "\\\\"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d51694fe-484a-46ac-92d6-969e76d60d10",
            "level": "medium",
            "logsource": {
                "category": "file_access",
                "definition": "Requirements: Microsoft-Windows-Kernel-File ETW provider",
                "product": "windows"
            },
            "references": [
                "https://github.com/vletoux/pingcastle"
            ],
            "related": [
                {
                    "id": "8344c19f-a023-45ff-ad63-a01c5396aea0",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Access To Potentially Sensitive Sysvol Files By Uncommon Application"
        },
        {
            "author": "frack113",
            "date": "2021/12/27",
            "description": "Look for the encrypted cpassword value within Group Policy Preference files on the Domain Controller. This value can be decrypted with gpp-decrypt.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "cpassword",
                        "\\sysvol\\",
                        ".xml"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "91a2c315-9ee6-4052-a853-6f6a8238f90d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/11",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.006/T1552.006.md#atomic-test-1---gpp-passwords-findstr"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Findstr GPP Passwords"
        },
        {
            "author": "Markus Neis, Jonhnathan Ribeiro, oscd.community",
            "date": "2018/04/09",
            "description": "Detects Access to Domain Group Policies stored in SYSVOL",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "\\SYSVOL\\",
                        "\\policies\\"
                    ]
                }
            },
            "falsepositives": [
                "Administrative activity"
            ],
            "id": "05f3c945-dcc8-4393-9f3d-af65077a8f86",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/01/07",
            "references": [
                "https://adsecurity.org/?p=2288",
                "https://www.hybrid-analysis.com/sample/f2943f5e45befa52fb12748ca7171d30096e1d4fc3c365561497c618341299d5?environmentId=100"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Suspicious SYSVOL Domain Group Policy Access"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/08/12",
            "description": "Detects findstring commands that include the keyword lsass, which indicates recon actviity for the LSASS process PID",
            "detection": {
                "condition": "all of selection_findstr_* or selection_special",
                "selection_findstr_cli": {
                    "CommandLine|contains": "lsass"
                },
                "selection_findstr_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ],
                "selection_special": {
                    "CommandLine|contains|windash": [
                        " /i \"lsass",
                        " /i lsass.exe",
                        "findstr \"lsass",
                        "findstr lsass",
                        "findstr.exe \"lsass",
                        "findstr.exe lsass"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fe63010f-8823-4864-a96b-a7b4a0f7b929",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/06/04",
            "references": [
                "https://blog.talosintelligence.com/2022/08/recent-cyber-attack.html?m=1"
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "LSASS Process Reconnaissance Via Findstr.EXE"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/08/12",
            "description": "Detects usage of findstr with the \"EVERYONE\" or \"BUILTIN\" keywords.\nThis was seen being used in combination with \"icacls\" and other utilities to spot misconfigured files or folders permissions.\n",
            "detection": {
                "condition": "all of selection_findstr_* or selection_special",
                "selection_findstr_cli": {
                    "CommandLine|contains": [
                        "\"Everyone\"",
                        "'Everyone'",
                        "\"BUILTIN\\\\\"",
                        "'BUILTIN\\'"
                    ]
                },
                "selection_findstr_img": [
                    {
                        "Image|endswith": [
                            "\\find.exe",
                            "\\findstr.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "FIND.EXE",
                            "FINDSTR.EXE"
                        ]
                    }
                ],
                "selection_special": {
                    "CommandLine|contains|all": [
                        "icacls ",
                        "findstr ",
                        "Everyone"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "47e4bab7-c626-47dc-967b-255608c9a920",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/11",
            "references": [
                "https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/"
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1552.006"
            ],
            "title": "Permission Misconfiguration Reconnaissance Via Findstr.EXE"
        }
    ]
}