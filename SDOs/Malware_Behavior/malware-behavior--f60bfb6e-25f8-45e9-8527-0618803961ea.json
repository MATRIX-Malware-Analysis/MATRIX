{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--f60bfb6e-25f8-45e9-8527-0618803961ea",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.358172Z",
    "name": "Masquerading: Double File Extension",
    "description": "Adversaries may abuse a double extension in the filename as a means of masquerading the true file type. A file name may include a secondary file type extension that may cause only the first extension to be displayed (ex: File.txt.exe may render in some views as just File.txt). However, the second extension is the true file type that determines how the file is opened and executed. The real file extension may be hidden by the operating system in the file browser (ex: explorer.exe), as well as in any software configured using or similar to the system\u2019s policies.[1][2] Adversaries may abuse double extensions to attempt to conceal dangerous file types of payloads. A very common usage involves tricking a user into opening what they think is a benign file type but is actually executable code. Such files often pose as email attachments and allow an adversary to gain Initial Access into a user\u2019s system via Spearphishing Attachment then User Execution. For example, an executable file attachment named Evil.txt.exe may display as Evil.txt to a user. The user may then view it as a benign text file and open it, inadvertently executing the hidden malware.[2]Common file types, such as text files (.txt, .doc, etc.) and image files (.jpg, .gif, etc.) are typically used as the first extension to appear benign. Executable extensions commonly regarded as dangerous, such as .exe, .lnk, .hta, and .scr, often appear as the second extension and true file type.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1036/007",
            "external_id": "T1036/007"
        },
        {
            "source_name": "CAPEC 635",
            "external_id": "malware-behavior--82f839c8-c4c5-4fd8-9cf8-e3ad02cddb91"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2022/06/19",
            "description": "Detects dropped files with double extensions, which is often used by malware as a method to abuse the fact that Windows hide default extensions by default.",
            "detection": {
                "condition": "1 of selection_*",
                "selection_exe": {
                    "TargetFilename|endswith": [
                        ".rar.exe",
                        ".zip.exe"
                    ]
                },
                "selection_gen": {
                    "TargetFilename|contains": [
                        ".doc.",
                        ".docx.",
                        ".jpg.",
                        ".pdf.",
                        ".ppt.",
                        ".pptx.",
                        ".xls.",
                        ".xlsx."
                    ],
                    "TargetFilename|endswith": [
                        ".exe",
                        ".iso",
                        ".rar",
                        ".zip"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "b4926b47-a9d7-434c-b3a0-adc3fa0bd13e",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2022/11/07",
            "references": [
                "https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/",
                "https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations",
                "https://www.cybereason.com/blog/research/a-bazar-of-tricks-following-team9s-development-cycles",
                "https://twitter.com/malwrhunterteam/status/1235135745611960321",
                "https://twitter.com/luc4m/status/1073181154126254080"
            ],
            "related": [
                {
                    "id": "1cdd9a09-06c9-4769-99ff-626e2b3991b8",
                    "type": "derived"
                },
                {
                    "id": "3215aa19-f060-4332-86d5-5602511f3ca8",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.007"
            ],
            "title": "Suspicious Double Extension Files"
        },
        {
            "id": "3215aa19-f060-4332-86d5-5602511f3ca8",
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2022/11/07",
            "description": "Detects the creation of files with an \"LNK\" as a second extension. This is sometimes used by malware as a method to abuse the fact that Windows hides the \"LNK\" extension by default.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_recent": {
                    "TargetFilename|contains": "\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\"
                },
                "filter_optional_office_excel": {
                    "Image|endswith": "\\excel.exe",
                    "TargetFilename|contains": "\\AppData\\Roaming\\Microsoft\\Excel"
                },
                "filter_optional_office_powerpoint": {
                    "Image|endswith": "\\powerpnt.exe",
                    "TargetFilename|contains": "\\AppData\\Roaming\\Microsoft\\PowerPoint"
                },
                "filter_optional_office_recent": {
                    "Image|endswith": [
                        "\\excel.exe",
                        "\\powerpnt.exe",
                        "\\winword.exe"
                    ],
                    "TargetFilename|contains": "\\AppData\\Roaming\\Microsoft\\Office\\Recent\\"
                },
                "filter_optional_office_word": {
                    "Image|endswith": "\\winword.exe",
                    "TargetFilename|contains": "\\AppData\\Roaming\\Microsoft\\Word"
                },
                "selection": {
                    "TargetFilename|contains": [
                        ".doc.",
                        ".docx.",
                        ".jpg.",
                        ".pdf.",
                        ".ppt.",
                        ".pptx.",
                        ".xls.",
                        ".xlsx."
                    ],
                    "TargetFilename|endswith": ".lnk"
                }
            },
            "falsepositives": [
                "Some tuning is required for other general purpose directories of third party apps"
            ],
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/10/18",
            "references": [
                "https://www.crowdstrike.com/blog/meet-crowdstrikes-adversary-of-the-month-for-june-mustang-panda/",
                "https://www.anomali.com/blog/china-based-apt-mustang-panda-targets-minority-groups-public-and-private-sector-organizations",
                "https://www.cybereason.com/blog/research/a-bazar-of-tricks-following-team9s-development-cycles",
                "https://twitter.com/malwrhunterteam/status/1235135745611960321",
                "https://twitter.com/luc4m/status/1073181154126254080"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "b4926b47-a9d7-434c-b3a0-adc3fa0bd13e"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.007"
            ],
            "title": "Suspicious LNK Double Extension File Created"
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/01/06",
            "description": "Detect execution of suspicious double extension files in ParentCommandLine",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "ParentImage|endswith": [
                            ".doc.lnk",
                            ".docx.lnk",
                            ".xls.lnk",
                            ".xlsx.lnk",
                            ".ppt.lnk",
                            ".pptx.lnk",
                            ".rtf.lnk",
                            ".pdf.lnk",
                            ".txt.lnk",
                            ".doc.js",
                            ".docx.js",
                            ".xls.js",
                            ".xlsx.js",
                            ".ppt.js",
                            ".pptx.js",
                            ".rtf.js",
                            ".pdf.js",
                            ".txt.js"
                        ]
                    },
                    {
                        "ParentCommandLine|contains": [
                            ".doc.lnk",
                            ".docx.lnk",
                            ".xls.lnk",
                            ".xlsx.lnk",
                            ".ppt.lnk",
                            ".pptx.lnk",
                            ".rtf.lnk",
                            ".pdf.lnk",
                            ".txt.lnk",
                            ".doc.js",
                            ".docx.js",
                            ".xls.js",
                            ".xlsx.js",
                            ".ppt.js",
                            ".pptx.js",
                            ".rtf.js",
                            ".pdf.js",
                            ".txt.js"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5e6a80c8-2d45-4633-9ef4-fa2671a39c5c",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/28",
            "references": [
                "https://www.virustotal.com/gui/file/7872d8845a332dce517adae9c3389fde5313ff2fed38c2577f3b498da786db68/behavior",
                "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/bluebottle-banks-targeted-africa"
            ],
            "related": [
                {
                    "id": "1cdd9a09-06c9-4769-99ff-626e2b3991b8",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036.007"
            ],
            "title": "Suspicious Parent Double Extension File Execution"
        }
    ]
}