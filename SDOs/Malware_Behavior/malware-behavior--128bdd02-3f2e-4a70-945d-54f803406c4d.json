{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--128bdd02-3f2e-4a70-945d-54f803406c4d",
    "created": "2024-08-13T14:46:37.025166Z",
    "modified": "2024-08-13T14:46:45.531656Z",
    "name": "Command and Scripting Interpreter: AppleScript",
    "description": "Adversaries may abuse AppleScript for execution. AppleScript is a macOS scripting language designed to control applications and parts of the OS via inter-application messages called AppleEvents.[1] These AppleEvent messages can be sent independently or easily scripted with AppleScript. These events can locate open windows, send keystrokes, and interact with almost any open application locally or remotely.Scripts can be run from the command-line via osascript /path/to/script or osascript -e 'script here'. Aside from the command line, scripts can be executed in numerous ways including Mail rules, Calendar.app alarms, and Automator workflows. AppleScripts can also be executed as plain text shell scripts by adding #!/usr/bin/osascript to the start of the script file.[2]AppleScripts do not need to call osascript to execute. However, they may be executed from within mach-O binaries by using the macOS Native APIs\u00a0NSAppleScript\u00a0or\u00a0OSAScript, both of which execute code independent of the /usr/bin/osascript command line utility.Adversaries may abuse AppleScript to execute various behaviors, such as interacting with an open SSH connection, moving to remote machines, and even presenting users with fake dialog boxes. These events cannot start applications remotely (they can start them locally), but they can interact with applications if they're already running remotely. On macOS 10.10 Yosemite and higher, AppleScript has the ability to execute Native APIs, which otherwise would require compilation and execution in a mach-O binary file format.[3] Since this is a scripting language, it can be used to launch more common techniques as well such as a reverse shell via Python.[4]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1059/002",
            "external_id": "T1059/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sohan G (D4rkCiph3r), Red Canary (Idea)",
            "date": "2023/04/03",
            "description": "Detects potential suspicious applet or osascript executing \"osacompile\".",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": "osacompile",
                    "ParentImage|endswith": [
                        "/applet",
                        "/osascript"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a753a6af-3126-426d-8bd0-26ebbcb92254",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://redcanary.com/blog/mac-application-bundles/"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.002"
            ],
            "title": "Osacompile Execution By Potentially Suspicious Applet/Osascript"
        },
        {
            "author": "Alejandro Ortuno, oscd.community",
            "date": "2020/10/21",
            "description": "Detects execution of AppleScript of the macOS scripting language AppleScript.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        " -e ",
                        ".scpt",
                        ".js"
                    ],
                    "Image|endswith": "/osascript"
                }
            },
            "falsepositives": [
                "Application installers might contain scripts as part of the installation process."
            ],
            "id": "1bc2e6c5-0885-472b-bed6-be5ea8eace55",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2023/02/01",
            "status": "test",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1059.002/T1059.002.md",
                "https://redcanary.com/blog/applescript/"
            ],
            "tags": [
                "attack.execution",
                "attack.t1059.002"
            ],
            "title": "MacOS Scripting Interpreter AppleScript"
        },
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/01/31",
            "description": "Detects suspicious child processes spawning from microsoft office suite applications such as word or excel. This could indicates malicious macro execution",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "/bash",
                        "/curl",
                        "/dash",
                        "/fish",
                        "/osacompile",
                        "/osascript",
                        "/sh",
                        "/zsh",
                        "/python",
                        "/python3",
                        "/wget"
                    ],
                    "ParentImage|contains": [
                        "Microsoft Word",
                        "Microsoft Excel",
                        "Microsoft PowerPoint",
                        "Microsoft OneNote"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "69483748-1525-4a6c-95ca-90dc8d431b68",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2023/02/04",
            "status": "test",
            "references": [
                "https://redcanary.com/blog/applescript/",
                "https://objective-see.org/blog/blog_0x4B.html"
            ],
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1059.002",
                "attack.t1137.002",
                "attack.t1204.002"
            ],
            "title": "Suspicious Microsoft Office Child Process - MacOS"
        },
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/01/31",
            "description": "Detects possible malicious execution of JXA in-memory via OSAScript",
            "detection": {
                "condition": "all of selection_*",
                "selection_js": [
                    {
                        "CommandLine|contains|all": [
                            " -l ",
                            "JavaScript"
                        ]
                    },
                    {
                        "CommandLine|contains": ".js"
                    }
                ],
                "selection_main": {
                    "CommandLine|contains|all": [
                        "osascript",
                        " -e ",
                        "eval",
                        "NSData.dataWithContentsOfURL"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine"
            ],
            "id": "f1408a58-0e94-4165-b80a-da9f96cf6fc3",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "status": "test",
            "references": [
                "https://redcanary.com/blog/applescript/"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "1bc2e6c5-0885-472b-bed6-be5ea8eace55"
                }
            ],
            "tags": [
                "attack.t1059.002",
                "attack.t1059.007",
                "attack.execution"
            ],
            "title": "JXA In-memory Execution Via OSAScript"
        },
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/01/31",
            "description": "Detects potential suspicious run-only executions compiled using OSACompile",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "osacompile",
                        " -x ",
                        " -e "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine"
            ],
            "id": "b9d9b652-d8ed-4697-89a2-a1186ee680ac",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "status": "test",
            "references": [
                "https://redcanary.com/blog/applescript/",
                "https://ss64.com/osx/osacompile.html"
            ],
            "tags": [
                "attack.t1059.002",
                "attack.execution"
            ],
            "title": "OSACompile Run-Only Execution"
        },
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/01/31",
            "description": "Detects possible collection of data from the clipboard via execution of the osascript binary",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "osascript",
                        " -e ",
                        "clipboard"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "fields": [
                "CommandLine"
            ],
            "id": "7794fa3c-edea-4cff-bec7-267dd4770fd7",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "status": "test",
            "references": [
                "https://www.sentinelone.com/blog/how-offensive-actors-use-applescript-for-attacking-macos/"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "1bc2e6c5-0885-472b-bed6-be5ea8eace55"
                }
            ],
            "tags": [
                "attack.collection",
                "attack.execution",
                "attack.t1115",
                "attack.t1059.002"
            ],
            "title": "Clipboard Data Collection Via OSAScript"
        },
        {
            "author": "Tim Rauch (rule), Elastic (idea)",
            "date": "2022/10/21",
            "description": "Detects when the macOS Script Editor utility spawns an unusual child process.",
            "detection": {
                "condition": "all of selection_*",
                "selection_img": [
                    {
                        "Image|endswith": [
                            "/curl",
                            "/bash",
                            "/sh",
                            "/zsh",
                            "/dash",
                            "/fish",
                            "/osascript",
                            "/mktemp",
                            "/chmod",
                            "/php",
                            "/nohup",
                            "/openssl",
                            "/plutil",
                            "/PlistBuddy",
                            "/xattr",
                            "/sqlite",
                            "/funzip",
                            "/popen"
                        ]
                    },
                    {
                        "Image|contains": [
                            "python",
                            "perl"
                        ]
                    }
                ],
                "selection_parent": {
                    "ParentImage|endswith": "/Script Editor"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "6e4dcdd1-e48b-42f7-b2d8-3b413fc58cb4",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "modified": "2022/12/28",
            "status": "test",
            "references": [
                "https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-7f541fbc4a4a28a92970e8bf53effea5bd934604429112c920affb457f5b2685",
                "https://wojciechregula.blog/post/macos-red-teaming-initial-access-via-applescript-url/"
            ],
            "tags": [
                "attack.t1566",
                "attack.t1566.002",
                "attack.initial_access",
                "attack.t1059",
                "attack.t1059.002",
                "attack.t1204",
                "attack.t1204.001",
                "attack.execution",
                "attack.persistence",
                "attack.t1553",
                "attack.defense_evasion"
            ],
            "title": "Suspicious Execution via macOS Script Editor"
        }
    ]
}