{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--7844a7cf-4519-4594-a6ce-b91c2820504f",
    "created": "2024-08-13T14:46:37.097937Z",
    "modified": "2024-08-13T14:46:45.994992Z",
    "name": "Data Staged",
    "description": "Adversaries may stage collected data in a central location or directory prior to Exfiltration. Data may be kept in separate files or combined into one file through techniques such as Archive Collected Data. Interactive command shells may be used, and common functionality within cmd and bash may be used to copy data into a staging location.[1]In cloud environments, adversaries may stage data within a particular instance or virtual machine before exfiltration. An adversary may Create Cloud Instance and stage data in that instance.[2]Adversaries may choose to stage data from a victim network in a centralized location prior to Exfiltration to minimize the number of connections made to their C2 server and better evade detection.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1074",
            "external_id": "T1074"
        },
        {
            "source_name": "mitre-attack",
            "external_id": "T1074",
            "url": "https://attack.mitre.org/techniques/T1074"
        },
        {
            "source_name": "Mandiant M-Trends 2020",
            "url": "https://content.fireeye.com/m-trends/rpt-m-trends-2020",
            "description": "Mandiant. (2020, February). M-Trends 2020. Retrieved April 24, 2020."
        },
        {
            "source_name": "PWC Cloud Hopper April 2017",
            "url": "https://web.archive.org/web/20220224041316/https:/www.pwc.co.uk/cyber-security/pdf/cloud-hopper-report-final-v4.pdf",
            "description": "PwC and BAE Systems. (2017, April). Operation Cloud Hopper. Retrieved April 5, 2017."
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Austin Songer @austinsonger",
            "date": "2021/08/13",
            "description": "Identifies potential full network packet capture in gcp. This feature can potentially be abused to read sensitive data from unencrypted internal traffic.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "gcp.audit.method_name": [
                        "v*.Compute.PacketMirrorings.Get",
                        "v*.Compute.PacketMirrorings.Delete",
                        "v*.Compute.PacketMirrorings.Insert",
                        "v*.Compute.PacketMirrorings.Patch",
                        "v*.Compute.PacketMirrorings.List",
                        "v*.Compute.PacketMirrorings.aggregatedList"
                    ]
                }
            },
            "falsepositives": [
                "Full Network Packet Capture may be done by a system or network administrator.",
                "If known behavior is causing false positives, it can be exempted from the rule."
            ],
            "id": "980a7598-1e7f-4962-9372-2d754c930d0e",
            "level": "medium",
            "logsource": {
                "product": "gcp",
                "service": "gcp.audit"
            },
            "modified": "2022/10/09",
            "references": [
                "https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging",
                "https://developers.google.com/resources/api-libraries/documentation/compute/v1/java/latest/com/google/api/services/compute/Compute.PacketMirrorings.html"
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1074"
            ],
            "title": "Google Full Network Traffic Packet Capture"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/12",
            "description": "Various protocols maybe used to put data on the device for exfil or infil",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "tftp",
                    "rcp",
                    "puts",
                    "copy",
                    "configure replace",
                    "archive tar"
                ]
            },
            "falsepositives": [
                "Generally used to copy configs or IOS images"
            ],
            "fields": [
                "CmdSet"
            ],
            "id": "5e51acb2-bcbe-435b-99c6-0e3cd5e2aa59",
            "level": "low",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.lateral_movement",
                "attack.command_and_control",
                "attack.exfiltration",
                "attack.t1074",
                "attack.t1105",
                "attack.t1560.001"
            ],
            "title": "Cisco Stage Data"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2021/07/20",
            "description": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "Compress-Archive -Path*-DestinationPath $env:TEMP",
                        "Compress-Archive -Path*-DestinationPath*\\AppData\\Local\\Temp\\",
                        "Compress-Archive -Path*-DestinationPath*:\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "85a8e5ba-bd03-4bfb-bbfa-a4409a8f8b98",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1074.001/T1074.001.md",
                "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a"
            ],
            "related": [
                {
                    "id": "71ff406e-b633-4989-96ec-bc49d825a412",
                    "type": "similar"
                },
                {
                    "id": "daf7eb81-35fd-410d-9d7a-657837e602bb",
                    "type": "similar"
                },
                {
                    "id": "b7a3c9a3-09ea-4934-8864-6a32cacd98d9",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1074.001"
            ],
            "title": "Folder Compress To Potentially Suspicious Output Via Compress-Archive Cmdlet"
        },
        {
            "id": "71ff406e-b633-4989-96ec-bc49d825a412",
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2021/07/20",
            "description": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Data|contains": [
                        "Compress-Archive -Path*-DestinationPath $env:TEMP",
                        "Compress-Archive -Path*-DestinationPath*\\AppData\\Local\\Temp\\",
                        "Compress-Archive -Path*-DestinationPath*:\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "powershell-classic"
            },
            "modified": "2023/12/18",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1074.001/T1074.001.md",
                "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a"
            ],
            "related": [
                {
                    "id": "daf7eb81-35fd-410d-9d7a-657837e602bb",
                    "type": "similar"
                },
                {
                    "id": "b7a3c9a3-09ea-4934-8864-6a32cacd98d9",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "85a8e5ba-bd03-4bfb-bbfa-a4409a8f8b98"
                }
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1074.001"
            ],
            "title": "Zip A Folder With PowerShell For Staging In Temp - PowerShell"
        },
        {
            "id": "b7a3c9a3-09ea-4934-8864-6a32cacd98d9",
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2021/07/20",
            "description": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "Compress-Archive -Path*-DestinationPath $env:TEMP",
                        "Compress-Archive -Path*-DestinationPath*\\AppData\\Local\\Temp\\",
                        "Compress-Archive -Path*-DestinationPath*:\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2023/12/18",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1074.001/T1074.001.md",
                "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a"
            ],
            "related": [
                {
                    "id": "71ff406e-b633-4989-96ec-bc49d825a412",
                    "type": "similar"
                },
                {
                    "id": "daf7eb81-35fd-410d-9d7a-657837e602bb",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "85a8e5ba-bd03-4bfb-bbfa-a4409a8f8b98"
                }
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1074.001"
            ],
            "title": "Zip A Folder With PowerShell For Staging In Temp - PowerShell Script"
        },
        {
            "id": "daf7eb81-35fd-410d-9d7a-657837e602bb",
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2021/07/20",
            "description": "Detects PowerShell scripts that make use of the \"Compress-Archive\" Cmdlet in order to compress folders and files where the output is stored in a potentially suspicious location that is used often by malware for exfiltration.\nAn adversary might compress data (e.g., sensitive documents) that is collected prior to exfiltration in order to make it portable and minimize the amount of data sent over the network.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ContextInfo|contains|all": [
                        "Compress-Archive -Path*-DestinationPath $env:TEMP",
                        "Compress-Archive -Path*-DestinationPath*\\AppData\\Local\\Temp\\",
                        "Compress-Archive -Path*-DestinationPath*:\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_module",
                "product": "windows",
                "definition": "0ad03ef1-f21b-4a79-8ce8-e6900c54b65b"
            },
            "modified": "2023/12/18",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1074.001/T1074.001.md",
                "https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-347a"
            ],
            "related": [
                {
                    "id": "71ff406e-b633-4989-96ec-bc49d825a412",
                    "type": "similar"
                },
                {
                    "id": "b7a3c9a3-09ea-4934-8864-6a32cacd98d9",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "85a8e5ba-bd03-4bfb-bbfa-a4409a8f8b98"
                }
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1074.001"
            ],
            "title": "Zip A Folder With PowerShell For Staging In Temp  - PowerShell Module"
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "IaaS",
        "Linux",
        "macOS"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Praetorian",
        "Shane Tully, @securitygypsy"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "collection"
        }
    ],
    "x_mitre_detection": "Processes that appear to be reading files from disparate locations and writing them to the same directory or file may be an indication of data being staged, especially if they are suspected of performing encryption or compression on the files, such as 7zip, RAR, ZIP, or zlib. Monitor publicly writeable directories, central locations, and commonly used staging directories (recycle bin, temp folders, etc.) to regularly check for compressed or encrypted data that may be indicative of staging.\n\nMonitor processes and command-line arguments for actions that could be taken to collect and combine files. Remote access tools with built-in features may interact directly with the Windows API to gather and copy to a location. Data may also be acquired and staged through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).\n\nConsider monitoring accesses and modifications to storage repositories (such as the Windows Registry), especially from suspicious processes that could be related to malicious data collection.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.4",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "File: File Access",
        "File: File Creation",
        "Windows Registry: Windows Registry Key Modification",
        "Command: Command Execution"
    ],
    "x_mitre_permissions_required": []
}