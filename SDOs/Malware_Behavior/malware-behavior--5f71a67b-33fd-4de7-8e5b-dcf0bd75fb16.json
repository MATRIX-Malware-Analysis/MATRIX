{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--5f71a67b-33fd-4de7-8e5b-dcf0bd75fb16",
    "created": "2024-08-13T14:46:37.080097Z",
    "modified": "2024-08-13T14:46:45.880788Z",
    "name": "Domain or Tenant Policy Modification: Group Policy Modification",
    "description": "Adversaries may modify Group Policy Objects (GPOs) to subvert the intended discretionary access controls for a domain, usually with the intention of escalating privileges on the domain. Group policy allows for centralized management of user and computer settings in Active Directory (AD). GPOs are containers for group policy settings made up of files stored within a predictable network path \\<DOMAIN>\\SYSVOL\\<DOMAIN>\\Policies\\.[1][2] Like other objects in AD, GPOs have access controls associated with them. By default all user accounts in the domain have permission to read GPOs. It is possible to delegate GPO access control permissions, e.g. write access, to specific users or groups in the domain.Malicious GPO modifications can be used to implement many other malicious behaviors such as Scheduled Task/Job, Disable or Modify Tools, Ingress Tool Transfer, Create Account, Service Execution,  and more.[2][3][4][5][6] Since GPOs can control so many user and machine settings in the AD environment, there are a great number of potential attacks that can stem from this GPO abuse.[3]For example, publicly available scripts such as New-GPOImmediateTask can be leveraged to automate the creation of a malicious Scheduled Task/Job by modifying GPO settings, in this case modifying <GPO_PATH>\\Machine\\Preferences\\ScheduledTasks\\ScheduledTasks.xml.[3][4] In some cases an adversary might modify specific user rights like SeEnableDelegationPrivilege, set in <GPO_PATH>\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf, to achieve a subtle AD backdoor with complete control of the domain because the user account under the adversary's control would then be able to modify GPOs.[7]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1484/001",
            "external_id": "T1484/001"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "frack113",
            "date": "2022/08/19",
            "description": "Detect malicious GPO modifications can be used to implement many other malicious behaviors.",
            "detection": {
                "condition": "all of selection_*",
                "selection_key": {
                    "CommandLine|contains": [
                        "GroupPolicyRefreshTimeDC",
                        "GroupPolicyRefreshTimeOffsetDC",
                        "GroupPolicyRefreshTime",
                        "GroupPolicyRefreshTimeOffset",
                        "EnableSmartScreen",
                        "ShellSmartScreenLevel"
                    ]
                },
                "selection_path": {
                    "CommandLine|contains": "\\SOFTWARE\\Policies\\Microsoft\\Windows\\System"
                },
                "selection_reg": [
                    {
                        "Image|endswith": "\\reg.exe"
                    },
                    {
                        "OriginalFileName": "reg.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate use"
            ],
            "id": "ada4b0c4-758b-46ac-9033-9004613a150d",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1484.001/T1484.001.md"
            ],
            "related": [
                {
                    "id": "b7216a7d-687e-4c8d-82b1-3080b2ad961f",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.privilege_escalation",
                "attack.t1484.001"
            ],
            "title": "Modify Group Policy Settings"
        },
        {
            "id": "b7216a7d-687e-4c8d-82b1-3080b2ad961f",
            "author": "frack113",
            "date": "2022/08/19",
            "description": "Detect malicious GPO modifications can be used to implement many other malicious behaviors.",
            "detection": {
                "condition": "all of selection_*",
                "selection_key": {
                    "ScriptBlockText|contains": [
                        "GroupPolicyRefreshTimeDC",
                        "GroupPolicyRefreshTimeOffsetDC",
                        "GroupPolicyRefreshTime",
                        "GroupPolicyRefreshTimeOffset",
                        "EnableSmartScreen",
                        "ShellSmartScreenLevel"
                    ]
                },
                "selection_path": {
                    "ScriptBlockText|contains": "\\SOFTWARE\\Policies\\Microsoft\\Windows\\System"
                }
            },
            "falsepositives": [
                "Legitimate use"
            ],
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/40b77d63808dd4f4eafb83949805636735a1fd15/atomics/T1484.001/T1484.001.md"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "ada4b0c4-758b-46ac-9033-9004613a150d"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.privilege_escalation",
                "attack.t1484.001"
            ],
            "title": "Modify Group Policy Settings - ScriptBlockLogging"
        }
    ]
}