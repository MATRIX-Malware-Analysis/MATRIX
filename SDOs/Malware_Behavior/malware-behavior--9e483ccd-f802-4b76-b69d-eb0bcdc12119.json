{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--9e483ccd-f802-4b76-b69d-eb0bcdc12119",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.926139Z",
    "name": "Event Triggered Execution: Accessibility Features",
    "description": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by accessibility features. Windows contains accessibility features that may be launched with a key combination before a user has logged in (ex: when the user is on the Windows logon screen). An adversary can modify the way these programs are launched to get a command prompt or backdoor without logging in to the system.Two common accessibility programs are C:\\Windows\\System32\\sethc.exe, launched when the shift key is pressed five times and C:\\Windows\\System32\\utilman.exe, launched when the Windows + U key combination is pressed. The sethc.exe program is often referred to as 'sticky keys', and has been used by adversaries for unauthenticated access through a remote desktop login screen. [1]Depending on the version of Windows, an adversary may take advantage of these features in different ways. Common methods used by adversaries include replacing accessibility feature binaries or pointers/references to these binaries in the Registry. In newer versions of Windows, the replaced binary needs to be digitally signed for x64 systems, the binary must reside in %systemdir%\\, and it must be protected by Windows File or Resource Protection (WFP/WRP). [2] The Image File Execution Options Injection debugger method was likely discovered as a potential workaround because it does not require the corresponding accessibility feature binary to be replaced.For simple binary replacement on Windows XP and later as well as and Windows Server 2003/R2 and later, for example, the program (e.g., C:\\Windows\\System32\\utilman.exe) may be replaced with 'cmd.exe' (or another program that provides backdoor access). Subsequently, pressing the appropriate key combination at the login screen while sitting at the keyboard or when connected over Remote Desktop Protocol will cause the replaced file to be executed with SYSTEM privileges. [3]Other accessibility features exist that may also be leveraged in a similar fashion: [2][4]On-Screen Keyboard: C:\\Windows\\System32\\osk.exeMagnifier: C:\\Windows\\System32\\Magnify.exeNarrator: C:\\Windows\\System32\\Narrator.exeDisplay Switcher: C:\\Windows\\System32\\DisplaySwitch.exeApp Switcher: C:\\Windows\\System32\\AtBroker.exe",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1546/008",
            "external_id": "T1546/008"
        },
        {
            "source_name": "CAPEC 558",
            "external_id": "malware-behavior--ad6e90bb-a41f-42b3-b36c-8975faf3878d"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "frack113",
            "date": "2022/12/11",
            "description": "Detects the creation of a symbolic link between \"cmd.exe\" and the accessibility on-screen keyboard binary (osk.exe) using \"mklink\". This technique provides an elevated command prompt to the user from the login screen without the need to log in.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "mklink",
                        "\\osk.exe",
                        "\\cmd.exe"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\cmd.exe"
                    },
                    {
                        "OriginalFileName": "Cmd.Exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "e9b61244-893f-427c-b287-3e708f321c6b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/20",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/5c1e6f1b4fafd01c8d1ece85f510160fc1275fbf/atomics/T1546.008/T1546.008.md",
                "https://ss64.com/nt/mklink.html"
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.persistence",
                "attack.t1546.008"
            ],
            "title": "Potential Privilege Escalation Using Symlink Between Osk and Cmd"
        },
        {
            "author": "Florian Roth (Nextron Systems), oscd.community, Jonhnathan Ribeiro",
            "date": "2019/09/06",
            "description": "Detects the registration of a debugger for a program that is available in the logon screen (sticky key backdoor).",
            "detection": {
                "condition": "all of selection*",
                "selection1": {
                    "CommandLine|contains": "\\CurrentVersion\\Image File Execution Options\\"
                },
                "selection2": {
                    "CommandLine|contains": [
                        "sethc.exe",
                        "utilman.exe",
                        "osk.exe",
                        "magnify.exe",
                        "narrator.exe",
                        "displayswitch.exe",
                        "atbroker.exe",
                        "HelpPane.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ae215552-081e-44c7-805f-be16f975c8a2",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/08/06",
            "references": [
                "https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/",
                "https://bazaar.abuse.ch/sample/6f3aa9362d72e806490a8abce245331030d1ab5ac77e400dd475748236a6cc81/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.privilege_escalation",
                "attack.t1546.008"
            ],
            "title": "Suspicious Debugger Registration Cmdline"
        },
        {
            "author": "frack113",
            "date": "2022/12/11",
            "description": "Detects potential tampering with Windows Defender settings such as adding exclusion using wmic",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": "/Namespace:\\\\\\\\root\\\\Microsoft\\\\Windows\\\\Defender"
                },
                "selection_img": [
                    {
                        "OriginalFileName": "wmic.exe"
                    },
                    {
                        "Image|endswith": "\\WMIC.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "51cbac1e-eee3-4a90-b1b7-358efb81fa0a",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/5c1e6f1b4fafd01c8d1ece85f510160fc1275fbf/atomics/T1562.001/T1562.001.md",
                "https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/",
                "https://www.bleepingcomputer.com/news/security/iobit-forums-hacked-to-spread-ransomware-to-its-members/"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1546.008"
            ],
            "title": "Potential Windows Defender Tampering Via Wmic.EXE"
        },
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/18",
            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
            "detection": {
                "condition": "selection_img and (1 of selection_flags_*)",
                "selection_flags_configure": {
                    "CommandLine|contains|all": [
                        "/configure",
                        "/db"
                    ]
                },
                "selection_flags_discovery": {
                    "CommandLine|contains|all": [
                        "/export",
                        "/cfg"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\secedit.exe"
                    },
                    {
                        "OriginalFileName": "SeCEdit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrative use"
            ],
            "id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1562.002",
                "attack.t1547.001",
                "attack.t1505.005",
                "attack.t1556.002",
                "attack.t1562",
                "attack.t1574.007",
                "attack.t1564.002",
                "attack.t1546.008",
                "attack.t1546.007",
                "attack.t1547.014",
                "attack.t1547.010",
                "attack.t1547.002",
                "attack.t1557",
                "attack.t1082"
            ],
            "title": "Potential Suspicious Activity Using SeCEdit"
        },
        {
            "author": "Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community",
            "date": "2018/03/15",
            "description": "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "sethc.exe",
                        "utilman.exe",
                        "osk.exe",
                        "Magnify.exe",
                        "Narrator.exe",
                        "DisplaySwitch.exe"
                    ],
                    "Image|endswith": [
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\mshta.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\wscript.exe",
                        "\\wt.exe"
                    ],
                    "ParentImage|endswith": "\\winlogon.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "2fdefcb3-dbda-401e-ae23-f0db027628bc",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/07",
            "references": [
                "https://learn.microsoft.com/en-us/archive/blogs/jonathantrull/detecting-sticky-key-backdoors"
            ],
            "related": [
                {
                    "id": "baca5663-583c-45f9-b5dc-ea96a22ce542",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.persistence",
                "attack.t1546.008",
                "car.2014-11-003",
                "car.2014-11-008"
            ],
            "title": "Sticky Key Like Backdoor Execution"
        },
        {
            "author": "Sreeman",
            "date": "2020/02/18",
            "description": "By replacing the sticky keys executable with the local admins CMD executable, an attacker is able to access a privileged windows console session without authenticating to the system.\nWhen the sticky keys are \"activated\" the privilleged shell is launched.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "copy ",
                        "/y ",
                        "C:\\windows\\system32\\cmd.exe C:\\windows\\system32\\sethc.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "1070db9a-3e5d-412e-8e7b-7183b616e1b3",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/07",
            "references": [
                "https://www.fireeye.com/blog/threat-research/2017/03/apt29_domain_frontin.html",
                "https://www.clearskysec.com/wp-content/uploads/2020/02/ClearSky-Fox-Kitten-Campaign-v1.pdf",
                "https://learn.microsoft.com/en-us/archive/blogs/jonathantrull/detecting-sticky-key-backdoors"
            ],
            "status": "test",
            "tags": [
                "attack.t1546.008",
                "attack.privilege_escalation"
            ],
            "title": "Persistence Via Sticky Key Backdoor"
        },
        {
            "id": "baca5663-583c-45f9-b5dc-ea96a22ce542",
            "author": "Florian Roth (Nextron Systems), @twjackomo, Jonhnathan Ribeiro, oscd.community",
            "date": "2018/03/15",
            "description": "Detects the usage and installation of a backdoor that uses an option to register a malicious debugger for built-in tools that are accessible in the login screen",
            "detection": {
                "condition": "selection_registry",
                "selection_registry": {
                    "TargetObject|endswith": [
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\sethc.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\utilman.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\osk.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Magnify.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Narrator.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\DisplaySwitch.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\atbroker.exe\\Debugger",
                        "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\HelpPane.exe\\Debugger"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "level": "critical",
            "logsource": {
                "category": "registry_event",
                "product": "windows"
            },
            "modified": "2022/11/26",
            "references": [
                "https://blogs.technet.microsoft.com/jonathantrull/2016/10/03/detecting-sticky-key-backdoors/",
                "https://bazaar.abuse.ch/sample/6f3aa9362d72e806490a8abce245331030d1ab5ac77e400dd475748236a6cc81/"
            ],
            "status": "test",
            "title": "Sticky Key Like Backdoor Usage - Registry",
            "tags": [
                "attack.privilege_escalation",
                "attack.persistence",
                "attack.t1546.008",
                "car.2014-11-003",
                "car.2014-11-008"
            ]
        }
    ]
}