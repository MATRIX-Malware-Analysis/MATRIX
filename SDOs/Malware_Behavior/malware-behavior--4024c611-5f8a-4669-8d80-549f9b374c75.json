{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--4024c611-5f8a-4669-8d80-549f9b374c75",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:44.876334Z",
    "name": "Unsecured Credentials: Credentials in Registry",
    "description": "Adversaries may search the Registry on compromised systems for insecurely stored credentials. The Windows Registry stores configuration information that can be used by the system or other programs. Adversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services. Sometimes these credentials are used for automatic logons.Example commands to find Registry keys related to password information: [1]Local Machine Hive: reg query HKLM /f password /t REG_SZ /sCurrent User Hive: reg query HKCU /f password /t REG_SZ /s",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1552/002",
            "external_id": "T1552/002"
        },
        {
            "source_name": "CAPEC 647",
            "external_id": "malware-behavior--0527bb68-b171-4c23-bbfd-e0136c976629"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/20",
            "description": "Detects processes that query known 3rd party registry keys that holds credentials via commandline",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "\\Software\\SimonTatham\\PuTTY\\Sessions",
                        "\\Software\\\\SimonTatham\\PuTTY\\SshHostKeys\\",
                        "\\Software\\Mobatek\\MobaXterm\\",
                        "\\Software\\WOW6432Node\\Radmin\\v3.0\\Server\\Parameters\\Radmin",
                        "\\Software\\Aerofox\\FoxmailPreview",
                        "\\Software\\Aerofox\\Foxmail\\V3.1",
                        "\\Software\\IncrediMail\\Identities",
                        "\\Software\\Qualcomm\\Eudora\\CommandLine",
                        "\\Software\\RimArts\\B2\\Settings",
                        "\\Software\\OpenVPN-GUI\\configs",
                        "\\Software\\Martin Prikryl\\WinSCP 2\\Sessions",
                        "\\Software\\FTPWare\\COREFTP\\Sites",
                        "\\Software\\DownloadManager\\Passwords",
                        "\\Software\\OpenSSH\\Agent\\Keys",
                        "\\Software\\TightVNC\\Server",
                        "\\Software\\ORL\\WinVNC3\\Password",
                        "\\Software\\RealVNC\\WinVNC4"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "87a476dc-0079-4583-a985-dee7a20a03de",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://isc.sans.edu/diary/More+Data+Exfiltration/25698",
                "https://github.com/synacktiv/Radmin3-Password-Cracker/blob/acfc87393e4b7c06353973a14a6c7126a51f36ac/regkey.txt",
                "https://github.com/HyperSine/how-does-MobaXterm-encrypt-password",
                "https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#inside-the-registry"
            ],
            "related": [
                {
                    "id": "e0b0c2ab-3d52-46d9-8cb7-049dc775fbd1",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.002"
            ],
            "title": "Enumeration for 3rd Party Creds From CLI"
        },
        {
            "id": "e0b0c2ab-3d52-46d9-8cb7-049dc775fbd1",
            "author": "frack113",
            "date": "2021/12/20",
            "description": "Adversaries may search the Registry on compromised systems for insecurely stored credentials.\nThe Windows Registry stores configuration information that can be used by the system or other programs.\nAdversaries may query the Registry looking for credentials and passwords that have been stored for use by other programs or services\n",
            "detection": {
                "condition": "reg and hive",
                "hive": [
                    {
                        "CommandLine|contains|all": [
                            "/f ",
                            "HKLM"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "/f ",
                            "HKCU"
                        ]
                    },
                    {
                        "CommandLine|contains": "HKCU\\Software\\SimonTatham\\PuTTY\\Sessions"
                    }
                ],
                "reg": {
                    "CommandLine|contains|all": [
                        " query ",
                        "/t ",
                        "REG_SZ",
                        "/s"
                    ],
                    "Image|endswith": "\\reg.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1552.002/T1552.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1552.002"
            ],
            "title": "Enumeration for Credentials in Registry"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g",
            "date": "2019/08/12",
            "description": "Detects handles requested to SAM registry hive",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4656,
                    "ObjectName|endswith": "\\SAM",
                    "ObjectType": "Key"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "ComputerName",
                "SubjectDomainName",
                "SubjectUserName",
                "ProcessName",
                "ObjectName"
            ],
            "id": "f8748f2c-89dc-4d95-afb0-5a2dfdbad332",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/27",
            "status": "test",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/190725-SAMRegistryHiveHandleRequest/notebook.html"
            ],
            "tags": [
                "attack.discovery",
                "attack.t1012",
                "attack.credential_access",
                "attack.t1552.002"
            ],
            "title": "SAM Registry Hive Handle Request"
        }
    ]
}