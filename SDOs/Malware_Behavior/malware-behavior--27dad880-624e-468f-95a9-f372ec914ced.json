{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--27dad880-624e-468f-95a9-f372ec914ced",
    "created": "2024-08-13T14:46:37.135941Z",
    "modified": "2024-08-13T14:46:46.230666Z",
    "name": "Create or Modify System Process: Systemd Service",
    "description": "Adversaries may create or modify systemd services to repeatedly execute malicious payloads as part of persistence. Systemd is a system and service manager commonly used for managing background daemon processes (also known as services) and other system resources.[1] Systemd is the default initialization (init) system on many Linux distributions replacing legacy init systems, including SysVinit and Upstart, while remaining backwards compatible.  Systemd utilizes unit configuration files with the .service file extension to encode information about a service's process. By default, system level unit files are stored in the /systemd/system directory of the root owned directories (/). User level unit files are stored in the /systemd/user directories of the user owned directories ($HOME).[2] Inside the .service unit files, the following directives are used to execute commands:[3] ExecStart, ExecStartPre, and ExecStartPost directives execute when a service is started manually by systemctl or on system start if the service is set to automatically start.ExecReload directive executes when a service restarts. ExecStop, ExecStopPre, and ExecStopPost directives execute when a service is stopped.  Adversaries have created new service files, altered the commands a .service file\u2019s directive executes, and modified the user directive a .service file executes as, which could result in privilege escalation. Adversaries may also place symbolic links in these directories, enabling systemd to find these payloads regardless of where they reside on the filesystem.[4][5][6] The .service file\u2019s User directive can be used to run service as a specific user, which could result in privilege escalation based on specific user/group permissions.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1543/002",
            "external_id": "T1543/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Pawel Mazur",
            "date": "2022/02/03",
            "description": "Detects a creation of systemd services which could be used by adversaries to execute malicious code.",
            "detection": {
                "condition": "path and 1 of name_*",
                "name_1": {
                    "name|startswith": [
                        "/usr/lib/systemd/system/",
                        "/etc/systemd/system/"
                    ]
                },
                "name_2": {
                    "name|contains": "/.config/systemd/user/"
                },
                "path": {
                    "nametype": "CREATE",
                    "type": "PATH"
                }
            },
            "falsepositives": [
                "Admin work like legit service installs."
            ],
            "id": "1bac86ba-41aa-4f62-9d6b-405eac99b485",
            "level": "medium",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2022/02/06",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1543.002/T1543.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1543.002"
            ],
            "title": "Systemd Service Creation"
        },
        {
            "author": "Jakob Weinzettl, oscd.community",
            "date": "2019/09/23",
            "description": "Detects a reload or a start of a service.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "a0|contains": "systemctl",
                    "a1|contains": [
                        "daemon-reload",
                        "start"
                    ],
                    "type": "EXECVE"
                }
            },
            "falsepositives": [
                "Installation of legitimate service.",
                "Legitimate reconfiguration of service."
            ],
            "id": "2625cc59-0634-40d0-821e-cb67382a3dd7",
            "level": "low",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1543.002/T1543.002.md"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1543.002"
            ],
            "title": "Systemd Service Reload or Start"
        }
    ]
}