{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--8446523e-084f-4f84-aebe-1eea263cc7fc",
    "created": "2024-08-13T14:46:37.0658Z",
    "modified": "2024-08-13T14:46:45.787366Z",
    "name": "Data Obfuscation",
    "description": "Adversaries may obfuscate command and control traffic to make it more difficult to detect.[1] Command and control (C2) communications are hidden (but not necessarily encrypted) in an attempt to make the content more difficult to discover or decipher and to make the communication less conspicuous and hide commands from being seen. This encompasses many methods, such as adding junk data to protocol traffic, using steganography, or impersonating legitimate protocols.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1001",
            "external_id": "T1001"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1001",
            "external_id": "T1001"
        },
        {
            "source_name": "University of Birmingham C2",
            "description": "Gardiner, J.,  Cova, M., Nagaraja, S. (2014, February). Command & Control Understanding, Denying and Detecting. Retrieved April 20, 2016.",
            "url": "https://arxiv.org/ftp/arxiv/papers/1408/1408.1136.pdf"
        },
        {
            "source_name": "Bitdefender FunnyDream Campaign November 2020",
            "description": "Vrabie, V. (2020, November). Dissecting a Chinese APT Targeting South Eastern Asian Government Institutions. Retrieved September 19, 2022.",
            "url": "https://www.bitdefender.com/files/News/CaseStudies/study/379/Bitdefender-Whitepaper-Chinese-APT.pdf"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "xknow @xknow_infosec, Tim Shelton",
            "date": "2019/03/24",
            "description": "Detects the creation of an \"Active Directory Schema Cache File\" (.sch) file by an uncommon tool.",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_generic": [
                    {
                        "Image|endswith": [
                            ":\\Program Files\\Cylance\\Desktop\\CylanceSvc.exe",
                            ":\\Windows\\CCM\\CcmExec.exe",
                            ":\\windows\\system32\\dllhost.exe",
                            ":\\Windows\\system32\\dsac.exe",
                            ":\\Windows\\system32\\efsui.exe",
                            ":\\windows\\system32\\mmc.exe",
                            ":\\windows\\system32\\svchost.exe",
                            ":\\Windows\\System32\\wbem\\WmiPrvSE.exe",
                            ":\\windows\\system32\\WindowsPowerShell\\v1.0\\powershell.exe"
                        ]
                    },
                    {
                        "Image|contains": [
                            ":\\Windows\\ccmsetup\\autoupgrade\\ccmsetup",
                            ":\\Program Files\\SentinelOne\\Sentinel Agent"
                        ]
                    }
                ],
                "filter_main_office": {
                    "Image|contains|all": [
                        ":\\Program Files\\",
                        "\\Microsoft Office"
                    ],
                    "Image|endswith": "\\OUTLOOK.EXE"
                },
                "filter_optional_citrix": {
                    "Image|endswith": ":\\Program Files\\Citrix\\Receiver StoreFront\\Services\\DefaultDomainServices\\Citrix.DeliveryServices.DomainServices.ServiceHost.exe"
                },
                "filter_optional_ldapwhoami": {
                    "Image|endswith": "\\LANDesk\\LDCLient\\ldapwhoami.exe"
                },
                "selection": {
                    "TargetFilename|contains": "\\Local\\Microsoft\\Windows\\SchCache\\",
                    "TargetFilename|endswith": ".sch"
                }
            },
            "falsepositives": [
                "Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc."
            ],
            "id": "75bf09fa-1dd7-4d18-9af9-dd9e492562eb",
            "level": "medium",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/10/18",
            "references": [
                "https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961",
                "https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/",
                "https://github.com/fox-it/LDAPFragger"
            ],
            "status": "test",
            "tags": [
                "attack.t1001.003",
                "attack.command_and_control"
            ],
            "title": "ADSI-Cache File Creation By Uncommon Tool"
        },
        {
            "author": "xknow @xknow_infosec",
            "date": "2019/03/24",
            "description": "Detects the usage of particular AttributeLDAPDisplayNames, which are known for data exchange via LDAP by the tool LDAPFragger and are additionally not commonly used in companies.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AttributeLDAPDisplayName": [
                        "primaryInternationalISDNNumber",
                        "otherFacsimileTelephoneNumber",
                        "primaryTelexNumber"
                    ],
                    "AttributeValue|contains": "*",
                    "EventID": 5136
                }
            },
            "falsepositives": [
                "Companies, who may use these default LDAP-Attributes for personal information"
            ],
            "id": "d00a9a72-2c09-4459-ad03-5e0a23351e36",
            "level": "high",
            "logsource": {
                "definition": "The \"Audit Directory Service Changes\" logging policy must be configured in order to receive events. Audit events are generated only for objects with configured system access control lists (SACLs). Audit events are generated only for objects with configured system access control lists (SACLs) and only when accessed in a manner that matches their SACL settings. This policy covers the following events ids - 5136, 5137, 5138, 5139, 5141. Note that the default policy does not cover User objects. For that a custom AuditRule need to be setup (See https://github.com/OTRF/Set-AuditRule)",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/05",
            "references": [
                "https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961",
                "https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/",
                "https://github.com/fox-it/LDAPFragger"
            ],
            "status": "test",
            "tags": [
                "attack.t1001.003",
                "attack.command_and_control"
            ],
            "title": "Suspicious LDAP-Attributes Used"
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "command-and-control"
        }
    ],
    "x_mitre_detection": "Analyze network data for uncommon data flows (e.g., a client sending significantly more data than it receives from a server). Processes utilizing the network that do not normally have network communication or have never been seen before are suspicious. Analyze packet contents to detect communications that do not follow the expected protocol behavior for the port that is being used. (Citation: University of Birmingham C2)",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.1",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Network Traffic: Network Traffic Content"
    ],
    "x_mitre_permissions_required": []
}