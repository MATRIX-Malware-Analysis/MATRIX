{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--01b7b973-bbc0-42bd-bd59-0bcb40da958a",
    "created": "2024-08-13T14:46:37.152144Z",
    "modified": "2024-08-13T14:46:48.688055Z",
    "name": "Device Driver Discovery",
    "description": "Adversaries may attempt to enumerate local device drivers on a victim host. Information about device drivers may highlight various insights that shape follow-on behaviors, such as the function/purpose of the host, present security tools (i.e. Security Software Discovery) or other defenses (e.g., Virtualization/Sandbox Evasion), as well as potential exploitable vulnerabilities (e.g., Exploitation for Privilege Escalation).Many OS utilities may provide information about local device drivers, such as driverquery.exe and the EnumDeviceDrivers() API function on Windows.[1][2] Information about device drivers (as well as associated services, i.e., System Service Discovery) may also be available in the Registry.[3]On Linux/macOS, device drivers (in the form of kernel modules) may be visible within /dev or using utilities such as lsmod and modinfo.[4][5][6]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1652",
            "external_id": "T1652"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1652",
            "external_id": "T1652"
        },
        {
            "source_name": "lsmod man",
            "description": "Kerrisk, M. (2022, December 18). lsmod(8) \u2014 Linux manual page. Retrieved March 28, 2023.",
            "url": "https://man7.org/linux/man-pages/man8/lsmod.8.html"
        },
        {
            "source_name": "Microsoft Registry Drivers",
            "description": "Microsoft. (2021, December 14). Registry Trees for Devices and Drivers. Retrieved March 28, 2023.",
            "url": "https://learn.microsoft.com/windows-hardware/drivers/install/overview-of-registry-trees-and-keys"
        },
        {
            "source_name": "Microsoft EnumDeviceDrivers",
            "description": "Microsoft. (2021, October 12). EnumDeviceDrivers function (psapi.h). Retrieved March 28, 2023.",
            "url": "https://learn.microsoft.com/windows/win32/api/psapi/nf-psapi-enumdevicedrivers"
        },
        {
            "source_name": "Microsoft Driverquery",
            "description": "Microsoft. (n.d.). driverquery. Retrieved March 28, 2023.",
            "url": "https://learn.microsoft.com/windows-server/administration/windows-commands/driverquery"
        },
        {
            "source_name": "Linux Kernel Programming",
            "description": "Pomerantz, O., Salzman, P.. (2003, April 4). The Linux Kernel Module Programming Guide. Retrieved April 6, 2018.",
            "url": "https://www.tldp.org/LDP/lkmpg/2.4/lkmpg.pdf"
        },
        {
            "source_name": "modinfo man",
            "description": "Russell, R. (n.d.). modinfo(8) - Linux man page. Retrieved March 28, 2023.",
            "url": "https://linux.die.net/man/8/modinfo"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "os": "linux"
                            },
                            {
                                "api": "system"
                            },
                            {
                                "or": [
                                    {
                                        "substring": "lsmod"
                                    },
                                    {
                                        "substring": "modinfo"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Device Driver Discovery [T1652]"
                    ],
                    "authors": [
                        "@mr-tz"
                    ],
                    "name": "enumerate device drivers on Linux",
                    "namespace": "collection",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "EnumDeviceDrivers"
                            },
                            {
                                "string": "/driverquery(.exe)?/i"
                            },
                            {
                                "and": [
                                    {
                                        "or": [
                                            {
                                                "match": "query or enumerate registry key"
                                            },
                                            {
                                                "match": "query or enumerate registry value"
                                            }
                                        ]
                                    },
                                    {
                                        "string": "/System\\\\(CurrentControlSet|ControlSet001)\\\\Services/i"
                                    },
                                    {
                                        "string": "/System\\\\(CurrentControlSet|ControlSet001)\\\\Control/i"
                                    },
                                    {
                                        "string": "/System\\\\(CurrentControlSet|ControlSet001)\\\\Enum/i"
                                    },
                                    {
                                        "string": "/System\\\\(CurrentControlSet|ControlSet001)\\\\HardwareProfiles/i"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Discovery::Device Driver Discovery [T1652]"
                    ],
                    "authors": [
                        "@mr-tz"
                    ],
                    "name": "enumerate device drivers on Windows",
                    "namespace": "collection",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    },
                    "references": [
                        "https://learn.microsoft.com/en-us/windows-hardware/drivers/install/overview-of-registry-trees-and-keys"
                    ]
                }
            }
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "ESET"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "discovery"
        }
    ],
    "x_mitre_detection": "",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.0",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Command: Command Execution",
        "Process: Process Creation",
        "Process: OS API Execution",
        "Windows Registry: Windows Registry Key Access"
    ],
    "x_mitre_permissions_required": []
}