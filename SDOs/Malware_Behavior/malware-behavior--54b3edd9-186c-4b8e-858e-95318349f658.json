{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--54b3edd9-186c-4b8e-858e-95318349f658",
    "created": "2019-08-01T00:00:00.000Z",
    "modified": "2024-04-27T00:00:00.000Z",
    "name": "Sandbox Detection",
    "description": "",
    "labels": [
        "malware-behavior"
    ],
    "object_marking_refs": [
        "marking-definition--093b6375-cd45-4aa3-8f91-6a03ddd7a3d3"
    ],
    "x_mitre_platforms": [],
    "x_mitre_domains": [],
    "x_mitre_contributors": [],
    "kill_chain_phases": [],
    "x_mitre_detection": "",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.0",
    "x_mitre_modified_by_ref": "",
    "x_mitre_data_sources": [],
    "x_mitre_permissions_required": [],
    "external_references": [
        {
            "source_name": "checkpoint",
            "description": "Check Point Research, \"CP<r>: Evasion Techniques,\" evasions.checkpoint.com, [Online].",
            "url": "https://evasions.checkpoint.com"
        },
        {
            "source_name": "splunk threat research",
            "description": "Splunk Threat Research Team, \"From Macros to No Macros: Continuous Malware Improvements by QakBot,\" Splunk, blog, Dec. 10, 2022 [Online].",
            "url": "https://www.splunk.com/en_us/blog/security/from-macros-to-no-macros-continuous-malware-improvements-by-qakbot.html"
        },
        {
            "source_name": "fireeye-vmaware",
            "description": "\"The Dead Giveaways of VM-Aware Malware,\" FireEye, Jan 2011.",
            "url": "https://web.archive.org/web/20160927120026/https://web.archive.org/web/20200815134441/https://www.fireeye.com/blog/threat-research/2011/01/the-dead-giveaways-of-vm-aware-malware.html"
        },
        {
            "source_name": "baker",
            "description": "B. Baker and A. Chiu, \"Threat Spotlight: Rombertik - Gazing Past the Smoke, Mirrors, and Trapdoors,\" Cisco Threat Research, blog, May 4, 2013 [Online].",
            "url": "https://blogs.cisco.com/security/talos/rombertik"
        },
        {
            "source_name": "lordnoteworthy",
            "description": "A. Faouzi (LordNoteworthy), \"README.md,\" Al-Khaser v0.81. Accessed Apr. 29, 2023 [Online].",
            "url": "https://github.com/LordNoteworthy/al-khaser"
        },
        {
            "source_name": "singh-knives",
            "description": "A. Singh and A. Bu, \"Hot Knives Through Butter: Evading File-based Sandboxes,\" FireEye, 2013 [Online].",
            "url": "https://media.blackhat.com/us-13/US-13-Singh-Hot-Knives-Through-Butter-Evading-File-based-Sandboxes-WP.pdf"
        },
        {
            "source_name": "hromcov\u00e1",
            "description": "Z. Hromcov\u00e1, \"Malicious campaign targets South Korean users with backdoor\u2011laced torrents,\" We Live Security, ESET, Jul. 8, 2019 [Online].",
            "url": "https://www.welivesecurity.com/2019/07/08/south-korean-users-backdoor-torrents/"
        },
        {
            "source_name": "marschalek",
            "description": "M. Marschalek, \"EvilBunny: Malware Instrumented by Lua,\" Cyphort Labs, blog, Dec. 16, 2014 [Online].",
            "url": "https://web.archive.org/web/20150311013500/http://www.cyphort.com/evilbunny-malware-instrumented-lua/"
        },
        {
            "source_name": "sonicwall",
            "description": "\"Revisiting Vobfus Worm,\" SonicWALL, Mar. 8, 2013 [Online].",
            "url": "https://securitynews.sonicwall.com/xmlpost/revisiting-vobfus-worm-mar-8-2013/"
        },
        {
            "source_name": "proofpoint-ursnif",
            "description": "\"Ursnif Banking Trojan Campaign Ups the Ante with New Sandbox Evasion Techniques,\" Proofpoint, Sep. 20, 2016 [Online].",
            "url": "https://www.proofpoint.com/us/threat-insight/post/ursnif-banking-trojan-campaign-sandbox-evasion-techniques"
        }
    ],
    "obj_defn": {
        "description": "Malware checks whether it is being executed inside an instrumented and isolated sandbox (test) environment. In performing reconnaissance of its environment, the malware will check a variety of user or system based artifacts. Examples include monitoring for user action as reflected by mouse clicks or timing checks [1], [2]. Upon detection of the sandbox, conditional execution will change the malware\u2019s behavior. For example, execution may terminate, or activity may appear benign, e.g., connecting to a benign domain. \n\nThe related **Virtualization/Sandbox Evasion ([T1497](https://attack.mitre.org/techniques/T1497/), [T1633](https://attack.mitre.org/techniques/T1633/))** ATT&CK techniques were defined subsequent to this MBC behavior.",
        "external_id": "B0007",
        "source_name": "mitre-mbc",
        "url": "https://github.com/MBCProject/mbc-markdown/blob/main/anti-behavioral-analysis/sandbox-detection.md"
    },
    "detection_rules": [
        {
            "api_fncs": [
                "CreateFile"
            ],
            "detect_ref": "malware-method--4ac35fe1-a449-45d6-ae06-0625a2bb5374",
            "rule_name": "check for microsoft office emulation",
            "rule_type": "capa",
            "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-vm/vm-detection/check-for-microsoft-office-emulation.yml"
        },
        {
            "api_fncs": [
                "GetModuleHandle"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_name": "check for sandbox and av modules",
            "rule_type": "capa",
            "url": "https://github.com/mandiant/capa-rules/blob/master/anti-analysis/anti-av/check-for-sandbox-and-av-modules.yml"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_joe_anubis_files.py",
            "rule_type": "cape",
            "url": "https://github.com/kevoreilly/community/blob/master/modules/signatures/windows/antisandbox_joe_anubis_files.py"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_cuckoo_files",
            "rule_type": "cape",
            "url": "https://github.com/kevoreilly/community/blob/master/modules/signatures/windows/antisandbox_cuckoo_files.py"
        },
        {
            "rule_name": "antisandbox_cuckoo_files",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_cuckoo_files.py"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_cuckoo_files",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_cuckoo_files.py"
        },
        {
            "rule_name": "antisandbox_threattrack_files",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_threattrack_files.py"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_threattrack_files",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_threattrack_files.py"
        },
        {
            "api_fncs": [
                "NtDelayExecution"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "rule_name": "antisandbox_sleep",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sleep.py"
        },
        {
            "api_fncs": [
                "NtDelayExecution"
            ],
            "detect_ref": "malware-method--69734f83-27f5-4333-bbaa-df9ef1830d66",
            "rule_type": "cape",
            "rule_name": "antisandbox_sleep",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sleep.py"
        },
        {
            "api_fncs": [
                "SetWindowsHookExA",
                "SetWindowsHookExW"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "rule_name": "antisandbox_mouse_hook",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_mouse_hook.py"
        },
        {
            "api_fncs": [
                "SetWindowsHookExA",
                "SetWindowsHookExW"
            ],
            "detect_ref": "malware-method--e61354cf-4f7e-49a4-a61e-d050fd33dc75",
            "rule_type": "cape",
            "rule_name": "antisandbox_mouse_hook",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_mouse_hook.py"
        },
        {
            "api_fncs": [
                "GetForegroundWindow",
                "NtDelayExecution"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "rule_name": "antisandbox_foregroundwindows",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_forehwnd.py"
        },
        {
            "rule_name": "antisandbox_sboxie_mutex",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sboxie_mutex.py"
        },
        {
            "rule_name": "antisandbox_script_timer",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_scripttimer.py"
        },
        {
            "api_fncs": [
                "LdrGetDllHandle",
                "LdrLoadDll"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "rule_name": "antisandbox_sboxie_libs",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sboxie_libs.py"
        },
        {
            "rule_name": "antisandbox_cuckoocrash",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_cuckoocrash.py"
        },
        {
            "rule_name": "antisandbox_joe_anubis_files",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_joe_anubis_files.py"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_joe_anubis_files",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_joe_anubis_files.py"
        },
        {
            "rule_name": "antisandbox_fortinet_files",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_fortinet_files.py"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_fortinet_files",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_fortinet_files.py"
        },
        {
            "rule_name": "antisandbox_sunbelt_files",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sunbelt_files.py"
        },
        {
            "detect_ref": "malware-method--53d8c090-24c0-4b63-a357-c647b6e0c7bd",
            "rule_name": "antisandbox_sunbelt_files",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sunbelt_files.py"
        },
        {
            "api_fncs": [
                "NtOpenDirectoryObject"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "rule_name": "antisandbox_sboxie_objects",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sboxie_objects.py"
        },
        {
            "api_fncs": [
                "LdrGetDllHandle",
                "LdrLoadDll"
            ],
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "rule_name": "antisandbox_sunbelt_libs",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_sunbelt_libs.py"
        },
        {
            "rule_name": "antisandbox_cuckoo",
            "detect_ref": "malware-behavior--b344af39-c24c-4bb9-8c80-cc8532f3f745",
            "rule_type": "cape",
            "url": "https://github.com/CAPESandbox/community/tree/master/modules/signatures/windows/antisandbox_cuckoo.py"
        }
    ],
    "tags": {
        "Anti-Analysis-Type": "Detection"
    }
}