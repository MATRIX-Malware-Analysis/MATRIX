{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--d69f8440-25fc-488d-8ae0-2da16c557682",
    "created": "2024-08-13T14:46:37.104582Z",
    "modified": "2024-08-13T14:46:46.035874Z",
    "name": "Indicator Removal: Network Share Connection Removal",
    "description": "Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation. Windows shared drive and SMB/Windows Admin Shares connections can be removed when no longer needed. Net is an example utility that can be used to remove network share connections with the net use \\system\\share /delete command. [1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1070/005",
            "external_id": "T1070/005"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "oscd.community, @redcanary, Zach Stanford @svch0st",
            "date": "2020/10/08",
            "description": "Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation",
            "detection": {
                "condition": "all of selection*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "share",
                        "/delete"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\net.exe",
                            "\\net1.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "net.exe",
                            "net1.exe"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Administrators or Power users may remove their shares via cmd line"
            ],
            "id": "cb7c4a03-2871-43c0-9bbb-18bbdb079896",
            "level": "low",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.005/T1070.005.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.005"
            ],
            "title": "Unmount Share Via Net.EXE"
        },
        {
            "author": "oscd.community, @redcanary, Zach Stanford @svch0st",
            "date": "2020/10/08",
            "description": "Detects when when a mounted share is removed. Adversaries may remove share connections that are no longer useful in order to clean up traces of their operation",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "Remove-SmbShare",
                        "Remove-FileShare"
                    ]
                }
            },
            "falsepositives": [
                "Administrators or Power users may remove their shares via cmd line"
            ],
            "id": "66a4d409-451b-4151-94f4-a55d559c49b0",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.005/T1070.005.md"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.005"
            ],
            "title": "PowerShell Deleted Mounted Share"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2024/03/19",
            "description": "Detects changes to the \"MaxMpxCt\" registry value.\nMaxMpxCt specifies the maximum outstanding network requests for the server per client, which is used when negotiating a Server Message Block (SMB) connection with a client. Note if the value is set beyond 125 older Windows 9x clients will fail to negotiate.\nRansomware threat actors and operators (specifically BlackCat) were seen increasing this value in order to handle a higher volume of traffic.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetObject|endswith": "\\Services\\LanmanServer\\Parameters\\MaxMpxCt"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "0e6a9e62-627e-496c-aef5-bfa39da29b5e",
            "level": "low",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "references": [
                "https://www.huntress.com/blog/blackcat-ransomware-affiliate-ttps",
                "https://securityscorecard.com/research/deep-dive-into-alphv-blackcat-ransomware",
                "https://www.intrinsec.com/alphv-ransomware-gang-analysis/?cn-reloaded=1",
                "https://www.sentinelone.com/labs/blackcat-ransomware-highly-configurable-rust-driven-raas-on-the-prowl-for-victims/"
            ],
            "status": "experimental",
            "title": "MaxMpxCt Registry Value Changed",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.005"
            ]
        },
        {
            "author": "frack113",
            "date": "2022/01/16",
            "description": "Administrative shares are hidden network shares created by Microsoft Windows NT operating systems that grant system administrators remote access to every disk volume on a network-connected system",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "DWORD (0x00000000)",
                    "TargetObject|contains": "\\Services\\LanmanServer\\Parameters\\",
                    "TargetObject|endswith": [
                        "\\AutoShareWks",
                        "\\AutoShareServer"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c7dcacd0-cc59-4004-b0a4-1d6cdebe6f3e",
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2024/03/25",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.005/T1070.005.md#atomic-test-4---disable-administrative-share-creation-at-startup"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070.005"
            ],
            "title": "Disable Administrative Share Creation at Startup"
        }
    ]
}