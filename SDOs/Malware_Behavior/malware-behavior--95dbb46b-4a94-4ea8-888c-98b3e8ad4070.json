{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--95dbb46b-4a94-4ea8-888c-98b3e8ad4070",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.340499Z",
    "name": "Boot or Logon Autostart Execution: Winlogon Helper DLL",
    "description": "Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in. Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete. Registry entries in HKLM\\Software[\\Wow6432Node\\]\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are used to manage additional helper programs and functionalities that support Winlogon.[1] Malicious modifications to these Registry keys may cause Winlogon to load and execute malicious DLLs and/or executables. Specifically, the following subkeys have been known to be possibly vulnerable to abuse: [1]Winlogon\\Notify - points to notification package DLLs that handle Winlogon eventsWinlogon\\Userinit - points to userinit.exe, the user initialization program executed when a user logs onWinlogon\\Shell - points to explorer.exe, the system shell executed when a user logs onAdversaries may take advantage of these features to repeatedly execute malicious code and establish persistence.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1547/004",
            "external_id": "T1547/004"
        },
        {
            "source_name": "CAPEC 579",
            "external_id": "malware-behavior--b4355cf8-b53c-463c-b89e-f5f20d341b68"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "match": "set registry value"
                                    },
                                    {
                                        "number": "0x80000001 = HKEY_CURRENT_USER"
                                    },
                                    {
                                        "number": "0x80000002 = HKEY_LOCAL_MACHINE"
                                    }
                                ]
                            },
                            {
                                "string": "/Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon/i"
                            },
                            {
                                "or": [
                                    {
                                        "string": "/Notify/i"
                                    },
                                    {
                                        "string": "/Userinit/i"
                                    },
                                    {
                                        "string": "/Shell/i"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Boot or Logon Autostart Execution::Winlogon Helper DLL [T1547.004]"
                    ],
                    "authors": [
                        "0x534a@mailbox.org"
                    ],
                    "examples": [
                        "9ff8e68343cc29c1036650fc153e69f7:0x47f818"
                    ],
                    "name": "persist via Winlogon Helper DLL registry key",
                    "namespace": "persistence/registry/winlogon-helper",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "@neu5ron, SOC Prime",
            "date": "2020/03/19",
            "description": "Windows DCE-RPC functions which indicate a persistence techniques on the remote system. All credit for the Zeek mapping of the suspicious endpoint/operation field goes to MITRE.",
            "detection": {
                "condition": "1 of op*",
                "op1": {
                    "endpoint": "spoolss",
                    "operation": "RpcAddMonitor"
                },
                "op2": {
                    "endpoint": "spoolss",
                    "operation": "RpcAddPrintProcessor"
                },
                "op3": {
                    "endpoint": "IRemoteWinspool",
                    "operation": "RpcAsyncAddMonitor"
                },
                "op4": {
                    "endpoint": "IRemoteWinspool",
                    "operation": "RpcAsyncAddPrintProcessor"
                },
                "op5": {
                    "endpoint": "ISecLogon",
                    "operation": "SeclCreateProcessWithLogonW"
                },
                "op6": {
                    "endpoint": "ISecLogon",
                    "operation": "SeclCreateProcessWithLogonExW"
                }
            },
            "falsepositives": [
                "Windows administrator tasks or troubleshooting",
                "Windows management scripts or software"
            ],
            "id": "53389db6-ba46-48e3-a94c-e0f2cefe1583",
            "level": "medium",
            "logsource": {
                "product": "zeek",
                "service": "dce_rpc"
            },
            "modified": "2021/11/27",
            "references": [
                "https://github.com/mitre-attack/bzar#indicators-for-attck-persistence"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1547.004"
            ],
            "title": "MITRE BZAR Indicators for Persistence"
        },
        {
            "author": "Timur Zinniatullin, oscd.community",
            "date": "2019/10/21",
            "description": "Winlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.\nRegistry entries in HKLM\\Software[Wow6432Node]Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ and HKCU\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\ are\nused to manage additional helper programs and functionalities that support Winlogon. Malicious modifications to these Registry keys may cause Winlogon to\nload and execute malicious DLLs and/or executables.\n",
            "detection": {
                "condition": "all of selection*",
                "selection": {
                    "ScriptBlockText|contains": "CurrentVersion\\Winlogon"
                },
                "selection2": {
                    "ScriptBlockText|contains": [
                        "Set-ItemProperty",
                        "New-Item"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "851c506b-6b7c-4ce2-8802-c703009d03c0",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "definition": "Requirements: Script Block Logging must be enabled",
                "product": "windows"
            },
            "modified": "2022/07/07",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.004/T1547.004.md"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1547.004"
            ],
            "title": "Winlogon Helper DLL"
        },
        {
            "author": "frack113",
            "date": "2021/12/30",
            "description": "Adversaries may abuse features of Winlogon to execute DLLs and/or executables when a user logs in.\nWinlogon.exe is a Windows component responsible for actions at logon/logoff as well as the secure attention sequence (SAS) triggered by Ctrl-Alt-Delete.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details|endswith": ".dll",
                    "TargetObject|endswith": "\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\logon"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bbf59793-6efb-4fa1-95ca-a7d288e52c88",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1547.004/T1547.004.md#atomic-test-3---winlogon-notify-key-logon-persistence---powershell"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1547.004"
            ],
            "title": "Winlogon Notify Key Logon Persistence"
        }
    ]
}