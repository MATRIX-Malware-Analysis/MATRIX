{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--65bdc9e6-708b-44b4-a612-2f95b4dd7012",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.309901Z",
    "name": "Data from Network Shared Drive",
    "description": "Adversaries may search network shares on computers they have compromised to find files of interest. Sensitive data can be collected from remote systems via shared network drives (host shared directory, network file server, etc.) that are accessible from the current system prior to Exfiltration. Interactive command shells may be in use, and common functionality within cmd may be used to gather information.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1039",
            "external_id": "T1039"
        },
        {
            "source_name": "CAPEC 639",
            "external_id": "malware-behavior--efd72166-96bf-49d1-b3c6-934f26b4f578"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1039",
            "external_id": "T1039"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems), oscd.community, Teymur Kheirkhabarov @HeirhabarovT, Zach Stanford @svch0st, Nasreddine Bencherchali",
            "date": "2019/12/30",
            "description": "Detects a copy command or a copy utility execution to or from an Admin share or remote",
            "detection": {
                "condition": "selection_target and (selection_other_tools or all of selection_cmd_* or all of selection_pwsh_*)",
                "selection_cmd_cli": {
                    "CommandLine|contains": "copy"
                },
                "selection_cmd_img": [
                    {
                        "Image|endswith": "\\cmd.exe"
                    },
                    {
                        "OriginalFileName": "Cmd.Exe"
                    }
                ],
                "selection_other_tools": [
                    {
                        "Image|endswith": [
                            "\\robocopy.exe",
                            "\\xcopy.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "robocopy.exe",
                            "XCOPY.EXE"
                        ]
                    }
                ],
                "selection_pwsh_cli": {
                    "CommandLine|contains": [
                        "copy-item",
                        "copy ",
                        "cpi ",
                        " cp ",
                        "move ",
                        "move-item",
                        " mi ",
                        " mv "
                    ]
                },
                "selection_pwsh_img": [
                    {
                        "Image|contains": [
                            "\\powershell.exe",
                            "\\pwsh.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll"
                        ]
                    }
                ],
                "selection_target": {
                    "CommandLine|contains": [
                        "\\\\\\\\*$",
                        "\\Sysvol\\"
                    ]
                }
            },
            "falsepositives": [
                "Administrative scripts"
            ],
            "id": "855bc8b5-2ae8-402e-a9ed-b889e6df1900",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/15",
            "references": [
                "https://twitter.com/SBousseaden/status/1211636381086339073",
                "https://drive.google.com/file/d/1lKya3_mLnR3UQuCoiYruO3qgu052_iS_/view",
                "https://www.elastic.co/guide/en/security/current/remote-file-copy-to-a-hidden-share.html",
                "https://www.microsoft.com/en-us/security/blog/2022/10/18/defenders-beware-a-case-for-post-ransomware-investigations/"
            ],
            "status": "test",
            "tags": [
                "attack.lateral_movement",
                "attack.collection",
                "attack.exfiltration",
                "attack.t1039",
                "attack.t1048",
                "attack.t1021.002"
            ],
            "title": "Copy From Or To Admin Share Or Sysvol Folder"
        },
        {
            "author": "Samir Bousseaden",
            "date": "2019/04/03",
            "description": "Detects known sensitive file extensions accessed on a network share",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 5145,
                    "RelativeTargetName|endswith": [
                        ".bak",
                        ".dmp",
                        ".edb",
                        ".kirbi",
                        ".msg",
                        ".nsf",
                        ".nst",
                        ".oab",
                        ".ost",
                        ".pst",
                        ".rdp",
                        "\\groups.xml"
                    ]
                }
            },
            "falsepositives": [
                "Help Desk operator doing backup or re-imaging end user machine or backup software",
                "Users working with these data types or exchanging message files"
            ],
            "id": "91c945bc-2ad1-4799-a591-4d00198a1215",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/09",
            "references": [
                "Internal Research"
            ],
            "related": [
                {
                    "id": "286b47ed-f6fe-40b3-b3a8-35129acd43bc",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.collection",
                "attack.t1039"
            ],
            "title": "Suspicious Access to Sensitive File Extensions"
        }
    ],
    "x_mitre_platforms": [
        "Linux",
        "macOS",
        "Windows"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "David Tayouri"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "collection"
        }
    ],
    "x_mitre_detection": "Monitor processes and command-line arguments for actions that could be taken to collect files from a network share. Remote access tools with built-in features may interact directly with the Windows API to gather data. Data may also be acquired through Windows system management tools such as [Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) and [PowerShell](https://attack.mitre.org/techniques/T1059/001).",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.4",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Network Share: Network Share Access",
        "Command: Command Execution",
        "Network Traffic: Network Connection Creation",
        "Network Traffic: Network Traffic Content",
        "Network Traffic: Network Traffic Flow",
        "File: File Access"
    ],
    "x_mitre_permissions_required": []
}