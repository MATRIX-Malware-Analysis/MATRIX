{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--cc4742ad-9429-43f9-9660-9599b2dbe66c",
    "created": "2024-08-13T14:46:37.110753Z",
    "modified": "2024-08-13T14:46:46.073785Z",
    "name": "Event Triggered Execution: Image File Execution Options Injection",
    "description": "Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by Image File Execution Options (IFEO) debuggers. IFEOs enable a developer to attach a debugger to an application. When a process is created, a debugger present in an application\u2019s IFEO will be prepended to the application\u2019s name, effectively launching the new process under the debugger (e.g., C:\\dbg\\ntsd.exe -g  notepad.exe). [1]IFEOs can be set directly via the Registry or in Global Flags via the GFlags tool. [2] IFEOs are represented as Debugger values in the Registry under HKLM\\SOFTWARE{\\Wow6432Node}\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\ where <executable> is the binary on which the debugger is attached. [1]IFEOs can also enable an arbitrary monitor program to be launched when a specified program silently exits (i.e. is prematurely terminated by itself or a second, non kernel-mode process). [3] [4] Similar to debuggers, silent exit monitoring can be enabled through GFlags and/or by directly modifying IFEO and silent process exit Registry values in HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\. [3] [4]Similar to Accessibility Features, on Windows Vista and later as well as Windows Server 2008 and later, a Registry key may be modified that configures 'cmd.exe,' or another program that provides backdoor access, as a 'debugger' for an accessibility program (ex: utilman.exe). After the Registry is modified, pressing the appropriate key combination at the login screen while at the keyboard or when connected with Remote Desktop Protocol will cause the 'debugger' program to be executed with SYSTEM privileges. [5]Similar to Process Injection, these values may also be abused to obtain privilege escalation by causing a malicious executable to be loaded and run in the context of separate processes on the computer. [6] Installing IFEO mechanisms may also provide Persistence via continuous triggered invocation.Malware may also use IFEO to Impair Defenses by registering invalid debuggers that redirect and effectively disable various system and security applications. [7] [8]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1546/012",
            "external_id": "T1546/012"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/08/10",
            "description": "Detects changes to the \"Default\" property for keys located in the \\Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\ registry. Which might be used as a method of persistence\nThe entries found under App Paths are used primarily for the following purposes.\nFirst, to map an application's executable file name to that file's fully qualified path.\nSecond, to prepend information to the PATH environment variable on a per-application, per-process basis.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details|contains": [
                        "\\Users\\Public",
                        "\\AppData\\Local\\Temp\\",
                        "\\Windows\\Temp\\",
                        "\\Desktop\\",
                        "\\Downloads\\",
                        "%temp%",
                        "%tmp%",
                        "iex",
                        "Invoke-",
                        "rundll32",
                        "regsvr32",
                        "mshta",
                        "cscript",
                        "wscript",
                        ".bat",
                        ".hta",
                        ".dll",
                        ".ps1"
                    ],
                    "TargetObject|contains": "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths",
                    "TargetObject|endswith": [
                        "(Default)",
                        "Path"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate applications registering their binary from on of the suspicious locations mentioned above (tune it)"
            ],
            "id": "707e097c-e20f-4f67-8807-1f72ff4500d6",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://www.hexacorn.com/blog/2013/01/19/beyond-good-ol-run-key-part-3/",
                "https://learn.microsoft.com/en-us/windows/win32/shell/app-registration"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1546.012"
            ],
            "title": "Potential Persistence Via App Paths Default Property"
        },
        {
            "author": "Karneades, Jonhnathan Ribeiro, Florian Roth",
            "date": "2018/04/11",
            "description": "Detects registry persistence technique using the GlobalFlags and SilentProcessExit keys",
            "detection": {
                "condition": "1 of selection_*",
                "selection_global_flag": {
                    "TargetObject|contains|all": [
                        "\\Microsoft\\Windows NT\\CurrentVersion\\",
                        "\\Image File Execution Options\\",
                        "\\GlobalFlag"
                    ]
                },
                "selection_silent_process": {
                    "TargetObject|contains": [
                        "\\ReportingMode",
                        "\\MonitorProcess"
                    ],
                    "TargetObject|contains|all": [
                        "\\Microsoft\\Windows NT\\CurrentVersion\\",
                        "\\SilentProcessExit\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "36803969-5421-41ec-b92f-8500f79c23b0",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/06/05",
            "references": [
                "https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/",
                "https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/"
            ],
            "related": [
                {
                    "id": "c81fe886-cac0-4913-a511-2822d72ff505",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.privilege_escalation",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.t1546.012",
                "car.2013-01-002"
            ],
            "title": "Potential Persistence Via GlobalFlags"
        }
    ]
}