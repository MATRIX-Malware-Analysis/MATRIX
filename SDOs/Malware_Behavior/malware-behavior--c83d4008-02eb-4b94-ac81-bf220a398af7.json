{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--c83d4008-02eb-4b94-ac81-bf220a398af7",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.378049Z",
    "name": "Impair Defenses: Indicator Blocking",
    "description": "An adversary may attempt to block indicators or events typically captured by sensors from being gathered and analyzed. This could include maliciously redirecting[1] or even disabling host-based sensors, such as Event Tracing for Windows (ETW)[2], by tampering settings that control the collection and flow of event telemetry.[3] These settings may be stored on the system in configuration files and/or in the Registry as well as being accessible via administrative utilities such as PowerShell or Windows Management Instrumentation.For example, adversaries may modify the File value in HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\EventLog\\Security to hide their malicious actions in a new or different .evtx log file. This action does not require a system reboot and takes effect immediately.[4] ETW interruption can be achieved multiple ways, however most directly by defining conditions using the PowerShell Set-EtwTraceProvider cmdlet or by interfacing directly with the Registry to make alterations.In the case of network-based reporting of indicators, an adversary may block traffic associated with reporting to prevent central analysis. This may be accomplished by many means, such as stopping a local process responsible for forwarding telemetry and/or creating a host-based firewall rule to block traffic to specific hosts responsible for aggregating events, such as security information and event management (SIEM) products.In Linux environments, adversaries may disable or reconfigure log processing tools such as syslog or nxlog to inhibit detection and monitoring capabilities to facilitate follow on behaviors [5].",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1562/006",
            "external_id": "T1562/006"
        },
        {
            "source_name": "CAPEC 571",
            "external_id": "malware-behavior--9bf87662-b201-4f50-ad6e-6aa4046005c3"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "kelnage",
            "date": "2023/09/07",
            "description": "Detects when an Okta user session starts where the user is behind an anonymising proxy service.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventtype": "user.session.start",
                    "securitycontext.isproxy": "true"
                }
            },
            "falsepositives": [
                "If a user requires an anonymising proxy due to valid justifications."
            ],
            "id": "bde30855-5c53-4c18-ae90-1ff79ebc9578",
            "level": "high",
            "logsource": {
                "product": "okta",
                "service": "okta"
            },
            "references": [
                "https://developer.okta.com/docs/reference/api/system-log/",
                "https://sec.okta.com/articles/2023/08/cross-tenant-impersonation-prevention-and-detection"
            ],
            "status": "experimental",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.006"
            ],
            "title": "Okta User Session Start Via An Anonymising Proxy Service"
        },
        {
            "author": "@neu5ron, Florian Roth (Nextron Systems), Jonhnathan Ribeiro, oscd.community",
            "date": "2019/03/22",
            "description": "Detects command line activity that tries to clear or disable any ETW trace log which could be a sign of logging evasion.\n",
            "detection": {
                "condition": "1 of selection_*",
                "selection_clear_1": {
                    "CommandLine|contains|all": [
                        "cl",
                        "/Trace"
                    ]
                },
                "selection_clear_2": {
                    "CommandLine|contains|all": [
                        "clear-log",
                        "/Trace"
                    ]
                },
                "selection_disable_1": {
                    "CommandLine|contains|all": [
                        "sl",
                        "/e:false"
                    ]
                },
                "selection_disable_2": {
                    "CommandLine|contains|all": [
                        "set-log",
                        "/e:false"
                    ]
                },
                "selection_disable_3": {
                    "CommandLine|contains|all": [
                        "logman",
                        "update",
                        "trace",
                        "--p",
                        "-ets"
                    ]
                },
                "selection_pwsh_remove": {
                    "CommandLine|contains": "Remove-EtwTraceProvider"
                },
                "selection_pwsh_set": {
                    "CommandLine|contains|all": [
                        "Set-EtwTraceProvider",
                        "0x11"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a238b5d0-ce2d-4414-a676-7a531b3d13d6",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/06/28",
            "references": [
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil",
                "https://abuse.io/lockergoga.txt",
                "https://medium.com/palantir/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070",
                "attack.t1562.006",
                "car.2016-04-002"
            ],
            "title": "ETW Trace Evasion Activity"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/28",
            "description": "Detects usage of powershell cmdlets to disable or remove ETW trace sessions",
            "detection": {
                "condition": "1 of selection*",
                "selection_pwsh_remove": {
                    "ScriptBlockText|contains": "Remove-EtwTraceProvider "
                },
                "selection_pwsh_set": {
                    "ScriptBlockText|contains|all": [
                        "Set-EtwTraceProvider ",
                        "0x11"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "115fdba9-f017-42e6-84cf-d5573bf2ddf8",
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/11/25",
            "references": [
                "https://medium.com/palantir/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "a238b5d0-ce2d-4414-a676-7a531b3d13d6"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1070",
                "attack.t1562.006",
                "car.2016-04-002"
            ],
            "title": "Disable of ETW Trace - Powershell"
        },
        {
            "author": "Mikhail Larin, oscd.community",
            "date": "2019/10/25",
            "description": "Detect changes of syslog daemons configuration files",
            "detection": {
                "condition": "selection",
                "selection": {
                    "name": [
                        "/etc/syslog.conf",
                        "/etc/rsyslog.conf",
                        "/etc/syslog-ng/syslog-ng.conf"
                    ],
                    "type": "PATH"
                }
            },
            "falsepositives": [
                "Legitimate administrative activity"
            ],
            "fields": [
                "exe",
                "comm",
                "key"
            ],
            "id": "c830f15d-6f6e-430f-8074-6f73d6807841",
            "level": "high",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2021/11/27",
            "status": "test",
            "references": [
                "self experience"
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.006"
            ],
            "title": "Logging Configuration Changes on Linux Host"
        },
        {
            "author": "Mikhail Larin, oscd.community",
            "date": "2019/10/25",
            "description": "Detect changes in auditd configuration files",
            "detection": {
                "condition": "selection",
                "selection": {
                    "name": [
                        "/etc/audit/*",
                        "/etc/libaudit.conf",
                        "/etc/audisp/*"
                    ],
                    "type": "PATH"
                }
            },
            "falsepositives": [
                "Legitimate administrative activity"
            ],
            "fields": [
                "exe",
                "comm",
                "key"
            ],
            "id": "977ef627-4539-4875-adf4-ed8f780c4922",
            "level": "high",
            "logsource": {
                "product": "linux",
                "service": "auditd"
            },
            "modified": "2021/11/27",
            "status": "test",
            "references": [
                "https://github.com/Neo23x0/auditd/blob/master/audit.rules",
                "Self Experience"
            ],
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.006"
            ],
            "title": "Auditing Configuration Changes on Linux Host"
        }
    ]
}