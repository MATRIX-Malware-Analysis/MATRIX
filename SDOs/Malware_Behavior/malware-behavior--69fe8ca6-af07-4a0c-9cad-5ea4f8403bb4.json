{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--69fe8ca6-af07-4a0c-9cad-5ea4f8403bb4",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:46.393447Z",
    "name": "Impair Defenses: Impair Command History Logging",
    "description": "Adversaries may impair command history logging to hide commands they run on a compromised system. Various command interpreters keep track of the commands users type in their terminal so that users can retrace what they've done. On Linux and macOS, command history is tracked in a file pointed to by the environment variable HISTFILE. When a user logs off a system, this information is flushed to a file in the user's home directory called ~/.bash_history. The HISTCONTROL environment variable keeps track of what should be saved by the history command and eventually into the ~/.bash_history file when a user logs out. HISTCONTROL does not exist by default on macOS, but can be set by the user and will be respected.Adversaries may clear the history environment variable (unset HISTFILE) or set the command history size to zero (export HISTFILESIZE=0) to prevent logging of commands. Additionally, HISTCONTROL can be configured to ignore commands that start with a space by simply setting it to 'ignorespace'. HISTCONTROL can also be set to ignore duplicate commands by setting it to 'ignoredups'. In some Linux systems, this is set by default to 'ignoreboth' which covers both of the previous examples. This means that ' ls' will not be saved, but 'ls' would be saved by history. Adversaries can abuse this to operate without leaving traces by simply prepending a space to all of their terminal commands. On Windows systems, the PSReadLine module tracks commands used in all PowerShell sessions and writes them to a file ($env:APPDATA\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt by default). Adversaries may change where these logs are saved using Set-PSReadLineOption -HistorySavePath {File Path}. This will cause ConsoleHost_history.txt to stop receiving logs. Additionally, it is possible to turn off logging to this file using the PowerShell command Set-PSReadlineOption -HistorySaveStyle SaveNothing.[1][2][3]Adversaries may also leverage a Network Device CLI on network devices to disable historical command logging (e.g. no logging).",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1562/003",
            "external_id": "T1562/003"
        },
        {
            "source_name": "CAPEC 13",
            "external_id": "malware-behavior--e7bea6c3-943c-477a-a7a1-18ab432337a5"
        },
        {
            "source_name": "CAPEC 268",
            "external_id": "malware-behavior--2d937180-2912-4747-a752-17bdfa7fcab7"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Cedric Maurugeon",
            "date": "2023/09/04",
            "description": "Detects changes to the ESXi syslog configuration via \"esxcli\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": " set",
                    "CommandLine|contains|all": [
                        "system",
                        "syslog",
                        "config"
                    ],
                    "Image|endswith": "/esxcli"
                }
            },
            "falsepositives": [
                "Legitimate administrative activities"
            ],
            "id": "38eb1dbb-011f-40b1-a126-cf03a0210563",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "linux"
            },
            "references": [
                "https://support.solarwinds.com/SuccessCenter/s/article/Configure-ESXi-Syslog-to-LEM?language=en_US",
                "https://developer.vmware.com/docs/11743/esxi-7-0-esxcli-command-reference/namespace/esxcli_system.html"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1562.001",
                "attack.t1562.003"
            ],
            "title": "ESXi Syslog Configuration Change Via ESXCLI"
        }
    ]
}