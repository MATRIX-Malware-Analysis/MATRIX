{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--e614299f-aa9b-4c95-9c32-cf0fdf2b7537",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:48.709915Z",
    "name": "Boot or Logon Autostart Execution: Active Setup",
    "description": "Adversaries may achieve persistence by adding a Registry key to the Active Setup of the local machine. Active Setup is a Windows mechanism that is used to execute programs when a user logs in. The value stored in the Registry key will be executed after a user logs into the computer.[1] These programs will be executed under the context of the user and will have the account's associated permissions level.Adversaries may abuse Active Setup by creating a key under  HKLM\\SOFTWARE\\Microsoft\\Active Setup\\Installed Components\\ and setting a malicious value for StubPath. This value will serve as the program that will be executed when a user logs into the computer.[2][3][4][5][6]Adversaries can abuse these components to execute malware, such as remote access tools, to maintain persistence through system reboots. Adversaries may also use Masquerading to make the Registry entries look as if they are associated with legitimate programs.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1547/014",
            "external_id": "T1547/014"
        },
        {
            "source_name": "CAPEC 270",
            "external_id": "malware-behavior--1e90609e-7477-49ff-9a87-b76b90c2260c"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "or": [
                                    {
                                        "match": "set registry value"
                                    },
                                    {
                                        "number": "0x80000002 = HKEY_LOCAL_MACHINE"
                                    }
                                ]
                            },
                            {
                                "string": "/Software\\\\Microsoft\\\\Active Setup\\\\Installed Components/i"
                            },
                            {
                                "string": "StubPath"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Boot or Logon Autostart Execution::Active Setup [T1547.014]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "c335a9d41185a32ad918c5389ee54235:0x4028F0"
                    ],
                    "name": "persist via Active Setup registry key",
                    "namespace": "persistence/registry",
                    "references": [
                        "https://www.fireeye.com/blog/threat-research/2017/02/spear_phishing_techn.html"
                    ],
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/18",
            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
            "detection": {
                "condition": "selection_img and (1 of selection_flags_*)",
                "selection_flags_configure": {
                    "CommandLine|contains|all": [
                        "/configure",
                        "/db"
                    ]
                },
                "selection_flags_discovery": {
                    "CommandLine|contains|all": [
                        "/export",
                        "/cfg"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\secedit.exe"
                    },
                    {
                        "OriginalFileName": "SeCEdit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrative use"
            ],
            "id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1562.002",
                "attack.t1547.001",
                "attack.t1505.005",
                "attack.t1556.002",
                "attack.t1562",
                "attack.t1574.007",
                "attack.t1564.002",
                "attack.t1546.008",
                "attack.t1546.007",
                "attack.t1547.014",
                "attack.t1547.010",
                "attack.t1547.002",
                "attack.t1557",
                "attack.t1082"
            ],
            "title": "Potential Suspicious Activity Using SeCEdit"
        }
    ]
}