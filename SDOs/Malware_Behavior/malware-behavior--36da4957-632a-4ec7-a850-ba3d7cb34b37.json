{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--36da4957-632a-4ec7-a850-ba3d7cb34b37",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.285178Z",
    "name": "Obfuscated Files or Information: Embedded Payloads",
    "description": "Adversaries may embed payloads within other files to conceal malicious content from defenses. Otherwise seemingly benign files (such as scripts and executables) may be abused to carry and obfuscate malicious payloads and content. In some cases, embedded payloads may also enable adversaries to Subvert Trust Controls by not impacting execution controls such as digital signatures and notarization tickets.[1] Adversaries may embed payloads in various file formats to hide payloads.[2] This is similar to Steganography, though does not involve weaving malicious content into specific bytes and patterns related to legitimate digital media formats.[3] For example, adversaries have been observed embedding payloads within or as an overlay of an otherwise benign binary.[4] Adversaries have also been observed nesting payloads (such as executables and run-only scripts) inside a file of the same format.[5] Embedded content may also be used as Process Injection payloads used to infect benign system processes.[6] These embedded then injected payloads may be used as part of the modules of malware designed to provide specific features such as encrypting C2 communications in support of an orchestrator module. For example, an embedded module may be injected into default browsers, allowing adversaries to then communicate via the network.[7]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1027/009",
            "external_id": "T1027/009"
        },
        {
            "source_name": "CAPEC 19",
            "external_id": "malware-behavior--52a108cc-fd05-4833-810d-9fe99133e493"
        },
        {
            "source_name": "CAPEC 35",
            "external_id": "malware-behavior--a3f0aa68-5598-470f-b4e9-1f481ad343df"
        },
        {
            "source_name": "CAPEC 448",
            "external_id": "malware-behavior--0c21482c-206c-4084-b827-14f94e9e187d"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "frack113",
            "date": "2022/12/27",
            "description": "Detects TOKEN OBFUSCATION technique from Invoke-Obfuscation",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "CommandLine|re": "\\w+`(\\w+|-|.)`[\\w+|\\s]"
                    },
                    {
                        "CommandLine|re": "\"(\\{\\d\\})+\"\\s*-f"
                    },
                    {
                        "CommandLine|re": "\\$\\{((e|n|v)*`(e|n|v)*)+:path\\}|\\$\\{((e|n|v)*`(e|n|v)*)+:((p|a|t|h)*`(p|a|t|h)*)+\\}|\\$\\{env:((p|a|t|h)*`(p|a|t|h)*)+\\}"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "deb9b646-a508-44ee-b7c9-d8965921c6b6",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://github.com/danielbohannon/Invoke-Obfuscation"
            ],
            "related": [
                {
                    "id": "f3a98ce4-6164-4dd4-867c-4d83de7eca51",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1027.009"
            ],
            "title": "Powershell Token Obfuscation - Process Creation"
        },
        {
            "id": "f3a98ce4-6164-4dd4-867c-4d83de7eca51",
            "author": "frack113",
            "date": "2022/12/27",
            "description": "Detects TOKEN OBFUSCATION technique from Invoke-Obfuscation",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_chocolatey": {
                    "ScriptBlockText|contains": [
                        "it will return true or false instead",
                        "The function also prevents `Get-ItemProperty` from failing"
                    ]
                },
                "filter_exchange": {
                    "Path|endswith": "\\bin\\servicecontrol.ps1",
                    "Path|startswith": "C:\\Program Files\\Microsoft\\Exchange Server\\",
                    "ScriptBlockText|contains": "`r`n"
                },
                "selection": [
                    {
                        "ScriptBlockText|re": "\\w+`(\\w+|-|.)`[\\w+|\\s]"
                    },
                    {
                        "ScriptBlockText|re": "\"(\\{\\d\\}){2,}\"\\s*-f"
                    },
                    {
                        "ScriptBlockText|re": "\\$\\{((e|n|v)*`(e|n|v)*)+:path\\}|\\$\\{((e|n|v)*`(e|n|v)*)+:((p|a|t|h)*`(p|a|t|h)*)+\\}|\\$\\{env:((p|a|t|h)*`(p|a|t|h)*)+\\}"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2023/03/24",
            "references": [
                "https://github.com/danielbohannon/Invoke-Obfuscation"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "deb9b646-a508-44ee-b7c9-d8965921c6b6"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1027.009"
            ],
            "title": "Powershell Token Obfuscation - Powershell"
        }
    ]
}