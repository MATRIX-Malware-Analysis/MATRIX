{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--c7c1baa2-bd38-4fde-9f45-fcdf20cdaf2e",
    "created": "2024-08-13T14:46:37.173802Z",
    "modified": "2024-08-13T14:46:48.715273Z",
    "name": "Modify Authentication Process: Password Filter DLL",
    "description": "Adversaries may register malicious password filter dynamic link libraries (DLLs) into the authentication process to acquire user credentials as they are validated. Windows password filters are password policy enforcement mechanisms for both domain and local accounts. Filters are implemented as DLLs containing a method to validate potential passwords against password policies. Filter DLLs can be positioned on local computers for local accounts and/or domain controllers for domain accounts. Before registering new passwords in the Security Accounts Manager (SAM), the Local Security Authority (LSA) requests validation from each registered filter. Any potential changes cannot take effect until every registered filter acknowledges validation. Adversaries can register malicious password filters to harvest credentials from local computers and/or entire domains. To perform proper validation, filters must receive plain-text credentials from the LSA. A malicious password filter would receive these plain-text credentials every time a password request is made.[1]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1556/002",
            "external_id": "T1556/002"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "export": "InitializeChangeNotify"
                            },
                            {
                                "export": "PasswordChangeNotify"
                            },
                            {
                                "export": "PasswordFilter"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Persistence::Modify Authentication Process::Password Filter DLL [T1556.002]"
                    ],
                    "authors": [
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "4f08636da3941f6f1e70ac2bf449b69e2ddbdc23dac58fd7eab9c5fdce6a4960"
                    ],
                    "name": "act as password filter DLL",
                    "namespace": "persistence/authentication-process",
                    "scopes": {
                        "dynamic": "file",
                        "static": "file"
                    }
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Janantha Marasinghe",
            "date": "2022/11/18",
            "description": "Detects potential suspicious behaviour using secedit.exe. Such as exporting or modifying the security policy",
            "detection": {
                "condition": "selection_img and (1 of selection_flags_*)",
                "selection_flags_configure": {
                    "CommandLine|contains|all": [
                        "/configure",
                        "/db"
                    ]
                },
                "selection_flags_discovery": {
                    "CommandLine|contains|all": [
                        "/export",
                        "/cfg"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\secedit.exe"
                    },
                    {
                        "OriginalFileName": "SeCEdit"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrative use"
            ],
            "id": "c2c76b77-32be-4d1f-82c9-7e544bdfe0eb",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://blueteamops.medium.com/secedit-and-i-know-it-595056dee53d",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/secedit"
            ],
            "status": "test",
            "tags": [
                "attack.discovery",
                "attack.persistence",
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.privilege_escalation",
                "attack.t1562.002",
                "attack.t1547.001",
                "attack.t1505.005",
                "attack.t1556.002",
                "attack.t1562",
                "attack.t1574.007",
                "attack.t1564.002",
                "attack.t1546.008",
                "attack.t1546.007",
                "attack.t1547.014",
                "attack.t1547.010",
                "attack.t1547.002",
                "attack.t1557",
                "attack.t1082"
            ],
            "title": "Potential Suspicious Activity Using SeCEdit"
        },
        {
            "author": "Sreeman",
            "date": "2020/10/29",
            "description": "Detects dropping of dll files in system32 that may be used to retrieve user credentials from LSASS",
            "detection": {
                "condition": "selection_cmdline",
                "selection_cmdline": {
                    "CommandLine|contains|all": [
                        "HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa",
                        "scecli\\0*",
                        "reg add"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b7966f4a-b333-455b-8370-8ca53c229762",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://pentestlab.blog/2020/02/10/credential-access-password-filter-dll/",
                "https://github.com/3gstudent/PasswordFilter/tree/master/PasswordFilter"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1556.002"
            ],
            "title": "Dropping Of Password Filter DLL"
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/12/27",
            "description": "Uses PowerShell to install/copy a file into a system directory such as \"System32\" or \"SysWOW64\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|re": "(Copy-Item|cpi) .{2,128} -Destination .{1,32}\\\\Windows\\\\(System32|SysWOW64)"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "63bf8794-9917-45bc-88dd-e1b5abc0ecfd",
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2024/01/22",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1556.002/T1556.002.md#atomic-test-1---install-and-register-password-filter-dll"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1556.002"
            ],
            "title": "Powershell Install a DLL in System Directory"
        }
    ]
}