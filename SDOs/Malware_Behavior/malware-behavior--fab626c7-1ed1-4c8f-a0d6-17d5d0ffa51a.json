{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--fab626c7-1ed1-4c8f-a0d6-17d5d0ffa51a",
    "created": "2024-08-13T14:46:37.106301Z",
    "modified": "2024-08-13T14:46:46.045874Z",
    "name": "System Binary Proxy Execution: Control Panel",
    "description": "Adversaries may abuse control.exe to proxy execution of malicious payloads. The Windows Control Panel process binary (control.exe) handles execution of Control Panel items, which are utilities that allow users to view and adjust computer settings.Control Panel items are registered executable (.exe) or Control Panel (.cpl) files, the latter are actually renamed dynamic-link library (.dll) files that export a CPlApplet function.[1][2] For ease of use, Control Panel items typically include graphical menus available to users after being registered and loaded into the Control Panel.[1] Control Panel items can be executed directly from the command line, programmatically via an application programming interface (API) call, or by simply double-clicking the file.[1] [2][3]Malicious Control Panel items can be delivered via Phishing campaigns[2][3] or executed as part of multi-stage malware.[4] Control Panel items, specifically CPL files, may also bypass application and/or file extension allow lists.Adversaries may also rename malicious DLL files (.dll) with Control Panel file extensions (.cpl) and register them to HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Control Panel\\Cpls. Even when these registered DLLs do not comply with the CPL file specification and do not export CPlApplet functions, they are loaded and executed through its DllEntryPoint when Control Panel is executed. CPL files not exporting CPlApplet are not directly executable.[5]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1218/002",
            "external_id": "T1218/002"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Kyaw Min Thein, Furkan Caliskan (@caliskanfurkan_)",
            "date": "2020/06/22",
            "description": "Detects the malicious use of a control panel item",
            "detection": {
                "condition": "all of selection_reg_* or (selection_cpl and not 1 of filter_cpl_*)",
                "filter_cpl_igfx": {
                    "CommandLine|contains|all": [
                        "regsvr32 ",
                        " /s ",
                        "igfxCPL.cpl"
                    ]
                },
                "filter_cpl_sys": {
                    "CommandLine|contains": [
                        "\\System32\\",
                        "%System%",
                        "|C:\\Windows\\system32|"
                    ]
                },
                "selection_cpl": {
                    "CommandLine|endswith": ".cpl"
                },
                "selection_reg_cli": {
                    "CommandLine|contains|all": [
                        "add",
                        "CurrentVersion\\Control Panel\\CPLs"
                    ]
                },
                "selection_reg_img": [
                    {
                        "Image|endswith": "\\reg.exe"
                    },
                    {
                        "OriginalFileName": "reg.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "0ba863e6-def5-4e50-9cea-4dd8c7dc46a4",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/10/11",
            "references": [
                "https://ired.team/offensive-security/code-execution/code-execution-through-control-panel-add-ins"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.defense_evasion",
                "attack.t1218.002",
                "attack.persistence",
                "attack.t1546"
            ],
            "title": "Control Panel Items"
        }
    ]
}