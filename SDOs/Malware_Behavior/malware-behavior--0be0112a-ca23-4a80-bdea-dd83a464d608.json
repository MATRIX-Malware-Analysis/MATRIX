{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--0be0112a-ca23-4a80-bdea-dd83a464d608",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.538854Z",
    "name": "Create or Modify System Process: Launch Agent",
    "description": "Adversaries may create or modify launch agents to repeatedly execute malicious payloads as part of persistence. When a user logs in, a per-user launchd process is started which loads the parameters for each launch-on-demand user agent from the property list (.plist) file found in /System/Library/LaunchAgents, /Library/LaunchAgents, and ~/Library/LaunchAgents.[1][2] [3] Property list files use the Label, ProgramArguments , and RunAtLoad keys to identify the Launch Agent's name, executable location, and execution time.[4] Launch Agents are often installed to perform updates to programs, launch user specified programs at login, or to conduct other developer tasks.Launch Agents can also be executed using the Launchctl command.Adversaries may install a new Launch Agent that executes at login by placing a .plist file into the appropriate folders with the RunAtLoad or KeepAlive keys set to true.[5][6] The Launch Agent name may be disguised by using a name from the related operating system or benign software. Launch Agents are created with user level privileges and execute with user level permissions.[7][8]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1543/001",
            "external_id": "T1543/001"
        },
        {
            "source_name": "CAPEC 564",
            "external_id": "malware-behavior--f5b71bfe-8ee3-4767-b9da-031cbb48d99e"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sohan G (D4rkCiph3r)",
            "date": "2023/02/18",
            "description": "Detects potential persistence activity using LaunchAgents or LaunchDaemons via the PlistBuddy utility",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "LaunchAgents",
                        "LaunchDaemons"
                    ],
                    "CommandLine|contains|all": [
                        "RunAtLoad",
                        "true"
                    ],
                    "Image|endswith": "/PlistBuddy"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "65d506d3-fcfe-4071-b4b2-bcefe721bbbb",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://redcanary.com/blog/clipping-silver-sparrows-wings/",
                "https://www.manpagez.com/man/8/PlistBuddy/"
            ],
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.t1543.001",
                "attack.t1543.004"
            ],
            "title": "Potential Persistence Via PlistBuddy"
        },
        {
            "author": "Pratinav Chandra",
            "date": "2024/05/13",
            "description": "Detects the execution of programs as Launch Agents or Launch Daemons using launchctl on macOS.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "submit",
                        "load",
                        "start"
                    ],
                    "Image|endswith": "/launchctl"
                }
            },
            "falsepositives": [
                "Legitimate administration activities is expected to trigger false positives. Investigate the command line being passed to determine if the service or launch agent are suspicious."
            ],
            "id": "ae9d710f-dcd1-4f75-a0a5-93a73b5dda0e",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1569.001/T1569.001.md",
                "https://www.sentinelone.com/labs/20-common-tools-techniques-used-by-macos-threat-actors-malware/",
                "https://www.welivesecurity.com/2020/07/16/mac-cryptocurrency-trading-application-rebranded-bundled-malware/",
                "https://www.trendmicro.com/en_us/research/18/d/new-macos-backdoor-linked-to-oceanlotus-found.html",
                "https://www.loobins.io/binaries/launchctl/"
            ],
            "status": "experimental",
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1569.001",
                "attack.t1543.001",
                "attack.t1543.004"
            ],
            "title": "Launch Agent/Daemon Execution Via Launchctl"
        }
    ]
}