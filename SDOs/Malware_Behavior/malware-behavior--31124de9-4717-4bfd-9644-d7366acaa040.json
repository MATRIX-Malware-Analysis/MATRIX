{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--31124de9-4717-4bfd-9644-d7366acaa040",
    "created": "2024-08-13T14:46:36.948883Z",
    "modified": "2024-08-13T14:46:45.064794Z",
    "name": "System Binary Proxy Execution: Msiexec",
    "description": "Adversaries may abuse msiexec.exe to proxy execution of malicious payloads. Msiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi).[1] The Msiexec.exe binary may also be digitally signed by Microsoft.Adversaries may abuse msiexec.exe to launch local or network accessible MSI files. Msiexec.exe can also execute DLLs.[2][3] Since it may be signed and native on Windows systems, msiexec.exe can be used to bypass application control solutions that do not account for its potential abuse. Msiexec.exe execution may also be elevated to SYSTEM privileges if the AlwaysInstallElevated policy is enabled.[4]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1218/007",
            "external_id": "T1218/007"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "frack113",
            "date": "2022/01/16",
            "description": "Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.\nMsiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\n",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_apple": {
                    "CommandLine|contains": [
                        "\\MsiExec.exe\" /Y \"C:\\Program Files\\Bonjour\\mdnsNSP.dll",
                        "\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll",
                        "\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll",
                        "\\MsiExec.exe\" /Y \"C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll",
                        "\\MsiExec.exe\" /Y \"C:\\Windows\\CCM\\",
                        "\\MsiExec.exe\" /Y C:\\Windows\\CCM\\",
                        "\\MsiExec.exe\" -Y \"C:\\Program Files\\Bonjour\\mdnsNSP.dll",
                        "\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Bonjour\\mdnsNSP.dll",
                        "\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Apple Software Update\\ScriptingObjectModel.dll",
                        "\\MsiExec.exe\" -Y \"C:\\Program Files (x86)\\Apple Software Update\\SoftwareUpdateAdmin.dll",
                        "\\MsiExec.exe\" -Y \"C:\\Windows\\CCM\\",
                        "\\MsiExec.exe\" -Y C:\\Windows\\CCM\\"
                    ]
                },
                "selection": {
                    "CommandLine|contains|windash": " -y",
                    "Image|endswith": "\\msiexec.exe"
                }
            },
            "falsepositives": [
                "Legitimate script"
            ],
            "id": "6f4191bb-912b-48a8-9ce7-682769541e6d",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.007/T1218.007.md",
                "https://twitter.com/_st0pp3r_/status/1583914515996897281"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.007"
            ],
            "title": "Suspicious Msiexec Execute Arbitrary DLL"
        },
        {
            "author": "frack113",
            "date": "2022/01/16",
            "description": "Adversaries may abuse msiexec.exe to proxy execution of malicious payloads.\nMsiexec.exe is the command-line utility for the Windows Installer and is thus commonly associated with executing installation packages (.msi)\n",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_*",
                "filter_ccm": {
                    "IntegrityLevel": "System",
                    "ParentImage": "C:\\Windows\\CCM\\Ccm32BitLauncher.exe"
                },
                "filter_system_temp": {
                    "ParentImage|startswith": "C:\\Windows\\Temp\\"
                },
                "filter_user_temp": {
                    "ParentImage|contains": "\\AppData\\Local\\Temp\\",
                    "ParentImage|startswith": "C:\\Users\\"
                },
                "selection_cli": {
                    "CommandLine|contains|windash": [
                        "-i",
                        "-package",
                        "-a",
                        "-j"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\msiexec.exe"
                    },
                    {
                        "OriginalFileName": "msiexec.exe"
                    }
                ],
                "selection_quiet": {
                    "CommandLine|contains|windash": "-q"
                }
            },
            "falsepositives": [
                "WindowsApps installing updates via the quiet flag"
            ],
            "id": "79a87aa6-e4bd-42fc-a5bb-5e6fbdcd62f5",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.007/T1218.007.md",
                "https://twitter.com/_st0pp3r_/status/1583914244344799235"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.007"
            ],
            "title": "Msiexec Quiet Installation"
        },
        {
            "author": "frack113",
            "date": "2022/04/16",
            "description": "Adversaries may abuse msiexec.exe to proxy the execution of malicious payloads",
            "detection": {
                "condition": "selection and not 1 of filter*",
                "filter_splunk_ufw": {
                    "CommandLine|contains": "C:\\Program Files\\SplunkUniversalForwarder\\bin\\",
                    "Image|endswith": ":\\Windows\\System32\\cmd.exe"
                },
                "filter_vs": [
                    {
                        "CommandLine|contains": "\\DismFoDInstall.cmd"
                    },
                    {
                        "ParentCommandLine|contains|all": [
                            "\\MsiExec.exe -Embedding ",
                            "Global\\MSI0000"
                        ]
                    }
                ],
                "selection": {
                    "Image|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\cmd.exe"
                    ],
                    "ParentCommandLine|contains|all": [
                        "MsiExec.exe",
                        "-Embedding "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4a2a2c3e-209f-4d01-b513-4155a540b469",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/07/14",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.007/T1218.007.md"
            ],
            "status": "test",
            "tags": [
                "attack.t1218.007",
                "attack.defense_evasion"
            ],
            "title": "Suspicious MsiExec Embedding Parent"
        },
        {
            "author": "frack113",
            "date": "2022/04/24",
            "description": "Detects MsiExec loading a DLL and calling its DllUnregisterServer function",
            "detection": {
                "condition": "all of selection_*",
                "selection_dll": {
                    "CommandLine|contains": ".dll"
                },
                "selection_flag": {
                    "CommandLine|contains|windash": " -z "
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\msiexec.exe"
                    },
                    {
                        "OriginalFileName": "\\msiexec.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "84f52741-8834-4a8c-a413-2eb2269aa6c8",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.007/T1218.007.md",
                "https://lolbas-project.github.io/lolbas/Binaries/Msiexec/",
                "https://twitter.com/_st0pp3r_/status/1583914515996897281"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.007"
            ],
            "title": "DllUnregisterServer Function Call Via Msiexec.EXE"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/02/09",
            "description": "Detects suspicious msiexec process starts with web addresses as parameter",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        " msiexec",
                        "://"
                    ]
                }
            },
            "falsepositives": [
                "False positives depend on scripts and administrative tools used in the monitored environment"
            ],
            "id": "f7b5f842-a6af-4da5-9e95-e32478f3cd2f",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/01/07",
            "references": [
                "https://blog.trendmicro.com/trendlabs-security-intelligence/attack-using-windows-installer-msiexec-exe-leads-lokibot/"
            ],
            "related": [
                {
                    "id": "8150732a-0c9d-4a99-82b9-9efb9b90c40c",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.007",
                "attack.command_and_control",
                "attack.t1105"
            ],
            "title": "MsiExec Web Install"
        },
        {
            "id": "8150732a-0c9d-4a99-82b9-9efb9b90c40c",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/28",
            "description": "Detects usage of Msiexec.exe to install packages hosted remotely quietly",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|windash": [
                        "-i",
                        "-package",
                        "-a",
                        "-j"
                    ]
                },
                "selection_remote": {
                    "CommandLine|contains": [
                        "http",
                        "\\\\\\\\"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\msiexec.exe"
                    },
                    {
                        "OriginalFileName": "msiexec.exe"
                    }
                ],
                "selection_quiet": {
                    "CommandLine|contains|windash": "-q"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://www.microsoft.com/en-us/security/blog/2022/10/27/raspberry-robin-worm-part-of-larger-ecosystem-facilitating-pre-ransomware-activity/"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "f7b5f842-a6af-4da5-9e95-e32478f3cd2f"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.007"
            ],
            "title": "Suspicious Msiexec Quiet Install From Remote Location"
        },
        {
            "author": "Stamatis Chatzimangou",
            "date": "2022/10/23",
            "description": "Detects installation of a remote msi file from web.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Data|contains": "://",
                    "EventID": [
                        1040,
                        1042
                    ],
                    "Provider_Name": "MsiInstaller"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5594e67a-7f92-4a04-b65d-1a42fd824a60",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "application"
            },
            "modified": "2022/10/23",
            "references": [
                "https://twitter.com/_st0pp3r_/status/1583922009842802689"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218",
                "attack.t1218.007"
            ],
            "title": "MSI Installation From Web"
        },
        {
            "author": "frack113",
            "date": "2022/04/24",
            "description": "Detects the execution of an MSI file using PowerShell and the WMI Win32_Product class",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Invoke-CimMethod ",
                        "-ClassName ",
                        "Win32_Product ",
                        "-MethodName ",
                        ".msi"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "91109523-17f0-4248-a800-f81d9e7c081d",
            "level": "medium",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1218.007/T1218.007.md"
            ],
            "status": "test",
            "title": "PowerShell WMI Win32_Product Install MSI",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.007"
            ]
        }
    ]
}