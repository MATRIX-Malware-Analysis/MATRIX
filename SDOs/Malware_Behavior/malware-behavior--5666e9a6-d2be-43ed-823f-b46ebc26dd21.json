{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--5666e9a6-d2be-43ed-823f-b46ebc26dd21",
    "created": "2024-08-13T14:46:36.906987Z",
    "modified": "2024-08-13T14:46:48.381305Z",
    "name": "Inhibit System Recovery",
    "description": "Adversaries may delete or remove built-in data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery.[1][2] This may deny access to available backups and recovery options.Operating systems may contain features that can help fix corrupted systems, such as a backup catalog, volume shadow copies, and automatic repair features. Adversaries may disable or delete system recovery features to augment the effects of Data Destruction and Data Encrypted for Impact.[1][2] Furthermore, adversaries may disable recovery notifications, then corrupt backups.[3]A number of native Windows utilities have been used by adversaries to disable or delete system recovery features:vssadmin.exe can be used to delete all volume shadow copies on a system - vssadmin.exe delete shadows /all /quietWindows Management Instrumentation can be used to delete volume shadow copies - wmic shadowcopy deletewbadmin.exe can be used to delete the Windows Backup Catalog - wbadmin.exe delete catalog -quietbcdedit.exe can be used to disable automatic Windows recovery features by modifying boot configuration data - bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures & bcdedit /set {default} recoveryenabled noREAgentC.exe can be used to disable Windows Recovery Environment (WinRE) repair/recovery options of an infected systemdiskshadow.exe can be used to delete all volume shadow copies on a system - diskshadow delete shadows all [4] [5]On network devices, adversaries may leverage Disk Wipe to delete backup firmware images and reformat the file system, then System Shutdown/Reboot to reload the device. Together this activity may leave network devices completely inoperable and inhibit recovery operations.Adversaries may also delete 'online' backups that are connected to their network \u2013 whether via network storage media or through folders that sync to cloud services.[6] In cloud environments, adversaries may disable versioning and backup policies and delete snapshots, machine images, and prior versions of objects designed to be used in disaster recovery scenarios.[7][8]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1490",
            "external_id": "T1490"
        },
        {
            "source_name": "mitre-attack",
            "url": "https://attack.mitre.org/techniques/T1490",
            "external_id": "T1490"
        },
        {
            "source_name": "Dark Reading Code Spaces Cyber Attack",
            "description": " Brian Prince. (2014, June 20). Code Hosting Service Shuts Down After Cyber Attack. Retrieved March 21, 2023.",
            "url": "https://www.darkreading.com/attacks-breaches/code-hosting-service-shuts-down-after-cyber-attack"
        },
        {
            "source_name": "FireEye WannaCry 2017",
            "description": "Berry, A., Homan, J., and Eitzman, R. (2017, May 23). WannaCry Malware Profile. Retrieved March 15, 2019.",
            "url": "https://www.fireeye.com/blog/threat-research/2017/05/wannacry-malware-profile.html"
        },
        {
            "source_name": "Talos Olympic Destroyer 2018",
            "description": "Mercer, W. and Rascagneres, P. (2018, February 12). Olympic Destroyer Takes Aim At Winter Olympics. Retrieved March 14, 2019.",
            "url": "https://blog.talosintelligence.com/2018/02/olympic-destroyer.html"
        },
        {
            "source_name": "Diskshadow",
            "description": "Microsoft Windows Server. (2023, February 3). Diskshadow. Retrieved November 21, 2023.",
            "url": "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/diskshadow"
        },
        {
            "source_name": "Crytox Ransomware",
            "description": "Romain Dumont . (2022, September 21). Technical Analysis of Crytox Ransomware. Retrieved November 22, 2023.",
            "url": "https://www.zscaler.com/blogs/security-research/technical-analysis-crytox-ransomware"
        },
        {
            "source_name": "Rhino Security Labs AWS S3 Ransomware",
            "description": "Spencer Gietzen. (n.d.). AWS Simple Storage Service S3 Ransomware Part 2: Prevention and Defense. Retrieved March 21, 2023.",
            "url": "https://rhinosecuritylabs.com/aws/s3-ransomware-part-2-prevention-and-defense/"
        },
        {
            "source_name": "ZDNet Ransomware Backups 2020",
            "description": "Steve Ranger. (2020, February 27). Ransomware victims thought their backups were safe. They were wrong. Retrieved March 21, 2023.",
            "url": "https://www.zdnet.com/article/ransomware-victims-thought-their-backups-were-safe-they-were-wrong/"
        },
        {
            "source_name": "disable_notif_synology_ransom",
            "description": "TheDFIRReport. (2022, March 1). Disabling notifications on Synology servers before ransom. Retrieved October 19, 2022.",
            "url": "https://twitter.com/TheDFIRReport/status/1498657590259109894"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "string": "/vssadmin.* delete shadows/i"
                            },
                            {
                                "string": "/vssadmin.* resize shadowstorage/i"
                            },
                            {
                                "string": "/wmic.* shadowcopy delete/i"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Impact::Inhibit System Recovery [T1490]",
                        "Defense Evasion::Indicator Removal::File Deletion [T1070.004]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "B87E9DD18A5533A09D3E48A7A1EFBCF6:0x140006AF0"
                    ],
                    "mbc": [
                        "Impact::Data Destruction::Delete Shadow Copies [E1485.m04]"
                    ],
                    "name": "delete volume shadow copies",
                    "namespace": "impact/inhibit-system-recovery",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "os": "windows"
                            },
                            {
                                "string": "/wbadmin(\\.exe)?\\s+delete\\s+catalog/i"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Impact::Inhibit System Recovery [T1490]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "name": "delete Windows backup catalog",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    },
                    "namespace": "impact/inhibit-system-recovery"
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "os": "windows"
                            },
                            {
                                "or": [
                                    {
                                        "description": "ignore errors and boot normally even if there is a failed boot, shutdown, or checkpoint",
                                        "string": "/bcdedit(\\.exe)?\\s+/set\\s+{default}\\s+bootstatuspolicy\\s+ignoreallfailures/i"
                                    },
                                    {
                                        "description": "disable automatic repair",
                                        "string": "/bcdedit(\\.exe)?\\s+/set\\s+{default}\\s+recoveryenabled\\s+no/i"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Impact::Inhibit System Recovery [T1490]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "name": "disable automatic Windows recovery features",
                    "scopes": {
                        "dynamic": "call",
                        "static": "basic block"
                    },
                    "namespace": "impact/inhibit-system-recovery"
                }
            }
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Sean Johnstone | Unit 42",
            "date": "2023/10/28",
            "description": "Detects when S3 bucket versioning is disabled. Threat actors use this technique during AWS ransomware incidents prior to deleting S3 objects.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": "PutBucketVersioning",
                    "eventSource": "s3.amazonaws.com",
                    "requestParameters|contains": "Suspended"
                }
            },
            "falsepositives": [
                "AWS administrator legitimately disabling bucket versioning"
            ],
            "id": "a136ac98-b2bc-4189-a14d-f0d0388e57a7",
            "level": "medium",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "references": [
                "https://invictus-ir.medium.com/ransomware-in-the-cloud-7f14805bbe82"
            ],
            "status": "experimental",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "AWS S3 Bucket Versioning Disable"
        },
        {
            "author": "Austin Clark",
            "date": "2019/08/12",
            "description": "Modifications to a config that will serve an adversary's impacts or persistence",
            "detection": {
                "condition": "keywords",
                "keywords": [
                    "ip http server",
                    "ip https server",
                    "kron policy-list",
                    "kron occurrence",
                    "policy-list",
                    "access-list",
                    "ip access-group",
                    "archive maximum"
                ]
            },
            "falsepositives": [
                "Legitimate administrators may run these commands"
            ],
            "fields": [
                "CmdSet"
            ],
            "id": "671ffc77-50a7-464f-9e3d-9ea2b493b26b",
            "level": "medium",
            "logsource": {
                "product": "cisco",
                "service": "aaa"
            },
            "modified": "2023/01/04",
            "status": "test",
            "tags": [
                "attack.persistence",
                "attack.impact",
                "attack.t1490",
                "attack.t1505",
                "attack.t1565.002",
                "attack.t1053"
            ],
            "title": "Cisco Modify Configuration"
        },
        {
            "author": "Pratinav Chandra",
            "date": "2024/05/29",
            "description": "Detects the addition of a new file or path exclusion to MacOS Time Machine via the \"tmutil\" utility.\nAn adversary could exclude a path from Time Machine backups to prevent certain files from being backed up.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmd": {
                    "CommandLine|contains": "addexclusion"
                },
                "selection_img": [
                    {
                        "Image|endswith": "/tmutil"
                    },
                    {
                        "CommandLine|contains": "tmutil"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrator activity"
            ],
            "id": "9acf45ed-3a26-4062-bf08-56857613eb52",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-12---disable-time-machine",
                "https://www.loobins.io/binaries/tmutil/"
            ],
            "status": "experimental",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "New File Exclusion Added To Time Machine Via Tmutil - MacOS"
        },
        {
            "author": "Pratinav Chandra",
            "date": "2024/05/29",
            "description": "Detects disabling of Time Machine (Apple's automated backup utility software) via the native macOS backup utility \"tmutil\".\nAn attacker can use this to prevent backups from occurring.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmd": {
                    "CommandLine|contains": "disable"
                },
                "selection_img": [
                    {
                        "Image|endswith": "/tmutil"
                    },
                    {
                        "CommandLine|contains": "tmutil"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate administrator activity"
            ],
            "id": "2c95fa8a-8b8d-4787-afce-7117ceb8e3da",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-12---disable-time-machine",
                "https://www.loobins.io/binaries/tmutil/"
            ],
            "status": "experimental",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Time Machine Backup Disabled Via Tmutil - MacOS"
        },
        {
            "author": "Pratinav Chandra",
            "date": "2024/05/29",
            "description": "Detects deletion attempts of MacOS Time Machine backups via the native backup utility \"tmutil\".\nAn adversary may perform this action before launching a ransonware attack to prevent the victim from restoring their files.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cmd": {
                    "CommandLine|contains": "delete"
                },
                "selection_img": [
                    {
                        "Image|endswith": "/tmutil"
                    },
                    {
                        "CommandLine|contains": "tmutil"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate activities"
            ],
            "id": "452df256-da78-427a-866f-49fa04417d74",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "macos"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1490/T1490.md#atomic-test-12---disable-time-machine",
                "https://www.loobins.io/binaries/tmutil/"
            ],
            "status": "experimental",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Time Machine Backup Deletion Attempt Via Tmutil - MacOS"
        },
        {
            "author": "frack113",
            "date": "2023/02/17",
            "description": "Detects the image load of VSS DLL by uncommon executables",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_program_files": {
                    "Image|startswith": [
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "filter_windows": [
                    {
                        "Image": [
                            "C:\\Windows\\explorer.exe",
                            "C:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe"
                        ]
                    },
                    {
                        "Image|startswith": [
                            "C:\\Windows\\System32\\",
                            "C:\\Windows\\SysWOW64\\",
                            "C:\\Windows\\Temp\\{",
                            "C:\\Windows\\WinSxS\\"
                        ]
                    }
                ],
                "selection": {
                    "ImageLoaded|endswith": "\\vsstrace.dll"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "48bfd177-7cf2-412b-ad77-baf923489e82",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/03/28",
            "references": [
                "https://github.com/ORCx41/DeleteShadowCopies"
            ],
            "related": [
                {
                    "id": "333cdbe8-27bb-4246-bf82-b41a0dca4b70",
                    "type": "similar"
                },
                {
                    "id": "37774c23-25a1-4adb-bb6d-8bb9fd59c0f8",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Suspicious Volume Shadow Copy Vsstrace.dll Load"
        },
        {
            "id": "37774c23-25a1-4adb-bb6d-8bb9fd59c0f8",
            "author": "frack113",
            "date": "2022/10/31",
            "description": "Detects the image load of VSS DLL by uncommon executables",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_program_files": {
                    "Image|startswith": [
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "filter_windows": [
                    {
                        "Image": [
                            "C:\\Windows\\explorer.exe",
                            "C:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe"
                        ]
                    },
                    {
                        "Image|startswith": [
                            "C:\\Windows\\System32\\",
                            "C:\\Windows\\SysWOW64\\",
                            "C:\\Windows\\Temp\\{",
                            "C:\\Windows\\WinSxS\\"
                        ]
                    }
                ],
                "filter_programdata_packagecache": {
                    "Image|startswith": "C:\\ProgramData\\Package Cache\\"
                },
                "selection": {
                    "ImageLoaded|endswith": "\\vssapi.dll"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/05/03",
            "references": [
                "https://github.com/ORCx41/DeleteShadowCopies"
            ],
            "related": [
                {
                    "id": "333cdbe8-27bb-4246-bf82-b41a0dca4b70",
                    "type": "similar"
                },
                {
                    "type": "similar",
                    "id": "48bfd177-7cf2-412b-ad77-baf923489e82"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Suspicious Volume Shadow Copy Vssapi.dll Load"
        },
        {
            "id": "333cdbe8-27bb-4246-bf82-b41a0dca4b70",
            "author": "Markus Neis, @markus_neis",
            "date": "2021/07/07",
            "description": "Detects the image load of vss_ps.dll by uncommon executables",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_image_null": {
                    "Image": null
                },
                "filter_legit": {
                    "Image|endswith": [
                        "\\clussvc.exe",
                        "\\dismhost.exe",
                        "\\dllhost.exe",
                        "\\inetsrv\\appcmd.exe",
                        "\\inetsrv\\iissetup.exe",
                        "\\msiexec.exe",
                        "\\rundll32.exe",
                        "\\searchindexer.exe",
                        "\\srtasks.exe",
                        "\\svchost.exe",
                        "\\System32\\SystemPropertiesAdvanced.exe",
                        "\\taskhostw.exe",
                        "\\thor.exe",
                        "\\thor64.exe",
                        "\\tiworker.exe",
                        "\\vssvc.exe",
                        "\\WmiPrvSE.exe",
                        "\\wsmprovhost.exe"
                    ],
                    "Image|startswith": "C:\\Windows\\"
                },
                "filter_programfiles": {
                    "Image|startswith": [
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "filter_update": {
                    "CommandLine|contains": "\\dismhost.exe {",
                    "CommandLine|startswith": "C:\\$WinREAgent\\Scratch\\"
                },
                "selection": {
                    "ImageLoaded|endswith": "\\vss_ps.dll"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2024/03/28",
            "references": [
                "https://www.virustotal.com/gui/file/ba88ca45589fae0139a40ca27738a8fc2dfbe1be5a64a9558f4e0f52b35c5add",
                "https://twitter.com/am0nsec/status/1412232114980982787"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "48bfd177-7cf2-412b-ad77-baf923489e82"
                },
                {
                    "id": "37774c23-25a1-4adb-bb6d-8bb9fd59c0f8",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Suspicious Volume Shadow Copy VSS_PS.dll Load"
        },
        {
            "author": "frack113",
            "date": "2022/01/02",
            "description": "Detects deletion of files with extensions often used for backup files. Adversaries may delete or remove built-in operating system data and turn off services designed to aid in the recovery of a corrupted system to prevent recovery.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "\\cmd.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\wt.exe",
                        "\\rundll32.exe",
                        "\\regsvr32.exe"
                    ],
                    "TargetFilename|endswith": [
                        ".VHD",
                        ".bac",
                        ".bak",
                        ".wbcat",
                        ".bkf",
                        ".set",
                        ".win",
                        ".dsk"
                    ]
                }
            },
            "falsepositives": [
                "Legitime usage"
            ],
            "id": "06125661-3814-4e03-bfa2-1e4411c60ac3",
            "level": "medium",
            "logsource": {
                "category": "file_delete",
                "product": "windows"
            },
            "modified": "2023/02/15",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-6---windows---delete-backup-files"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Backup Files Deleted"
        },
        {
            "author": "Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)",
            "date": "2021/08/09",
            "description": "Detects a command that accesses the VolumeShadowCopy in order to extract sensitive files such as the Security or SAM registry hives or the AD database (ntds.dit)\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_1": {
                    "CommandLine|contains": "\\\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy"
                },
                "selection_2": {
                    "CommandLine|contains": [
                        "\\\\NTDS.dit",
                        "\\\\SYSTEM",
                        "\\\\SECURITY"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "f57f8d16-1f39-4dcb-a604-6c73d9b54b3d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/01/18",
            "references": [
                "https://twitter.com/vxunderground/status/1423336151860002816?s=20",
                "https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection",
                "https://pentestlab.blog/2018/07/04/dumping-domain-password-hashes/"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Sensitive File Access Via Volume Shadow Copy Backup"
        },
        {
            "author": "Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)",
            "date": "2021/08/09",
            "description": "Detects the execution of the builtin \"copy\" command that targets a shadow copy (sometimes used to copy registry hives that are in use)",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains|all": [
                        "copy ",
                        "\\\\\\\\\\?\\\\GLOBALROOT\\\\Device\\\\HarddiskVolumeShadowCopy"
                    ]
                }
            },
            "falsepositives": [
                "Backup scenarios using the commandline"
            ],
            "id": "c73124a7-3e89-44a3-bdc1-25fe4df754b1",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/07",
            "references": [
                "https://twitter.com/vxunderground/status/1423336151860002816?s=20",
                "https://www.virustotal.com/gui/file/03e9b8c2e86d6db450e5eceec057d7e369ee2389b9daecaf06331a95410aa5f8/detection",
                "https://pentestlab.blog/2018/07/04/dumping-domain-password-hashes/"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Copy From VolumeShadowCopy Via Cmd.EXE"
        },
        {
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/12/13",
            "description": "Detects the deletion of backups or system state backups via \"wbadmin.exe\".\nThis technique is used by numerous ransomware families and actors.\nThis may only be successful on server platforms that have Windows Backup enabled.\n",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_main_*",
                "filter_main_keep_versions": {
                    "CommandLine|contains": "keepVersions:0"
                },
                "selection_cli": {
                    "CommandLine|contains|all": [
                        "delete ",
                        "backup"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\wbadmin.exe"
                    },
                    {
                        "OriginalFileName": "WBADMIN.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate backup activity from administration scripts and software."
            ],
            "id": "89f75308-5b1b-4390-b2d8-d6b2340efaf8",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/05/10",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell",
                "https://github.com/albertzsigovits/malware-notes/blob/558898932c1579ff589290092a2c8febefc3a4c9/Ransomware/Lockbit.md",
                "https://www.sentinelone.com/labs/ranzy-ransomware-better-encryption-among-new-features-of-thunderx-derivative/",
                "https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/ransomware-report-avaddon-and-new-techniques-emerge-industrial-sector-targeted",
                "https://www.trendmicro.com/content/dam/trendmicro/global/en/research/24/b/lockbit-attempts-to-stay-afloat-with-a-new-version/technical-appendix-lockbit-ng-dev-analysis.pdf",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wbadmin-delete-systemstatebackup"
            ],
            "related": [
                {
                    "id": "639c9081-f482-47d3-a0bd-ddee3d4ecd76",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Windows Backup Deleted Via Wbadmin.EXE"
        },
        {
            "author": "Florian Roth (Nextron Systems), Michael Haag, Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community, Andreas Hunkeler (@Karneades)",
            "date": "2019/10/22",
            "description": "Shadow Copies deletion using operating systems utilities",
            "detection": {
                "condition": "(all of selection1*) or (all of selection2*) or (all of selection3*)",
                "selection1_cli": {
                    "CommandLine|contains|all": [
                        "shadow",
                        "delete"
                    ]
                },
                "selection1_img": [
                    {
                        "Image|endswith": [
                            "\\powershell.exe",
                            "\\pwsh.exe",
                            "\\wmic.exe",
                            "\\vssadmin.exe",
                            "\\diskshadow.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "PowerShell.EXE",
                            "pwsh.dll",
                            "wmic.exe",
                            "VSSADMIN.EXE",
                            "diskshadow.exe"
                        ]
                    }
                ],
                "selection2_cli": {
                    "CommandLine|contains|all": [
                        "delete",
                        "catalog",
                        "quiet"
                    ]
                },
                "selection2_img": [
                    {
                        "Image|endswith": "\\wbadmin.exe"
                    },
                    {
                        "OriginalFileName": "WBADMIN.EXE"
                    }
                ],
                "selection3_cli": {
                    "CommandLine|contains": [
                        "unbounded",
                        "/MaxSize="
                    ],
                    "CommandLine|contains|all": [
                        "resize",
                        "shadowstorage"
                    ]
                },
                "selection3_img": [
                    {
                        "Image|endswith": "\\vssadmin.exe"
                    },
                    {
                        "OriginalFileName": "VSSADMIN.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason",
                "LANDesk LDClient Ivanti-PSModule (PS EncodedCommand)"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "c947b146-0abc-4c87-9c64-b17e9d7274a2",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/11/03",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://blog.talosintelligence.com/2017/05/wannacry.html",
                "https://securingtomorrow.mcafee.com/other-blogs/mcafee-labs/new-teslacrypt-ransomware-arrives-via-spam/",
                "https://www.bleepingcomputer.com/news/security/why-everyone-should-disable-vssadmin-exe-now/",
                "https://www.hybrid-analysis.com/sample/ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa?environmentId=100",
                "https://github.com/Neo23x0/Raccine#the-process",
                "https://github.com/Neo23x0/Raccine/blob/20a569fa21625086433dcce8bb2765d0ea08dcb6/yara/gen_ransomware_command_lines.yar",
                "https://redcanary.com/blog/intelligence-insights-october-2021/",
                "https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/blackbyte-exbyte-ransomware"
            ],
            "status": "stable",
            "tags": [
                "attack.defense_evasion",
                "attack.impact",
                "attack.t1070",
                "attack.t1490"
            ],
            "title": "Shadow Copies Deletion Using Operating Systems Utilities"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), frack113",
            "date": "2024/05/10",
            "description": "Detects the recovery of files from backups via \"wbadmin.exe\".\nAttackers can restore sensitive files such as NTDS.DIT or Registry Hives from backups in order to potentially extract credentials.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains|all": [
                        " recovery",
                        "recoveryTarget",
                        "itemtype:File"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\wbadmin.exe"
                    },
                    {
                        "OriginalFileName": "WBADMIN.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "6fe4aa1e-0531-4510-8be2-782154b73b48",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wbadmin-start-recovery",
                "https://lolbas-project.github.io/lolbas/Binaries/Wbadmin/"
            ],
            "related": [
                {
                    "id": "84972c80-251c-4c3a-9079-4f00aad93938",
                    "type": "derived"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "File Recovery From Backup Via Wbadmin.EXE"
        },
        {
            "author": "E.M. Anhaus (originally from Atomic Blue Detections, Endgame), oscd.community",
            "date": "2019/10/24",
            "description": "Detects the use of the bcdedit command to tamper with the boot configuration data. This technique is often times used by malware or attackers as a destructive way before launching ransomware.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": [
                    {
                        "CommandLine|contains|all": [
                            "bootstatuspolicy",
                            "ignoreallfailures"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "recoveryenabled",
                            "no"
                        ]
                    }
                ],
                "selection_img": [
                    {
                        "Image|endswith": "\\bcdedit.exe"
                    },
                    {
                        "OriginalFileName": "bcdedit.exe"
                    }
                ],
                "selection_set": {
                    "CommandLine|contains": "set"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "fields": [
                "ComputerName",
                "User",
                "CommandLine"
            ],
            "id": "1444443e-6757-43e4-9ea4-c8fc705f79a2",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/15",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md",
                "https://eqllib.readthedocs.io/en/latest/analytics/c4732632-9c1d-4980-9fa8-1d98c93f918e.html"
            ],
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "status": "stable",
            "title": "Boot Configuration Tampering Via Bcdedit.EXE"
        },
        {
            "author": "Tim Rauch, Elastic (idea)",
            "date": "2022/09/20",
            "description": "Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil",
            "detection": {
                "condition": "all of selection*",
                "selection_delete": {
                    "CommandLine|contains": [
                        ".Delete()",
                        "Remove-WmiObject",
                        "rwmi",
                        "Remove-CimInstance",
                        "rcim"
                    ]
                },
                "selection_get": {
                    "CommandLine|contains": [
                        "Get-WmiObject",
                        "gwmi",
                        "Get-CimInstance",
                        "gcim"
                    ]
                },
                "selection_shadowcopy": {
                    "CommandLine|contains": "Win32_ShadowCopy"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "21ff4ca9-f13a-41ad-b828-0077b2af2e40",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/12/30",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell",
                "https://www.elastic.co/guide/en/security/current/volume-shadow-copy-deletion-via-powershell.html"
            ],
            "related": [
                {
                    "id": "e17121b4-ef2a-4418-8a59-12fb1631fa9e",
                    "type": "derived"
                },
                {
                    "id": "c1337eb8-921a-4b59-855b-4ba188ddcc42",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Deletion of Volume Shadow Copies via WMI with PowerShell"
        },
        {
            "id": "639c9081-f482-47d3-a0bd-ddee3d4ecd76",
            "author": "frack113, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/12/13",
            "description": "Detects the deletion of all backups or system state backups via \"wbadmin.exe\".\nThis technique is used by numerous ransomware families and actors.\nThis may only be successful on server platforms that have Windows Backup enabled.\n",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": "keepVersions:0",
                    "CommandLine|contains|all": [
                        "delete",
                        "backup"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\wbadmin.exe"
                    },
                    {
                        "OriginalFileName": "WBADMIN.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/05/10",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell",
                "https://github.com/albertzsigovits/malware-notes/blob/558898932c1579ff589290092a2c8febefc3a4c9/Ransomware/Lockbit.md",
                "https://www.sentinelone.com/labs/ranzy-ransomware-better-encryption-among-new-features-of-thunderx-derivative/",
                "https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/ransomware-report-avaddon-and-new-techniques-emerge-industrial-sector-targeted",
                "https://www.trendmicro.com/content/dam/trendmicro/global/en/research/24/b/lockbit-attempts-to-stay-afloat-with-a-new-version/technical-appendix-lockbit-ng-dev-analysis.pdf",
                "https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/wbadmin-delete-systemstatebackup"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "89f75308-5b1b-4390-b2d8-d6b2340efaf8"
                }
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "All Backups Deleted Via Wbadmin.EXE"
        },
        {
            "author": "frack113",
            "date": "2021/06/03",
            "description": "Shadow Copies deletion using operating systems utilities via PowerShell",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Data|contains": [
                        "Delete()",
                        "Remove-WmiObject"
                    ],
                    "Data|contains|all": [
                        "Get-WmiObject",
                        "Win32_ShadowCopy"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate Administrator deletes Shadow Copies using operating systems utilities for legitimate reason"
            ],
            "id": "87df9ee1-5416-453a-8a08-e8d4a51e9ce1",
            "level": "high",
            "logsource": {
                "category": "ps_classic_start",
                "product": "windows"
            },
            "modified": "2023/10/27",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md",
                "https://www.fortinet.com/blog/threat-research/stomping-shadow-copies-a-second-look-into-deletion-methods"
            ],
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "status": "stable",
            "title": "Delete Volume Shadow Copies Via WMI With PowerShell"
        },
        {
            "id": "e17121b4-ef2a-4418-8a59-12fb1631fa9e",
            "author": "frack113",
            "date": "2021/12/26",
            "description": "Deletes Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains|all": [
                        "Get-WmiObject",
                        "Win32_ShadowCopy",
                        ".Delete()"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/02",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Delete Volume Shadow Copies via WMI with PowerShell - PS Script"
        },
        {
            "id": "c1337eb8-921a-4b59-855b-4ba188ddcc42",
            "author": "Tim Rauch",
            "date": "2022/09/20",
            "description": "Detects deletion of Windows Volume Shadow Copies with PowerShell code and Get-WMIObject. This technique is used by numerous ransomware families such as Sodinokibi/REvil",
            "detection": {
                "condition": "all of selection*",
                "selection_delete": {
                    "ScriptBlockText|contains": [
                        ".Delete()",
                        "Remove-WmiObject",
                        "rwmi",
                        "Remove-CimInstance",
                        "rcim"
                    ]
                },
                "selection_get": {
                    "ScriptBlockText|contains": [
                        "Get-WmiObject",
                        "gwmi",
                        "Get-CimInstance",
                        "gcim"
                    ]
                },
                "selection_shadowcopy": {
                    "ScriptBlockText|contains": "Win32_ShadowCopy"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows"
            },
            "modified": "2022/12/02",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-5---windows---delete-volume-shadow-copies-via-wmi-with-powershell",
                "https://www.elastic.co/guide/en/security/current/volume-shadow-copy-deletion-via-powershell.html"
            ],
            "related": [
                {
                    "id": "e17121b4-ef2a-4418-8a59-12fb1631fa9e",
                    "type": "derived"
                },
                {
                    "type": "similar",
                    "id": "21ff4ca9-f13a-41ad-b828-0077b2af2e40"
                }
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Deletion of Volume Shadow Copies via WMI with PowerShell - PS Script"
        },
        {
            "author": "frack113",
            "date": "2022/04/04",
            "description": "Detects the addition of new root, CA or AuthRoot certificates to the Windows registry",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "Binary Data",
                    "TargetObject|contains": [
                        "\\SOFTWARE\\Microsoft\\SystemCertificates\\Root\\Certificates\\",
                        "\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\Root\\Certificates\\",
                        "\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\Root\\Certificates\\",
                        "\\SOFTWARE\\Microsoft\\SystemCertificates\\CA\\Certificates\\",
                        "\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\CA\\Certificates\\",
                        "\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\CA\\Certificates\\",
                        "\\SOFTWARE\\Microsoft\\SystemCertificates\\AuthRoot\\Certificates\\",
                        "\\SOFTWARE\\Policies\\Microsoft\\SystemCertificates\\AuthRoot\\Certificates\\",
                        "\\SOFTWARE\\Microsoft\\EnterpriseCertificates\\AuthRoot\\Certificates\\"
                    ],
                    "TargetObject|endswith": "\\Blob"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "d223b46b-5621-4037-88fe-fda32eead684",
            "level": "medium",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1553.004/T1553.004.md#atomic-test-6---add-root-certificate-to-currentuser-certificate-store",
                "https://posts.specterops.io/code-signing-certificate-cloning-attacks-and-defenses-6f98657fc6ec"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "New Root or CA or AuthRoot Certificate to Store"
        },
        {
            "author": "frack113",
            "date": "2022/04/04",
            "description": "Detects the modification of the registry to disable a system restore on the computer",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "DWORD (0x00000001)",
                    "TargetObject|contains": [
                        "\\Policies\\Microsoft\\Windows NT\\SystemRestore",
                        "\\Microsoft\\Windows NT\\CurrentVersion\\SystemRestore"
                    ],
                    "TargetObject|endswith": [
                        "DisableConfig",
                        "DisableSR"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5de03871-5d46-4539-a82d-3aa992a69a83",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md#atomic-test-9---disable-system-restore-through-registry"
            ],
            "status": "test",
            "tags": [
                "attack.impact",
                "attack.t1490"
            ],
            "title": "Registry Disable System Restore"
        }
    ],
    "x_mitre_platforms": [
        "Windows",
        "macOS",
        "Linux",
        "Network",
        "IaaS",
        "Containers"
    ],
    "x_mitre_domains": [
        "enterprise-attack"
    ],
    "x_mitre_contributors": [
        "Yonatan Gotlib, Deep Instinct",
        "Austin Clark, @c2defense",
        "Pallavi Sivakumaran, WithSecure",
        "Joey Lei",
        "Harjot Shah Singh"
    ],
    "kill_chain_phases": [
        {
            "kill_chain_name": "mitre-attack",
            "phase_name": "impact"
        }
    ],
    "x_mitre_detection": "Use process monitoring to monitor the execution and command line parameters of binaries involved in inhibiting system recovery, such as vssadmin, wbadmin, bcdedit, REAgentC, and diskshadow. The Windows event logs, ex. Event ID 524 indicating a system catalog was deleted, may contain entries associated with suspicious activity.\n\nMonitor the status of services involved in system recovery. Monitor the registry for changes associated with system recovery features (ex: the creation of <code>HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\PreviousVersions\\DisableLocalPage</code>).\n\nFor network infrastructure devices, collect AAA logging to monitor for `erase`, `format`, and `reload` commands being run in succession.",
    "x_mitre_is_subtechnique": false,
    "x_mitre_version": "1.4",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5",
    "x_mitre_data_sources": [
        "Process: Process Creation",
        "Windows Registry: Windows Registry Key Modification",
        "Cloud Storage: Cloud Storage Deletion",
        "Command: Command Execution",
        "Service: Service Metadata",
        "Snapshot: Snapshot Deletion",
        "File: File Deletion"
    ],
    "x_mitre_permissions_required": []
}