{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--1ee47efe-ae91-423d-bba6-5c95b6e3d555",
    "created": "2024-08-13T14:46:37.125306Z",
    "modified": "2024-08-13T14:46:46.165879Z",
    "name": "Command and Scripting Interpreter: Cloud API",
    "description": "Adversaries may abuse cloud APIs to execute malicious commands. APIs available in cloud environments provide various functionalities and are a feature-rich method for programmatic access to nearly all aspects of a tenant. These APIs may be utilized through various methods such as command line interpreters (CLIs), in-browser Cloud Shells, PowerShell modules like Azure for PowerShell[1], or software developer kits (SDKs) available for languages such as Python.  Cloud API functionality may allow for administrative access across all major services in a tenant such as compute, storage, identity and access management (IAM), networking, and security policies.With proper permissions (often via use of credentials such as Application Access Token and Web Session Cookie), adversaries may abuse cloud APIs to invoke various functions that execute malicious actions. For example, CLI and PowerShell functionality may be accessed through binaries installed on cloud-hosted or on-premises hosts or accessed through a browser-based cloud shell offered by many cloud platforms (such as AWS, Azure, and GCP). These cloud shells are often a packaged unified environment to use CLI and/or scripting modules hosted as a container in the cloud environment.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1059/009",
            "external_id": "T1059/009"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "daniel.bohannon@permiso.io (@danielhbohannon)",
            "date": "2023/05/17",
            "description": "Detects S3 browser utility creating Inline IAM policy containing default S3 bucket name placeholder value of \"<YOUR-BUCKET-NAME>\".",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": "PutUserPolicy",
                    "eventSource": "iam.amazonaws.com",
                    "requestParameters|contains|all": [
                        "\"arn:aws:s3:::<YOUR-BUCKET-NAME>/*\"",
                        "\"s3:GetObject\"",
                        "\"Allow\""
                    ],
                    "userAgent|contains": "S3 Browser"
                }
            },
            "falsepositives": [
                "Valid usage of S3 browser with accidental creation of default Inline IAM policy without changing default S3 bucket name placeholder value"
            ],
            "id": "db014773-7375-4f4e-b83b-133337c0ffee",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "modified": "2023/05/17",
            "references": [
                "https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1059.009",
                "attack.persistence",
                "attack.t1078.004"
            ],
            "title": "AWS IAM S3Browser Templated S3 Bucket Policy Creation"
        },
        {
            "author": "daniel.bohannon@permiso.io (@danielhbohannon)",
            "date": "2023/05/17",
            "description": "Detects S3 Browser utility creating IAM User or AccessKey.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": [
                        "CreateUser",
                        "CreateAccessKey"
                    ],
                    "eventSource": "iam.amazonaws.com",
                    "userAgent|contains": "S3 Browser"
                }
            },
            "falsepositives": [
                "Valid usage of S3 Browser for IAM User and/or AccessKey creation"
            ],
            "id": "db014773-d9d9-4792-91e5-133337c0ffee",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "references": [
                "https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1059.009",
                "attack.t1078.004"
            ],
            "title": "AWS IAM S3Browser User or AccessKey Creation"
        },
        {
            "author": "daniel.bohannon@permiso.io (@danielhbohannon)",
            "date": "2023/05/17",
            "description": "Detects S3 Browser utility performing reconnaissance looking for existing IAM Users without a LoginProfile defined then (when found) creating a LoginProfile.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "eventName": [
                        "GetLoginProfile",
                        "CreateLoginProfile"
                    ],
                    "eventSource": "iam.amazonaws.com",
                    "userAgent|contains": "S3 Browser"
                }
            },
            "falsepositives": [
                "Valid usage of S3 Browser for IAM LoginProfile listing and/or creation"
            ],
            "id": "db014773-b1d3-46bd-ba26-133337c0ffee",
            "level": "high",
            "logsource": {
                "product": "aws",
                "service": "cloudtrail"
            },
            "references": [
                "https://permiso.io/blog/s/unmasking-guivil-new-cloud-threat-actor"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.persistence",
                "attack.t1059.009",
                "attack.t1078.004"
            ],
            "title": "AWS IAM S3Browser LoginProfile Creation"
        }
    ]
}