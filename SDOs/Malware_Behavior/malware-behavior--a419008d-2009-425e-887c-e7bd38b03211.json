{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--a419008d-2009-425e-887c-e7bd38b03211",
    "created": "2024-08-13T14:46:36.958157Z",
    "modified": "2024-08-13T14:46:45.10738Z",
    "name": "System Binary Proxy Execution: Regsvr32",
    "description": "Adversaries may abuse Regsvr32.exe to proxy execution of malicious code. Regsvr32.exe is a command-line program used to register and unregister object linking and embedding controls, including dynamic link libraries (DLLs), on Windows systems. The Regsvr32.exe binary may also be signed by Microsoft. [1]Malicious usage of Regsvr32.exe may avoid triggering security tools that may not monitor execution of, and modules loaded by, the regsvr32.exe process because of allowlists or false positives from Windows using regsvr32.exe for normal operations. Regsvr32.exe can also be used to specifically bypass application control using functionality to load COM scriptlets to execute DLLs under user permissions. Since Regsvr32.exe is network and proxy aware, the scripts can be loaded by passing a uniform resource locator (URL) to file on an external Web server as an argument during invocation. This method makes no changes to the Registry as the COM object is not actually registered, only executed. [2] This variation of the technique is often referred to as a 'Squiblydoo' and has been used in campaigns targeting governments. [3] [4]Regsvr32.exe can also be leveraged to register a COM Object used to establish persistence via Component Object Model Hijacking. [3]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1218/010",
            "external_id": "T1218/010"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Dmitriy Lifanov, oscd.community",
            "date": "2019/10/25",
            "description": "Detects DNS queries initiated by \"Regsvr32.exe\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\regsvr32.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "36e037c4-c228-4866-b6a3-48eb292b9955",
            "level": "medium",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "modified": "2023/09/18",
            "references": [
                "https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/",
                "https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/"
            ],
            "related": [
                {
                    "id": "c7e91a02-d771-4a6d-a700-42587e0b1095",
                    "type": "derived"
                }
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1559.001",
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "DNS Query Request By Regsvr32.EXE"
        },
        {
            "id": "c7e91a02-d771-4a6d-a700-42587e0b1095",
            "author": "Dmitriy Lifanov, oscd.community",
            "date": "2019/10/25",
            "description": "Detects a network connection initiated by \"Regsvr32.exe\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\regsvr32.exe",
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2023/09/18",
            "references": [
                "https://pentestlab.blog/2017/05/11/applocker-bypass-regsvr32/",
                "https://oddvar.moe/2017/12/13/applocker-case-study-how-insecure-is-it-really-part-1/"
            ],
            "status": "test",
            "title": "Network Connection Initiated By Regsvr32.EXE",
            "tags": [
                "attack.execution",
                "attack.t1559.001",
                "attack.defense_evasion",
                "attack.t1218.010"
            ]
        },
        {
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2024/02/28",
            "description": "Detects windows utilities loading an unsigned or untrusted DLL.\nAdversaries often abuse those programs to proxy execution of malicious code.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_sig_status": {
                    "SignatureStatus": [
                        "errorChaining",
                        "errorCode_endpoint",
                        "errorExpired",
                        "trusted"
                    ]
                },
                "filter_main_sig_status_empty": {
                    "SignatureStatus": [
                        "",
                        "-"
                    ]
                },
                "filter_main_sig_status_null": {
                    "SignatureStatus": null
                },
                "filter_main_signed": {
                    "Signed": "true"
                },
                "filter_main_signed_empty": {
                    "Signed": [
                        "",
                        "-"
                    ]
                },
                "filter_main_signed_null": {
                    "Signed": null
                },
                "selection": {
                    "Image|endswith": [
                        "\\InstallUtil.exe",
                        "\\RegAsm.exe",
                        "\\RegSvcs.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b5de0c9a-6f19-43e0-af4e-55ad01f550af",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2024/03/07",
            "references": [
                "https://www.elastic.co/security-labs/Hunting-for-Suspicious-Windows-Libraries-for-Execution-and-Evasion",
                "https://akhere.hashnode.dev/hunting-unsigned-dlls-using-kql",
                "https://unit42.paloaltonetworks.com/unsigned-dlls/?web_view=true"
            ],
            "status": "experimental",
            "tags": [
                "attack.t1218.011",
                "attack.t1218.010",
                "attack.defense_evasion"
            ],
            "title": "Unsigned DLL Loaded by Windows Utility"
        },
        {
            "author": "Florian Roth (Nextron Systems), Markus Neis, FPT.EagleEye Team, Vadim Khrykov, Cyb3rEng, Michael Haag, Christopher Peacock @securepeacock, @scythe_io",
            "date": "2018/04/06",
            "description": "Detects a suspicious process spawning from one of the Microsoft Office suite products (Word, Excel, PowerPoint, Publisher, Visio, etc.)",
            "detection": {
                "condition": "selection_parent and 1 of selection_child_*",
                "selection_child_processes": [
                    {
                        "OriginalFileName": [
                            "bitsadmin.exe",
                            "CertOC.exe",
                            "CertUtil.exe",
                            "Cmd.Exe",
                            "CMSTP.EXE",
                            "cscript.exe",
                            "curl.exe",
                            "HH.exe",
                            "IEExec.exe",
                            "InstallUtil.exe",
                            "javaw.exe",
                            "Microsoft.Workflow.Compiler.exe",
                            "msdt.exe",
                            "MSHTA.EXE",
                            "msiexec.exe",
                            "Msxsl.exe",
                            "odbcconf.exe",
                            "pcalua.exe",
                            "PowerShell.EXE",
                            "RegAsm.exe",
                            "RegSvcs.exe",
                            "REGSVR32.exe",
                            "RUNDLL32.exe",
                            "schtasks.exe",
                            "ScriptRunner.exe",
                            "wmic.exe",
                            "WorkFolders.exe",
                            "wscript.exe"
                        ]
                    },
                    {
                        "Image|endswith": [
                            "\\AppVLP.exe",
                            "\\bash.exe",
                            "\\bitsadmin.exe",
                            "\\certoc.exe",
                            "\\certutil.exe",
                            "\\cmd.exe",
                            "\\cmstp.exe",
                            "\\control.exe",
                            "\\cscript.exe",
                            "\\curl.exe",
                            "\\forfiles.exe",
                            "\\hh.exe",
                            "\\ieexec.exe",
                            "\\installutil.exe",
                            "\\javaw.exe",
                            "\\mftrace.exe",
                            "\\Microsoft.Workflow.Compiler.exe",
                            "\\msbuild.exe",
                            "\\msdt.exe",
                            "\\mshta.exe",
                            "\\msidb.exe",
                            "\\msiexec.exe",
                            "\\msxsl.exe",
                            "\\odbcconf.exe",
                            "\\pcalua.exe",
                            "\\powershell.exe",
                            "\\pwsh.exe",
                            "\\regasm.exe",
                            "\\regsvcs.exe",
                            "\\regsvr32.exe",
                            "\\rundll32.exe",
                            "\\schtasks.exe",
                            "\\scrcons.exe",
                            "\\scriptrunner.exe",
                            "\\sh.exe",
                            "\\svchost.exe",
                            "\\verclsid.exe",
                            "\\wmic.exe",
                            "\\workfolders.exe",
                            "\\wscript.exe"
                        ]
                    }
                ],
                "selection_child_susp_paths": {
                    "Image|contains": [
                        "\\AppData\\",
                        "\\Users\\Public\\",
                        "\\ProgramData\\",
                        "\\Windows\\Tasks\\",
                        "\\Windows\\Temp\\",
                        "\\Windows\\System32\\Tasks\\"
                    ]
                },
                "selection_parent": {
                    "ParentImage|endswith": [
                        "\\EQNEDT32.EXE",
                        "\\EXCEL.EXE",
                        "\\MSACCESS.EXE",
                        "\\MSPUB.exe",
                        "\\ONENOTE.EXE",
                        "\\POWERPNT.exe",
                        "\\VISIO.exe",
                        "\\WINWORD.EXE",
                        "\\wordpad.exe",
                        "\\wordview.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "438025f9-5856-4663-83f7-52f878a70a50",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/24",
            "references": [
                "https://www.hybrid-analysis.com/sample/465aabe132ccb949e75b8ab9c5bda36d80cf2fd503d52b8bad54e295f28bbc21?environmentId=100",
                "https://mgreen27.github.io/posts/2018/04/02/DownloadCradle.html",
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml",
                "https://github.com/splunk/security_content/blob/develop/detections/endpoint/office_spawning_control.yml",
                "https://twitter.com/andythevariable/status/1576953781581144064?s=20&t=QiJILvK4ZiBdR8RJe24u-A",
                "https://www.elastic.co/security-labs/exploring-the-ref2731-intrusion-set",
                "https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/defense_evasion_execution_msbuild_started_by_office_app.toml",
                "https://www.vmray.com/analyses/2d2fa29185ad/report/overview.html",
                "https://app.any.run/tasks/c903e9c8-0350-440c-8688-3881b556b8e0/"
            ],
            "related": [
                {
                    "id": "c27515df-97a9-4162-8a60-dc0eeb51b775",
                    "type": "derived"
                },
                {
                    "id": "e1693bc8-7168-4eab-8718-cdcaa68a1738",
                    "type": "derived"
                },
                {
                    "id": "23daeb52-e6eb-493c-8607-c4f0246cb7d8",
                    "type": "obsoletes"
                },
                {
                    "id": "518643ba-7d9c-4fa5-9f37-baed36059f6a",
                    "type": "obsoletes"
                },
                {
                    "id": "04f5363a-6bca-42ff-be70-0d28bf629ead",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1047",
                "attack.t1204.002",
                "attack.t1218.010"
            ],
            "title": "Suspicious Microsoft Office Child Process"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/26",
            "description": "Detects execution of regsvr32 where the DLL is located in a potentially suspicious location.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        ":\\ProgramData\\",
                        ":\\Temp\\",
                        ":\\Users\\Public\\",
                        ":\\Windows\\Temp\\",
                        "\\AppData\\Local\\Temp\\",
                        "\\AppData\\Roaming\\"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\regsvr32.exe"
                    },
                    {
                        "OriginalFileName": "REGSVR32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Some installers might execute \"regsvr32\" with DLLs located in %TEMP% or in %PROGRAMDATA%. Apply additional filters if necessary."
            ],
            "id": "9525dc73-0327-438c-8c04-13c0e037e9da",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://web.archive.org/web/20171001085340/https://subt0x10.blogspot.com/2017/04/bypass-application-whitelisting-script.html",
                "https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/"
            ],
            "related": [
                {
                    "id": "8e2b24c9-4add-46a0-b4bb-0057b4e6187d",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Regsvr32 Execution From Potential Suspicious Location"
        },
        {
            "author": "Maxim Pavlunin",
            "date": "2020/04/01",
            "description": "Detects a suspicious execution of a Microsoft HTML Help (HH.exe)",
            "detection": {
                "condition": "all of selection_*",
                "selection_img": [
                    {
                        "OriginalFileName": "HH.exe"
                    },
                    {
                        "Image|endswith": "\\hh.exe"
                    }
                ],
                "selection_paths": {
                    "CommandLine|contains": [
                        ".application",
                        "\\AppData\\Local\\Temp\\",
                        "\\Content.Outlook\\",
                        "\\Downloads\\",
                        "\\Users\\Public\\",
                        "\\Windows\\Temp\\"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "e8a95b5e-c891-46e2-b33a-93937d3abc31",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/12",
            "references": [
                "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/",
                "https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-27939090904026cc396b0b629c8e4314acd6f5dac40a676edbc87f4567b47eb7",
                "https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/",
                "https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.initial_access",
                "attack.t1047",
                "attack.t1059.001",
                "attack.t1059.003",
                "attack.t1059.005",
                "attack.t1059.007",
                "attack.t1218",
                "attack.t1218.001",
                "attack.t1218.010",
                "attack.t1218.011",
                "attack.t1566",
                "attack.t1566.001"
            ],
            "title": "Suspicious HH.EXE Execution"
        },
        {
            "id": "e1693bc8-7168-4eab-8718-cdcaa68a1738",
            "author": "Vadim Khrykov, Cyb3rEng",
            "date": "2021/08/23",
            "description": "Office application called wmic to proxye execution through a LOLBIN process. This is often used to break suspicious parent-child chain (Office app spawns LOLBin).",
            "detection": {
                "condition": "all of selection_*",
                "selection_parent": {
                    "ParentImage|endswith": [
                        "\\WINWORD.EXE",
                        "\\EXCEL.EXE",
                        "\\POWERPNT.exe",
                        "\\MSPUB.exe",
                        "\\VISIO.exe",
                        "\\MSACCESS.EXE",
                        "\\EQNEDT32.EXE",
                        "\\ONENOTE.EXE",
                        "\\wordpad.exe",
                        "\\wordview.exe"
                    ]
                },
                "selection_wmic_cli": {
                    "CommandLine|contains": [
                        "regsvr32",
                        "rundll32",
                        "msiexec",
                        "mshta",
                        "verclsid",
                        "wscript",
                        "cscript"
                    ],
                    "CommandLine|contains|all": [
                        "process",
                        "create",
                        "call"
                    ]
                },
                "selection_wmic_img": [
                    {
                        "Image|endswith": "\\wbem\\WMIC.exe"
                    },
                    {
                        "OriginalFileName": "wmic.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "438025f9-5856-4663-83f7-52f878a70a50"
                },
                {
                    "id": "518643ba-7d9c-4fa5-9f37-baed36059f6a",
                    "type": "obsoletes"
                },
                {
                    "id": "9d1c72f5-43f0-4da5-9320-648cf2099dd0",
                    "type": "obsoletes"
                },
                {
                    "id": "c0e1c3d5-4381-4f18-8145-2583f06a1fe5",
                    "type": "obsoletes"
                },
                {
                    "id": "04f5363a-6bca-42ff-be70-0d28bf629ead",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.t1204.002",
                "attack.t1047",
                "attack.t1218.010",
                "attack.execution",
                "attack.defense_evasion"
            ],
            "title": "Suspicious WMIC Execution Via Office Process"
        },
        {
            "author": "Vadim Khrykov (ThreatIntel), Cyb3rEng, Florian Roth (Nextron Systems)",
            "date": "2021/08/23",
            "description": "Detects suspicious and uncommon child processes of WmiPrvSE",
            "detection": {
                "condition": "selection_parent and 1 of selection_children_* and not 1 of filter_main_*",
                "filter_main_msiexec": {
                    "CommandLine|contains": "/i ",
                    "Image|endswith": "\\msiexec.exe"
                },
                "filter_main_werfault": {
                    "Image|endswith": "\\WerFault.exe"
                },
                "filter_main_wmiprvse": {
                    "Image|endswith": "\\WmiPrvSE.exe"
                },
                "selection_children_1": {
                    "Image|endswith": [
                        "\\certutil.exe",
                        "\\cscript.exe",
                        "\\mshta.exe",
                        "\\msiexec.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\verclsid.exe",
                        "\\wscript.exe"
                    ]
                },
                "selection_children_2": {
                    "CommandLine|contains": [
                        "cscript",
                        "mshta",
                        "powershell",
                        "pwsh",
                        "regsvr32",
                        "rundll32",
                        "wscript"
                    ],
                    "Image|endswith": "\\cmd.exe"
                },
                "selection_parent": {
                    "ParentImage|endswith": "\\wbem\\WmiPrvSE.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "8a582fe2-0882-4b89-a82a-da6b2dc32937",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/11/10",
            "references": [
                "https://thedfirreport.com/2021/03/29/sodinokibi-aka-revil-ransomware/",
                "https://github.com/vadim-hunter/Detection-Ideas-Rules/blob/02bcbfc2bfb8b4da601bb30de0344ae453aa1afe/Threat%20Intelligence/The%20DFIR%20Report/20210329_Sodinokibi_(aka_REvil)_Ransomware.yaml",
                "https://blog.osarmor.com/319/onenote-attachment-delivers-asyncrat-malware/",
                "https://twitter.com/ForensicITGuy/status/1334734244120309760"
            ],
            "related": [
                {
                    "id": "692f0bec-83ba-4d04-af7e-e884a96059b6",
                    "type": "similar"
                },
                {
                    "id": "d21374ff-f574-44a7-9998-4a8c8bf33d7d",
                    "type": "similar"
                },
                {
                    "id": "18cf6cf0-39b0-4c22-9593-e244bdc9a2d4",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.defense_evasion",
                "attack.t1047",
                "attack.t1204.002",
                "attack.t1218.010"
            ],
            "title": "Suspicious WmiPrvSE Child Process"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/01/11",
            "description": "Detects regsvr32 execution to download and install DLLs located remotely where the address is an IP address.",
            "detection": {
                "condition": "all of selection_*",
                "selection_img": [
                    {
                        "Image|endswith": "\\regsvr32.exe"
                    },
                    {
                        "OriginalFileName": "REGSVR32.EXE"
                    }
                ],
                "selection_ip": {
                    "CommandLine|contains": [
                        " /i:http://1",
                        " /i:http://2",
                        " /i:http://3",
                        " /i:http://4",
                        " /i:http://5",
                        " /i:http://6",
                        " /i:http://7",
                        " /i:http://8",
                        " /i:http://9",
                        " /i:https://1",
                        " /i:https://2",
                        " /i:https://3",
                        " /i:https://4",
                        " /i:https://5",
                        " /i:https://6",
                        " /i:https://7",
                        " /i:https://8",
                        " /i:https://9",
                        " -i:http://1",
                        " -i:http://2",
                        " -i:http://3",
                        " -i:http://4",
                        " -i:http://5",
                        " -i:http://6",
                        " -i:http://7",
                        " -i:http://8",
                        " -i:http://9",
                        " -i:https://1",
                        " -i:https://2",
                        " -i:https://3",
                        " -i:https://4",
                        " -i:https://5",
                        " -i:https://6",
                        " -i:https://7",
                        " -i:https://8",
                        " -i:https://9"
                    ]
                }
            },
            "falsepositives": [
                "FQDNs that start with a number such as \"7-Zip\""
            ],
            "id": "2dd2c217-bf68-437a-b57c-fe9fd01d5de8",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/24",
            "references": [
                "https://twitter.com/mrd0x/status/1461041276514623491",
                "https://twitter.com/tccontre18/status/1480950986650832903",
                "https://lolbas-project.github.io/lolbas/Binaries/Regsvr32/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Potentially Suspicious Regsvr32 HTTP IP Pattern"
        },
        {
            "author": "elhoim, Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/05/05",
            "description": "Detects potentially suspicious child processes of \"regsvr32.exe\".",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_werfault": {
                    "CommandLine|contains": " -u -p ",
                    "Image|endswith": "\\werfault.exe"
                },
                "selection": {
                    "Image|endswith": [
                        "\\calc.exe",
                        "\\cscript.exe",
                        "\\explorer.exe",
                        "\\mshta.exe",
                        "\\net.exe",
                        "\\net1.exe",
                        "\\nltest.exe",
                        "\\notepad.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\reg.exe",
                        "\\schtasks.exe",
                        "\\werfault.exe",
                        "\\wscript.exe"
                    ],
                    "ParentImage|endswith": "\\regsvr32.exe"
                }
            },
            "falsepositives": [
                "Unlikely, but can rarely occur. Apply additional filters accordingly."
            ],
            "id": "6f0947a4-1c5e-4e0d-8ac7-53159b8f23ca",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/26",
            "related": [
                {
                    "id": "8e2b24c9-4add-46a0-b4bb-0057b4e6187d",
                    "type": "obsoletes"
                }
            ],
            "references": [
                "https://redcanary.com/blog/intelligence-insights-april-2022/",
                "https://www.echotrail.io/insights/search/regsvr32.exe",
                "https://www.ired.team/offensive-security/code-execution/t1117-regsvr32-aka-squiblydoo"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Potentially Suspicious Child Process Of Regsvr32"
        },
        {
            "author": "Maxim Pavlunin, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/04/01",
            "description": "Detects a suspicious child process of a Microsoft HTML Help (HH.exe)",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "\\CertReq.exe",
                        "\\CertUtil.exe",
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\installutil.exe",
                        "\\MSbuild.exe",
                        "\\MSHTA.EXE",
                        "\\msiexec.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\regsvr32.exe",
                        "\\rundll32.exe",
                        "\\schtasks.exe",
                        "\\wmic.exe",
                        "\\wscript.exe"
                    ],
                    "ParentImage|endswith": "\\hh.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "52cad028-0ff0-4854-8f67-d25dfcbc78b4",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/12",
            "references": [
                "https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/chm-badness-delivers-a-banking-trojan/",
                "https://github.com/elastic/protections-artifacts/commit/746086721fd385d9f5c6647cada1788db4aea95f#diff-27939090904026cc396b0b629c8e4314acd6f5dac40a676edbc87f4567b47eb7",
                "https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/higaisa-or-winnti-apt-41-backdoors-old-and-new/",
                "https://www.zscaler.com/blogs/security-research/unintentional-leak-glimpse-attack-vectors-apt37"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.initial_access",
                "attack.t1047",
                "attack.t1059.001",
                "attack.t1059.003",
                "attack.t1059.005",
                "attack.t1059.007",
                "attack.t1218",
                "attack.t1218.001",
                "attack.t1218.010",
                "attack.t1218.011",
                "attack.t1566",
                "attack.t1566.001"
            ],
            "title": "HTML Help HH.EXE Suspicious Child Process"
        },
        {
            "author": "Florian Roth (Nextron Systems), frack113",
            "date": "2021/11/29",
            "description": "Detects the execution of REGSVR32.exe with DLL files masquerading as other files",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|endswith": [
                        ".bin",
                        ".bmp",
                        ".cr2",
                        ".dat",
                        ".eps",
                        ".gif",
                        ".ico",
                        ".jpeg",
                        ".jpg",
                        ".nef",
                        ".orf",
                        ".png",
                        ".raw",
                        ".sr2",
                        ".temp",
                        ".tif",
                        ".tiff",
                        ".tmp",
                        ".rtf",
                        ".txt"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\regsvr32.exe"
                    },
                    {
                        "OriginalFileName": "REGSVR32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "089fc3d2-71e8-4763-a8a5-c97fbb0a403e",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/24",
            "related": [
                {
                    "id": "8e2b24c9-4add-46a0-b4bb-0057b4e6187d",
                    "type": "obsoletes"
                }
            ],
            "references": [
                "https://thedfirreport.com/2021/11/29/continuing-the-bazar-ransomware-story/",
                "https://blog.talosintelligence.com/2021/10/threat-hunting-in-large-datasets-by.html",
                "https://guides.lib.umich.edu/c.php?g=282942&p=1885348"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Regsvr32 DLL Execution With Suspicious File Extension"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/07/13",
            "description": "Detects a potential command line flag anomaly related to \"regsvr32\" in which the \"/i\" flag is used without the \"/n\" which should be uncommon.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_flag": {
                    "CommandLine|contains|windash": " -n "
                },
                "selection": {
                    "Image|endswith": "\\regsvr32.exe",
                    "CommandLine|contains|windash": " -i:"
                }
            },
            "falsepositives": [
                "Administrator typo might cause some false positives"
            ],
            "id": "b236190c-1c61-41e9-84b3-3fe03f6d76b0",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://twitter.com/sbousseaden/status/1282441816986484737?s=12"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Potential Regsvr32 Commandline Flag Anomaly"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2023/05/24",
            "description": "Detects regsvr32 execution to download/install/register new DLLs that are hosted on Web or FTP servers.",
            "detection": {
                "condition": "all of selection_*",
                "selection_flag": {
                    "CommandLine|contains": [
                        " /i",
                        " -i"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\regsvr32.exe"
                    },
                    {
                        "OriginalFileName": "REGSVR32.EXE"
                    }
                ],
                "selection_protocol": {
                    "CommandLine|contains": [
                        "ftp",
                        "http"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "867356ee-9352-41c9-a8f2-1be690d78216",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/26",
            "related": [
                {
                    "id": "8e2b24c9-4add-46a0-b4bb-0057b4e6187d",
                    "type": "obsoletes"
                }
            ],
            "references": [
                "https://twitter.com/mrd0x/status/1461041276514623491",
                "https://twitter.com/tccontre18/status/1480950986650832903",
                "https://lolbas-project.github.io/lolbas/Binaries/Regsvr32/"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Potentially Suspicious Regsvr32 HTTP/FTP Pattern"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/26",
            "description": "Detects various command line and scripting engines/processes such as \"PowerShell\", \"Wscript\", \"Cmd\", etc. spawning a \"regsvr32\" instance.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_rpcproxy": {
                    "CommandLine|endswith": " /s C:\\Windows\\System32\\RpcProxy\\RpcProxy.dll",
                    "ParentImage": "C:\\Windows\\System32\\cmd.exe"
                },
                "selection": {
                    "Image|endswith": "\\regsvr32.exe",
                    "ParentImage|endswith": [
                        "\\cmd.exe",
                        "\\cscript.exe",
                        "\\mshta.exe",
                        "\\powershell_ise.exe",
                        "\\powershell.exe",
                        "\\pwsh.exe",
                        "\\wscript.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate \".bat\", \".hta\", \".ps1\" or \".vbs\" scripts leverage legitimately often. Apply additional filter and exclusions as necessary",
                "Some legitimate Windows services"
            ],
            "id": "ab37a6ec-6068-432b-a64e-2c7bf95b1d22",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://web.archive.org/web/20171001085340/https://subt0x10.blogspot.com/2017/04/bypass-application-whitelisting-script.html",
                "https://app.any.run/tasks/34221348-072d-4b70-93f3-aa71f6ebecad/"
            ],
            "related": [
                {
                    "id": "8e2b24c9-4add-46a0-b4bb-0057b4e6187d",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ],
            "title": "Scripting/CommandLine Process Spawned Regsvr32"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2023/05/26",
            "description": "Detects execution of regsvr32 where the DLL is located in a highly suspicious locations",
            "detection": {
                "condition": "selection_img and (selection_path_1 or (selection_path_2 and not selection_exclude_known_dirs)) and not 1 of filter_main_*",
                "filter_main_empty": {
                    "CommandLine": ""
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\regsvr32.exe"
                    },
                    {
                        "OriginalFileName": "REGSVR32.EXE"
                    }
                ],
                "filter_main_null": {
                    "CommandLine": null
                },
                "selection_exclude_known_dirs": {
                    "CommandLine|contains": [
                        "C:\\Program Files (x86)\\",
                        "C:\\Program Files\\",
                        "C:\\ProgramData\\",
                        "C:\\Users\\",
                        " C:\\Windows\\",
                        " \"C:\\Windows\\",
                        " 'C:\\Windows\\"
                    ]
                },
                "selection_path_1": {
                    "CommandLine|contains": [
                        ":\\PerfLogs\\",
                        ":\\Temp\\",
                        "\\Windows\\Registration\\CRMLog",
                        "\\Windows\\System32\\com\\dmp\\",
                        "\\Windows\\System32\\FxsTmp\\",
                        "\\Windows\\System32\\Microsoft\\Crypto\\RSA\\MachineKeys\\",
                        "\\Windows\\System32\\spool\\drivers\\color\\",
                        "\\Windows\\System32\\spool\\PRINTERS\\",
                        "\\Windows\\System32\\spool\\SERVERS\\",
                        "\\Windows\\System32\\Tasks_Migrated\\",
                        "\\Windows\\System32\\Tasks\\Microsoft\\Windows\\SyncCenter\\",
                        "\\Windows\\SysWOW64\\com\\dmp\\",
                        "\\Windows\\SysWOW64\\FxsTmp\\",
                        "\\Windows\\SysWOW64\\Tasks\\Microsoft\\Windows\\PLA\\System\\",
                        "\\Windows\\SysWOW64\\Tasks\\Microsoft\\Windows\\SyncCenter\\",
                        "\\Windows\\Tasks\\",
                        "\\Windows\\Tracing\\"
                    ]
                },
                "selection_path_2": {
                    "CommandLine|contains": [
                        " \"C:\\",
                        " C:\\",
                        " 'C:\\",
                        "D:\\"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "327ff235-94eb-4f06-b9de-aaee571324be",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "Internal Research"
            ],
            "title": "Regsvr32 Execution From Highly Suspicious Location",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/31",
            "description": "Detects REGSVR32.exe to execute DLL hosted on remote shares",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": " \\\\\\\\"
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\regsvr32.exe"
                    },
                    {
                        "OriginalFileName": "\\REGSVR32.EXE"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "88a87a10-384b-4ad7-8871-2f9bf9259ce5",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://thedfirreport.com/2022/10/31/follina-exploit-leads-to-domain-compromise/"
            ],
            "title": "Suspicious Regsvr32 Execution From Remote Share",
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.010"
            ]
        }
    ]
}