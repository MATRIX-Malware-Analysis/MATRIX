{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--fcab31db-fd6c-4bfb-850b-3a19ca4b39b5",
    "created": "2024-08-13T14:46:37.004431Z",
    "modified": "2024-08-13T14:46:45.39931Z",
    "name": "Multi-hop Proxy: ",
    "description": "Adversaries may chain together multiple proxies to disguise the source of malicious traffic. Typically, a defender will be able to identify the last proxy traffic traversed before it enters their network; the defender may or may not be able to identify any previous proxies before the last-hop proxy. This technique makes identifying the original source of the malicious traffic even more difficult by requiring the defender to trace malicious traffic through several proxies to identify its source.For example, adversaries may construct or use onion routing networks \u2013 such as the publicly available Tor network \u2013 to transport encrypted C2 traffic through a compromised population, allowing communication with any device within the network.[1]In the case of network infrastructure, it is possible for an adversary to leverage multiple compromised devices to create a multi-hop proxy chain (i.e., Network Devices). By leveraging Patch System Image on routers, adversaries can add custom code to the affected network devices that will implement onion routing between those nodes. This method is dependent upon the Network Boundary Bridging method allowing the adversaries to cross the protected network boundary of the Internet perimeter and into the organization\u2019s Wide-Area Network (WAN).  Protocols such as ICMP may be used as a transport.Similarly, adversaries may abuse peer-to-peer (P2P) and blockchain-oriented infrastructure to implement routing between a decentralized network of peers.[2]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1090/003",
            "external_id": "T1090/003"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "frack113",
            "date": "2022/02/20",
            "description": "Detects DNS queries to an \".onion\" address related to Tor routing networks",
            "detection": {
                "condition": "selection",
                "selection": {
                    "QueryName|contains": ".onion"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b55ca2a3-7cff-4dda-8bdd-c7bfa63bf544",
            "level": "high",
            "logsource": {
                "category": "dns_query",
                "product": "windows"
            },
            "modified": "2023/09/18",
            "references": [
                "https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/"
            ],
            "related": [
                {
                    "id": "8384bd26-bde6-4da9-8e5d-4174a7a47ca2",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.command_and_control",
                "attack.t1090.003"
            ],
            "title": "DNS Query Tor .Onion Address - Sysmon"
        },
        {
            "author": "frack113",
            "date": "2022/02/20",
            "description": "Detects the use of Tor or Tor-Browser to connect to onion routing networks",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "\\tor.exe",
                        "\\Tor Browser\\Browser\\firefox.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "62f7c9bf-9135-49b2-8aeb-1e54a6ecc13c",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/13",
            "references": [
                "https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/"
            ],
            "status": "test",
            "title": "Tor Client/Browser Execution",
            "tags": [
                "attack.command_and_control",
                "attack.t1090.003"
            ]
        },
        {
            "id": "8384bd26-bde6-4da9-8e5d-4174a7a47ca2",
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/02/20",
            "description": "Detects DNS resolution of an .onion address related to Tor routing networks",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 3008,
                    "QueryName|contains": ".onion"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "level": "high",
            "logsource": {
                "definition": "Requirements: Microsoft-Windows-DNS Client Events/Operational Event Log must be enabled/collected in order to receive the events.",
                "product": "windows",
                "service": "dns-client"
            },
            "related": [
                {
                    "type": "similar",
                    "id": "b55ca2a3-7cff-4dda-8bdd-c7bfa63bf544"
                }
            ],
            "references": [
                "https://www.logpoint.com/en/blog/detecting-tor-use-with-logpoint/"
            ],
            "status": "test",
            "title": "Query Tor Onion Address - DNS Client",
            "tags": [
                "attack.command_and_control",
                "attack.t1090.003"
            ]
        }
    ]
}