{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--923b76bd-c0e9-4e1c-a69b-ab7938c74f09",
    "created": "2024-08-13T14:46:36.684307Z",
    "modified": "2024-08-13T14:46:45.725281Z",
    "name": "Use Alternate Authentication Material: Pass the Ticket",
    "description": "Adversaries may 'pass the ticket' using stolen Kerberos tickets to move laterally within an environment, bypassing normal system access controls. Pass the ticket (PtT) is a method of authenticating to a system using Kerberos tickets without having access to an account's password. Kerberos authentication can be used as the first step to lateral movement to a remote system.When preforming PtT, valid Kerberos tickets for Valid Accounts are captured by OS Credential Dumping. A user's service tickets or ticket granting ticket (TGT) may be obtained, depending on the level of access. A service ticket allows for access to a particular resource, whereas a TGT can be used to request service tickets from the Ticket Granting Service (TGS) to access any resource the user has privileges to access.[1][2]A Silver Ticket can be obtained for services that use Kerberos as an authentication mechanism and are used to generate tickets to access that particular resource and the system that hosts the resource (e.g., SharePoint).[1]A Golden Ticket can be obtained for the domain using the Key Distribution Service account KRBTGT account NTLM hash, which enables generation of TGTs for any account in Active Directory.[3]Adversaries may also create a valid Kerberos ticket using other user information, such as stolen password hashes or AES keys. For example, 'overpassing the hash' involves using a NTLM password hash to authenticate as a user (i.e. Pass the Hash) while also using the password hash to create a valid Kerberos ticket.[4]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1550/003",
            "external_id": "T1550/003"
        },
        {
            "source_name": "CAPEC 645",
            "external_id": "malware-behavior--09541f33-703c-4640-90bb-643feecb59a3"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Ilyas Ochkov, oscd.community",
            "date": "2019/10/24",
            "description": "Detects uncommon outbound network activity via Kerberos default port indicating possible lateral movement or first stage PrivEsc via delegation.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_lsass": {
                    "Image": "C:\\Windows\\System32\\lsass.exe"
                },
                "filter_optional_chrome": {
                    "Image": [
                        "C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe",
                        "C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"
                    ]
                },
                "filter_optional_firefox": {
                    "Image": [
                        "C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe",
                        "C:\\Program Files\\Mozilla Firefox\\firefox.exe"
                    ]
                },
                "filter_optional_tomcat": {
                    "Image|endswith": "\\tomcat\\bin\\tomcat8.exe"
                },
                "selection": {
                    "DestinationPort": 88,
                    "Initiated": "true"
                }
            },
            "falsepositives": [
                "Web Browsers and third party application might generate similar activity. An initial baseline is required."
            ],
            "id": "e54979bd-c5f9-4d6c-967b-a04b19ac4c74",
            "level": "medium",
            "logsource": {
                "category": "network_connection",
                "product": "windows"
            },
            "modified": "2024/03/15",
            "references": [
                "https://github.com/GhostPack/Rubeus"
            ],
            "related": [
                {
                    "id": "eca91c7c-9214-47b9-b4c5-cb1d7e4f2350",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1558",
                "attack.lateral_movement",
                "attack.t1550.003"
            ],
            "title": "Uncommon Outbound Kerberos Connection"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/12/19",
            "description": "Detects the execution of the hacktool Rubeus via PE information of command line parameters",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\Rubeus.exe"
                    },
                    {
                        "OriginalFileName": "Rubeus.exe"
                    },
                    {
                        "Description": "Rubeus"
                    },
                    {
                        "CommandLine|contains": [
                            "asreproast ",
                            "dump /service:krbtgt ",
                            "dump /luid:0x",
                            "kerberoast ",
                            "createnetonly /program:",
                            "ptt /ticket:",
                            "/impersonateuser:",
                            "renew /ticket:",
                            "asktgt /user:",
                            "harvest /interval:",
                            "s4u /user:",
                            "s4u /ticket:",
                            "hash /password:",
                            "golden /aes256:",
                            "silver /user:"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "7ec2c172-dceb-4c10-92c9-87c1881b7e18",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/20",
            "references": [
                "https://blog.harmj0y.net/redteaming/from-kekeo-to-rubeus",
                "https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html",
                "https://github.com/GhostPack/Rubeus"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "7ec2c172-dceb-4c10-92c9-87c1881b7e18"
                }
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1558.003",
                "attack.lateral_movement",
                "attack.t1550.003"
            ],
            "title": "HackTool - Rubeus Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/04/26",
            "description": "Detects KrbRelayUp used to perform a universal no-fix local privilege escalation in Windows domain environments where LDAP signing is not enforced",
            "detection": {
                "condition": "1 of selection_*",
                "selection_cli_1": {
                    "CommandLine|contains|all": [
                        " relay ",
                        " -Domain ",
                        " -ComputerName "
                    ]
                },
                "selection_cli_2": {
                    "CommandLine|contains|all": [
                        " krbscm ",
                        " -sc "
                    ]
                },
                "selection_cli_3": {
                    "CommandLine|contains|all": [
                        " spawn ",
                        " -d ",
                        " -cn ",
                        " -cp "
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\KrbRelayUp.exe"
                    },
                    {
                        "OriginalFileName": "KrbRelayUp.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "12827a56-61a4-476a-a9cb-f3068f191073",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/Dec0ne/KrbRelayUp"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1558.003",
                "attack.lateral_movement",
                "attack.t1550.003"
            ],
            "title": "HackTool - KrbRelayUp Execution"
        },
        {
            "author": "Christian Burkard (Nextron Systems), Florian Roth (Nextron Systems)",
            "date": "2023/04/27",
            "description": "Detects the execution of the hacktool Rubeus using specific command line flags",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": [
                        "asreproast ",
                        "dump /service:krbtgt ",
                        "dump /luid:0x",
                        "kerberoast ",
                        "createnetonly /program:",
                        "ptt /ticket:",
                        "/impersonateuser:",
                        "renew /ticket:",
                        "asktgt /user:",
                        "harvest /interval:",
                        "s4u /user:",
                        "s4u /ticket:",
                        "hash /password:",
                        "golden /aes256:",
                        "silver /user:"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "3245cd30-e015-40ff-a31d-5cadd5f377ec",
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "references": [
                "https://blog.harmj0y.net/redteaming/from-kekeo-to-rubeus",
                "https://m0chan.github.io/2019/07/31/How-To-Attack-Kerberos-101.html",
                "https://github.com/GhostPack/Rubeus"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "7ec2c172-dceb-4c10-92c9-87c1881b7e18"
                }
            ],
            "status": "test",
            "title": "HackTool - Rubeus Execution - ScriptBlock",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1558.003",
                "attack.lateral_movement",
                "attack.t1550.003"
            ]
        }
    ]
}