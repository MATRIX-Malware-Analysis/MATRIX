{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--8ff6dea7-8d30-412c-81ad-39ba6c71b84b",
    "created": "2024-08-13T14:46:36.983932Z",
    "modified": "2024-08-13T14:46:45.271516Z",
    "name": "OS Credential Dumping: LSASS Memory",
    "description": "Adversaries may attempt to access credential material stored in the process memory of the Local Security Authority Subsystem Service (LSASS). After a user logs on, the system generates and stores a variety of credential materials in LSASS process memory. These credential materials can be harvested by an administrative user or SYSTEM and used to conduct Lateral Movement using Use Alternate Authentication Material.As well as in-memory techniques, the LSASS process memory can be dumped from the target host and analyzed on a local system.For example, on the target host use procdump:procdump -ma lsass.exe lsass_dumpLocally, mimikatz can be run using:sekurlsa::Minidump lsassdump.dmpsekurlsa::logonPasswordsBuilt-in Windows tools such as comsvcs.dll can also be used:rundll32.exe C:\\Windows\\System32\\comsvcs.dll MiniDump PID  lsass.dmp full[1][2]Similar to Image File Execution Options Injection, the silent process exit mechanism can be abused to create a memory dump of lsass.exe through Windows Error Reporting (WerFault.exe).[3]Windows Security Support Provider (SSP) DLLs are loaded into LSASS process at system start. Once loaded into the LSA, SSP DLLs have access to encrypted and plaintext passwords that are stored in Windows, such as any logged-on user's Domain password or smart card PINs. The SSP configuration is stored in two Registry keys: HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\Security Packages and HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\OSConfig\\Security Packages. An adversary may modify these Registry keys to add new SSPs, which will be loaded the next time the system boots, or when the AddSecurityPackage Windows API function is called.[4]The following SSPs can be used to access credentials:Msv: Interactive logons, batch logons, and service logons are done through the MSV authentication package.Wdigest: The Digest Authentication protocol is designed for use with Hypertext Transfer Protocol (HTTP) and Simple Authentication Security Layer (SASL) exchanges.[5]Kerberos: Preferred for mutual client-server domain authentication in Windows 2000 and later.CredSSP:  Provides SSO and Network Level Authentication for Remote Desktop Services.[5]",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1003/001",
            "external_id": "T1003/001"
        }
    ],
    "x_mitre_detection_rules": [
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/09/09",
            "description": "Detects a highly relevant Antivirus alert that reports a password dumper.",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Signature|startswith": "PWS"
                    },
                    {
                        "Signature|contains": [
                            "DumpCreds",
                            "DumpLsass",
                            "HTool/WCE",
                            "Kekeo",
                            "LsassDump",
                            "Mimikatz",
                            "Outflank",
                            "PShlSpy",
                            "PSWTool",
                            "PWCrack",
                            "PWDump",
                            "PWS.",
                            "PWSX",
                            "Rubeus",
                            "SecurityTool",
                            "SharpDump"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "78cc2dd2-7d20-4d32-93ff-057084c38b93",
            "level": "critical",
            "logsource": {
                "category": "antivirus"
            },
            "modified": "2024/07/17",
            "references": [
                "https://www.nextron-systems.com/?s=antivirus",
                "https://www.virustotal.com/gui/file/5fcda49ee7f202559a6cbbb34edb65c33c9a1e0bde9fa2af06a6f11b55ded619",
                "https://www.virustotal.com/gui/file/a4edfbd42595d5bddb442c82a02cf0aaa10893c1bf79ea08b9ce576f82749448"
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1558",
                "attack.t1003.001",
                "attack.t1003.002"
            ],
            "title": "Antivirus Password Dumper Detection"
        },
        {
            "author": "@neu5ron, Teymur Kheirkhabarov, oscd.community",
            "date": "2020/04/02",
            "description": "Transferring files with well-known filenames (sensitive files with credential data) using network shares",
            "detection": {
                "condition": "selection",
                "selection": {
                    "name": [
                        "\\mimidrv",
                        "\\lsass",
                        "\\windows\\minidump\\",
                        "\\hiberfil",
                        "\\sqldmpr",
                        "\\sam",
                        "\\ntds.dit",
                        "\\security"
                    ]
                }
            },
            "falsepositives": [
                "Transferring sensitive files for legitimate administration work by legitimate administrator"
            ],
            "id": "2e69f167-47b5-4ae7-a390-47764529eff5",
            "level": "medium",
            "logsource": {
                "product": "zeek",
                "service": "smb_files"
            },
            "modified": "2021/11/27",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "id": "910ab938-668b-401b-b08c-b596e80fdca5",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.001",
                "attack.t1003.003"
            ],
            "title": "Transferring Files with Credential Data via Network Shares - Zeek"
        },
        {
            "author": "Samir Bousseaden (original elastic rule), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/29",
            "description": "Detects suspicious access to LSASS handle via a call trace to \"seclogon.dll\" with a suspicious access right.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CallTrace|contains": "seclogon.dll",
                    "GrantedAccess": "0x14c0",
                    "SourceImage|endswith": "\\svchost.exe",
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "472159c5-31b9-4f56-b794-b766faa8b0a7",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "references": [
                "https://twitter.com/SBousseaden/status/1541920424635912196",
                "https://github.com/elastic/detection-rules/blob/2bc1795f3d7bcc3946452eb4f07ae799a756d94e/rules/windows/credential_access_lsass_handle_via_malseclogon.toml",
                "https://splintercod3.blogspot.com/p/the-hidden-side-of-seclogon-part-3.html"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "Suspicious LSASS Access Via MalSecLogon",
            "status": "test"
        },
        {
            "author": "Florian Roth, Roberto Rodriguez, Dimitrios Slamaris, Mark Russinovich, Thomas Patzke, Teymur Kheirkhabarov, Sherif Eldeeb, James Dickenson, Aleksey Potapov, oscd.community",
            "date": "2021/11/22",
            "description": "Detects process access requests to LSASS process with potentially suspicious access flags",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_explorer": {
                    "GrantedAccess": "0x401",
                    "SourceImage|endswith": "\\explorer.exe"
                },
                "filter_main_generic": {
                    "SourceImage|contains": [
                        ":\\Program Files (x86)\\",
                        ":\\Program Files\\",
                        ":\\Windows\\System32\\",
                        ":\\Windows\\SysWOW64\\"
                    ]
                },
                "filter_main_windefend_1": {
                    "SourceImage|contains": ":\\ProgramData\\Microsoft\\Windows Defender\\",
                    "SourceImage|endswith": "\\MsMpEng.exe"
                },
                "filter_main_windefend_2": {
                    "CallTrace|contains|all": [
                        "|?:\\ProgramData\\Microsoft\\Windows Defender\\Definition Updates\\{",
                        "}\\mpengine.dll+"
                    ],
                    "GrantedAccess": "0x1418"
                },
                "filter_main_windefend_3": {
                    "CallTrace|contains": [
                        "|c:\\program files\\windows defender\\mprtp.dll",
                        "|c:\\program files\\windows defender\\MpClient.dll"
                    ]
                },
                "filter_optional_malwarebytes": {
                    "SourceImage|endswith": ":\\ProgramData\\MALWAREBYTES\\MBAMSERVICE\\ctlrupdate\\mbupdatr.exe"
                },
                "filter_optional_mbami": {
                    "GrantedAccess": "0x40",
                    "SourceImage|endswith": "\\MBAMInstallerService.exe"
                },
                "filter_optional_nextron": {
                    "GrantedAccess": "0x40",
                    "SourceImage|endswith": [
                        "\\aurora-agent-64.exe",
                        "\\aurora-agent.exe",
                        "\\thor.exe",
                        "\\thor64.exe"
                    ]
                },
                "filter_optional_steam_apps": {
                    "SourceImage|contains": "\\SteamLibrary\\steamapps\\"
                },
                "filter_optional_sysinternals_handle": {
                    "GrantedAccess": "0x40",
                    "SourceImage|endswith": [
                        "\\handle.exe",
                        "\\handle64.exe"
                    ]
                },
                "filter_optional_sysinternals_process_explorer": {
                    "GrantedAccess": "0x40",
                    "SourceImage|endswith": [
                        "\\PROCEXP64.EXE",
                        "\\PROCEXP.EXE"
                    ]
                },
                "filter_optional_vmwaretools": {
                    "SourceImage|contains": ":\\ProgramData\\VMware\\VMware Tools\\",
                    "SourceImage|endswith": "\\vmtoolsd.exe"
                },
                "filter_optional_vscode": {
                    "SourceImage|endswith": "\\AppData\\Local\\Programs\\Microsoft VS Code\\Code.exe"
                },
                "filter_optional_webex": {
                    "GrantedAccess": "0x401",
                    "SourceImage|endswith": "\\AppData\\Local\\WebEx\\WebexHost.exe"
                },
                "selection_access": [
                    {
                        "GrantedAccess|endswith": [
                            "30",
                            "50",
                            "70",
                            "90",
                            "B0",
                            "D0",
                            "F0",
                            "18",
                            "38",
                            "58",
                            "78",
                            "98",
                            "B8",
                            "D8",
                            "F8",
                            "1A",
                            "3A",
                            "5A",
                            "7A",
                            "9A",
                            "BA",
                            "DA",
                            "FA",
                            "0x14C2"
                        ]
                    },
                    {
                        "GrantedAccess|startswith": [
                            "0x100000",
                            "0x1418",
                            "0x1438",
                            "0x143a",
                            "0x1f0fff",
                            "0x1f1fff",
                            "0x1f2fff",
                            "0x1f3fff",
                            "0x40"
                        ]
                    }
                ],
                "selection_target": {
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Legitimate software such as AV and EDR"
            ],
            "id": "a18dd26b-6450-46de-8c91-9659150cf088",
            "level": "medium",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://learn.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights",
                "https://onedrive.live.com/view.aspx?resid=D026B4699190F1E6!2843&ithint=file%2cpptx&app=PowerPoint&authkey=!AMvCRTKB_V1J5ow",
                "https://web.archive.org/web/20230208123920/https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html",
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "http://security-research.dyndns.org/pub/slides/FIRST2017/FIRST-2017_Tom-Ueltschi_Sysmon_FINAL_notes.pdf"
            ],
            "related": [
                {
                    "id": "32d0d3e2-e58d-4d41-926b-18b520b2b32d",
                    "type": "similar"
                }
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0002"
            ],
            "title": "Potentially Suspicious GrantedAccess Flags On LSASS"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2012/06/27",
            "description": "Detects process LSASS memory dump using Mimikatz, NanoDump, Invoke-Mimikatz, Procdump or Taskmgr based on the CallTrace pointing to ntdll.dll, dbghelp.dll or dbgcore.dll for win10, server2016 and up.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "GrantedAccess": "0x1FFFFF",
                    "SourceImage|endswith": "\\WerFault.exe",
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Actual failures in lsass.exe that trigger a crash dump (unlikely)",
                "Unknown cases in which WerFault accesses lsass.exe"
            ],
            "id": "e5b33f7d-eb93-48b6-9851-09e1e610b6d7",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://github.com/helpsystems/nanodump/commit/578116faea3d278d53d70ea932e2bbfe42569507"
            ],
            "status": "test",
            "title": "Credential Dumping Attempt Via WerFault",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0002"
            ]
        },
        {
            "author": "Bhabesh Raj (rule), @thefLinkk",
            "date": "2022/06/27",
            "description": "Detects HandleKatz opening LSASS to duplicate its handle to later dump the memory without opening any new handles",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CallTrace|contains": "|UNKNOWN(",
                    "CallTrace|endswith": ")",
                    "CallTrace|startswith": "C:\\Windows\\System32\\ntdll.dll+",
                    "TargetImage|endswith": "\\lsass.exe",
                    "GrantedAccess": "0x1440"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "b1bd3a59-c1fd-4860-9f40-4dd161a7d1f5",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/28",
            "references": [
                "https://github.com/codewhitesec/HandleKatz"
            ],
            "status": "test",
            "tags": [
                "attack.execution",
                "attack.t1106",
                "attack.defense_evasion",
                "attack.t1003.001"
            ],
            "title": "HackTool - HandleKatz Duplicating LSASS Handle"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/02/10",
            "description": "Detects a possible process memory dump that uses a white-listed filename like TrolleyExpress.exe as a way to dump the LSASS process memory without Microsoft Defender interference\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "GrantedAccess|endswith": [
                        "10",
                        "30",
                        "50",
                        "70",
                        "90",
                        "B0",
                        "D0",
                        "F0",
                        "18",
                        "38",
                        "58",
                        "78",
                        "98",
                        "B8",
                        "D8",
                        "F8",
                        "1A",
                        "3A",
                        "5A",
                        "7A",
                        "9A",
                        "BA",
                        "DA",
                        "FA",
                        "0x14C2",
                        "FF"
                    ],
                    "SourceImage|endswith": [
                        "\\TrolleyExpress.exe",
                        "\\ProcessDump.exe",
                        "\\dump64.exe"
                    ],
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "4be8b654-0c01-4c9d-a10c-6b28467fc651",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://twitter.com/_xpn_/status/1491557187168178176",
                "https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz",
                "https://twitter.com/mrd0x/status/1460597833917251595"
            ],
            "status": "test",
            "title": "LSASS Access From Potentially White-Listed Processes",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0002"
            ]
        },
        {
            "author": "Patryk Prauze - ING Tech",
            "date": "2019/05/20",
            "description": "Detects remote access to the LSASS process via WinRM. This could be a sign of credential dumping from tools like mimikatz.",
            "detection": {
                "condition": "selection and not 1 of filter_main_*",
                "filter_main_access": {
                    "GrantedAccess": "0x80000000"
                },
                "selection": {
                    "SourceImage|endswith": ":\\Windows\\system32\\wsmprovhost.exe",
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "aa35a627-33fb-4d04-a165-d33b4afca3e8",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://pentestlab.blog/2018/05/15/lateral-movement-winrm/"
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1059.001",
                "attack.lateral_movement",
                "attack.t1021.006",
                "attack.s0002"
            ],
            "title": "Remote LSASS Process Access Through Windows Remote Management"
        },
        {
            "author": "Bhabesh Raj, Jonhnathan Ribeiro",
            "date": "2023/11/27",
            "description": "Detects LSASS process access for potential credential dumping by a Python-like tool such as LaZagne or Pypykatz.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CallTrace|contains": [
                        "python27.dll+",
                        "python3*.dll+"
                    ],
                    "GrantedAccess": "0x1FFFFF",
                    "CallTrace|contains|all": [
                        "_ctypes.pyd+",
                        ":\\Windows\\System32\\KERNELBASE.dll+",
                        ":\\Windows\\SYSTEM32\\ntdll.dll+"
                    ],
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f8be3e82-46a3-4e4e-ada5-8e538ae8b9c9",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://twitter.com/bh4b3sh/status/1303674603819081728",
                "https://github.com/skelsec/pypykatz"
            ],
            "related": [
                {
                    "id": "4b9a8556-99c4-470b-a40c-9c8d02c77ed0",
                    "type": "obsoletes"
                },
                {
                    "id": "7186e989-4ed7-4f4e-a656-4674b9e3e48b",
                    "type": "obsoletes"
                }
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0349"
            ],
            "title": "Credential Dumping Activity By Python Based Tool"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/02/10",
            "description": "Detects LSASS process access requests from a source process with the \"dump\" keyword in its image name.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "GrantedAccess|endswith": [
                        "10",
                        "30",
                        "50",
                        "70",
                        "90",
                        "B0",
                        "D0",
                        "F0",
                        "18",
                        "38",
                        "58",
                        "78",
                        "98",
                        "B8",
                        "D8",
                        "F8",
                        "1A",
                        "3A",
                        "5A",
                        "7A",
                        "9A",
                        "BA",
                        "DA",
                        "FA",
                        "0x14C2",
                        "FF"
                    ],
                    "SourceImage|contains": "dump",
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Rare programs that contain the word dump in their name and access lsass"
            ],
            "id": "9bd012ee-0dff-44d7-84a0-aa698cfd87a3",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://twitter.com/_xpn_/status/1491557187168178176",
                "https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dump-credentials-from-lsass-process-without-mimikatz"
            ],
            "status": "test",
            "title": "LSASS Memory Access by Tool With Dump Keyword In Name",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0002"
            ]
        },
        {
            "author": "Roberto Rodriguez (Cyb3rWard0g), OTR (Open Threat Research)",
            "date": "2020/10/20",
            "description": "Detects adversaries leveraging the MiniDump export function from comsvcs.dll via rundll32 to perform a memory dump from lsass.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CallTrace|contains": "comsvcs.dll",
                    "SourceImage|endswith": "\\rundll32.exe",
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a49fa4d5-11db-418c-8473-1e014a8dd462",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2023/11/29",
            "references": [
                "https://twitter.com/shantanukhande/status/1229348874298388484",
                "https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Lsass Memory Dump via Comsvcs DLL"
        },
        {
            "author": "Samir Bousseaden, Michael Haag",
            "date": "2019/04/03",
            "description": "Detects process access requests to the LSASS process with specific call trace calls and access masks.\nThis behaviour is expressed by many credential dumping tools such as Mimikatz, NanoDump, Invoke-Mimikatz, Procdump and even the Taskmgr dumping feature.\n",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_system_user": {
                    "SourceUser|contains": [
                        "AUTHORI",
                        "AUTORI"
                    ]
                },
                "filter_optional_sysmon": {
                    "SourceImage|endswith": ":\\Windows\\Sysmon64.exe"
                },
                "filter_optional_thor": {
                    "CallTrace|contains|all": [
                        ":\\Windows\\Temp\\asgard2-agent\\",
                        "\\thor\\thor64.exe+",
                        "|UNKNOWN("
                    ],
                    "GrantedAccess": "0x103800"
                },
                "selection": {
                    "CallTrace|contains": [
                        "dbgcore.dll",
                        "dbghelp.dll",
                        "kernel32.dll",
                        "kernelbase.dll",
                        "ntdll.dll"
                    ],
                    "GrantedAccess|contains": [
                        "0x1038",
                        "0x1438",
                        "0x143a",
                        "0x1fffff"
                    ],
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "5ef9853e-4d0e-4a70-846f-a9ca37d876da",
            "level": "medium",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "modified": "2024/03/02",
            "references": [
                "https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html",
                "https://web.archive.org/web/20230208123920/https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html",
                "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1003.001/T1003.001.md",
                "https://research.splunk.com/endpoint/windows_possible_credential_dumping/"
            ],
            "status": "experimental",
            "title": "Potential Credential Dumping Activity Via LSASS",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0002"
            ]
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), Swachchhanda Shrawan Poudel",
            "date": "2023/11/27",
            "description": "Detects process access requests from hacktool processes based on their default image name",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "SourceImage|endswith": [
                            "\\Akagi.exe",
                            "\\Akagi64.exe",
                            "\\atexec_windows.exe",
                            "\\Certify.exe",
                            "\\Certipy.exe",
                            "\\CoercedPotato.exe",
                            "\\crackmapexec.exe",
                            "\\CreateMiniDump.exe",
                            "\\dcomexec_windows.exe",
                            "\\dpapi_windows.exe",
                            "\\findDelegation_windows.exe",
                            "\\GetADUsers_windows.exe",
                            "\\GetNPUsers_windows.exe",
                            "\\getPac_windows.exe",
                            "\\getST_windows.exe",
                            "\\getTGT_windows.exe",
                            "\\GetUserSPNs_windows.exe",
                            "\\gmer.exe",
                            "\\hashcat.exe",
                            "\\htran.exe",
                            "\\ifmap_windows.exe",
                            "\\impersonate.exe",
                            "\\Inveigh.exe",
                            "\\LocalPotato.exe",
                            "\\mimikatz_windows.exe",
                            "\\mimikatz.exe",
                            "\\netview_windows.exe",
                            "\\nmapAnswerMachine_windows.exe",
                            "\\opdump_windows.exe",
                            "\\PasswordDump.exe",
                            "\\Potato.exe",
                            "\\PowerTool.exe",
                            "\\PowerTool64.exe",
                            "\\psexec_windows.exe",
                            "\\PurpleSharp.exe",
                            "\\pypykatz.exe",
                            "\\QuarksPwDump.exe",
                            "\\rdp_check_windows.exe",
                            "\\Rubeus.exe",
                            "\\SafetyKatz.exe",
                            "\\sambaPipe_windows.exe",
                            "\\SelectMyParent.exe",
                            "\\SharpChisel.exe",
                            "\\SharPersist.exe",
                            "\\SharpEvtMute.exe",
                            "\\SharpImpersonation.exe",
                            "\\SharpLDAPmonitor.exe",
                            "\\SharpLdapWhoami.exe",
                            "\\SharpUp.exe",
                            "\\SharpView.exe",
                            "\\smbclient_windows.exe",
                            "\\smbserver_windows.exe",
                            "\\sniff_windows.exe",
                            "\\sniffer_windows.exe",
                            "\\split_windows.exe",
                            "\\SpoolSample.exe",
                            "\\Stracciatella.exe",
                            "\\SysmonEOP.exe",
                            "\\temp\\rot.exe",
                            "\\ticketer_windows.exe",
                            "\\TruffleSnout.exe",
                            "\\winPEASany_ofs.exe",
                            "\\winPEASany.exe",
                            "\\winPEASx64_ofs.exe",
                            "\\winPEASx64.exe",
                            "\\winPEASx86_ofs.exe",
                            "\\winPEASx86.exe",
                            "\\xordump.exe"
                        ]
                    },
                    {
                        "SourceImage|contains": [
                            "\\goldenPac",
                            "\\just_dce_",
                            "\\karmaSMB",
                            "\\kintercept",
                            "\\LocalPotato",
                            "\\ntlmrelayx",
                            "\\rpcdump",
                            "\\samrdump",
                            "\\secretsdump",
                            "\\smbexec",
                            "\\smbrelayx",
                            "\\wmiexec",
                            "\\wmipersist",
                            "HotPotato",
                            "Juicy Potato",
                            "JuicyPotato",
                            "PetitPotam",
                            "RottenPotato"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "d0d2f720-d14f-448d-8242-51ff396a334e",
            "level": "high",
            "logsource": {
                "category": "process_access",
                "product": "windows"
            },
            "references": [
                "https://jsecurity101.medium.com/bypassing-access-mask-auditing-strategies-480fb641c158",
                "https://www.splunk.com/en_us/blog/security/you-bet-your-lsass-hunting-lsass-access.html"
            ],
            "title": "HackTool - Generic Process Access",
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0002"
            ]
        },
        {
            "author": "oscd.community, Natalia Shornikova",
            "date": "2020/10/06",
            "description": "Detects remote thread creation by PowerShell processes into \"lsass.exe\"",
            "detection": {
                "condition": "selection",
                "selection": {
                    "SourceImage|endswith": [
                        "\\powershell.exe",
                        "\\pwsh.exe"
                    ],
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "fb656378-f909-47c1-8747-278bf09f4f4f",
            "level": "high",
            "logsource": {
                "category": "create_remote_thread",
                "product": "windows"
            },
            "modified": "2022/12/18",
            "references": [
                "https://speakerdeck.com/heirhabarov/hunting-for-powershell-abuse"
            ],
            "related": [
                {
                    "id": "3f07b9d1-2082-4c56-9277-613a621983cc",
                    "type": "obsoletes"
                },
                {
                    "id": "0f920ebe-7aea-4c54-b202-9aa0c609cfe5",
                    "type": "similar"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Potential Credential Dumping Attempt Via PowerShell Remote Thread"
        },
        {
            "author": "Thomas Patzke",
            "date": "2017/02/19",
            "description": "Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage.\nThe process in field Process is the malicious program. A single execution can lead to hundreds of events.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "StartModule": "",
                    "TargetImage|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Antivirus products"
            ],
            "id": "f239b326-2f41-4d6b-9dfa-c846a60ef505",
            "level": "high",
            "logsource": {
                "category": "create_remote_thread",
                "product": "windows"
            },
            "modified": "2021/06/21",
            "references": [
                "https://jpcertcc.github.io/ToolAnalysisResultSheet/details/WCE.htm"
            ],
            "status": "stable",
            "tags": [
                "attack.credential_access",
                "attack.s0005",
                "attack.t1003.001"
            ],
            "title": "Password Dumper Remote Thread in LSASS"
        },
        {
            "author": "Ensar \u015eamil, @sblmsrsn, @oscd_initiative",
            "date": "2020/10/06",
            "description": "Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|endswith": [
                        "\\ttdrecord.dll",
                        "\\ttdwriter.dll",
                        "\\ttdloader.dll"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate usage by software developers/testers"
            ],
            "id": "e76c8240-d68f-4773-8880-5c6f63595aaf",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2022/12/02",
            "references": [
                "https://lolbas-project.github.io/lolbas/Binaries/Tttracer/",
                "https://twitter.com/mattifestation/status/1196390321783025666",
                "https://twitter.com/oulusoyum/status/1191329746069655553"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.t1218",
                "attack.t1003.001"
            ],
            "title": "Time Travel Debugging Utility Usage - Image"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/08/14",
            "description": "Detects rundll32 loading a renamed comsvcs.dll to dump process memory",
            "detection": {
                "condition": "selection and not filter",
                "filter": {
                    "ImageLoaded|endswith": "\\comsvcs.dll"
                },
                "selection": {
                    "Hashes|contains": [
                        "IMPHASH=eed93054cb555f3de70eaa9787f32ebb",
                        "IMPHASH=5e0dbdec1fce52daae251a110b4f309d",
                        "IMPHASH=eadbccbb324829acb5f2bbe87e5549a8",
                        "IMPHASH=407ca0f7b523319d758a40d7c0193699",
                        "IMPHASH=281d618f4e6271e527e6386ea6f748de"
                    ],
                    "Image|endswith": "\\rundll32.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "8cde342c-ba48-4b74-b615-172c330f2e93",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2023/02/17",
            "references": [
                "https://twitter.com/sbousseaden/status/1555200155351228419"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.defense_evasion",
                "attack.t1003.001"
            ],
            "title": "Suspicious Renamed Comsvcs DLL Loaded By Rundll32"
        },
        {
            "author": "Perez Diego (@darkquassar), oscd.community, Ecco",
            "date": "2019/10/27",
            "description": "Detects the load of dbghelp/dbgcore DLL (used to make memory dumps) by suspicious processes.\nTools like ProcessHacker and some attacker tradecract use MiniDumpWriteDump API found in dbghelp.dll or dbgcore.dll.\nAs an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.\n",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ImageLoaded|endswith": [
                        "\\dbghelp.dll",
                        "\\dbgcore.dll"
                    ],
                    "Signed": "false"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "bdc64095-d59a-42a2-8588-71fd9c9d9abc",
            "level": "high",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2022/12/09",
            "references": [
                "https://learn.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump",
                "https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html",
                "https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6"
            ],
            "related": [
                {
                    "id": "0e277796-5f23-4e49-a490-483131d4f6e1",
                    "type": "similar"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Suspicious Unsigned Dbghelp/Dbgcore DLL Loaded"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/10/22",
            "description": "Loading unsigned image (DLL, EXE) into LSASS process",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\lsass.exe",
                    "Signed": "false"
                }
            },
            "falsepositives": [
                "Valid user connecting using RDP"
            ],
            "id": "857c8db3-c89b-42fb-882b-f681c7cf4da2",
            "level": "medium",
            "logsource": {
                "category": "image_load",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Unsigned Image Loaded Into LSASS Process"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/11/15",
            "description": "Detects creation of files with names used by different memory dumping tools to create a memory dump of the LSASS process memory, which contains user credentials.",
            "detection": {
                "condition": "1 of selection_*",
                "selection_1": {
                    "TargetFilename|endswith": [
                        "\\lsass.dmp",
                        "\\lsass.zip",
                        "\\lsass.rar",
                        "\\Andrew.dmp",
                        "\\Coredump.dmp",
                        "\\NotLSASS.zip",
                        "\\PPLBlade.dmp"
                    ]
                },
                "selection_2": {
                    "TargetFilename|contains": [
                        "\\lsass_2",
                        "\\lsassdump",
                        "\\lsassdmp"
                    ]
                },
                "selection_3": {
                    "TargetFilename|contains|all": [
                        "\\lsass",
                        ".dmp"
                    ]
                },
                "selection_4": {
                    "TargetFilename|contains": "SQLDmpr",
                    "TargetFilename|endswith": ".mdmp"
                },
                "selection_5": {
                    "TargetFilename|endswith": ".dmp",
                    "TargetFilename|startswith": "nanodump"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a5a2d357-1ab8-4675-a967-ef9990a59391",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/09/05",
            "references": [
                "https://www.google.com/search?q=procdump+lsass",
                "https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf",
                "https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/credential_access_lsass_memdump_file_created.toml",
                "https://www.whiteoaksecurity.com/blog/attacks-defenses-dumping-lsass-no-mimikatz/",
                "https://github.com/helpsystems/nanodump",
                "https://github.com/CCob/MirrorDump"
            ],
            "related": [
                {
                    "id": "db2110f3-479d-42a6-94fb-d35bc1e46492",
                    "type": "obsoletes"
                },
                {
                    "id": "5e3d3601-0662-4af0-b1d2-36a05e90c40a",
                    "type": "obsoletes"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "LSASS Process Memory Dump Files"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2024/03/11",
            "description": "Detects file creation events with filename patterns used by CrackMapExec.",
            "detection": {
                "condition": "selection_path and 1 of selection_names_*",
                "selection_names_re": [
                    {
                        "TargetFilename|re": "\\\\[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\\.txt$"
                    },
                    {
                        "TargetFilename|re": "\\\\[a-zA-Z]{8}\\.tmp$"
                    }
                ],
                "selection_names_str": {
                    "TargetFilename|endswith": [
                        "\\temp.ps1",
                        "\\msol.ps1"
                    ]
                },
                "selection_path": {
                    "TargetFilename|startswith": "C:\\Windows\\Temp\\"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "736ffa74-5f6f-44ca-94ef-1c0df4f51d2a",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2024/06/27",
            "references": [
                "https://github.com/byt3bl33d3r/CrackMapExec/"
            ],
            "related": [
                {
                    "id": "9433ff9c-5d3f-4269-99f8-95fc826ea489",
                    "type": "obsoletes"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "experimental",
            "title": "HackTool - CrackMapExec File Indicators"
        },
        {
            "author": "@pbssubhash",
            "date": "2022/12/08",
            "description": "Detects the presence of an LSASS dump file in the \"CrashDumps\" folder. This could be a sign of LSASS credential dumping. Techniques such as the LSASS Shtinkering have been seen abusing the Windows Error Reporting to dump said process.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename|contains": "lsass.exe.",
                    "TargetFilename|endswith": ".dmp",
                    "TargetFilename|startswith": "C:\\Windows\\System32\\config\\systemprofile\\AppData\\Local\\CrashDumps\\"
                }
            },
            "falsepositives": [
                "Rare legitimate dump of the process by the operating system due to a crash of lsass"
            ],
            "id": "6902955a-01b7-432c-b32a-6f5f81d8f625",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://github.com/deepinstinct/Lsass-Shtinkering",
                "https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Asaf%20Gilboa%20-%20LSASS%20Shtinkering%20Abusing%20Windows%20Error%20Reporting%20to%20Dump%20LSASS.pdf"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "LSASS Process Dump Artefact In CrashDumps Folder",
            "status": "test"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/06/27",
            "description": "Detects WerFault creating a dump file with a name that indicates that the dump file could be an LSASS process memory, which contains user credentials",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image": "C:\\WINDOWS\\system32\\WerFault.exe",
                    "TargetFilename|contains": [
                        "\\lsass",
                        "lsass.exe"
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c3e76af5-4ce0-4a14-9c9a-25ceb8fda182",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://github.com/helpsystems/nanodump"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "WerFault LSASS Process Memory Dump",
            "status": "test"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/11/01",
            "description": "Files with well-known filenames (parts of credential dump software or files produced by them) creation",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "TargetFilename|contains": [
                            "\\fgdump-log",
                            "\\kirbi",
                            "\\pwdump",
                            "\\pwhashes",
                            "\\wce_ccache",
                            "\\wce_krbtkts"
                        ]
                    },
                    {
                        "TargetFilename|endswith": [
                            "\\cachedump.exe",
                            "\\cachedump64.exe",
                            "\\DumpExt.dll",
                            "\\DumpSvc.exe",
                            "\\Dumpy.exe",
                            "\\fgexec.exe",
                            "\\lsremora.dll",
                            "\\lsremora64.dll",
                            "\\NTDS.out",
                            "\\procdump64.exe",
                            "\\pstgdump.exe",
                            "\\pwdump.exe",
                            "\\SAM.out",
                            "\\SECURITY.out",
                            "\\servpw.exe",
                            "\\servpw64.exe",
                            "\\SYSTEM.out",
                            "\\test.pwd",
                            "\\wceaux.dll"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Legitimate Administrator using tool for password recovery"
            ],
            "id": "8fbf3271-1ef6-4e94-8210-03c2317947f6",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2022/09/21",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.003",
                "attack.t1003.004",
                "attack.t1003.005"
            ],
            "title": "Cred Dump Tools Dropped Files"
        },
        {
            "author": "Markus Neis",
            "date": "2018/07/24",
            "description": "Detects default lsass dump filename generated by SafetyKatz.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename|endswith": "\\Temp\\debug.bin"
                }
            },
            "falsepositives": [
                "Rare legitimate files with similar filename structure"
            ],
            "id": "e074832a-eada-4fd7-94a1-10642b130e16",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2024/06/27",
            "references": [
                "https://github.com/GhostPack/SafetyKatz",
                "https://github.com/GhostPack/SafetyKatz/blob/715b311f76eb3a4c8d00a1bd29c6cd1899e450b7/SafetyKatz/Program.cs#L63"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - SafetyKatz Dump Indicator"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2020/02/04",
            "description": "Detects the creation of the default dump file used by Outflank Dumpert tool. A process dumper, which dumps the lsass process memory",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetFilename|endswith": "dumpert.dmp"
                }
            },
            "falsepositives": [
                "Very unlikely"
            ],
            "id": "93d94efc-d7ad-4161-ad7d-1638c4f908d8",
            "level": "critical",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "modified": "2023/05/09",
            "references": [
                "https://github.com/outflanknl/Dumpert",
                "https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/"
            ],
            "related": [
                {
                    "id": "2704ab9e-afe2-4854-a3b1-0c0706d03578",
                    "type": "derived"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - Dumpert Process Dumper Default File"
        },
        {
            "author": "Swachchhanda Shrawan Poudel",
            "date": "2023/10/19",
            "description": "Detects the creation of an \"lsass.dmp\" file by the taskmgr process. This indicates a manual dumping of the LSASS.exe process memory using Windows Task Manager.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        ":\\Windows\\system32\\taskmgr.exe",
                        ":\\Windows\\SysWOW64\\taskmgr.exe"
                    ],
                    "TargetFilename|contains|all": [
                        "\\AppData\\Local\\Temp\\",
                        "\\lsass",
                        ".DMP"
                    ]
                }
            },
            "falsepositives": [
                "Rare case of troubleshooting by an administrator or support that has to be investigated regardless"
            ],
            "id": "69ca12af-119d-44ed-b50f-a47af0ebc364",
            "level": "high",
            "logsource": {
                "category": "file_event",
                "product": "windows"
            },
            "references": [
                "https://github.com/redcanaryco/atomic-red-team/blob/987e3ca988ae3cff4b9f6e388c139c05bf44bbb8/atomics/T1003.001/T1003.001.md#L1"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "LSASS Process Memory Dump Creation Via Taskmgr.EXE",
            "status": "experimental"
        },
        {
            "author": "Florian Roth (Nextron Systems), Modexp, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2020/02/18",
            "description": "Detects a process memory dump via \"comsvcs.dll\" using rundll32, covering multiple different techniques (ordinal, minidump function, etc.)",
            "detection": {
                "condition": "(selection_img and 1 of selection_cli_*) or selection_generic",
                "selection_cli_1": {
                    "CommandLine|contains": [
                        "#-",
                        "#+",
                        "#24",
                        "24 ",
                        "MiniDump"
                    ],
                    "CommandLine|contains|all": [
                        "comsvcs",
                        "full"
                    ]
                },
                "selection_generic": {
                    "CommandLine|contains": [
                        " #",
                        ",#",
                        ", #"
                    ],
                    "CommandLine|contains|all": [
                        "24",
                        "comsvcs",
                        "full"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rundll32.exe"
                    },
                    {
                        "OriginalFileName": "RUNDLL32.EXE"
                    },
                    {
                        "CommandLine|contains": "rundll32"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "646ea171-dded-4578-8a4d-65e9822892e3",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/16",
            "references": [
                "https://twitter.com/shantanukhande/status/1229348874298388484",
                "https://twitter.com/pythonresponder/status/1385064506049630211?s=21",
                "https://twitter.com/Hexacorn/status/1224848930795552769",
                "https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/",
                "https://twitter.com/SBousseaden/status/1167417096374050817",
                "https://twitter.com/Wietze/status/1542107456507203586",
                "https://github.com/Hackndo/lsassy/blob/14d8f8ae596ecf22b449bfe919829173b8a07635/lsassy/dumpmethod/comsvcs.py"
            ],
            "related": [
                {
                    "id": "09e6d5c0-05b8-4ff8-9eeb-043046ec774c",
                    "type": "obsoletes"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.t1036",
                "attack.t1003.001",
                "car.2013-05-009"
            ],
            "title": "Process Memory Dump Via Comsvcs.DLL"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community, David ANDRE (additional keywords), Tim Shelton",
            "date": "2019/10/22",
            "description": "Detection well-known mimikatz command line arguments",
            "detection": {
                "condition": "1 of selection_*",
                "selection_function_names": {
                    "CommandLine|contains": [
                        "::aadcookie",
                        "::detours",
                        "::memssp",
                        "::mflt",
                        "::ncroutemon",
                        "::ngcsign",
                        "::printnightmare",
                        "::skeleton",
                        "::preshutdown",
                        "::mstsc",
                        "::multirdp"
                    ]
                },
                "selection_module_names": {
                    "CommandLine|contains": [
                        "rpc::",
                        "token::",
                        "crypto::",
                        "dpapi::",
                        "sekurlsa::",
                        "kerberos::",
                        "lsadump::",
                        "privilege::",
                        "process::",
                        "vault::"
                    ]
                },
                "selection_tools_name": {
                    "CommandLine|contains": [
                        "DumpCreds",
                        "mimikatz"
                    ]
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "a642964e-bead-4bed-8910-1bb4d63e3b4d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/21",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://tools.thehacker.recipes/mimikatz/modules"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006"
            ],
            "title": "HackTool - Mimikatz Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/31",
            "description": "Detects the use of Windows Credential Editor (WCE)",
            "detection": {
                "condition": "1 of selection_* and not filter",
                "filter": {
                    "Image|endswith": "\\clussvc.exe"
                },
                "selection_1": [
                    {
                        "Imphash": [
                            "a53a02b997935fd8eedcb5f7abab9b9f",
                            "e96a73c7bf33a464c510ede582318bf2"
                        ]
                    },
                    {
                        "Hashes|contains": [
                            "IMPHASH=a53a02b997935fd8eedcb5f7abab9b9f",
                            "IMPHASH=e96a73c7bf33a464c510ede582318bf2"
                        ]
                    }
                ],
                "selection_2": {
                    "CommandLine|endswith": ".exe -S",
                    "ParentImage|endswith": "\\services.exe"
                }
            },
            "falsepositives": [
                "Another service that uses a single -s command line switch"
            ],
            "id": "7aa7009a-28b9-4344-8c1f-159489a390df",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://www.ampliasecurity.com/research/windows-credentials-editor/"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0005"
            ],
            "title": "HackTool - Windows Credential Editor (WCE) Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/03/12",
            "description": "Detects suspicious process patterns found in logs when CrackMapExec is used",
            "detection": {
                "condition": "1 of selection*",
                "selection_lsass_dump1": {
                    "CommandLine|contains": [
                        "cmd.exe /c ",
                        "cmd.exe /r ",
                        "cmd.exe /k ",
                        "cmd /c ",
                        "cmd /r ",
                        "cmd /k "
                    ],
                    "CommandLine|contains|all": [
                        "tasklist /fi ",
                        "Imagename eq lsass.exe"
                    ],
                    "User|contains": [
                        "AUTHORI",
                        "AUTORI"
                    ]
                },
                "selection_lsass_dump2": {
                    "CommandLine|contains|all": [
                        "do rundll32.exe C:\\windows\\System32\\comsvcs.dll, MiniDump",
                        "\\Windows\\Temp\\",
                        " full",
                        "%%B"
                    ]
                },
                "selection_procdump": {
                    "CommandLine|contains|all": [
                        "tasklist /v /fo csv",
                        "findstr /i \"lsass\""
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "f26307d8-14cd-47e3-a26b-4b4769f24af6",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/13",
            "references": [
                "https://mpgn.gitbook.io/crackmapexec/smb-protocol/obtaining-credentials/dump-lsass"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - CrackMapExec Process Patterns"
        },
        {
            "id": "2704ab9e-afe2-4854-a3b1-0c0706d03578",
            "author": "Florian Roth (Nextron Systems)",
            "date": "2020/02/04",
            "description": "Detects the use of Dumpert process dumper, which dumps the lsass.exe process memory",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Hashes|contains": "09D278F9DE118EF09163C6140255C690"
                    },
                    {
                        "CommandLine|contains": "Dumpert.dll"
                    }
                ]
            },
            "falsepositives": [
                "Very unlikely"
            ],
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/outflanknl/Dumpert",
                "https://unit42.paloaltonetworks.com/actors-still-exploiting-sharepoint-vulnerability/"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - Dumpert Process Dumper Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/01/04",
            "description": "Detects uses of the createdump.exe LOLOBIN utility to dump process memory",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " -u ",
                        " --full ",
                        " -f ",
                        " --name ",
                        ".dmp "
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\createdump.exe"
                    },
                    {
                        "OriginalFileName": "FX_VER_INTERNALNAME_STR"
                    }
                ]
            },
            "falsepositives": [
                "Command lines that use the same flags"
            ],
            "id": "515c8be5-e5df-4c5e-8f6d-a4a2f05e4b48",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/08/19",
            "references": [
                "https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/",
                "https://twitter.com/bopin2020/status/1366400799199272960"
            ],
            "related": [
                {
                    "id": "1a1ed54a-2ba4-4221-94d5-01dee560d71e",
                    "type": "similar"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ],
            "title": "CreateDump Process Dump"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/06/09",
            "description": "Detects execution of \"AdPlus.exe\", a binary that is part of the Windows SDK that can be used as a LOLBIN in order to dump process memory and execute arbitrary commands.",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " -hang ",
                        " -pn ",
                        " -pmn ",
                        " -p ",
                        " -po ",
                        " -c ",
                        " -sc "
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\adplus.exe"
                    },
                    {
                        "OriginalFileName": "Adplus.exe"
                    }
                ]
            },
            "falsepositives": [
                "Legitimate usage of Adplus for debugging purposes"
            ],
            "id": "2f869d59-7f6a-4931-992c-cce556ff2d53",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/06/23",
            "references": [
                "https://lolbas-project.github.io/lolbas/OtherMSBinaries/Adplus/",
                "https://twitter.com/nas_bench/status/1534916659676422152",
                "https://twitter.com/nas_bench/status/1534915321856917506"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.execution",
                "attack.t1003.001"
            ],
            "title": "Potential Adplus.EXE Abuse"
        },
        {
            "id": "1a1ed54a-2ba4-4221-94d5-01dee560d71e",
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/09/20",
            "description": "Detects uses of a renamed legitimate createdump.exe LOLOBIN utility to dump process memory",
            "detection": {
                "condition": "1 of selection_* and not filter",
                "filter": {
                    "Image|endswith": "\\createdump.exe"
                },
                "selection_cli": [
                    {
                        "CommandLine|contains|all": [
                            " -u ",
                            " -f ",
                            ".dmp"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            " --full ",
                            " --name ",
                            ".dmp"
                        ]
                    }
                ],
                "selection_pe": {
                    "OriginalFileName": "FX_VER_INTERNALNAME_STR"
                }
            },
            "falsepositives": [
                "Command lines that use the same flags"
            ],
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/14",
            "references": [
                "https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/",
                "https://twitter.com/bopin2020/status/1366400799199272960"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "515c8be5-e5df-4c5e-8f6d-a4a2f05e4b48"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ],
            "title": "Renamed CreateDump Utility Execution"
        },
        {
            "author": "@pbssubhash , Nasreddine Bencherchali",
            "date": "2022/12/08",
            "description": "Detects potential credential dumping via Windows Error Reporting LSASS Shtinkering technique which uses the Windows Error Reporting to dump lsass",
            "detection": {
                "condition": "all of selection_* and not 1 of filter_*",
                "filter_lsass": {
                    "ParentImage": "C:\\Windows\\System32\\lsass.exe"
                },
                "selection_cli": {
                    "CommandLine|contains|all": [
                        " -u -p ",
                        " -ip ",
                        " -s "
                    ],
                    "ParentUser|contains": [
                        "AUTHORI",
                        "AUTORI"
                    ],
                    "User|contains": [
                        "AUTHORI",
                        "AUTORI"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\Werfault.exe"
                    },
                    {
                        "OriginalFileName": "WerFault.exe"
                    }
                ]
            },
            "falsepositives": [
                "Windows Error Reporting might produce similar behavior. In that case, check the PID associated with the \"-p\" parameter in the CommandLine."
            ],
            "id": "9a4ccd1a-3526-4d99-b980-9f9c5d3a6ff3",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "references": [
                "https://github.com/deepinstinct/Lsass-Shtinkering",
                "https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Asaf%20Gilboa%20-%20LSASS%20Shtinkering%20Abusing%20Windows%20Error%20Reporting%20to%20Dump%20LSASS.pdf"
            ],
            "modified": "2022/12/09",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Potential Credential Dumping Via WER"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/04/06",
            "description": "Detects suspicious ways to use the \"DumpMinitool.exe\" binary",
            "detection": {
                "cmd_has_flags": {
                    "CommandLine|contains": [
                        " Full",
                        " Mini",
                        " WithHeap"
                    ]
                },
                "condition": "selection and ( ( not filter_folder ) or susp_flags or ( cmd_has_flags and not filter_cmd_misses_flags ) )",
                "filter_cmd_misses_flags": {
                    "CommandLine|contains": "--dumpType"
                },
                "filter_folder": {
                    "Image|contains": [
                        "\\Microsoft Visual Studio\\",
                        "\\Extensions\\"
                    ]
                },
                "selection": [
                    {
                        "Image|endswith": [
                            "\\DumpMinitool.exe",
                            "\\DumpMinitool.x86.exe",
                            "\\DumpMinitool.arm64.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "DumpMinitool.exe",
                            "DumpMinitool.x86.exe",
                            "DumpMinitool.arm64.exe"
                        ]
                    }
                ],
                "susp_flags": {
                    "CommandLine|contains": ".txt"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "eb1c4225-1c23-4241-8dd4-051389fde4ce",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/12",
            "references": [
                "https://twitter.com/mrd0x/status/1511415432888131586",
                "https://twitter.com/mrd0x/status/1511489821247684615",
                "https://lolbas-project.github.io/lolbas/OtherMSBinaries/DumpMinitool/"
            ],
            "status": "test",
            "title": "Suspicious DumpMinitool Execution",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ]
        },
        {
            "author": "Cedric MAURUGEON, Florian Roth (Nextron Systems), Swachchhanda Shrawan Poudel, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/09/24",
            "description": "Detects the use of the Microsoft Windows Resource Leak Diagnostic tool \"rdrleakdiag.exe\" to dump process memory",
            "detection": {
                "condition": "all of selection_cli_* or (selection_img and selection_cli_dump)",
                "selection_cli_dump": {
                    "CommandLine|contains": [
                        "fullmemdmp",
                        "/memdmp",
                        "-memdmp"
                    ]
                },
                "selection_cli_output": {
                    "CommandLine|contains": [
                        " -o ",
                        " /o "
                    ]
                },
                "selection_cli_process": {
                    "CommandLine|contains": [
                        " -p ",
                        " /p "
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": "\\rdrleakdiag.exe"
                    },
                    {
                        "OriginalFileName": "RdrLeakDiag.exe"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "edadb1e5-5919-4e4c-8462-a9e643b02c4b",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/24",
            "references": [
                "https://www.pureid.io/dumping-abusing-windows-credentials-part-1/",
                "https://www.crowdstrike.com/blog/overwatch-exposes-aquatic-panda-in-possession-of-log-4-shell-exploit-tools/",
                "https://lolbas-project.github.io/lolbas/Binaries/Rdrleakdiag/",
                "https://twitter.com/0gtweet/status/1299071304805560321?s=21"
            ],
            "related": [
                {
                    "id": "6355a919-2e97-4285-a673-74645566340d",
                    "type": "obsoletes"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Process Memory Dump via RdrLeakDiag.EXE"
        },
        {
            "author": "Ensar \u015eamil, @sblmsrsn, @oscd_initiative",
            "date": "2020/10/06",
            "description": "Detects usage of Time Travel Debugging Utility. Adversaries can execute malicious processes and dump processes, such as lsass.exe, via tttracer.exe.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ParentImage|endswith": "\\tttracer.exe"
                }
            },
            "falsepositives": [
                "Legitimate usage by software developers/testers"
            ],
            "id": "0b4ae027-2a2d-4b93-8c7e-962caaba5b2a",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/10/09",
            "references": [
                "https://lolbas-project.github.io/lolbas/Binaries/Tttracer/",
                "https://twitter.com/mattifestation/status/1196390321783025666",
                "https://twitter.com/oulusoyum/status/1191329746069655553"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "e76c8240-d68f-4773-8880-5c6f63595aaf"
                }
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.credential_access",
                "attack.t1218",
                "attack.t1003.001"
            ],
            "title": "Time Travel Debugging Utility Usage"
        },
        {
            "author": "E.M. Anhaus, Tony Lambert, oscd.community, Nasreddine Bencherchali (Nextron Systems)",
            "date": "2019/10/24",
            "description": "Detects the presence of the keywords \"lsass\" and \".dmp\" in the commandline, which could indicate a potential attempt to dump or create a dump of the lsass process.\n",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "CommandLine|contains": [
                            "lsass.dmp",
                            "lsass.zip",
                            "lsass.rar",
                            "Andrew.dmp",
                            "Coredump.dmp",
                            "NotLSASS.zip",
                            "lsass_2",
                            "lsassdump",
                            "lsassdmp"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "lsass",
                            ".dmp"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "SQLDmpr",
                            ".mdmp"
                        ]
                    },
                    {
                        "CommandLine|contains|all": [
                            "nanodump",
                            ".dmp"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "ffa6861c-4461-4f59-8a41-578c39f3f23e",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/08/29",
            "references": [
                "https://github.com/Hackndo/lsassy",
                "https://medium.com/@markmotig/some-ways-to-dump-lsass-exe-c4a75fdc49bf",
                "https://github.com/elastic/detection-rules/blob/c76a39796972ecde44cb1da6df47f1b6562c9770/rules/windows/credential_access_lsass_memdump_file_created.toml",
                "https://www.whiteoaksecurity.com/blog/attacks-defenses-dumping-lsass-no-mimikatz/",
                "https://github.com/helpsystems/nanodump",
                "https://github.com/CCob/MirrorDump"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "a5a2d357-1ab8-4675-a967-ef9990a59391"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "LSASS Dump Keyword In CommandLine"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/22",
            "description": "Detects the use of CreateMiniDump hack tool used to dump the LSASS process memory for credential extraction on the attacker's machine",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\CreateMiniDump.exe"
                    },
                    {
                        "Imphash": "4a07f944a83e8a7c2525efa35dd30e2f"
                    },
                    {
                        "Hashes|contains": "IMPHASH=4a07f944a83e8a7c2525efa35dd30e2f"
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "36d88494-1d43-4dc0-b3fa-35c8fea0ca9d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsass-passwords-without-mimikatz-minidumpwritedump-av-signature-bypass"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - CreateMiniDump Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2018/10/30",
            "description": "Detects suspicious uses of the SysInternals Procdump utility by using a special command line parameter in combination with the lsass.exe process.\nThis way we are also able to catch cases in which the attacker has renamed the procdump executable.\n",
            "detection": {
                "condition": "all of selection*",
                "selection_flags": {
                    "CommandLine|contains|windash": " -ma "
                },
                "selection_process": {
                    "CommandLine|contains": " ls"
                }
            },
            "falsepositives": [
                "Unlikely, because no one should dump an lsass process memory",
                "Another tool that uses command line flags similar to ProcDump"
            ],
            "id": "5afee48e-67dd-4e03-a783-f74259dcf998",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/03/13",
            "references": [
                "https://learn.microsoft.com/en-us/sysinternals/downloads/procdump"
            ],
            "status": "stable",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.credential_access",
                "attack.t1003.001",
                "car.2013-05-009"
            ],
            "title": "Potential LSASS Process Dump Via Procdump"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/20",
            "description": "Detects the execution of the hacktool SafetyKatz via PE information and default Image name",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\SafetyKatz.exe"
                    },
                    {
                        "OriginalFileName": "SafetyKatz.exe"
                    },
                    {
                        "Description": "SafetyKatz"
                    }
                ]
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "b1876533-4ed5-4a83-90f3-b8645840a413",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/GhostPack/SafetyKatz"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - SafetyKatz Execution"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/08/18",
            "description": "Detects the use of HandleKatz, a tool that demonstrates the usage of cloned handles to Lsass in order to create an obfuscated memory dump of the same",
            "detection": {
                "condition": "1 of selection_*",
                "selection_flags": {
                    "CommandLine|contains": [
                        ".dmp",
                        "lsass",
                        ".obf",
                        "dump"
                    ],
                    "CommandLine|contains|all": [
                        "--pid:",
                        "--outfile:"
                    ]
                },
                "selection_loader_img": {
                    "CommandLine|contains": "--pid:",
                    "Image|endswith": "\\loader.exe"
                },
                "selection_loader_imphash": [
                    {
                        "Imphash": [
                            "38d9e015591bbfd4929e0d0f47fa0055",
                            "0e2216679ca6e1094d63322e3412d650"
                        ]
                    },
                    {
                        "Hashes|contains": [
                            "IMPHASH=38D9E015591BBFD4929E0D0F47FA0055",
                            "IMPHASH=0E2216679CA6E1094D63322E3412D650"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "ca621ba5-54ab-4035-9942-d378e6fcde3c",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/04/15",
            "references": [
                "https://github.com/codewhitesec/HandleKatz"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - HandleKatz LSASS Dumper Execution"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems), Florian Roth (Nextron Systems)",
            "date": "2022/04/06",
            "description": "Detects the use of \"DumpMinitool.exe\" a tool that allows the dump of process memory via the use of the \"MiniDumpWriteDump\"",
            "detection": {
                "condition": "all of selection_*",
                "selection_cli": {
                    "CommandLine|contains": [
                        " Full",
                        " Mini",
                        " WithHeap"
                    ]
                },
                "selection_img": [
                    {
                        "Image|endswith": [
                            "\\DumpMinitool.exe",
                            "\\DumpMinitool.x86.exe",
                            "\\DumpMinitool.arm64.exe"
                        ]
                    },
                    {
                        "OriginalFileName": [
                            "DumpMinitool.exe",
                            "DumpMinitool.x86.exe",
                            "DumpMinitool.arm64.exe"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "dee0a7a3-f200-4112-a99b-952196d81e42",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/04/12",
            "references": [
                "https://twitter.com/mrd0x/status/1511415432888131586",
                "https://twitter.com/mrd0x/status/1511489821247684615",
                "https://lolbas-project.github.io/lolbas/OtherMSBinaries/DumpMinitool/",
                "https://gist.github.com/nasbench/6d58c3c125e2fa1b8f7a09754c1b087f"
            ],
            "status": "test",
            "title": "DumpMinitool Execution",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems), Samir Bousseaden",
            "date": "2021/11/27",
            "description": "Detects a suspicious LSASS process process clone that could be a sign of credential dumping activity",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": "\\Windows\\System32\\lsass.exe",
                    "ParentImage|endswith": "\\Windows\\System32\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "c8da0dfd-4ed0-4b68-962d-13c9c884384e",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/03/02",
            "references": [
                "https://www.matteomalvica.com/blog/2019/12/02/win-defender-atp-cred-bypass/",
                "https://twitter.com/Hexacorn/status/1420053502554951689",
                "https://twitter.com/SBousseaden/status/1464566846594691073?s=20"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003",
                "attack.t1003.001"
            ],
            "title": "Potential Credential Dumping Via LSASS Process Clone"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/01/11",
            "description": "Detects uses of the SysInternals ProcDump utility in which ProcDump or its output get renamed, or a dump file is moved or copied to a different name",
            "detection": {
                "condition": "1 of selection_*",
                "selection_1": {
                    "CommandLine|contains": [
                        "copy procdump",
                        "move procdump"
                    ]
                },
                "selection_2": {
                    "CommandLine|contains": [
                        "2.dmp",
                        "lsass",
                        "out.dmp"
                    ],
                    "CommandLine|contains|all": [
                        "copy ",
                        ".dmp "
                    ]
                },
                "selection_3": {
                    "CommandLine|contains": [
                        "copy lsass.exe_",
                        "move lsass.exe_"
                    ]
                }
            },
            "falsepositives": [
                "False positives are expected in cases in which ProcDump just gets copied to a different directory without any renaming"
            ],
            "id": "79b06761-465f-4f88-9ef2-150e24d3d737",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/05/09",
            "references": [
                "https://twitter.com/mrd0x/status/1480785527901204481"
            ],
            "status": "test",
            "title": "Potential SysInternals ProcDump Evasion",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/01/28",
            "description": "Detects suspicious use of XORDump process memory dumping utility",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\xordump.exe"
                    },
                    {
                        "CommandLine|contains": [
                            " -process lsass.exe ",
                            " -m comsvcs ",
                            " -m dbghelp ",
                            " -m dbgcore "
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Another tool that uses the command line switches of XORdump"
            ],
            "id": "66e563f9-1cbd-4a22-a957-d8b7c0f44372",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/08",
            "references": [
                "https://github.com/audibleblink/xordump"
            ],
            "status": "test",
            "title": "HackTool - XORDump Execution",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/08/16",
            "description": "Detects usage of the SysInternals Procdump utility",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Image|endswith": [
                        "\\procdump.exe",
                        "\\procdump64.exe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate use of procdump by a developer or administrator"
            ],
            "id": "2e65275c-8288-4ab4-aeb7-6274f58b6b20",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/28",
            "references": [
                "https://learn.microsoft.com/en-us/sysinternals/downloads/procdump"
            ],
            "status": "test",
            "title": "Procdump Execution",
            "tags": [
                "attack.defense_evasion",
                "attack.t1036",
                "attack.t1003.001"
            ]
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2022/02/10",
            "description": "Detects a possible process memory dump that uses the white-listed Citrix TrolleyExpress.exe filename as a way to dump the lsass process memory",
            "detection": {
                "condition": "selection or ( renamed and not 1 of filter* )",
                "filter_empty": {
                    "OriginalFileName": null
                },
                "filter_renamed": {
                    "OriginalFileName|contains": "CtxInstall"
                },
                "renamed": {
                    "Image|endswith": "\\TrolleyExpress.exe"
                },
                "selection": {
                    "CommandLine|contains": [
                        "\\TrolleyExpress 7",
                        "\\TrolleyExpress 8",
                        "\\TrolleyExpress 9",
                        "\\TrolleyExpress.exe 7",
                        "\\TrolleyExpress.exe 8",
                        "\\TrolleyExpress.exe 9",
                        "\\TrolleyExpress.exe -ma "
                    ]
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "fields": [
                "CommandLine",
                "ParentCommandLine"
            ],
            "id": "4c0aaedc-154c-4427-ada0-d80ef9c9deb6",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2022/05/13",
            "references": [
                "https://twitter.com/_xpn_/status/1491557187168178176",
                "https://www.youtube.com/watch?v=Ie831jF0bb0"
            ],
            "status": "test",
            "tags": [
                "attack.defense_evasion",
                "attack.t1218.011",
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "Process Access via TrolleyExpress Exclusion"
        },
        {
            "author": "Austin Songer @austinsonger, Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)",
            "date": "2021/11/26",
            "description": "Detects when a user is potentially trying to bypass the Windows Defender AV by renaming a tool to dump64.exe and placing it in the Visual Studio folder.\nCurrently the rule is covering only usage of procdump but other utilities can be added in order to increase coverage.\n",
            "detection": {
                "condition": "selection_dump and 1 of selection_tools_*",
                "selection_dump": {
                    "Image|contains": "\\Microsoft Visual Studio\\",
                    "Image|endswith": "\\dump64.exe",
                    "Image|startswith": ":\\Program Files"
                },
                "selection_tools_procdump": [
                    {
                        "OriginalFileName": "procdump"
                    },
                    {
                        "CommandLine|contains": [
                            " -ma ",
                            " -mp "
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "129966c9-de17-4334-a123-8b58172e664d",
            "level": "high",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2024/06/21",
            "references": [
                "https://twitter.com/mrd0x/status/1460597833917251595"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Potential Windows Defender AV Bypass Via Dump64.EXE Rename"
        },
        {
            "author": "Kirill Kiryanov, oscd.community",
            "date": "2020/10/08",
            "description": "Detects process dump via legitimate sqldumper.exe binary",
            "detection": {
                "condition": "selection",
                "selection": {
                    "CommandLine|contains": [
                        "0x0110",
                        "0x01100:40"
                    ],
                    "Image|endswith": "\\sqldumper.exe"
                }
            },
            "falsepositives": [
                "Legitimate MSSQL Server actions"
            ],
            "id": "23ceaf5c-b6f1-4a32-8559-f2ff734be516",
            "level": "medium",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "references": [
                "https://twitter.com/countuponsec/status/910977826853068800",
                "https://twitter.com/countuponsec/status/910969424215232518",
                "https://lolbas-project.github.io/lolbas/OtherMSBinaries/Sqldumper/"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Dumping Process via Sqldumper.exe"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/10/24",
            "description": "Detects the use of Inveigh a cross-platform .NET IPv4/IPv6 machine-in-the-middle tool",
            "detection": {
                "condition": "selection",
                "selection": [
                    {
                        "Image|endswith": "\\Inveigh.exe"
                    },
                    {
                        "OriginalFileName": [
                            "\\Inveigh.exe",
                            "\\Inveigh.dll"
                        ]
                    },
                    {
                        "Description": "Inveigh"
                    },
                    {
                        "CommandLine|contains": [
                            " -SpooferIP",
                            " -ReplyToIPs ",
                            " -ReplyToDomains ",
                            " -ReplyToMACs ",
                            " -SnifferIP"
                        ]
                    }
                ]
            },
            "falsepositives": [
                "Very unlikely"
            ],
            "id": "b99a1518-1ad5-4f65-bc95-1ffff97a8fd0",
            "level": "critical",
            "logsource": {
                "category": "process_creation",
                "product": "windows"
            },
            "modified": "2023/02/04",
            "references": [
                "https://github.com/Kevin-Robertson/Inveigh",
                "https://thedfirreport.com/2020/11/23/pysa-mespinoza-ransomware/"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "HackTool - Inveigh Execution"
        },
        {
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/11/01",
            "description": "Detects well-known credential dumping tools execution via specific named pipe creation",
            "detection": {
                "condition": "selection",
                "selection": {
                    "PipeName|contains": [
                        "\\cachedump",
                        "\\lsadump",
                        "\\wceservicepipe"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate Administrator using tool for password recovery"
            ],
            "id": "961d0ba2-3eea-4303-a930-2cf78bbfcc5e",
            "level": "critical",
            "logsource": {
                "category": "pipe_created",
                "product": "windows",
                "definition": "Note that you have to configure logging for Named Pipe Events in Sysmon config (Event ID 17 and Event ID 18). The basic configuration is in popular sysmon configuration (https://github.com/SwiftOnSecurity/sysmon-config), but it is worth verifying. You can also use other repo, e.g. https://github.com/Neo23x0/sysmon-config, https://github.com/olafhartong/sysmon-modular. How to test detection? You can check powershell script from this site https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575"
            },
            "modified": "2023/08/07",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment",
                "https://image.slidesharecdn.com/zeronights2017kheirkhabarov-171118103000/75/hunting-for-credentials-dumping-in-windows-environment-57-2048.jpg?cb=1666035799"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005"
            ],
            "title": "HackTool - Credential Dumping Tools Named Pipe Created"
        },
        {
            "author": "Florian Roth (Nextron Systems), David ANDRE (additional keywords)",
            "date": "2017/01/10",
            "description": "This method detects mimikatz keywords in different Eventlogs (some of them only appear in older Mimikatz version that are however still used by different threat groups)",
            "detection": {
                "condition": "keywords and not filter",
                "filter": {
                    "EventID": 15
                },
                "keywords": [
                    "dpapi::masterkey",
                    "eo.oe.kiwi",
                    "event::clear",
                    "event::drop",
                    "gentilkiwi.com",
                    "kerberos::golden",
                    "kerberos::ptc",
                    "kerberos::ptt",
                    "kerberos::tgt",
                    "Kiwi Legit Printer",
                    "lsadump::",
                    "mimidrv.sys",
                    "\\mimilib.dll",
                    "misc::printnightmare",
                    "misc::shadowcopies",
                    "misc::skeleton",
                    "privilege::backup",
                    "privilege::debug",
                    "privilege::driver",
                    "sekurlsa::"
                ]
            },
            "falsepositives": [
                "Naughty administrators",
                "AV Signature updates",
                "Files with Mimikatz in their filename"
            ],
            "id": "06d71506-7beb-4f22-8888-e2e5e2ca7fd8",
            "level": "high",
            "logsource": {
                "product": "windows"
            },
            "modified": "2022/01/05",
            "references": [
                "https://tools.thehacker.recipes/mimikatz/modules"
            ],
            "status": "test",
            "tags": [
                "attack.s0002",
                "attack.lateral_movement",
                "attack.credential_access",
                "car.2013-07-001",
                "car.2019-04-004",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.001",
                "attack.t1003.006"
            ],
            "title": "Mimikatz Use"
        },
        {
            "author": "Markus Neis",
            "date": "2018/08/26",
            "description": "Detects Access to LSASS Process",
            "detection": {
                "condition": "selection and not 1 of filter_*",
                "filter_begins": {
                    "ProcessName|startswith": [
                        "C:\\Windows\\System32\\DriverStore\\",
                        "C:\\WINDOWS\\Installer\\",
                        "C:\\Program Files\\",
                        "C:\\Program Files (x86)\\"
                    ]
                },
                "filter_exact": {
                    "ProcessName": [
                        "C:\\Windows\\System32\\atiesrxx.exe",
                        "C:\\Windows\\System32\\CompatTelRunner.exe",
                        "C:\\Windows\\System32\\msiexec.exe",
                        "C:\\Windows\\System32\\nvwmi64.exe",
                        "C:\\Windows\\System32\\svchost.exe",
                        "C:\\Windows\\System32\\Taskmgr.exe",
                        "C:\\Windows\\System32\\wbem\\WmiPrvSE.exe",
                        "C:\\Windows\\SysWOW64\\msiexec.exe"
                    ]
                },
                "filter_thor": {
                    "ProcessName|endswith": [
                        "\\thor64.exe",
                        "\\thor.exe"
                    ],
                    "ProcessName|startswith": "C:\\Windows\\Temp\\asgard2-agent\\"
                },
                "selection": {
                    "EventID": 1121,
                    "Path|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Google Chrome GoogleUpdate.exe",
                "Some Taskmgr.exe related activity"
            ],
            "id": "a0a278fe-2c0e-4de2-ac3c-c68b08a9ba98",
            "level": "high",
            "logsource": {
                "definition": "Requirements:Enabled Block credential stealing from the Windows local security authority subsystem (lsass.exe) from Attack Surface Reduction (GUID: 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2)",
                "product": "windows",
                "service": "windefend"
            },
            "modified": "2022/08/13",
            "references": [
                "https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "LSASS Access Detected via Attack Surface Reduction"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2017/03/05",
            "description": "Detects well-known credential dumping tools execution via service execution events",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 7045,
                    "ImagePath|contains": [
                        "cachedump",
                        "dumpsvc",
                        "fgexec",
                        "gsecdump",
                        "mimidrv",
                        "pwdump",
                        "servpw"
                    ],
                    "Provider_Name": "Service Control Manager"
                }
            },
            "falsepositives": [
                "Legitimate Administrator using credential dumping tool for password recovery"
            ],
            "id": "4976aa50-8f41-45c6-8b15-ab3fc10e79ed",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "system"
            },
            "modified": "2022/11/29",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006",
                "attack.t1569.002",
                "attack.s0005"
            ],
            "title": "Credential Dumping Tools Service Execution - System"
        },
        {
            "author": "Nasreddine Bencherchali (Nextron Systems)",
            "date": "2022/12/07",
            "description": "Detects Windows error reporting event where the process that crashed is lsass. This could be the cause of an intentional crash by techniques such as Lsass-Shtinkering to dump credential",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AppName": "lsass.exe",
                    "EventID": 1000,
                    "ExceptionCode": "c0000001",
                    "Provider_Name": "Application Error"
                }
            },
            "falsepositives": [
                "Rare legitimate crashing of the lsass process"
            ],
            "id": "a18e0862-127b-43ca-be12-1a542c75c7c5",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "application"
            },
            "references": [
                "https://github.com/deepinstinct/Lsass-Shtinkering",
                "https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Asaf%20Gilboa%20-%20LSASS%20Shtinkering%20Abusing%20Windows%20Error%20Reporting%20to%20Dump%20LSASS.pdf",
                "https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-erref/596a1078-e883-4972-9bbc-49e60bebca55"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "title": "Potential Credential Dumping Via WER - Application",
            "status": "test"
        },
        {
            "id": "910ab938-668b-401b-b08c-b596e80fdca5",
            "author": "Teymur Kheirkhabarov, oscd.community",
            "date": "2019/10/22",
            "description": "Transferring files with well-known filenames (sensitive files with credential data) using network shares",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 5145,
                    "RelativeTargetName|contains": [
                        "\\mimidrv",
                        "\\lsass",
                        "\\windows\\minidump\\",
                        "\\hiberfil",
                        "\\sqldmpr",
                        "\\sam",
                        "\\ntds.dit",
                        "\\security"
                    ]
                }
            },
            "falsepositives": [
                "Transferring sensitive files for legitimate administration work by legitimate administrator"
            ],
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2021/11/30",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "type": "similar",
                    "id": "2e69f167-47b5-4ae7-a390-47764529eff5"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.002",
                "attack.t1003.001",
                "attack.t1003.003"
            ],
            "title": "Transferring Files with Credential Data via Network Shares"
        },
        {
            "author": "sigma",
            "date": "2017/02/12",
            "description": "Detects process handle on LSASS process with certain access mask and object type SAM_DOMAIN",
            "detection": {
                "condition": "selection",
                "selection": {
                    "AccessMask": "0x705",
                    "EventID": 4656,
                    "ObjectType": "SAM_DOMAIN",
                    "ProcessName|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "aa1697b7-d611-4f9a-9cb2-5125b4ccfd5c",
            "level": "high",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/10/09",
            "references": [
                "https://twitter.com/jackcr/status/807385668833968128"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Password Dumper Activity on LSASS"
        },
        {
            "author": "Florian Roth (Nextron Systems), Teymur Kheirkhabarov, Daniil Yugoslavskiy, oscd.community",
            "date": "2017/03/05",
            "description": "Detects well-known credential dumping tools execution via service execution events",
            "detection": {
                "condition": "selection",
                "selection": {
                    "EventID": 4697,
                    "ServiceFileName|contains": [
                        "cachedump",
                        "dumpsvc",
                        "fgexec",
                        "gsecdump",
                        "mimidrv",
                        "pwdump",
                        "servpw"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate Administrator using credential dumping tool for password recovery"
            ],
            "id": "f0d1feba-4344-4ca9-8121-a6c97bd6df52",
            "level": "high",
            "logsource": {
                "definition": "The 'System Security Extension' audit subcategory need to be enabled to log the EID 4697",
                "product": "windows",
                "service": "security"
            },
            "modified": "2022/11/29",
            "references": [
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "related": [
                {
                    "type": "derived",
                    "id": "4976aa50-8f41-45c6-8b15-ab3fc10e79ed"
                }
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.execution",
                "attack.t1003.001",
                "attack.t1003.002",
                "attack.t1003.004",
                "attack.t1003.005",
                "attack.t1003.006",
                "attack.t1569.002",
                "attack.s0005"
            ],
            "title": "Credential Dumping Tools Service Execution - Security"
        },
        {
            "author": "Roberto Rodriguez @Cyb3rWard0g",
            "date": "2019/06/20",
            "description": "Detects potential mimikatz-like tools accessing LSASS from non system account",
            "detection": {
                "condition": "selection and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_generic": {
                    "ProcessName|contains": [
                        ":\\Program Files\\",
                        ":\\Program Files (x86)\\"
                    ]
                },
                "filter_main_service_account": {
                    "SubjectUserName|endswith": "$"
                },
                "filter_main_wmiprvse": {
                    "AccessMask": "0x1410",
                    "ProcessName": "C:\\Windows\\System32\\wbem\\WmiPrvSE.exe"
                },
                "filter_optional_steam": {
                    "ProcessName|contains": "\\SteamLibrary\\steamapps\\"
                },
                "selection": {
                    "AccessMask": [
                        "0x100000",
                        "0x1010",
                        "0x1400",
                        "0x1410",
                        "0x1418",
                        "0x1438",
                        "0x143a",
                        "0x1f0fff",
                        "0x1f1fff",
                        "0x1f2fff",
                        "0x1f3fff",
                        "0x40",
                        "143a",
                        "1f0fff",
                        "1f1fff",
                        "1f2fff",
                        "1f3fff"
                    ],
                    "EventID": [
                        4663,
                        4656
                    ],
                    "ObjectName|endswith": "\\lsass.exe",
                    "ObjectType": "Process"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "962fe167-e48d-4fd6-9974-11e5b9a5d6d1",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2023/12/11",
            "references": [
                "https://threathunterplaybook.com/hunts/windows/170105-LSASSMemoryReadAccess/notebook.html"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "LSASS Access From Non System Account"
        },
        {
            "author": "Roberto Rodriguez, Teymur Kheirkhabarov, Dimitrios Slamaris, Mark Russinovich, Aleksey Potapov, oscd.community (update)",
            "date": "2019/11/01",
            "description": "Detects process handle on LSASS process with certain access mask",
            "detection": {
                "condition": "1 of selection_* and not 1 of filter_main_* and not 1 of filter_optional_*",
                "filter_main_aurora": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|contains": ":\\Windows\\Temp\\asgard2-agent-sc\\aurora\\",
                    "ProcessName|endswith": "\\aurora-agent-64.exe"
                },
                "filter_main_avira1": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|contains|all": [
                        ":\\Users\\",
                        "\\AppData\\Local\\Temp\\is-"
                    ],
                    "ProcessName|endswith": "\\avira_system_speedup.tmp"
                },
                "filter_main_avira2": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|contains": ":\\Windows\\Temp\\",
                    "ProcessName|endswith": "\\avira_speedup_setup_update.tmp"
                },
                "filter_main_exact": {
                    "ProcessName|endswith": [
                        ":\\Windows\\System32\\taskhostw.exe",
                        ":\\Windows\\System32\\msiexec.exe",
                        ":\\Windows\\CCM\\CcmExec.exe"
                    ]
                },
                "filter_main_generic": {
                    "ProcessName|contains": ":\\Program Files"
                },
                "filter_main_googleupdate": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|contains": ":\\Windows\\SystemTemp\\",
                    "ProcessName|endswith": "\\GoogleUpdate.exe"
                },
                "filter_main_scenarioengine": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|endswith": "\\x64\\SCENARIOENGINE.EXE"
                },
                "filter_main_snmp": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|endswith": ":\\Windows\\System32\\snmp.exe"
                },
                "filter_main_specific": {
                    "ProcessName|contains": [
                        ":\\Program Files (x86)\\",
                        ":\\Program Files\\",
                        ":\\ProgramData\\Microsoft\\Windows Defender\\Platform\\",
                        ":\\Windows\\SysNative\\",
                        ":\\Windows\\System32\\",
                        ":\\Windows\\SysWow64\\",
                        ":\\Windows\\Temp\\asgard2-agent\\"
                    ],
                    "ProcessName|endswith": [
                        "\\csrss.exe",
                        "\\GamingServices.exe",
                        "\\lsm.exe",
                        "\\MicrosoftEdgeUpdate.exe",
                        "\\minionhost.exe",
                        "\\MRT.exe",
                        "\\MsMpEng.exe",
                        "\\perfmon.exe",
                        "\\procexp.exe",
                        "\\procexp64.exe",
                        "\\svchost.exe",
                        "\\taskmgr.exe",
                        "\\thor.exe",
                        "\\thor64.exe",
                        "\\vmtoolsd.exe",
                        "\\VsTskMgr.exe",
                        "\\wininit.exe",
                        "\\wmiprvse.exe",
                        "RtkAudUService64"
                    ]
                },
                "filter_main_sysmon": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|endswith": ":\\Windows\\Sysmon64.exe"
                },
                "filter_optional_procmon": {
                    "AccessList|contains": "%%4484",
                    "ProcessName|endswith": [
                        "\\procmon64.exe",
                        "\\procmon.exe"
                    ]
                },
                "selection_1": {
                    "AccessMask|contains": [
                        "0x40",
                        "0x1400",
                        "0x100000",
                        "0x1410",
                        "0x1010",
                        "0x1438",
                        "0x143a",
                        "0x1418",
                        "0x1f0fff",
                        "0x1f1fff",
                        "0x1f2fff",
                        "0x1f3fff"
                    ],
                    "EventID": 4656,
                    "ObjectName|endswith": "\\lsass.exe"
                },
                "selection_2": {
                    "AccessList|contains": [
                        "4484",
                        "4416"
                    ],
                    "EventID": 4663,
                    "ObjectName|endswith": "\\lsass.exe"
                }
            },
            "falsepositives": [
                "Legitimate software accessing LSASS process for legitimate reason; update the whitelist with it"
            ],
            "id": "4a1b6da0-d94f-4fc3-98fc-2d9cb9e5ee76",
            "level": "medium",
            "logsource": {
                "product": "windows",
                "service": "security"
            },
            "modified": "2023/12/19",
            "references": [
                "https://web.archive.org/web/20230208123920/https://cyberwardog.blogspot.com/2017/03/chronicles-of-threat-hunter-hunting-for_22.html",
                "https://www.slideshare.net/heirhabarov/hunting-for-credentials-dumping-in-windows-environment"
            ],
            "status": "experimental",
            "tags": [
                "attack.credential_access",
                "car.2019-04-004",
                "attack.t1003.001"
            ],
            "title": "Potentially Suspicious AccessMask Requested From LSASS"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/04/23",
            "description": "Detects a Get-Process command on lsass process, which is in almost all cases a sign of malicious activity",
            "detection": {
                "condition": "selection",
                "selection": {
                    "ScriptBlockText|contains": "Get-Process lsass"
                }
            },
            "falsepositives": [
                "Legitimate certificate exports invoked by administrators or users (depends on processes in the environment - filter if unusable)"
            ],
            "id": "84c174ab-d3ef-481f-9c86-a50d0b8e3edb",
            "level": "high",
            "logsource": {
                "category": "ps_script",
                "product": "windows",
                "definition": "Requirements: Script Block Logging must be enabled"
            },
            "modified": "2022/12/25",
            "references": [
                "https://twitter.com/PythonResponder/status/1385064506049630211"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "PowerShell Get-Process LSASS in ScriptBlock"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2021/02/26",
            "description": "Detects changes to the Registry in which a monitor program gets registered to dump the memory of the lsass.exe process",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetObject|contains": "Microsoft\\Windows NT\\CurrentVersion\\SilentProcessExit\\lsass.exe"
                }
            },
            "falsepositives": [
                "Unlikely"
            ],
            "id": "55e29995-75e7-451a-bef0-6225e2f13597",
            "level": "critical",
            "logsource": {
                "category": "registry_event",
                "product": "windows"
            },
            "modified": "2022/12/19",
            "references": [
                "https://www.deepinstinct.com/2021/02/16/lsass-memory-dumps-are-stealthier-than-ever-before-part-2/",
                "https://oddvar.moe/2018/04/10/persistence-using-globalflags-in-image-file-execution-options-hidden-from-autoruns-exe/"
            ],
            "related": [
                {
                    "id": "36803969-5421-41ec-b92f-8500f79c23b0",
                    "type": "similar"
                }
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Potential Credential Dumping Via LSASS SilentProcessExit Technique"
        },
        {
            "author": "Florian Roth (Nextron Systems)",
            "date": "2019/12/31",
            "description": "Detects the use of Windows Credential Editor (WCE)",
            "detection": {
                "condition": "selection",
                "selection": {
                    "TargetObject|contains": "Services\\WCESERVICE\\Start"
                }
            },
            "falsepositives": [
                "Unknown"
            ],
            "id": "a6b33c02-8305-488f-8585-03cb2a7763f2",
            "level": "critical",
            "logsource": {
                "category": "registry_event",
                "product": "windows"
            },
            "modified": "2021/11/27",
            "references": [
                "https://www.ampliasecurity.com/research/windows-credentials-editor/"
            ],
            "status": "test",
            "tags": [
                "attack.credential_access",
                "attack.t1003.001",
                "attack.s0005"
            ],
            "title": "Windows Credential Editor Registry"
        },
        {
            "author": "@pbssubhash",
            "date": "2022/12/08",
            "description": "Detects the setting of the \"DumpType\" registry value to \"2\" which stands for a \"Full Dump\". Technique such as LSASS Shtinkering requires this value to be \"2\" in order to dump LSASS.",
            "detection": {
                "condition": "selection",
                "selection": {
                    "Details": "DWORD (0x00000002)",
                    "TargetObject|contains": [
                        "\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps\\DumpType",
                        "\\SOFTWARE\\Microsoft\\Windows\\Windows Error Reporting\\LocalDumps\\lsass.exe\\DumpType"
                    ]
                }
            },
            "falsepositives": [
                "Legitimate application that needs to do a full dump of their process"
            ],
            "id": "33efc23c-6ea2-4503-8cfe-bdf82ce8f719",
            "level": "high",
            "logsource": {
                "category": "registry_set",
                "product": "windows"
            },
            "modified": "2023/08/17",
            "references": [
                "https://github.com/deepinstinct/Lsass-Shtinkering",
                "https://learn.microsoft.com/en-us/windows/win32/wer/collecting-user-mode-dumps",
                "https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/Asaf%20Gilboa%20-%20LSASS%20Shtinkering%20Abusing%20Windows%20Error%20Reporting%20to%20Dump%20LSASS.pdf"
            ],
            "tags": [
                "attack.credential_access",
                "attack.t1003.001"
            ],
            "status": "test",
            "title": "Lsass Full Dump Request Via DumpType Registry Settings"
        }
    ]
}