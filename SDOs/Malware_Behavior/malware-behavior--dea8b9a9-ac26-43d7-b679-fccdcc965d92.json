{
    "type": "malware-behavior",
    "spec_version": "2.1",
    "id": "malware-behavior--dea8b9a9-ac26-43d7-b679-fccdcc965d92",
    "created": "2024-08-13T14:46:36.985495Z",
    "modified": "2024-08-13T14:46:48.463423Z",
    "name": "Archive Collected Data: Archive via Library",
    "description": "An adversary may compress or encrypt data that is collected prior to exfiltration using 3rd party libraries. Many libraries exist that can archive data, including Python rarfile [1], libzip [2], and zlib [3]. Most libraries include functionality to encrypt and/or compress data.Some archival libraries are preinstalled on systems, such as bzip2 on macOS and Linux, and zip on Windows. Note that the libraries are different from the utilities. The libraries can be linked against when compiling, while the utilities require spawning a subshell, or a similar execution mechanism.",
    "object_marking_refs": [
        "marking-definition--613f2e26-407d-48c7-9eca-b8e91df99dc9"
    ],
    "external_references": [
        {
            "source_name": "MITRE ATT&CK",
            "url": "https://attack.mitre.org/techniques/T1560/002",
            "external_id": "T1560/002"
        }
    ],
    "x_mitre_capa_rules": [
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "RtlDecompressBuffer"
                            },
                            {
                                "string": "RtlDecompressBuffer"
                            },
                            {
                                "api": "RtlDecompressBufferEx"
                            },
                            {
                                "string": "RtlDecompressBufferEx"
                            },
                            {
                                "api": "RtlDecompressBufferEx2"
                            },
                            {
                                "string": "RtlDecompressBufferEx2"
                            },
                            {
                                "api": "RtlCompressBuffer"
                            },
                            {
                                "string": "RtlCompressBuffer"
                            },
                            {
                                "api": "RtlCompressBufferLZNT1"
                            },
                            {
                                "string": "RtlCompressBufferLZNT1"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Collection::Archive Collected Data::Archive via Library [T1560.002]"
                    ],
                    "authors": [
                        "moritz.raabe@mandiant.com"
                    ],
                    "examples": [
                        "638dcc3d37b3a574044233c9637d7288:0x401020"
                    ],
                    "mbc": [
                        "Data::Compress Data [C0024]"
                    ],
                    "name": "compress data via WinAPI",
                    "namespace": "data-manipulation/compression",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    }
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "and": [
                            {
                                "match": "create File Compression Interface context on Windows"
                            },
                            {
                                "or": [
                                    {
                                        "api": "cabinet.FCIAddFile = add file to Cabinet"
                                    },
                                    {
                                        "api": "cabinet.FCIFlushFolder = flush current folder under construction"
                                    },
                                    {
                                        "api": "cabinet.FCIFlushCabinet = complete current cabinet"
                                    },
                                    {
                                        "api": "cabinet.FCIDestroy = delete an open FCI context"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Collection::Archive Collected Data::Archive via Library [T1560.002]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com",
                        "jakub.jozwiak@mandiant.com"
                    ],
                    "examples": [
                        "44bad2e2a9e387b86870f009d01833ea4618d2a7cda5f64fa84a19f3bdf4efaf:0x1400028E0"
                    ],
                    "mbc": [
                        "Data::Compress Data [C0024]"
                    ],
                    "name": "create Cabinet on Windows",
                    "namespace": "data-manipulation/compression",
                    "scopes": {
                        "dynamic": "thread",
                        "static": "function"
                    },
                    "references": [
                        "https://learn.microsoft.com/en-us/windows/win32/devnotes/creating-a-cabinet"
                    ]
                }
            }
        },
        {
            "rule": {
                "features": [
                    {
                        "or": [
                            {
                                "api": "System.IO.Compression.GZipStream::ctor"
                            }
                        ]
                    }
                ],
                "meta": {
                    "att&ck": [
                        "Collection::Archive Collected Data::Archive via Library [T1560.002]"
                    ],
                    "authors": [
                        "michael.hunhoff@mandiant.com"
                    ],
                    "name": "compress data using GZip in .NET",
                    "mbc": [
                        "Data::Compress Data [C0024]"
                    ],
                    "namespace": "data-manipulation/compression",
                    "scopes": {
                        "dynamic": "call",
                        "static": "function"
                    }
                }
            }
        }
    ]
}