{
    "type": "vulnerability",
    "spec_version": "2.1",
    "id": "vulnerability--647e9d74-81b8-469a-a501-190c9127a3c9",
    "created": "2024-08-13T16:05:34.931956Z",
    "modified": "2024-08-13T16:05:34.93196Z",
    "name": "Post-authentication Remote Code Execution (RCE) in ZStack REST API",
    "description": "ZStack is open source IaaS(infrastructure as a service) software aiming to automate datacenters, managing resources of compute, storage, and networking all by APIs. Affected versions of ZStack REST API are vulnerable to post-authentication Remote Code Execution (RCE) via bypass of the Groovy shell sandbox. The REST API exposes the GET zstack/v1/batch-queries?script endpoint which is backed up by the BatchQueryAction class. Messages are represented by the APIBatchQueryMsg, dispatched to the QueryFacadeImpl facade and handled by the BatchQuery class. The HTTP request parameter script is mapped to the APIBatchQueryMsg.script property and evaluated as a Groovy script in BatchQuery.query the evaluation of the user-controlled Groovy script is sandboxed by SandboxTransformer which will apply the restrictions defined in the registered (sandbox.register()) GroovyInterceptor. Even though the sandbox heavily restricts the receiver types to a small set of allowed types, the sandbox is non effective at controlling any code placed in Java annotations and therefore vulnerable to meta-programming escapes. This issue leads to post-authenticated remote code execution. For more details see the referenced GHSL-2021-065. This issue is patched in versions 3.8.21, 3.10.8, and 4.1.0.",
    "external_references": [
        {
            "source_name": "cve",
            "external_id": "CVE-2021-32829"
        }
    ],
    "metrics": [
        {
            "cvssV3_1": {
                "attackComplexity": "LOW",
                "attackVector": "NETWORK",
                "availabilityImpact": "NONE",
                "baseScore": 9.6,
                "baseSeverity": "CRITICAL",
                "confidentialityImpact": "HIGH",
                "integrityImpact": "HIGH",
                "privilegesRequired": "LOW",
                "scope": "CHANGED",
                "userInteraction": "NONE",
                "vectorString": "CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:N",
                "version": "3.1"
            }
        }
    ],
    "references": [
        {
            "tags": [
                "x_refsource_CONFIRM"
            ],
            "url": "https://securitylab.github.com/advisories/GHSL-2021-065-zstack/"
        },
        {
            "tags": [
                "x_refsource_MISC"
            ],
            "url": "https://github.com/zstackio/zstack/security/advisories/GHSA-6xgq-7rqg-x3q5"
        },
        {
            "tags": [
                "x_refsource_MISC"
            ],
            "url": "https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html"
        }
    ]
}