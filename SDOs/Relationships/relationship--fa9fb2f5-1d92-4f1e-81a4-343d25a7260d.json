{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--fa9fb2f5-1d92-4f1e-81a4-343d25a7260d",
    "created": "2024-08-13T14:51:23.448610Z",
    "modified": "2024-08-13T14:51:23.448613Z",
    "relationship_type": "detects",
    "source_ref": "x-mitre-data-component--0935b964-b044-4905-9b60-dc5cc1712193",
    "target_ref": "malware-behavior--5666e9a6-d2be-43ed-823f-b46ebc26dd21",
    "object_marking_refs": [
        "marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168"
    ],
    "external_references": [],
    "description": "Use process monitoring to monitor the execution and command line parameters of binaries involved in inhibiting system recovery, such as `vssadmin`, `wbadmin`, and `bcdedit`. After compromising a network of systems, threat actors often try to delete/resize Shadow Copy in an attempt to prevent administrators from restoring the systems to versions present before the attack. This is often done via vssadmin, a legitimate Windows tool to interact with shadow copies. This action is often employed by ransomware, may lead to a failure in recovering systems after an attack. The pseudo code detection focus on Windows Security and Sysmon process creation (4688 and 1). The use of wmic to delete shadow copy generates WMI-Activity Operationnal 5857 event and could generate 5858 (if the operation fails). These 2 EventIDs could be interesting when attackers use wmic without process creation and/or for forensics.\n\nAnalytic 1 - Detecting Shadow Copy Deletion or Resize\n \n<code>(source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") OR (source=\"*WinEventLog:Security\" EventCode=\"4688\")(CommandLine=\"*vssadmin* *delete* *shadows*\" OR CommandLine=\"*wmic* *shadowcopy* *delete*\" OR CommandLine=\"*vssadmin* *resize* *shadowstorage*\")) OR (EventCode=\"5857\" ProviderName=\"MSVSS__PROVIDER\") OR (EventCode=\"5858\" Operation=\"*Win32_ShadowCopy*\")</code>\n\nAnalytic 2 - BCDEdit Failure Recovery Modification\n \n<code>(source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") OR (source=\"*WinEventLog:Security\" EventCode=\"4688\") Image= \"C:\\Windows\\System32\\bcdedit.exe\" AND CommandLine=\"*recoveryenabled*\"</code>",
    "x_mitre_version": "0.1",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5"
}