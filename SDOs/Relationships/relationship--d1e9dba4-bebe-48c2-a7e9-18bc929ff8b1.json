{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--d1e9dba4-bebe-48c2-a7e9-18bc929ff8b1",
    "created": "2024-08-13T14:51:22.208409Z",
    "modified": "2024-08-13T14:51:22.208412Z",
    "relationship_type": "detects",
    "source_ref": "x-mitre-data-component--0935b964-b044-4905-9b60-dc5cc1712193",
    "target_ref": "malware-behavior--68f7e3a1-f09f-4164-9a62-16b648a0dd5a",
    "object_marking_refs": [
        "marking-definition--fa42a846-8d90-4e51-bc29-71d5b4802168"
    ],
    "external_references": [],
    "description": "Use process monitoring to monitor the execution and arguments of regsvr32.exe. Compare recent invocations of regsvr32.exe with prior history of known good arguments and loaded files to determine anomalous and potentially adversarial activity.\n\nNote: Event IDs are for Sysmon (Event ID 1 - process create) and Windows Security Log (Event ID 4688 - a new process has been created). \n- Analytic 1 is a more generic analytic that looks for suspicious usage of regsvr32.exe, specifically for cases where regsvr32.exe creates child processes that aren\u2019t itself. It\u2019s not likely that this will result in millions of hits, but it does occur during benign activity so some form of baselining would be necessary for this to be useful as an alerting analytic.\n- Analytic 2 is around \u201cSquiblydoo\u201d, which is a specific usage of regsvr32.exe to load a COM scriptlet directly from the internet and execute it in a way that bypasses application whitelisting. It looks for regsvr32.exe process creation events that load scrobj.dll via the command-line (which executes the COM scriptlet).\n- Analytic 3 This uses the same logic as above, but adds lightweight baselining by ignoring all results that also showed up in the previous 30 days (it runs over 1 day).\n- Analytic 4 This looks for child processes that may be spawend by regsvr32, while attempting to eliminate some of the common false positives such as werfault (Windows Error Reporting).\n\nAnalytic 1 - Generic Regsvr32\n\n<code> (source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") OR (source=\"*WinEventLog:Security\" EventCode=\"4688\") regsvr32.exe | search ParentImage=\"*regsvr32.exe\" AND Image!=\"*regsvr32.exe*\"</code>\n\nAnalytic 2 - Squiblydoo\n\n<code>(source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") OR (source=\"*WinEventLog:Security\" EventCode=\"4688\") regsvr32.exe scrobj.dll | search Image=\"*regsvr32.exe\"</code>\n\nAnalyt 3 - New Items since last month \n\n<code>(source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") earliest=-d@d latest=now() regsvr32.exe | search ParentImage=\"*regsvr32.exe\" AND Image!=\"*regsvr32.exe*\" | search NOT [\nsearch (source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") earliest=-60d@d latest=-30d@d regsvr32.exe | search ParentImage=\"*regsvr32.exe\" AND Image!=\"*regsvr32.exe*\" | dedup CommandLine | fields CommandLine ]</code>\n\nAnalytic 4 - Spawning Child Processes \n\n<code>(source=\"*WinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=\"1\") (ParentImage=\"C:\\\\Windows\\\\System32\\\\regsvr32.exe\" OR ParentImage=\"C:\\\\Windows\\\\SysWOW64\\\\regsvr32.exe\") AND Image!=\"C:\\\\Windows\\\\System32\\\\regsvr32.exe\" AND Image!=\"C:\\\\Windows\\\\SysWOW64\\\\regsvr32.exe\" AND Image!=\"C:\\\\WINDOWS\\\\System32\\\\regsvr32.exe\" AND Image!=\"C:\\\\WINDOWS\\\\SysWOW64\\\\regsvr32.exe\" AND Image!=\"C:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\" AND Image!=\"C:\\\\Windows\\\\System32\\\\wevtutil.exe\" AND Image!=\"C:\\\\Windows\\\\System32\\\\WerFault.exe\"|stats values(ComputerName) as \"Computer Name\" values(ParentCommandLine) as \"Parent Command Line\" count(Image) as ImageCount by Image</code>",
    "x_mitre_version": "0.1",
    "x_mitre_modified_by_ref": "identity--c78cb6e5-0c4b-4611-8297-d1b8b55e40b5"
}