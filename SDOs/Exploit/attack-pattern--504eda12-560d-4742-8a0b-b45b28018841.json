{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--504eda12-560d-4742-8a0b-b45b28018841",
    "created": "2024-08-14T16:26:40.465564Z",
    "modified": "2024-08-14T16:26:40.465568Z",
    "name": "LLMNR Query",
    "description": "( This module sends LLMNR queries, which are really just normal UDP DNS queries done (usually) over multicast on a different port, 5355. Targets other than the default RHOSTS' 224.0.0.252 should not respond but may anyway. )",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/llmnr/query.rb",
            "external_id": "query.rb"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::UDPScanner\n  include Msf::Auxiliary::LLMNR\n\n  def initialize(info = {})\n    super(\n      update_info(\n        info,\n        'Name'           => 'LLMNR Query',\n        'Description'    => %q(\n          This module sends LLMNR queries, which are really just normal UDP DNS\n          queries done (usually) over multicast on a different port, 5355.\n          Targets other than the default RHOSTS' 224.0.0.252 should not respond\n          but may anyway.\n        ),\n        'Author'         =>\n          [\n            'Jon Hart <jon_hart[at]rapid7.com>'\n          ],\n        'License'        => MSF_LICENSE\n      )\n    )\n  end\n\n  def scanner_prescan(batch)\n    print_status(\"Sending LLMNR #{query_type_name}/#{query_class_name} queries for #{query_name} to #{batch[0]}->#{batch[-1]} port #{rport} (#{batch.length} hosts)\")\n    @results = {}\n  end\n\n  def scanner_postscan(_batch)\n    found = {}\n    @results.each_pair do |peer, resps|\n      resps.each do |resp|\n        found[peer] ||= {}\n        next if found[peer][resp]\n        response_info = describe_response(resp)\n        print_good(\"#{peer} responded with #{response_info}\")\n        report_service(host: peer, port: rport, proto: \"udp\", name: \"llmnr\", info: response_info)\n        found[peer][resp] = true\n      end\n    end\n  end\nend\n"
}