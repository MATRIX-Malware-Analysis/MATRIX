{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--e9b692f2-ff3c-4201-b1f9-c4d93ab69869",
    "created": "2024-08-14T16:27:48.009744Z",
    "modified": "2024-08-14T16:27:48.009747Z",
    "name": "NTP Mode 7 GET_RESTRICT DRDoS Scanner",
    "description": " This module identifies NTP servers which permit \"reslist\" queries and obtains the list of restrictions placed on various network interfaces networks or hosts. The reslist feature allows remote attackers to cause a distributed, reflected denial of service (aka, \"DRDoS\" or traffic amplification) via spoofed requests. The more interfaces, networks or hosts with specific restrictions, the greater the amplification. requests. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/ntp/ntp_reslist_dos.rb",
            "external_id": "ntp_reslist_dos.rb"
        },
        {
            "source_name": "reference",
            "url": "https://github.com/rapid7/metasploit-framework/pull/3696"
        },
        {
            "source_name": "reference",
            "url": "https://www.rapid7.com/blog/post/2014/08/25/r7-2014-12-more-amplification-vulnerabilities-in-ntp-allow-even-more-drdos-attacks/"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Auxiliary::Report\n  include Msf::Exploit::Remote::Udp\n  include Msf::Auxiliary::UDPScanner\n  include Msf::Auxiliary::NTP\n  include Msf::Auxiliary::DRDoS\n\n  def initialize\n    super(\n      'Name'           => 'NTP Mode 7 GET_RESTRICT DRDoS Scanner',\n      'Description'    => %q{\n        This module identifies NTP servers which permit \"reslist\" queries and\n        obtains the list of restrictions placed on various network interfaces,\n        networks or hosts. The reslist feature allows remote\n        attackers to cause a distributed, reflected denial of service (aka, \"DRDoS\" or\n        traffic amplification) via spoofed requests. The more interfaces, networks\n        or hosts with specific restrictions, the greater the amplification.\n        requests.\n      },\n      'Author'         => 'Jon Hart <jon_hart[at]rapid7.com>',\n      'References'     =>\n        [\n          ['CVE', '2013-5211'], # see also scanner/ntp/ntp_monlist.rb\n          ['URL', 'https://github.com/rapid7/metasploit-framework/pull/3696'],\n          ['URL', 'https://www.rapid7.com/blog/post/2014/08/25/r7-2014-12-more-amplification-vulnerabilities-in-ntp-allow-even-more-drdos-attacks/']\n        ],\n      'DisclosureDate' => 'Aug 25 2014',\n      'License'        => MSF_LICENSE\n    )\n  end\n\n  # Called for each response packet\n  def scanner_process(data, shost, sport)\n    @results[shost] ||= []\n    privmsg = Rex::Proto::NTP::NTPPrivate.new.read(data)\n    @results[shost] << privmsg.to_binary_s\n  end\n\n  # Called before the scan block\n  def scanner_prescan(batch)\n    @results = {}\n    @probe = Rex::Proto::NTP.ntp_private(datastore['VERSION'], datastore['IMPLEMENTATION'], 16).to_binary_s\n  end\n\n  # Called after the scan block\n  def scanner_postscan(batch)\n    @results.keys.each do |k|\n      response_map = { @probe => @results[k] }\n      # TODO: check to see if any of the responses are actually NTP before reporting\n      report_service(\n        :host  => k,\n        :proto => 'udp',\n        :port  => rport,\n        :name  => 'ntp'\n      )\n\n      peer = \"#{k}:#{rport}\"\n      vulnerable, proof = prove_amplification(response_map)\n      what = 'R7-2014-12 NTP Mode 7 GET_RESTRICT DRDoS'\n      if vulnerable\n        print_good(\"#{peer} - Vulnerable to #{what}: #{proof}\")\n        report_vuln({\n          :host  => k,\n          :port  => rport,\n          :proto => 'udp',\n          :name  => what,\n          :refs  => self.references\n        })\n      else\n        vprint_status(\"#{peer} - Not vulnerable to #{what}: #{proof}\")\n      end\n    end\n  end\nend\n",
    "x_mitre_disclosure_date": "Aug 25 2014"
}