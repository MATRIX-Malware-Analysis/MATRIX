{
    "data": [
        {
            "id": "8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6_CAPA",
            "type": "file_behaviour",
            "links": {
                "self": "https://www.virustotal.com/api/v3/file_behaviours/8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6_CAPA"
            },
            "attributes": {
                "sandbox_name": "CAPA",
                "signature_matches": [
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "calculate modulo 256 via x86 assembly",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: calculate modulo 256 via x86 assembly\n    authors:\n      - moritz.raabe@mandiant.com\n    lib: true\n    scopes:\n      static: instruction\n      dynamic: unsupported  # requires mnemonic features\n    mbc:\n      - Data::Modulo [C0058]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4049A9\n  features:\n    #  and ecx, 800000FFh\n    #  and ecx, 0FFh\n    - and:\n      - mnemonic: and\n      - or:\n        - number: 0x800000FF\n        - number: 0xFF\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "generate random numbers using the Delphi LCG",
                        "description": "data-manipulation/prng/lcg",
                        "authors": [
                            "william.ballenthin@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: generate random numbers using the Delphi LCG\n    namespace: data-manipulation/prng/lcg\n    authors:\n      - william.ballenthin@mandiant.com\n    scopes:\n      static: basic block\n      dynamic: unsupported  # requires mnemonic features\n    mbc:\n      - Cryptography::Generate Pseudo-random Sequence [C0021]\n    references:\n      - https://en.wikipedia.org/wiki/Linear_congruential_generator\n      - https://community.osr.com/discussion/130410/generating-random-numbers\n  features:\n    - and:\n      - instruction:\n        - mnemonic: imul\n        - number: 0x8088405 = multiplier a\n      - mnemonic: inc = increment c\n",
                        "refs": [
                            {
                                "ref": "https://en.wikipedia.org/wiki/Linear_congruential_generator"
                            },
                            {
                                "ref": "https://community.osr.com/discussion/130410/generating-random-numbers"
                            }
                        ]
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "PEB access",
                        "authors": [
                            "michael.hunhoff@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: PEB access\n    authors:\n      - michael.hunhoff@mandiant.com\n    lib: true\n    scopes:\n      static: basic block\n      dynamic: unsupported  # requires characteristic, offset, mnemonic features\n    mbc:\n      - Anti-Behavioral Analysis::Debugger Detection::Process Environment Block [B0001.019]\n    references:\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp\n    examples:\n      - al-khaser_x86.exe_:0x420D20\n  features:\n    - or:\n      - characteristic: peb access\n      - and:\n        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L41\n        - arch: i386\n        - characteristic: fs access\n        - or:\n          # in 0f5d5d07c6533bc6d991836ce79daaa1\n          # then we have:\n          #\n          #     xor edx, edx\n          #     mov edx, fs:[edx+30h]\n          - offset: 0x30\n          - instruction:\n            # in the case of CallObfuscator, gs:[rax]\n            - mnemonic: add\n            - number: 0x30\n      - and:\n        - arch: amd64\n        - characteristic: gs access\n        - or:\n          - offset: 0x60\n          - instruction:\n            - mnemonic: add\n            - number: 0x60\n      - and:\n        # WoW64 PEB address is fetched via the WoW64 Thread Environment Block (TEB) at FS:[0x18]-0x2000\n        # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp#L45\n        - characteristic: fs access\n        - instruction:\n          - mnemonic: sub\n          - number: 0x2000\n",
                        "refs": [
                            {
                                "ref": "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp"
                            }
                        ]
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "encode data using XOR",
                        "description": "data-manipulation/encoding/xor",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: encode data using XOR\n    namespace: data-manipulation/encoding/xor\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: basic block\n      dynamic: unsupported  # requires characteristic, Not features\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information [T1027]\n    mbc:\n      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]\n      - Data::Encode Data::XOR [C0026.002]\n    examples:\n      - 2D3EDC218A90F03089CC01715A9F047F:0x403D7E\n  features:\n    - and:\n      - characteristic: tight loop\n      - characteristic: nzxor\n      - not:\n        - description: filter for potential false positives\n        - or:\n          - or:\n            - description: unsigned bitwise negation operation (~i)\n            - number: 0xFFFFFFFF = bitwise negation for unsigned 32 bits\n            - number: 0xFFFFFFFFFFFFFFFF = bitwise negation for unsigned 64 bits\n          - or:\n            - description: signed bitwise negation operation (~i)\n            - number: 0x0FFFFFFF = bitwise negation for signed 32 bits\n            - number: 0x0FFFFFFFFFFFFFFF = bitwise negation for signed 64 bits\n          - or:\n            - description: Magic constants used in the implementation of strings functions.\n            # such as `strlen` and `strcat` in the Windows standard library:\n            # (((i - 0x81010101) ^ ~i) & 0x81010100)\n            ## 32 bits\n            - number: 0x7EFEFEFF = optimized string constant for 32 bits\n            - number: 0x81010101 = -0x81010101 = 0x7EFEFEFF\n            - number: 0x81010100 = 0x81010100 = ~0x7EFEFEFF\n            ## 64 bits\n            - number: 0x7EFEFEFEFEFEFEFF = optimized string constant for 64 bits\n            - number: 0x8101010101010101 = -0x8101010101010101 = 0x7EFEFEFEFEFEFEFF\n            - number: 0x8101010101010100 = 0x8101010101010100 = ~0x7EFEFEFEFEFEFEFF\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "contain loop",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: contain loop\n    authors:\n      - moritz.raabe@mandiant.com\n    lib: true\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic features\n    examples:\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\n  features:\n    - or:\n      - characteristic: loop\n      - characteristic: tight loop\n      - characteristic: recursive call\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "encrypt data using RC4 PRGA",
                        "description": "data-manipulation/encryption/rc4",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: encrypt data using RC4 PRGA\n    namespace: data-manipulation/encryption/rc4\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic, mnemonic, basicblock features\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information [T1027]\n    mbc:\n      - Cryptography::Encrypt Data::RC4 [C0027.009]\n      - Cryptography::Generate Pseudo-random Sequence::RC4 PRGA [C0021.004]\n    examples:\n      - 34404A3FB9804977C6AB86CB991FB130:0x403DB0\n      - 34404A3FB9804977C6AB86CB991FB130:0x403E50\n      - 9324D1A8AE37A36AE560C37448C9705A:0x4049F0\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x4064C6\n  features:\n    - and:\n      # TODO: maybe add characteristic for nzxor reg size\n      - count(characteristic(nzxor)): 1\n      - or:\n        - match: calculate modulo 256 via x86 assembly\n        # compiler may do this via zero-extended mov from 8-bit register\n        - count(mnemonic(movzx)): 4 or more\n      # should not call (many) functions\n      - count(characteristic(calls from)): (0, 4)\n      # should not be too simple or too complex (50 is picked by intuition)\n      - count(basic blocks): (4, 50)\n      - match: contain loop\n      - optional:\n        - or:\n          - number: 0xFF\n          - number: 0x100\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "get number of processors",
                        "description": "host-interaction/hardware/cpu",
                        "authors": [
                            "michael.hunhoff@mandiant.com",
                            "anushka.virgaonkar@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: get number of processors\n    namespace: host-interaction/hardware/cpu\n    authors:\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires property features\n    att&ck:\n      - Discovery::System Information Discovery [T1082]\n    references:\n      - https://github.com/LordNoteworthy/al-khaser/blob/bed03d2f849d9060c68f8d5905bd204d0cb3f593/al-khaser/AntiVM/Generic.cpp#L361\n    examples:\n      - al-khaser_x86.exe_:0x432CB0\n  features:\n    - or:\n      - and:\n        - match: PEB access\n        - or:\n          - and:\n            - arch: i386\n            - number: 0x64 = PEB->NumberOfProcessors\n          - and:\n            - arch: amd64\n            - number: 0xB8 = PEB->NumberOfProcessors\n      - property/read: System.Environment::ProcessorCount\n",
                        "refs": [
                            {
                                "ref": "https://github.com/LordNoteworthy/al-khaser/blob/bed03d2f849d9060c68f8d5905bd204d0cb3f593/al-khaser/AntiVM/Generic.cpp#L361"
                            }
                        ]
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "parse PE header",
                        "description": "load-code/pe",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: parse PE header\n    namespace: load-code/pe\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires mnemonic, operand[1].offset features\n    att&ck:\n      - Execution::Shared Modules [T1129]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x403DD0\n  features:\n    - and:\n      - os: windows\n      - and:\n        - mnemonic: cmp\n        - or:\n          - number: 0x4550 = IMAGE_NT_SIGNATURE (PE)\n          - and:\n            - number: 0x50\n            - number: 0x45\n        - or:\n          - number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ)\n          - and:\n            - number: 0x4D\n            - number: 0x5A\n        - optional:\n          - and:\n            - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew\n            - or:\n              - and:\n                - arch: i386\n                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage\n                - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\n              - and:\n                - arch: amd64\n                - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage\n                - operand[1].offset: 0x30 = IMAGE_NT_HEADERS64.OptionalHeader.ImageBase\n          - basic block:\n            - and:\n              - operand[1].offset: 0x3C = IMAGE_DOS_HEADER.e_lfanew\n              - 3 or more:\n                - operand[1].offset: 0x4 = IMAGE_NT_HEADERS.FileHeader.Machine\n                - operand[1].offset: 0x6 = IMAGE_NT_HEADERS.FileHeader.NumberOfSections\n                - operand[1].offset: 0x14 = IMAGE_NT_HEADERS.FileHeader.SizeOfOptionalHeader\n                - operand[1].offset: 0x16 = IMAGE_NT_HEADERS.FileHeader.Characteristics\n                - operand[1].offset: 0x28 = IMAGE_NT_HEADERS.OptionalHeader.AddressOfEntryPoint  # for 32 and 64 bit\n                - or:\n                  - and:\n                    - arch: i386\n                    - operand[1].offset: 0x34 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\n                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS.OptionalHeader.SizeOfImage\n                  - and:\n                    - arch: amd64\n                    - operand[1].offset: 0x30 = IMAGE_NT_HEADERS.OptionalHeader.ImageBase\n                    - operand[1].offset: 0x50 = IMAGE_NT_HEADERS64.OptionalHeader.SizeOfImage\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "persist via Run registry key",
                        "description": "persistence/registry/run",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: persist via Run registry key\n    namespace: persistence/registry/run\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: function\n      dynamic: thread\n    att&ck:\n      - Persistence::Boot or Logon Autostart Execution::Registry Run Keys / Startup Folder [T1547.001]\n    mbc:\n      - Persistence::Registry Run Keys / Startup Folder [F0012]\n    examples:\n      - Practical Malware Analysis Lab 06-03.exe_:0x401130\n      - b87e9dd18a5533a09d3e48a7a1efbcf6:0x1400070E0\n      - 9ff8e68343cc29c1036650fc153e69f7:0x470624\n  features:\n    - and:\n      - or:\n        - match: set registry value\n        - number: 0x80000001 = HKEY_CURRENT_USER\n        - number: 0x80000002 = HKEY_LOCAL_MACHINE\n      - or:\n        - and:\n          - string: /Software\\\\Microsoft\\\\Windows\\\\CurrentVersion/i\n          - or:\n            - string: /Run/i\n            - string: /Explorer\\\\Shell Folders/i\n            - string: /User Shell Folders/i\n            - string: /RunServices/i\n            - string: /Policies\\\\Explorer\\\\Run/i\n        - string: /Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows\\\\load/i\n        - string: /System\\\\CurrentControlSet\\\\Control\\\\Session Manager\\\\BootExecute/i\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "encrypt data using RC4 KSA",
                        "description": "data-manipulation/encryption/rc4",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: encrypt data using RC4 KSA\n    namespace: data-manipulation/encryption/rc4\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported  # requires characteristic, mnemonic, Not features\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information [T1027]\n    mbc:\n      - Cryptography::Encrypt Data::RC4 [C0027.009]\n      - Cryptography::Encryption Key::RC4 KSA [C0028.002]\n    examples:\n      - 34404A3FB9804977C6AB86CB991FB130:0x403D40\n      - 9324D1A8AE37A36AE560C37448C9705A:0x404950\n      - 2B8BEC5BCB1777EAA155D832F7AFC797:0x405C42\n      - 73CE04892E5F39EC82B00C02FC04C70F:0x40646E\n  features:\n    - or:\n      - and:\n        - basic block:\n          - and:\n            - description: initialize S\n            # misses if regular loop is used,\n            # however we cannot model that a loop contains a certain number\n            - characteristic: tight loop\n            - or:\n              - number: 0xFF\n              - number: 0x100\n        - or:\n          - description: modulo 256\n          - match: calculate modulo 256 via x86 assembly\n          - basic block:\n            - and:\n              - description: modulo via zero-extended mov from 8-bit register\n              - count(mnemonic(movzx)): 2 or more\n              # avoid false positives; filter out unexpected instructions\n              - not:\n                - or:\n                  - mnemonic: shl\n                  - mnemonic: rol\n                  - characteristic: nzxor\n        - or:\n          - description: modulo key length\n          - mnemonic: div\n          - mnemonic: idiv\n      - and:\n        - description: write DWORDs instead of bytes\n        - or:\n          - number: 0x03020100\n          - number: 0xFFFEFDFC\n        - instruction:\n          - or:\n            - mnemonic: add\n            - mnemonic: sub\n          - number: 0x04040404\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "persist via Winlogon Helper DLL registry key",
                        "description": "persistence/registry/winlogon-helper",
                        "authors": [
                            "0x534a@mailbox.org"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: persist via Winlogon Helper DLL registry key\n    namespace: persistence/registry/winlogon-helper\n    authors:\n      - 0x534a@mailbox.org\n    scopes:\n      static: function\n      dynamic: thread\n    att&ck:\n      - Persistence::Boot or Logon Autostart Execution::Winlogon Helper DLL [T1547.004]\n    examples:\n      - 9ff8e68343cc29c1036650fc153e69f7:0x47f818\n  features:\n    - and:\n      - or:\n        - match: set registry value\n        - number: 0x80000001 = HKEY_CURRENT_USER\n        - number: 0x80000002 = HKEY_LOCAL_MACHINE\n      - string: /Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon/i\n      - or:\n        - string: /Notify/i\n        - string: /Userinit/i\n        - string: /Shell/i\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "packed with generic packer",
                        "description": "anti-analysis/packer/generic",
                        "authors": [
                            "william.ballenthin@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: packed with generic packer\n    namespace: anti-analysis/packer/generic\n    authors:\n      - william.ballenthin@mandiant.com\n    scopes:\n      static: function\n      dynamic: unsupported\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]\n    mbc:\n      - Anti-Static Analysis::Software Packing::Standard Compression [F0001.002]\n    examples:\n      - Practical Malware Analysis Lab 18-01.exe_:0x409dc0\n  features:\n    - and:\n      - or:\n        - mnemonic: pusha\n        - mnemonic: pushad  # vivisect\n      - or:\n        - mnemonic: popa\n        - mnemonic: popad  # vivisect\n      - characteristic: cross section flow\n      - not:\n        - match: contain pusha popa sequence\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "packed with UPX",
                        "description": "anti-analysis/packer/upx",
                        "authors": [
                            "william.ballenthin@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: packed with UPX\n    namespace: anti-analysis/packer/upx\n    authors:\n      - william.ballenthin@mandiant.com\n    scopes:\n      static: file\n      dynamic: file\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information::Software Packing [T1027.002]\n    mbc:\n      - Anti-Static Analysis::Software Packing::UPX [F0001.008]\n    examples:\n      - CD2CBA9E6313E8DF2C1273593E649682\n      - Practical Malware Analysis Lab 01-02.exe_:0x0401000\n  features:\n    - or:\n      - and:\n        - format: pe\n        - or:\n          - section: UPX0\n          - section: UPX1\n      - and:\n        - format: elf\n        - or:\n          - string: \"UPX!\"\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "reference anti-VM strings targeting Xen",
                        "description": "anti-analysis/anti-vm/vm-detection",
                        "authors": [
                            "michael.hunhoff@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: reference anti-VM strings targeting Xen\n    namespace: anti-analysis/anti-vm/vm-detection\n    authors:\n      - michael.hunhoff@mandiant.com\n    scopes:\n      static: file\n      dynamic: file\n    att&ck:\n      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]\n    mbc:\n      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]\n    references:\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Xen.cpp\n    examples:\n      - al-khaser_x86.exe_\n  features:\n    - or:\n      - string: /^Xen/i\n      - string: /XenVMMXenVMM/i\n      - string: /xenservice.exe/i\n      - string: /XenVMMXenVMM/i\n      - string: /HVM domU/i\n",
                        "refs": [
                            {
                                "ref": "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Xen.cpp"
                            }
                        ]
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "linked against ZLIB",
                        "description": "linking/static/zlib",
                        "authors": [
                            "william.ballenthin@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: linked against ZLIB\n    namespace: linking/static/zlib\n    authors:\n      - william.ballenthin@mandiant.com\n    scopes:\n      static: file\n      dynamic: file\n    mbc:\n      - Data::Compression Library [C0060]\n    examples:\n      - 6cc148363200798a12091b97a17181a1\n  features:\n    - or:\n      - string: /deflate .* Copyright/\n      - string: /inflate .* Copyright/\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "compiled with Borland Delphi",
                        "description": "compiler/delphi",
                        "authors": [
                            "william.ballenthin@mandiant.com",
                            "@mr-tz"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: compiled with Borland Delphi\n    namespace: compiler/delphi\n    authors:\n      - william.ballenthin@mandiant.com\n      - \"@mr-tz\"\n    scopes:\n      static: file\n      dynamic: file\n    examples:\n      - 4BDD67FF852C221112337FECD0681EAC\n  features:\n    - or:\n      - string: \"Borland C++ - Copyright 2002 Borland Corporation\"\n      - string: \"Sysutils::Exception\"\n      - string: \"TForm1\"\n      - import: \"BORLNDMM.DLL\"\n      - substring: \"SOFTWARE\\\\Borland\\\\Delphi\\\\RTL\"\n      - substring: \"Embarcadero Delphi for Win32 compiler\"\n"
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "reference anti-VM strings",
                        "description": "anti-analysis/anti-vm/vm-detection",
                        "authors": [
                            "moritz.raabe@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: reference anti-VM strings\n    namespace: anti-analysis/anti-vm/vm-detection\n    authors:\n      - moritz.raabe@mandiant.com\n    scopes:\n      static: file\n      dynamic: file\n    att&ck:\n      - Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]\n    mbc:\n      - Anti-Behavioral Analysis::Virtual Machine Detection [B0009]\n    references:\n      - https://github.com/ctxis/CAPE/blob/master/modules/signatures/antivm_*\n      - https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp\n    examples:\n      - Practical Malware Analysis Lab 17-02.dll_\n  features:\n    - or:\n      - string: /HARDWARE\\\\ACPI\\\\(DSDT|FADT|RSDT)\\\\BOCHS/i\n      - string: /HARDWARE\\\\DESCRIPTION\\\\System\\\\(SystemBiosVersion|VideoBiosVersion)/i\n      - string: /HARDWARE\\\\DESCRIPTION\\\\System\\\\CentralProcessor/i\n      - string: /HARDWARE\\\\DEVICEMAP\\\\Scsi\\\\Scsi Port 0\\\\Scsi Bus 0\\\\Target Id 0\\\\Logical Unit Id 0/i\n      - string: /SYSTEM\\\\(CurrentControlSet|ControlSet001)\\\\Enum\\\\IDE/i\n      - string: /SYSTEM\\\\(CurrentControlSet|ControlSet001)\\\\Services\\\\Disk\\\\Enum\\\\/i\n      - string: /SYSTEM\\\\(CurrentControlSet|ControlSet001)\\\\Control\\\\SystemInformation\\\\SystemManufacturer/i\n      - string: /A M I/i\n      - string: /Hyper-V/i\n      - string: /Kernel-VMDetection-Private/i\n      # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L699\n      - string: /KVMKVMKVM/i\n        description: KVM\n      - string: /Microsoft Hv/i\n        description: Microsoft Hyper-V or Windows Virtual PC\n      # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L8\n      - string: /avghookx.dll/i\n        description: AVG\n      - string: /avghooka.dll/i\n        description: AVG\n      - string: /snxhk.dll/i\n        description: Avast\n      - string: /pstorec.dll/i\n        description: SunBelt Sandbox\n      - string: /vmcheck.dll/i\n        description: Virtual PC\n      - string: /wpespy.dll/i\n        description: WPE Pro\n      - string: /cmdvrt64.dll/i\n        description: Comodo Container\n      - string: /cmdvrt32.dll/i\n        description: Comodo Container\n      # https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp#L46\n      - string: /sample.exe/i\n      - string: /bot.exe/i\n      - string: /sandbox.exe/i\n      - string: /malware.exe/i\n      - string: /test.exe/i\n      - string: /klavme.exe/i\n      - string: /myapp.exe/i\n      - string: /testapp.exe/i\n",
                        "refs": [
                            {
                                "ref": "https://github.com/ctxis/CAPE/blob/master/modules/signatures/antivm_*"
                            },
                            {
                                "ref": "https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Generic.cpp"
                            }
                        ]
                    },
                    {
                        "format": "SIG_FORMAT_CAPA",
                        "name": "(internal) packer file limitation",
                        "description": "internal/limitation/file : This sample appears to be packed.\n\nPacked samples have often been obfuscated to hide their logic.\ncapa cannot handle obfuscation well using static analysis. This means the results may be misleading or incomplete.\nIf possible, you should try to unpack this input file before analyzing it with capa.\nAlternatively, run the sample in a supported sandbox and invoke capa against the report to obtain dynamic analysis results.\n",
                        "authors": [
                            "william.ballenthin@mandiant.com"
                        ],
                        "rule_src": "rule:\n  meta:\n    name: (internal) packer file limitation\n    namespace: internal/limitation/file\n    authors:\n      - william.ballenthin@mandiant.com\n    description: |\n      This sample appears to be packed.\n\n      Packed samples have often been obfuscated to hide their logic.\n      capa cannot handle obfuscation well using static analysis. This means the results may be misleading or incomplete.\n      If possible, you should try to unpack this input file before analyzing it with capa.\n      Alternatively, run the sample in a supported sandbox and invoke capa against the report to obtain dynamic analysis results.\n    scopes:\n      static: file\n      dynamic: file\n    examples:\n      - CD2CBA9E6313E8DF2C1273593E649682\n  features:\n    - or:\n      - match: anti-analysis/packer\n"
                    }
                ],
                "has_evtx": false,
                "analysis_date": 1712850796,
                "mbc": [
                    {
                        "id": "C0058",
                        "objective": "Data",
                        "behavior": "Modulo",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "calculate modulo 256 via x86 assembly"
                            }
                        ]
                    },
                    {
                        "id": "C0021",
                        "objective": "Cryptography",
                        "behavior": "Generate Pseudo-random Sequence",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "generate random numbers using the Delphi LCG"
                            }
                        ]
                    },
                    {
                        "id": "B0001.019",
                        "objective": "Anti-Behavioral Analysis",
                        "behavior": "Debugger Detection",
                        "method": "Process Environment Block",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "PEB access"
                            }
                        ]
                    },
                    {
                        "id": "E1027.m02",
                        "objective": "Defense Evasion",
                        "behavior": "Obfuscated Files or Information",
                        "method": "Encoding-Standard Algorithm",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encode data using XOR"
                            }
                        ]
                    },
                    {
                        "id": "C0026.002",
                        "objective": "Data",
                        "behavior": "Encode Data",
                        "method": "XOR",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encode data using XOR"
                            }
                        ]
                    },
                    {
                        "id": "C0027.009",
                        "objective": "Cryptography",
                        "behavior": "Encrypt Data",
                        "method": "RC4",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encrypt data using RC4 PRGA"
                            }
                        ]
                    },
                    {
                        "id": "C0021.004",
                        "objective": "Cryptography",
                        "behavior": "Generate Pseudo-random Sequence",
                        "method": "RC4 PRGA",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encrypt data using RC4 PRGA"
                            }
                        ]
                    },
                    {
                        "id": "F0012",
                        "objective": "Persistence",
                        "behavior": "Registry Run Keys / Startup Folder",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "persist via Run registry key"
                            }
                        ]
                    },
                    {
                        "id": "C0027.009",
                        "objective": "Cryptography",
                        "behavior": "Encrypt Data",
                        "method": "RC4",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encrypt data using RC4 KSA"
                            }
                        ]
                    },
                    {
                        "id": "C0028.002",
                        "objective": "Cryptography",
                        "behavior": "Encryption Key",
                        "method": "RC4 KSA",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encrypt data using RC4 KSA"
                            }
                        ]
                    },
                    {
                        "id": "F0001.002",
                        "objective": "Anti-Static Analysis",
                        "behavior": "Software Packing",
                        "method": "Standard Compression",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "packed with generic packer"
                            }
                        ]
                    },
                    {
                        "id": "F0001.008",
                        "objective": "Anti-Static Analysis",
                        "behavior": "Software Packing",
                        "method": "UPX",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "packed with UPX"
                            }
                        ]
                    },
                    {
                        "id": "B0009",
                        "objective": "Anti-Behavioral Analysis",
                        "behavior": "Virtual Machine Detection",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "reference anti-VM strings targeting Xen"
                            }
                        ]
                    },
                    {
                        "id": "C0060",
                        "objective": "Data",
                        "behavior": "Compression Library",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "linked against ZLIB"
                            }
                        ]
                    },
                    {
                        "id": "B0009",
                        "objective": "Anti-Behavioral Analysis",
                        "behavior": "Virtual Machine Detection",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "reference anti-VM strings"
                            }
                        ]
                    }
                ],
                "mitre_attack_techniques": [
                    {
                        "id": "T1027",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "encode data using XOR",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encode data using XOR"
                            }
                        ]
                    },
                    {
                        "id": "T1027",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "encrypt data using RC4 PRGA",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encrypt data using RC4 PRGA"
                            }
                        ]
                    },
                    {
                        "id": "T1082",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "get number of processors",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "get number of processors"
                            }
                        ]
                    },
                    {
                        "id": "T1129",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "parse PE header",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "parse PE header"
                            }
                        ]
                    },
                    {
                        "id": "T1547.001",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "persist via Run registry key",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "persist via Run registry key"
                            }
                        ]
                    },
                    {
                        "id": "T1027",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "encrypt data using RC4 KSA",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "encrypt data using RC4 KSA"
                            }
                        ]
                    },
                    {
                        "id": "T1547.004",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "persist via Winlogon Helper DLL registry key",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "persist via Winlogon Helper DLL registry key"
                            }
                        ]
                    },
                    {
                        "id": "T1027.002",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "packed with generic packer",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "packed with generic packer"
                            }
                        ]
                    },
                    {
                        "id": "T1027.002",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "packed with UPX",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "packed with UPX"
                            }
                        ]
                    },
                    {
                        "id": "T1497.001",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "reference anti-VM strings targeting Xen",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "reference anti-VM strings targeting Xen"
                            }
                        ]
                    },
                    {
                        "id": "T1497.001",
                        "severity": "IMPACT_SEVERITY_INFO",
                        "signature_description": "reference anti-VM strings",
                        "refs": [
                            {
                                "ref": "#signature_matches",
                                "value": "reference anti-VM strings"
                            }
                        ]
                    }
                ],
                "last_modification_date": 1712850796,
                "behash": "cb4ce0efea9120f73803acff2d29baa9",
                "has_html_report": false,
                "has_memdump": false,
                "has_pcap": false
            }
        },
        {
            "id": "8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6_VMRay",
            "type": "file_behaviour",
            "links": {
                "self": "https://www.virustotal.com/api/v3/file_behaviours/8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6_VMRay"
            },
            "attributes": {
                "sandbox_name": "VMRay",
                "verdict_labels": [
                    "DarkComet"
                ],
                "signature_matches": [
                    {
                        "id": "vti_match_0",
                        "format": "SIG_FORMAT_YARA",
                        "name": "Malicious content matched by YARA rules",
                        "description": "YARA detected \"DarkComet_1\" from ruleset \"RATs\" in the sample file C:\\Users\\RDhJ0CNFevzX\\Desktop\\8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6.exe.",
                        "severity": "IMPACT_SEVERITY_HIGH",
                        "refs": [
                            {
                                "ref": "#files_dropped",
                                "value": "8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6"
                            },
                            {
                                "ref": "#process_tree",
                                "value": "\"C:\\Users\\RDhJ0CNFevzX\\Desktop\\8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6.exe\""
                            }
                        ]
                    },
                    {
                        "id": "vti_match_1",
                        "format": "SIG_FORMAT_YARA",
                        "name": "Malicious content matched by YARA rules",
                        "description": "YARA detected \"RAT_DarkComet\" from ruleset \"RATs\" in the sample file C:\\Users\\RDhJ0CNFevzX\\Desktop\\8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6.exe.",
                        "severity": "IMPACT_SEVERITY_HIGH",
                        "refs": [
                            {
                                "ref": "#files_dropped",
                                "value": "8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6"
                            },
                            {
                                "ref": "#process_tree",
                                "value": "\"C:\\Users\\RDhJ0CNFevzX\\Desktop\\8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6.exe\""
                            }
                        ]
                    }
                ],
                "has_evtx": false,
                "analysis_date": 1712850576,
                "last_modification_date": 1712854565,
                "verdicts": [
                    "MALWARE"
                ],
                "behash": "af0426fa43cc1c46a73083071d8c18ac",
                "processes_tree": [
                    {
                        "process_id": "4576",
                        "name": "\"C:\\Users\\RDhJ0CNFevzX\\Desktop\\8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6.exe\" "
                    }
                ],
                "has_html_report": false,
                "has_memdump": false,
                "has_pcap": false
            }
        },
        {
            "id": "8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6_Yomi Hunter",
            "type": "file_behaviour",
            "links": {
                "self": "https://www.virustotal.com/api/v3/file_behaviours/8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6_Yomi Hunter"
            },
            "attributes": {
                "sandbox_name": "Yomi Hunter",
                "has_evtx": true,
                "analysis_date": 1712875172,
                "dns_lookups": [
                    {
                        "hostname": "crt.sectigo.com",
                        "resolved_ips": [
                            "104.18.38.233"
                        ]
                    }
                ],
                "mitre_attack_techniques": [
                    {
                        "id": "T1045",
                        "signature_description": "Manalize Local SandBox Packer Harvesting"
                    },
                    {
                        "id": "T1059",
                        "signature_description": "Apparent Internal Usage of CMD.EXE"
                    }
                ],
                "last_modification_date": 1712868030,
                "verdicts": [
                    "MALWARE"
                ],
                "behash": "64d125374b9ead71d044480b8f001d90",
                "http_conversations": [
                    {
                        "url": "http://crt.sectigo.com/SectigoPublicCodeSigningCAR36.crt",
                        "request_method": "GET",
                        "request_headers": {
                            "User-Agent": "Microsoft-CryptoAPI/6.1",
                            "Host": "crt.sectigo.com"
                        },
                        "response_headers": {
                            "Content-Length": "1566",
                            "Content-Type": "application/pkix-cert"
                        },
                        "response_status_code": 200
                    },
                    {
                        "url": "http://crt.sectigo.com/SectigoPublicCodeSigningRootR46.p7c",
                        "request_method": "GET",
                        "request_headers": {
                            "User-Agent": "Microsoft-CryptoAPI/6.1",
                            "Host": "crt.sectigo.com"
                        },
                        "response_headers": {
                            "Content-Length": "4515",
                            "Content-Type": "application/pkcs7-mime"
                        },
                        "response_status_code": 200
                    }
                ],
                "files_dropped": [
                    {
                        "path": "/msdownload/update/v3/static/trustedr/en/authrootstl.cab",
                        "sha256": "1ed81fa8dfb6999a9fedc6e779138ffd99568992e22d300acd181a6d2c8de184",
                        "type": "CAB",
                        "download_url": "ctldl.windowsupdate.comhttp://ctldl.windowsupdate.com/msdownload/update/v3/static/trustedr/en/authrootstl.cab?ea333a613ba166f8"
                    }
                ],
                "has_html_report": true,
                "has_memdump": false,
                "has_pcap": true
            }
        }
    ],
    "meta": {
        "count": 3
    },
    "links": {
        "self": "https://www.virustotal.com/api/v3/files/8d9fe5e4e626557b2af4d169518fd65b588638ebeaa41a7752a236a27f8b7cd6/behaviours?limit=10"
    }
}